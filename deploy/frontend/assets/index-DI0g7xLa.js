var zk=Object.defineProperty;var Cf=t=>{throw TypeError(t)};var Vk=(t,e,n)=>e in t?zk(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var de=(t,e,n)=>Vk(t,typeof e!="symbol"?e+"":e,n),gl=(t,e,n)=>e.has(t)||Cf("Cannot "+n);var ae=(t,e,n)=>(gl(t,e,"read from private field"),n?n.call(t):e.get(t)),Sn=(t,e,n)=>e.has(t)?Cf("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),Ii=(t,e,n,i)=>(gl(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n),te=(t,e,n)=>(gl(t,e,"access private method"),n);function Wk(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in t)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function $k(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var rg={exports:{}},Mc={},sg={exports:{}},Oe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zo=Symbol.for("react.element"),qk=Symbol.for("react.portal"),Hk=Symbol.for("react.fragment"),Kk=Symbol.for("react.strict_mode"),Gk=Symbol.for("react.profiler"),Jk=Symbol.for("react.provider"),Yk=Symbol.for("react.context"),Qk=Symbol.for("react.forward_ref"),Xk=Symbol.for("react.suspense"),Zk=Symbol.for("react.memo"),eS=Symbol.for("react.lazy"),Tf=Symbol.iterator;function tS(t){return t===null||typeof t!="object"?null:(t=Tf&&t[Tf]||t["@@iterator"],typeof t=="function"?t:null)}var og={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ag=Object.assign,cg={};function Ds(t,e,n){this.props=t,this.context=e,this.refs=cg,this.updater=n||og}Ds.prototype.isReactComponent={};Ds.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ds.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function lg(){}lg.prototype=Ds.prototype;function qu(t,e,n){this.props=t,this.context=e,this.refs=cg,this.updater=n||og}var Hu=qu.prototype=new lg;Hu.constructor=qu;ag(Hu,Ds.prototype);Hu.isPureReactComponent=!0;var Ef=Array.isArray,dg=Object.prototype.hasOwnProperty,Ku={current:null},ug={key:!0,ref:!0,__self:!0,__source:!0};function hg(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)dg.call(e,i)&&!ug.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];r.children=c}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:Zo,type:t,key:s,ref:o,props:r,_owner:Ku.current}}function nS(t,e){return{$$typeof:Zo,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Gu(t){return typeof t=="object"&&t!==null&&t.$$typeof===Zo}function iS(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var wf=/\/+/g;function vl(t,e){return typeof t=="object"&&t!==null&&t.key!=null?iS(""+t.key):e.toString(36)}function xa(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Zo:case qk:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+vl(o,0):i,Ef(r)?(n="",t!=null&&(n=t.replace(wf,"$&/")+"/"),xa(r,e,n,"",function(l){return l})):r!=null&&(Gu(r)&&(r=nS(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(wf,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",Ef(t))for(var a=0;a<t.length;a++){s=t[a];var c=i+vl(s,a);o+=xa(s,e,n,c,r)}else if(c=tS(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=i+vl(s,a++),o+=xa(s,e,n,c,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function aa(t,e,n){if(t==null)return t;var i=[],r=0;return xa(t,i,"","",function(s){return e.call(n,s,r++)}),i}function rS(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Gt={current:null},Ra={transition:null},sS={ReactCurrentDispatcher:Gt,ReactCurrentBatchConfig:Ra,ReactCurrentOwner:Ku};function fg(){throw Error("act(...) is not supported in production builds of React.")}Oe.Children={map:aa,forEach:function(t,e,n){aa(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return aa(t,function(){e++}),e},toArray:function(t){return aa(t,function(e){return e})||[]},only:function(t){if(!Gu(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Oe.Component=Ds;Oe.Fragment=Hk;Oe.Profiler=Gk;Oe.PureComponent=qu;Oe.StrictMode=Kk;Oe.Suspense=Xk;Oe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sS;Oe.act=fg;Oe.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=ag({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Ku.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)dg.call(e,c)&&!ug.hasOwnProperty(c)&&(i[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)i.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];i.children=a}return{$$typeof:Zo,type:t.type,key:r,ref:s,props:i,_owner:o}};Oe.createContext=function(t){return t={$$typeof:Yk,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Jk,_context:t},t.Consumer=t};Oe.createElement=hg;Oe.createFactory=function(t){var e=hg.bind(null,t);return e.type=t,e};Oe.createRef=function(){return{current:null}};Oe.forwardRef=function(t){return{$$typeof:Qk,render:t}};Oe.isValidElement=Gu;Oe.lazy=function(t){return{$$typeof:eS,_payload:{_status:-1,_result:t},_init:rS}};Oe.memo=function(t,e){return{$$typeof:Zk,type:t,compare:e===void 0?null:e}};Oe.startTransition=function(t){var e=Ra.transition;Ra.transition={};try{t()}finally{Ra.transition=e}};Oe.unstable_act=fg;Oe.useCallback=function(t,e){return Gt.current.useCallback(t,e)};Oe.useContext=function(t){return Gt.current.useContext(t)};Oe.useDebugValue=function(){};Oe.useDeferredValue=function(t){return Gt.current.useDeferredValue(t)};Oe.useEffect=function(t,e){return Gt.current.useEffect(t,e)};Oe.useId=function(){return Gt.current.useId()};Oe.useImperativeHandle=function(t,e,n){return Gt.current.useImperativeHandle(t,e,n)};Oe.useInsertionEffect=function(t,e){return Gt.current.useInsertionEffect(t,e)};Oe.useLayoutEffect=function(t,e){return Gt.current.useLayoutEffect(t,e)};Oe.useMemo=function(t,e){return Gt.current.useMemo(t,e)};Oe.useReducer=function(t,e,n){return Gt.current.useReducer(t,e,n)};Oe.useRef=function(t){return Gt.current.useRef(t)};Oe.useState=function(t){return Gt.current.useState(t)};Oe.useSyncExternalStore=function(t,e,n){return Gt.current.useSyncExternalStore(t,e,n)};Oe.useTransition=function(){return Gt.current.useTransition()};Oe.version="18.3.1";sg.exports=Oe;var w=sg.exports;const ud=$k(w),oS=Wk({__proto__:null,default:ud},[w]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aS=w,cS=Symbol.for("react.element"),lS=Symbol.for("react.fragment"),dS=Object.prototype.hasOwnProperty,uS=aS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,hS={key:!0,ref:!0,__self:!0,__source:!0};function pg(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)dS.call(e,i)&&!hS.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:cS,type:t,key:s,ref:o,props:r,_owner:uS.current}}Mc.Fragment=lS;Mc.jsx=pg;Mc.jsxs=pg;rg.exports=Mc;var u=rg.exports,ec={},mg={exports:{}},vn={},gg={exports:{}},vg={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(J,ue){var z=J.length;J.push(ue);e:for(;0<z;){var Le=z-1>>>1,Ee=J[Le];if(0<r(Ee,ue))J[Le]=ue,J[z]=Ee,z=Le;else break e}}function n(J){return J.length===0?null:J[0]}function i(J){if(J.length===0)return null;var ue=J[0],z=J.pop();if(z!==ue){J[0]=z;e:for(var Le=0,Ee=J.length,pt=Ee>>>1;Le<pt;){var ct=2*(Le+1)-1,H=J[ct],ye=ct+1,kt=J[ye];if(0>r(H,z))ye<Ee&&0>r(kt,H)?(J[Le]=kt,J[ye]=z,Le=ye):(J[Le]=H,J[ct]=z,Le=ct);else if(ye<Ee&&0>r(kt,z))J[Le]=kt,J[ye]=z,Le=ye;else break e}}return ue}function r(J,ue){var z=J.sortIndex-ue.sortIndex;return z!==0?z:J.id-ue.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],d=1,h=null,f=3,p=!1,y=!1,v=!1,T=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(J){for(var ue=n(l);ue!==null;){if(ue.callback===null)i(l);else if(ue.startTime<=J)i(l),ue.sortIndex=ue.expirationTime,e(c,ue);else break;ue=n(l)}}function k(J){if(v=!1,S(J),!y)if(n(c)!==null)y=!0,We(E);else{var ue=n(l);ue!==null&&Tt(k,ue.startTime-J)}}function E(J,ue){y=!1,v&&(v=!1,g(_),_=-1),p=!0;var z=f;try{for(S(ue),h=n(c);h!==null&&(!(h.expirationTime>ue)||J&&!X());){var Le=h.callback;if(typeof Le=="function"){h.callback=null,f=h.priorityLevel;var Ee=Le(h.expirationTime<=ue);ue=t.unstable_now(),typeof Ee=="function"?h.callback=Ee:h===n(c)&&i(c),S(ue)}else i(c);h=n(c)}if(h!==null)var pt=!0;else{var ct=n(l);ct!==null&&Tt(k,ct.startTime-ue),pt=!1}return pt}finally{h=null,f=z,p=!1}}var x=!1,I=null,_=-1,F=5,D=-1;function X(){return!(t.unstable_now()-D<F)}function ce(){if(I!==null){var J=t.unstable_now();D=J;var ue=!0;try{ue=I(!0,J)}finally{ue?Pe():(x=!1,I=null)}}else x=!1}var Pe;if(typeof m=="function")Pe=function(){m(ce)};else if(typeof MessageChannel<"u"){var Qe=new MessageChannel,Rt=Qe.port2;Qe.port1.onmessage=ce,Pe=function(){Rt.postMessage(null)}}else Pe=function(){T(ce,0)};function We(J){I=J,x||(x=!0,Pe())}function Tt(J,ue){_=T(function(){J(t.unstable_now())},ue)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(J){J.callback=null},t.unstable_continueExecution=function(){y||p||(y=!0,We(E))},t.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<J?Math.floor(1e3/J):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(J){switch(f){case 1:case 2:case 3:var ue=3;break;default:ue=f}var z=f;f=ue;try{return J()}finally{f=z}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(J,ue){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var z=f;f=J;try{return ue()}finally{f=z}},t.unstable_scheduleCallback=function(J,ue,z){var Le=t.unstable_now();switch(typeof z=="object"&&z!==null?(z=z.delay,z=typeof z=="number"&&0<z?Le+z:Le):z=Le,J){case 1:var Ee=-1;break;case 2:Ee=250;break;case 5:Ee=1073741823;break;case 4:Ee=1e4;break;default:Ee=5e3}return Ee=z+Ee,J={id:d++,callback:ue,priorityLevel:J,startTime:z,expirationTime:Ee,sortIndex:-1},z>Le?(J.sortIndex=z,e(l,J),n(c)===null&&J===n(l)&&(v?(g(_),_=-1):v=!0,Tt(k,z-Le))):(J.sortIndex=Ee,e(c,J),y||p||(y=!0,We(E))),J},t.unstable_shouldYield=X,t.unstable_wrapCallback=function(J){var ue=f;return function(){var z=f;f=ue;try{return J.apply(this,arguments)}finally{f=z}}}})(vg);gg.exports=vg;var fS=gg.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pS=w,gn=fS;function j(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var yg=new Set,Ro={};function Ar(t,e){Ss(t,e),Ss(t+"Capture",e)}function Ss(t,e){for(Ro[t]=e,t=0;t<e.length;t++)yg.add(e[t])}var Ci=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),hd=Object.prototype.hasOwnProperty,mS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,xf={},Rf={};function gS(t){return hd.call(Rf,t)?!0:hd.call(xf,t)?!1:mS.test(t)?Rf[t]=!0:(xf[t]=!0,!1)}function vS(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function yS(t,e,n,i){if(e===null||typeof e>"u"||vS(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Jt(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var jt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){jt[t]=new Jt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];jt[e]=new Jt(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){jt[t]=new Jt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){jt[t]=new Jt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){jt[t]=new Jt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){jt[t]=new Jt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){jt[t]=new Jt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){jt[t]=new Jt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){jt[t]=new Jt(t,5,!1,t.toLowerCase(),null,!1,!1)});var Ju=/[\-:]([a-z])/g;function Yu(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Ju,Yu);jt[e]=new Jt(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Ju,Yu);jt[e]=new Jt(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Ju,Yu);jt[e]=new Jt(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){jt[t]=new Jt(t,1,!1,t.toLowerCase(),null,!1,!1)});jt.xlinkHref=new Jt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){jt[t]=new Jt(t,1,!1,t.toLowerCase(),null,!0,!0)});function Qu(t,e,n,i){var r=jt.hasOwnProperty(e)?jt[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(yS(e,n,r,i)&&(n=null),i||r===null?gS(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Ri=pS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ca=Symbol.for("react.element"),zr=Symbol.for("react.portal"),Vr=Symbol.for("react.fragment"),Xu=Symbol.for("react.strict_mode"),fd=Symbol.for("react.profiler"),kg=Symbol.for("react.provider"),Sg=Symbol.for("react.context"),Zu=Symbol.for("react.forward_ref"),pd=Symbol.for("react.suspense"),md=Symbol.for("react.suspense_list"),eh=Symbol.for("react.memo"),Li=Symbol.for("react.lazy"),bg=Symbol.for("react.offscreen"),If=Symbol.iterator;function Ws(t){return t===null||typeof t!="object"?null:(t=If&&t[If]||t["@@iterator"],typeof t=="function"?t:null)}var at=Object.assign,yl;function ro(t){if(yl===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);yl=e&&e[1]||""}return`
`+yl+t}var kl=!1;function Sl(t,e){if(!t||kl)return"";kl=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var i=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){i=l}t.call(e.prototype)}else{try{throw Error()}catch(l){i=l}t()}}catch(l){if(l&&i&&typeof l.stack=="string"){for(var r=l.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var c=`
`+r[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{kl=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ro(t):""}function kS(t){switch(t.tag){case 5:return ro(t.type);case 16:return ro("Lazy");case 13:return ro("Suspense");case 19:return ro("SuspenseList");case 0:case 2:case 15:return t=Sl(t.type,!1),t;case 11:return t=Sl(t.type.render,!1),t;case 1:return t=Sl(t.type,!0),t;default:return""}}function gd(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Vr:return"Fragment";case zr:return"Portal";case fd:return"Profiler";case Xu:return"StrictMode";case pd:return"Suspense";case md:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Sg:return(t.displayName||"Context")+".Consumer";case kg:return(t._context.displayName||"Context")+".Provider";case Zu:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case eh:return e=t.displayName||null,e!==null?e:gd(t.type)||"Memo";case Li:e=t._payload,t=t._init;try{return gd(t(e))}catch{}}return null}function SS(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return gd(e);case 8:return e===Xu?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function tr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Cg(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function bS(t){var e=Cg(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function la(t){t._valueTracker||(t._valueTracker=bS(t))}function Tg(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=Cg(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function tc(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function vd(t,e){var n=e.checked;return at({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Pf(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=tr(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Eg(t,e){e=e.checked,e!=null&&Qu(t,"checked",e,!1)}function yd(t,e){Eg(t,e);var n=tr(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?kd(t,e.type,n):e.hasOwnProperty("defaultValue")&&kd(t,e.type,tr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function _f(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function kd(t,e,n){(e!=="number"||tc(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var so=Array.isArray;function ns(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+tr(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Sd(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(j(91));return at({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Af(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(j(92));if(so(n)){if(1<n.length)throw Error(j(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:tr(n)}}function wg(t,e){var n=tr(e.value),i=tr(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function Df(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function xg(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function bd(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?xg(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var da,Rg=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(da=da||document.createElement("div"),da.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=da.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Io(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var po={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},CS=["Webkit","ms","Moz","O"];Object.keys(po).forEach(function(t){CS.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),po[e]=po[t]})});function Ig(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||po.hasOwnProperty(t)&&po[t]?(""+e).trim():e+"px"}function Pg(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=Ig(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var TS=at({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Cd(t,e){if(e){if(TS[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(j(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(j(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(j(61))}if(e.style!=null&&typeof e.style!="object")throw Error(j(62))}}function Td(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ed=null;function th(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var wd=null,is=null,rs=null;function Nf(t){if(t=na(t)){if(typeof wd!="function")throw Error(j(280));var e=t.stateNode;e&&(e=zc(e),wd(t.stateNode,t.type,e))}}function _g(t){is?rs?rs.push(t):rs=[t]:is=t}function Ag(){if(is){var t=is,e=rs;if(rs=is=null,Nf(t),e)for(t=0;t<e.length;t++)Nf(e[t])}}function Dg(t,e){return t(e)}function Ng(){}var bl=!1;function Og(t,e,n){if(bl)return t(e,n);bl=!0;try{return Dg(t,e,n)}finally{bl=!1,(is!==null||rs!==null)&&(Ng(),Ag())}}function Po(t,e){var n=t.stateNode;if(n===null)return null;var i=zc(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(j(231,e,typeof n));return n}var xd=!1;if(Ci)try{var $s={};Object.defineProperty($s,"passive",{get:function(){xd=!0}}),window.addEventListener("test",$s,$s),window.removeEventListener("test",$s,$s)}catch{xd=!1}function ES(t,e,n,i,r,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(d){this.onError(d)}}var mo=!1,nc=null,ic=!1,Rd=null,wS={onError:function(t){mo=!0,nc=t}};function xS(t,e,n,i,r,s,o,a,c){mo=!1,nc=null,ES.apply(wS,arguments)}function RS(t,e,n,i,r,s,o,a,c){if(xS.apply(this,arguments),mo){if(mo){var l=nc;mo=!1,nc=null}else throw Error(j(198));ic||(ic=!0,Rd=l)}}function Dr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Lg(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Of(t){if(Dr(t)!==t)throw Error(j(188))}function IS(t){var e=t.alternate;if(!e){if(e=Dr(t),e===null)throw Error(j(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return Of(r),t;if(s===i)return Of(r),e;s=s.sibling}throw Error(j(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(j(189))}}if(n.alternate!==i)throw Error(j(190))}if(n.tag!==3)throw Error(j(188));return n.stateNode.current===n?t:e}function Mg(t){return t=IS(t),t!==null?jg(t):null}function jg(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=jg(t);if(e!==null)return e;t=t.sibling}return null}var Fg=gn.unstable_scheduleCallback,Lf=gn.unstable_cancelCallback,PS=gn.unstable_shouldYield,_S=gn.unstable_requestPaint,vt=gn.unstable_now,AS=gn.unstable_getCurrentPriorityLevel,nh=gn.unstable_ImmediatePriority,Ug=gn.unstable_UserBlockingPriority,rc=gn.unstable_NormalPriority,DS=gn.unstable_LowPriority,Bg=gn.unstable_IdlePriority,jc=null,ti=null;function NS(t){if(ti&&typeof ti.onCommitFiberRoot=="function")try{ti.onCommitFiberRoot(jc,t,void 0,(t.current.flags&128)===128)}catch{}}var Wn=Math.clz32?Math.clz32:MS,OS=Math.log,LS=Math.LN2;function MS(t){return t>>>=0,t===0?32:31-(OS(t)/LS|0)|0}var ua=64,ha=4194304;function oo(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function sc(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=oo(a):(s&=o,s!==0&&(i=oo(s)))}else o=n&~r,o!==0?i=oo(o):s!==0&&(i=oo(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Wn(e),r=1<<n,i|=t[n],e&=~r;return i}function jS(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function FS(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Wn(s),a=1<<o,c=r[o];c===-1?(!(a&n)||a&i)&&(r[o]=jS(a,e)):c<=e&&(t.expiredLanes|=a),s&=~a}}function Id(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function zg(){var t=ua;return ua<<=1,!(ua&4194240)&&(ua=64),t}function Cl(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ea(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Wn(e),t[e]=n}function US(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Wn(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function ih(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Wn(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var qe=0;function Vg(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Wg,rh,$g,qg,Hg,Pd=!1,fa=[],$i=null,qi=null,Hi=null,_o=new Map,Ao=new Map,ji=[],BS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Mf(t,e){switch(t){case"focusin":case"focusout":$i=null;break;case"dragenter":case"dragleave":qi=null;break;case"mouseover":case"mouseout":Hi=null;break;case"pointerover":case"pointerout":_o.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ao.delete(e.pointerId)}}function qs(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=na(e),e!==null&&rh(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function zS(t,e,n,i,r){switch(e){case"focusin":return $i=qs($i,t,e,n,i,r),!0;case"dragenter":return qi=qs(qi,t,e,n,i,r),!0;case"mouseover":return Hi=qs(Hi,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return _o.set(s,qs(_o.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Ao.set(s,qs(Ao.get(s)||null,t,e,n,i,r)),!0}return!1}function Kg(t){var e=vr(t.target);if(e!==null){var n=Dr(e);if(n!==null){if(e=n.tag,e===13){if(e=Lg(n),e!==null){t.blockedOn=e,Hg(t.priority,function(){$g(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ia(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=_d(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Ed=i,n.target.dispatchEvent(i),Ed=null}else return e=na(n),e!==null&&rh(e),t.blockedOn=n,!1;e.shift()}return!0}function jf(t,e,n){Ia(t)&&n.delete(e)}function VS(){Pd=!1,$i!==null&&Ia($i)&&($i=null),qi!==null&&Ia(qi)&&(qi=null),Hi!==null&&Ia(Hi)&&(Hi=null),_o.forEach(jf),Ao.forEach(jf)}function Hs(t,e){t.blockedOn===e&&(t.blockedOn=null,Pd||(Pd=!0,gn.unstable_scheduleCallback(gn.unstable_NormalPriority,VS)))}function Do(t){function e(r){return Hs(r,t)}if(0<fa.length){Hs(fa[0],t);for(var n=1;n<fa.length;n++){var i=fa[n];i.blockedOn===t&&(i.blockedOn=null)}}for($i!==null&&Hs($i,t),qi!==null&&Hs(qi,t),Hi!==null&&Hs(Hi,t),_o.forEach(e),Ao.forEach(e),n=0;n<ji.length;n++)i=ji[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<ji.length&&(n=ji[0],n.blockedOn===null);)Kg(n),n.blockedOn===null&&ji.shift()}var ss=Ri.ReactCurrentBatchConfig,oc=!0;function WS(t,e,n,i){var r=qe,s=ss.transition;ss.transition=null;try{qe=1,sh(t,e,n,i)}finally{qe=r,ss.transition=s}}function $S(t,e,n,i){var r=qe,s=ss.transition;ss.transition=null;try{qe=4,sh(t,e,n,i)}finally{qe=r,ss.transition=s}}function sh(t,e,n,i){if(oc){var r=_d(t,e,n,i);if(r===null)Dl(t,e,i,ac,n),Mf(t,i);else if(zS(r,t,e,n,i))i.stopPropagation();else if(Mf(t,i),e&4&&-1<BS.indexOf(t)){for(;r!==null;){var s=na(r);if(s!==null&&Wg(s),s=_d(t,e,n,i),s===null&&Dl(t,e,i,ac,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else Dl(t,e,i,null,n)}}var ac=null;function _d(t,e,n,i){if(ac=null,t=th(i),t=vr(t),t!==null)if(e=Dr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Lg(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return ac=t,null}function Gg(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(AS()){case nh:return 1;case Ug:return 4;case rc:case DS:return 16;case Bg:return 536870912;default:return 16}default:return 16}}var Bi=null,oh=null,Pa=null;function Jg(){if(Pa)return Pa;var t,e=oh,n=e.length,i,r="value"in Bi?Bi.value:Bi.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return Pa=r.slice(t,1<i?1-i:void 0)}function _a(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function pa(){return!0}function Ff(){return!1}function yn(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?pa:Ff,this.isPropagationStopped=Ff,this}return at(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=pa)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=pa)},persist:function(){},isPersistent:pa}),e}var Ns={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ah=yn(Ns),ta=at({},Ns,{view:0,detail:0}),qS=yn(ta),Tl,El,Ks,Fc=at({},ta,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ch,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ks&&(Ks&&t.type==="mousemove"?(Tl=t.screenX-Ks.screenX,El=t.screenY-Ks.screenY):El=Tl=0,Ks=t),Tl)},movementY:function(t){return"movementY"in t?t.movementY:El}}),Uf=yn(Fc),HS=at({},Fc,{dataTransfer:0}),KS=yn(HS),GS=at({},ta,{relatedTarget:0}),wl=yn(GS),JS=at({},Ns,{animationName:0,elapsedTime:0,pseudoElement:0}),YS=yn(JS),QS=at({},Ns,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),XS=yn(QS),ZS=at({},Ns,{data:0}),Bf=yn(ZS),eb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},tb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},nb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ib(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=nb[t])?!!e[t]:!1}function ch(){return ib}var rb=at({},ta,{key:function(t){if(t.key){var e=eb[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=_a(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?tb[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ch,charCode:function(t){return t.type==="keypress"?_a(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?_a(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),sb=yn(rb),ob=at({},Fc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zf=yn(ob),ab=at({},ta,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ch}),cb=yn(ab),lb=at({},Ns,{propertyName:0,elapsedTime:0,pseudoElement:0}),db=yn(lb),ub=at({},Fc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),hb=yn(ub),fb=[9,13,27,32],lh=Ci&&"CompositionEvent"in window,go=null;Ci&&"documentMode"in document&&(go=document.documentMode);var pb=Ci&&"TextEvent"in window&&!go,Yg=Ci&&(!lh||go&&8<go&&11>=go),Vf=" ",Wf=!1;function Qg(t,e){switch(t){case"keyup":return fb.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Xg(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Wr=!1;function mb(t,e){switch(t){case"compositionend":return Xg(e);case"keypress":return e.which!==32?null:(Wf=!0,Vf);case"textInput":return t=e.data,t===Vf&&Wf?null:t;default:return null}}function gb(t,e){if(Wr)return t==="compositionend"||!lh&&Qg(t,e)?(t=Jg(),Pa=oh=Bi=null,Wr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Yg&&e.locale!=="ko"?null:e.data;default:return null}}var vb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $f(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!vb[t.type]:e==="textarea"}function Zg(t,e,n,i){_g(i),e=cc(e,"onChange"),0<e.length&&(n=new ah("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var vo=null,No=null;function yb(t){dv(t,0)}function Uc(t){var e=Hr(t);if(Tg(e))return t}function kb(t,e){if(t==="change")return e}var ev=!1;if(Ci){var xl;if(Ci){var Rl="oninput"in document;if(!Rl){var qf=document.createElement("div");qf.setAttribute("oninput","return;"),Rl=typeof qf.oninput=="function"}xl=Rl}else xl=!1;ev=xl&&(!document.documentMode||9<document.documentMode)}function Hf(){vo&&(vo.detachEvent("onpropertychange",tv),No=vo=null)}function tv(t){if(t.propertyName==="value"&&Uc(No)){var e=[];Zg(e,No,t,th(t)),Og(yb,e)}}function Sb(t,e,n){t==="focusin"?(Hf(),vo=e,No=n,vo.attachEvent("onpropertychange",tv)):t==="focusout"&&Hf()}function bb(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Uc(No)}function Cb(t,e){if(t==="click")return Uc(e)}function Tb(t,e){if(t==="input"||t==="change")return Uc(e)}function Eb(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var qn=typeof Object.is=="function"?Object.is:Eb;function Oo(t,e){if(qn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!hd.call(e,r)||!qn(t[r],e[r]))return!1}return!0}function Kf(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Gf(t,e){var n=Kf(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Kf(n)}}function nv(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?nv(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function iv(){for(var t=window,e=tc();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=tc(t.document)}return e}function dh(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function wb(t){var e=iv(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&nv(n.ownerDocument.documentElement,n)){if(i!==null&&dh(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=Gf(n,s);var o=Gf(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var xb=Ci&&"documentMode"in document&&11>=document.documentMode,$r=null,Ad=null,yo=null,Dd=!1;function Jf(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Dd||$r==null||$r!==tc(i)||(i=$r,"selectionStart"in i&&dh(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),yo&&Oo(yo,i)||(yo=i,i=cc(Ad,"onSelect"),0<i.length&&(e=new ah("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=$r)))}function ma(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var qr={animationend:ma("Animation","AnimationEnd"),animationiteration:ma("Animation","AnimationIteration"),animationstart:ma("Animation","AnimationStart"),transitionend:ma("Transition","TransitionEnd")},Il={},rv={};Ci&&(rv=document.createElement("div").style,"AnimationEvent"in window||(delete qr.animationend.animation,delete qr.animationiteration.animation,delete qr.animationstart.animation),"TransitionEvent"in window||delete qr.transitionend.transition);function Bc(t){if(Il[t])return Il[t];if(!qr[t])return t;var e=qr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in rv)return Il[t]=e[n];return t}var sv=Bc("animationend"),ov=Bc("animationiteration"),av=Bc("animationstart"),cv=Bc("transitionend"),lv=new Map,Yf="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function or(t,e){lv.set(t,e),Ar(e,[t])}for(var Pl=0;Pl<Yf.length;Pl++){var _l=Yf[Pl],Rb=_l.toLowerCase(),Ib=_l[0].toUpperCase()+_l.slice(1);or(Rb,"on"+Ib)}or(sv,"onAnimationEnd");or(ov,"onAnimationIteration");or(av,"onAnimationStart");or("dblclick","onDoubleClick");or("focusin","onFocus");or("focusout","onBlur");or(cv,"onTransitionEnd");Ss("onMouseEnter",["mouseout","mouseover"]);Ss("onMouseLeave",["mouseout","mouseover"]);Ss("onPointerEnter",["pointerout","pointerover"]);Ss("onPointerLeave",["pointerout","pointerover"]);Ar("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ar("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ar("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ar("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ar("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ar("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ao="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pb=new Set("cancel close invalid load scroll toggle".split(" ").concat(ao));function Qf(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,RS(i,e,void 0,t),t.currentTarget=null}function dv(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&r.isPropagationStopped())break e;Qf(r,a,l),s=c}else for(o=0;o<i.length;o++){if(a=i[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&r.isPropagationStopped())break e;Qf(r,a,l),s=c}}}if(ic)throw t=Rd,ic=!1,Rd=null,t}function Xe(t,e){var n=e[jd];n===void 0&&(n=e[jd]=new Set);var i=t+"__bubble";n.has(i)||(uv(e,t,2,!1),n.add(i))}function Al(t,e,n){var i=0;e&&(i|=4),uv(n,t,i,e)}var ga="_reactListening"+Math.random().toString(36).slice(2);function Lo(t){if(!t[ga]){t[ga]=!0,yg.forEach(function(n){n!=="selectionchange"&&(Pb.has(n)||Al(n,!1,t),Al(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ga]||(e[ga]=!0,Al("selectionchange",!1,e))}}function uv(t,e,n,i){switch(Gg(e)){case 1:var r=WS;break;case 4:r=$S;break;default:r=sh}n=r.bind(null,e,n,t),r=void 0,!xd||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function Dl(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;o=o.return}for(;a!==null;){if(o=vr(a),o===null)return;if(c=o.tag,c===5||c===6){i=s=o;continue e}a=a.parentNode}}i=i.return}Og(function(){var l=s,d=th(n),h=[];e:{var f=lv.get(t);if(f!==void 0){var p=ah,y=t;switch(t){case"keypress":if(_a(n)===0)break e;case"keydown":case"keyup":p=sb;break;case"focusin":y="focus",p=wl;break;case"focusout":y="blur",p=wl;break;case"beforeblur":case"afterblur":p=wl;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Uf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=KS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=cb;break;case sv:case ov:case av:p=YS;break;case cv:p=db;break;case"scroll":p=qS;break;case"wheel":p=hb;break;case"copy":case"cut":case"paste":p=XS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=zf}var v=(e&4)!==0,T=!v&&t==="scroll",g=v?f!==null?f+"Capture":null:f;v=[];for(var m=l,S;m!==null;){S=m;var k=S.stateNode;if(S.tag===5&&k!==null&&(S=k,g!==null&&(k=Po(m,g),k!=null&&v.push(Mo(m,k,S)))),T)break;m=m.return}0<v.length&&(f=new p(f,y,null,n,d),h.push({event:f,listeners:v}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",f&&n!==Ed&&(y=n.relatedTarget||n.fromElement)&&(vr(y)||y[Ti]))break e;if((p||f)&&(f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window,p?(y=n.relatedTarget||n.toElement,p=l,y=y?vr(y):null,y!==null&&(T=Dr(y),y!==T||y.tag!==5&&y.tag!==6)&&(y=null)):(p=null,y=l),p!==y)){if(v=Uf,k="onMouseLeave",g="onMouseEnter",m="mouse",(t==="pointerout"||t==="pointerover")&&(v=zf,k="onPointerLeave",g="onPointerEnter",m="pointer"),T=p==null?f:Hr(p),S=y==null?f:Hr(y),f=new v(k,m+"leave",p,n,d),f.target=T,f.relatedTarget=S,k=null,vr(d)===l&&(v=new v(g,m+"enter",y,n,d),v.target=S,v.relatedTarget=T,k=v),T=k,p&&y)t:{for(v=p,g=y,m=0,S=v;S;S=jr(S))m++;for(S=0,k=g;k;k=jr(k))S++;for(;0<m-S;)v=jr(v),m--;for(;0<S-m;)g=jr(g),S--;for(;m--;){if(v===g||g!==null&&v===g.alternate)break t;v=jr(v),g=jr(g)}v=null}else v=null;p!==null&&Xf(h,f,p,v,!1),y!==null&&T!==null&&Xf(h,T,y,v,!0)}}e:{if(f=l?Hr(l):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var E=kb;else if($f(f))if(ev)E=Tb;else{E=bb;var x=Sb}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(E=Cb);if(E&&(E=E(t,l))){Zg(h,E,n,d);break e}x&&x(t,f,l),t==="focusout"&&(x=f._wrapperState)&&x.controlled&&f.type==="number"&&kd(f,"number",f.value)}switch(x=l?Hr(l):window,t){case"focusin":($f(x)||x.contentEditable==="true")&&($r=x,Ad=l,yo=null);break;case"focusout":yo=Ad=$r=null;break;case"mousedown":Dd=!0;break;case"contextmenu":case"mouseup":case"dragend":Dd=!1,Jf(h,n,d);break;case"selectionchange":if(xb)break;case"keydown":case"keyup":Jf(h,n,d)}var I;if(lh)e:{switch(t){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Wr?Qg(t,n)&&(_="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(_="onCompositionStart");_&&(Yg&&n.locale!=="ko"&&(Wr||_!=="onCompositionStart"?_==="onCompositionEnd"&&Wr&&(I=Jg()):(Bi=d,oh="value"in Bi?Bi.value:Bi.textContent,Wr=!0)),x=cc(l,_),0<x.length&&(_=new Bf(_,t,null,n,d),h.push({event:_,listeners:x}),I?_.data=I:(I=Xg(n),I!==null&&(_.data=I)))),(I=pb?mb(t,n):gb(t,n))&&(l=cc(l,"onBeforeInput"),0<l.length&&(d=new Bf("onBeforeInput","beforeinput",null,n,d),h.push({event:d,listeners:l}),d.data=I))}dv(h,e)})}function Mo(t,e,n){return{instance:t,listener:e,currentTarget:n}}function cc(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Po(t,n),s!=null&&i.unshift(Mo(t,s,r)),s=Po(t,e),s!=null&&i.push(Mo(t,s,r))),t=t.return}return i}function jr(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Xf(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,c=a.alternate,l=a.stateNode;if(c!==null&&c===i)break;a.tag===5&&l!==null&&(a=l,r?(c=Po(n,s),c!=null&&o.unshift(Mo(n,c,a))):r||(c=Po(n,s),c!=null&&o.push(Mo(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var _b=/\r\n?/g,Ab=/\u0000|\uFFFD/g;function Zf(t){return(typeof t=="string"?t:""+t).replace(_b,`
`).replace(Ab,"")}function va(t,e,n){if(e=Zf(e),Zf(t)!==e&&n)throw Error(j(425))}function lc(){}var Nd=null,Od=null;function Ld(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Md=typeof setTimeout=="function"?setTimeout:void 0,Db=typeof clearTimeout=="function"?clearTimeout:void 0,ep=typeof Promise=="function"?Promise:void 0,Nb=typeof queueMicrotask=="function"?queueMicrotask:typeof ep<"u"?function(t){return ep.resolve(null).then(t).catch(Ob)}:Md;function Ob(t){setTimeout(function(){throw t})}function Nl(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),Do(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);Do(e)}function Ki(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function tp(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Os=Math.random().toString(36).slice(2),ei="__reactFiber$"+Os,jo="__reactProps$"+Os,Ti="__reactContainer$"+Os,jd="__reactEvents$"+Os,Lb="__reactListeners$"+Os,Mb="__reactHandles$"+Os;function vr(t){var e=t[ei];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Ti]||n[ei]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=tp(t);t!==null;){if(n=t[ei])return n;t=tp(t)}return e}t=n,n=t.parentNode}return null}function na(t){return t=t[ei]||t[Ti],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Hr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(j(33))}function zc(t){return t[jo]||null}var Fd=[],Kr=-1;function ar(t){return{current:t}}function Ze(t){0>Kr||(t.current=Fd[Kr],Fd[Kr]=null,Kr--)}function Ye(t,e){Kr++,Fd[Kr]=t.current,t.current=e}var nr={},zt=ar(nr),on=ar(!1),Tr=nr;function bs(t,e){var n=t.type.contextTypes;if(!n)return nr;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function an(t){return t=t.childContextTypes,t!=null}function dc(){Ze(on),Ze(zt)}function np(t,e,n){if(zt.current!==nr)throw Error(j(168));Ye(zt,e),Ye(on,n)}function hv(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(j(108,SS(t)||"Unknown",r));return at({},n,i)}function uc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||nr,Tr=zt.current,Ye(zt,t),Ye(on,on.current),!0}function ip(t,e,n){var i=t.stateNode;if(!i)throw Error(j(169));n?(t=hv(t,e,Tr),i.__reactInternalMemoizedMergedChildContext=t,Ze(on),Ze(zt),Ye(zt,t)):Ze(on),Ye(on,n)}var hi=null,Vc=!1,Ol=!1;function fv(t){hi===null?hi=[t]:hi.push(t)}function jb(t){Vc=!0,fv(t)}function cr(){if(!Ol&&hi!==null){Ol=!0;var t=0,e=qe;try{var n=hi;for(qe=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}hi=null,Vc=!1}catch(r){throw hi!==null&&(hi=hi.slice(t+1)),Fg(nh,cr),r}finally{qe=e,Ol=!1}}return null}var Gr=[],Jr=0,hc=null,fc=0,Tn=[],En=0,Er=null,ki=1,Si="";function fr(t,e){Gr[Jr++]=fc,Gr[Jr++]=hc,hc=t,fc=e}function pv(t,e,n){Tn[En++]=ki,Tn[En++]=Si,Tn[En++]=Er,Er=t;var i=ki;t=Si;var r=32-Wn(i)-1;i&=~(1<<r),n+=1;var s=32-Wn(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,ki=1<<32-Wn(e)+r|n<<r|i,Si=s+t}else ki=1<<s|n<<r|i,Si=t}function uh(t){t.return!==null&&(fr(t,1),pv(t,1,0))}function hh(t){for(;t===hc;)hc=Gr[--Jr],Gr[Jr]=null,fc=Gr[--Jr],Gr[Jr]=null;for(;t===Er;)Er=Tn[--En],Tn[En]=null,Si=Tn[--En],Tn[En]=null,ki=Tn[--En],Tn[En]=null}var mn=null,fn=null,nt=!1,jn=null;function mv(t,e){var n=wn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function rp(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,mn=t,fn=Ki(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,mn=t,fn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Er!==null?{id:ki,overflow:Si}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=wn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,mn=t,fn=null,!0):!1;default:return!1}}function Ud(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Bd(t){if(nt){var e=fn;if(e){var n=e;if(!rp(t,e)){if(Ud(t))throw Error(j(418));e=Ki(n.nextSibling);var i=mn;e&&rp(t,e)?mv(i,n):(t.flags=t.flags&-4097|2,nt=!1,mn=t)}}else{if(Ud(t))throw Error(j(418));t.flags=t.flags&-4097|2,nt=!1,mn=t}}}function sp(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;mn=t}function ya(t){if(t!==mn)return!1;if(!nt)return sp(t),nt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Ld(t.type,t.memoizedProps)),e&&(e=fn)){if(Ud(t))throw gv(),Error(j(418));for(;e;)mv(t,e),e=Ki(e.nextSibling)}if(sp(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(j(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){fn=Ki(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}fn=null}}else fn=mn?Ki(t.stateNode.nextSibling):null;return!0}function gv(){for(var t=fn;t;)t=Ki(t.nextSibling)}function Cs(){fn=mn=null,nt=!1}function fh(t){jn===null?jn=[t]:jn.push(t)}var Fb=Ri.ReactCurrentBatchConfig;function Gs(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(j(309));var i=n.stateNode}if(!i)throw Error(j(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(j(284));if(!n._owner)throw Error(j(290,t))}return t}function ka(t,e){throw t=Object.prototype.toString.call(e),Error(j(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function op(t){var e=t._init;return e(t._payload)}function vv(t){function e(g,m){if(t){var S=g.deletions;S===null?(g.deletions=[m],g.flags|=16):S.push(m)}}function n(g,m){if(!t)return null;for(;m!==null;)e(g,m),m=m.sibling;return null}function i(g,m){for(g=new Map;m!==null;)m.key!==null?g.set(m.key,m):g.set(m.index,m),m=m.sibling;return g}function r(g,m){return g=Qi(g,m),g.index=0,g.sibling=null,g}function s(g,m,S){return g.index=S,t?(S=g.alternate,S!==null?(S=S.index,S<m?(g.flags|=2,m):S):(g.flags|=2,m)):(g.flags|=1048576,m)}function o(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,m,S,k){return m===null||m.tag!==6?(m=zl(S,g.mode,k),m.return=g,m):(m=r(m,S),m.return=g,m)}function c(g,m,S,k){var E=S.type;return E===Vr?d(g,m,S.props.children,k,S.key):m!==null&&(m.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===Li&&op(E)===m.type)?(k=r(m,S.props),k.ref=Gs(g,m,S),k.return=g,k):(k=ja(S.type,S.key,S.props,null,g.mode,k),k.ref=Gs(g,m,S),k.return=g,k)}function l(g,m,S,k){return m===null||m.tag!==4||m.stateNode.containerInfo!==S.containerInfo||m.stateNode.implementation!==S.implementation?(m=Vl(S,g.mode,k),m.return=g,m):(m=r(m,S.children||[]),m.return=g,m)}function d(g,m,S,k,E){return m===null||m.tag!==7?(m=br(S,g.mode,k,E),m.return=g,m):(m=r(m,S),m.return=g,m)}function h(g,m,S){if(typeof m=="string"&&m!==""||typeof m=="number")return m=zl(""+m,g.mode,S),m.return=g,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case ca:return S=ja(m.type,m.key,m.props,null,g.mode,S),S.ref=Gs(g,null,m),S.return=g,S;case zr:return m=Vl(m,g.mode,S),m.return=g,m;case Li:var k=m._init;return h(g,k(m._payload),S)}if(so(m)||Ws(m))return m=br(m,g.mode,S,null),m.return=g,m;ka(g,m)}return null}function f(g,m,S,k){var E=m!==null?m.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return E!==null?null:a(g,m,""+S,k);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case ca:return S.key===E?c(g,m,S,k):null;case zr:return S.key===E?l(g,m,S,k):null;case Li:return E=S._init,f(g,m,E(S._payload),k)}if(so(S)||Ws(S))return E!==null?null:d(g,m,S,k,null);ka(g,S)}return null}function p(g,m,S,k,E){if(typeof k=="string"&&k!==""||typeof k=="number")return g=g.get(S)||null,a(m,g,""+k,E);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case ca:return g=g.get(k.key===null?S:k.key)||null,c(m,g,k,E);case zr:return g=g.get(k.key===null?S:k.key)||null,l(m,g,k,E);case Li:var x=k._init;return p(g,m,S,x(k._payload),E)}if(so(k)||Ws(k))return g=g.get(S)||null,d(m,g,k,E,null);ka(m,k)}return null}function y(g,m,S,k){for(var E=null,x=null,I=m,_=m=0,F=null;I!==null&&_<S.length;_++){I.index>_?(F=I,I=null):F=I.sibling;var D=f(g,I,S[_],k);if(D===null){I===null&&(I=F);break}t&&I&&D.alternate===null&&e(g,I),m=s(D,m,_),x===null?E=D:x.sibling=D,x=D,I=F}if(_===S.length)return n(g,I),nt&&fr(g,_),E;if(I===null){for(;_<S.length;_++)I=h(g,S[_],k),I!==null&&(m=s(I,m,_),x===null?E=I:x.sibling=I,x=I);return nt&&fr(g,_),E}for(I=i(g,I);_<S.length;_++)F=p(I,g,_,S[_],k),F!==null&&(t&&F.alternate!==null&&I.delete(F.key===null?_:F.key),m=s(F,m,_),x===null?E=F:x.sibling=F,x=F);return t&&I.forEach(function(X){return e(g,X)}),nt&&fr(g,_),E}function v(g,m,S,k){var E=Ws(S);if(typeof E!="function")throw Error(j(150));if(S=E.call(S),S==null)throw Error(j(151));for(var x=E=null,I=m,_=m=0,F=null,D=S.next();I!==null&&!D.done;_++,D=S.next()){I.index>_?(F=I,I=null):F=I.sibling;var X=f(g,I,D.value,k);if(X===null){I===null&&(I=F);break}t&&I&&X.alternate===null&&e(g,I),m=s(X,m,_),x===null?E=X:x.sibling=X,x=X,I=F}if(D.done)return n(g,I),nt&&fr(g,_),E;if(I===null){for(;!D.done;_++,D=S.next())D=h(g,D.value,k),D!==null&&(m=s(D,m,_),x===null?E=D:x.sibling=D,x=D);return nt&&fr(g,_),E}for(I=i(g,I);!D.done;_++,D=S.next())D=p(I,g,_,D.value,k),D!==null&&(t&&D.alternate!==null&&I.delete(D.key===null?_:D.key),m=s(D,m,_),x===null?E=D:x.sibling=D,x=D);return t&&I.forEach(function(ce){return e(g,ce)}),nt&&fr(g,_),E}function T(g,m,S,k){if(typeof S=="object"&&S!==null&&S.type===Vr&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case ca:e:{for(var E=S.key,x=m;x!==null;){if(x.key===E){if(E=S.type,E===Vr){if(x.tag===7){n(g,x.sibling),m=r(x,S.props.children),m.return=g,g=m;break e}}else if(x.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===Li&&op(E)===x.type){n(g,x.sibling),m=r(x,S.props),m.ref=Gs(g,x,S),m.return=g,g=m;break e}n(g,x);break}else e(g,x);x=x.sibling}S.type===Vr?(m=br(S.props.children,g.mode,k,S.key),m.return=g,g=m):(k=ja(S.type,S.key,S.props,null,g.mode,k),k.ref=Gs(g,m,S),k.return=g,g=k)}return o(g);case zr:e:{for(x=S.key;m!==null;){if(m.key===x)if(m.tag===4&&m.stateNode.containerInfo===S.containerInfo&&m.stateNode.implementation===S.implementation){n(g,m.sibling),m=r(m,S.children||[]),m.return=g,g=m;break e}else{n(g,m);break}else e(g,m);m=m.sibling}m=Vl(S,g.mode,k),m.return=g,g=m}return o(g);case Li:return x=S._init,T(g,m,x(S._payload),k)}if(so(S))return y(g,m,S,k);if(Ws(S))return v(g,m,S,k);ka(g,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,m!==null&&m.tag===6?(n(g,m.sibling),m=r(m,S),m.return=g,g=m):(n(g,m),m=zl(S,g.mode,k),m.return=g,g=m),o(g)):n(g,m)}return T}var Ts=vv(!0),yv=vv(!1),pc=ar(null),mc=null,Yr=null,ph=null;function mh(){ph=Yr=mc=null}function gh(t){var e=pc.current;Ze(pc),t._currentValue=e}function zd(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function os(t,e){mc=t,ph=Yr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(nn=!0),t.firstContext=null)}function In(t){var e=t._currentValue;if(ph!==t)if(t={context:t,memoizedValue:e,next:null},Yr===null){if(mc===null)throw Error(j(308));Yr=t,mc.dependencies={lanes:0,firstContext:t}}else Yr=Yr.next=t;return e}var yr=null;function vh(t){yr===null?yr=[t]:yr.push(t)}function kv(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,vh(e)):(n.next=r.next,r.next=n),e.interleaved=n,Ei(t,i)}function Ei(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Mi=!1;function yh(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Sv(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function bi(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Gi(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,Be&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Ei(t,n)}return r=i.interleaved,r===null?(e.next=e,vh(i)):(e.next=r.next,r.next=e),i.interleaved=e,Ei(t,n)}function Aa(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,ih(t,n)}}function ap(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function gc(t,e,n,i){var r=t.updateQueue;Mi=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var d=t.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=l:a.next=l,d.lastBaseUpdate=c))}if(s!==null){var h=r.baseState;o=0,d=l=c=null,a=s;do{var f=a.lane,p=a.eventTime;if((i&f)===f){d!==null&&(d=d.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var y=t,v=a;switch(f=e,p=n,v.tag){case 1:if(y=v.payload,typeof y=="function"){h=y.call(p,h,f);break e}h=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=v.payload,f=typeof y=="function"?y.call(p,h,f):y,f==null)break e;h=at({},h,f);break e;case 2:Mi=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=r.effects,f===null?r.effects=[a]:f.push(a))}else p={eventTime:p,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(l=d=p,c=h):d=d.next=p,o|=f;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;f=a,a=f.next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}while(!0);if(d===null&&(c=h),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=d,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);xr|=o,t.lanes=o,t.memoizedState=h}}function cp(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(j(191,r));r.call(i)}}}var ia={},ni=ar(ia),Fo=ar(ia),Uo=ar(ia);function kr(t){if(t===ia)throw Error(j(174));return t}function kh(t,e){switch(Ye(Uo,e),Ye(Fo,t),Ye(ni,ia),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:bd(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=bd(e,t)}Ze(ni),Ye(ni,e)}function Es(){Ze(ni),Ze(Fo),Ze(Uo)}function bv(t){kr(Uo.current);var e=kr(ni.current),n=bd(e,t.type);e!==n&&(Ye(Fo,t),Ye(ni,n))}function Sh(t){Fo.current===t&&(Ze(ni),Ze(Fo))}var st=ar(0);function vc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ll=[];function bh(){for(var t=0;t<Ll.length;t++)Ll[t]._workInProgressVersionPrimary=null;Ll.length=0}var Da=Ri.ReactCurrentDispatcher,Ml=Ri.ReactCurrentBatchConfig,wr=0,ot=null,Et=null,Pt=null,yc=!1,ko=!1,Bo=0,Ub=0;function Ft(){throw Error(j(321))}function Ch(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!qn(t[n],e[n]))return!1;return!0}function Th(t,e,n,i,r,s){if(wr=s,ot=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Da.current=t===null||t.memoizedState===null?Wb:$b,t=n(i,r),ko){s=0;do{if(ko=!1,Bo=0,25<=s)throw Error(j(301));s+=1,Pt=Et=null,e.updateQueue=null,Da.current=qb,t=n(i,r)}while(ko)}if(Da.current=kc,e=Et!==null&&Et.next!==null,wr=0,Pt=Et=ot=null,yc=!1,e)throw Error(j(300));return t}function Eh(){var t=Bo!==0;return Bo=0,t}function Qn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pt===null?ot.memoizedState=Pt=t:Pt=Pt.next=t,Pt}function Pn(){if(Et===null){var t=ot.alternate;t=t!==null?t.memoizedState:null}else t=Et.next;var e=Pt===null?ot.memoizedState:Pt.next;if(e!==null)Pt=e,Et=t;else{if(t===null)throw Error(j(310));Et=t,t={memoizedState:Et.memoizedState,baseState:Et.baseState,baseQueue:Et.baseQueue,queue:Et.queue,next:null},Pt===null?ot.memoizedState=Pt=t:Pt=Pt.next=t}return Pt}function zo(t,e){return typeof e=="function"?e(t):e}function jl(t){var e=Pn(),n=e.queue;if(n===null)throw Error(j(311));n.lastRenderedReducer=t;var i=Et,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,c=null,l=s;do{var d=l.lane;if((wr&d)===d)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),i=l.hasEagerState?l.eagerState:t(i,l.action);else{var h={lane:d,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=h,o=i):c=c.next=h,ot.lanes|=d,xr|=d}l=l.next}while(l!==null&&l!==s);c===null?o=i:c.next=a,qn(i,e.memoizedState)||(nn=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=c,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,ot.lanes|=s,xr|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Fl(t){var e=Pn(),n=e.queue;if(n===null)throw Error(j(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);qn(s,e.memoizedState)||(nn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function Cv(){}function Tv(t,e){var n=ot,i=Pn(),r=e(),s=!qn(i.memoizedState,r);if(s&&(i.memoizedState=r,nn=!0),i=i.queue,wh(xv.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Pt!==null&&Pt.memoizedState.tag&1){if(n.flags|=2048,Vo(9,wv.bind(null,n,i,r,e),void 0,null),Dt===null)throw Error(j(349));wr&30||Ev(n,e,r)}return r}function Ev(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ot.updateQueue,e===null?(e={lastEffect:null,stores:null},ot.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function wv(t,e,n,i){e.value=n,e.getSnapshot=i,Rv(e)&&Iv(t)}function xv(t,e,n){return n(function(){Rv(e)&&Iv(t)})}function Rv(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!qn(t,n)}catch{return!0}}function Iv(t){var e=Ei(t,1);e!==null&&$n(e,t,1,-1)}function lp(t){var e=Qn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:zo,lastRenderedState:t},e.queue=t,t=t.dispatch=Vb.bind(null,ot,t),[e.memoizedState,t]}function Vo(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=ot.updateQueue,e===null?(e={lastEffect:null,stores:null},ot.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function Pv(){return Pn().memoizedState}function Na(t,e,n,i){var r=Qn();ot.flags|=t,r.memoizedState=Vo(1|e,n,void 0,i===void 0?null:i)}function Wc(t,e,n,i){var r=Pn();i=i===void 0?null:i;var s=void 0;if(Et!==null){var o=Et.memoizedState;if(s=o.destroy,i!==null&&Ch(i,o.deps)){r.memoizedState=Vo(e,n,s,i);return}}ot.flags|=t,r.memoizedState=Vo(1|e,n,s,i)}function dp(t,e){return Na(8390656,8,t,e)}function wh(t,e){return Wc(2048,8,t,e)}function _v(t,e){return Wc(4,2,t,e)}function Av(t,e){return Wc(4,4,t,e)}function Dv(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Nv(t,e,n){return n=n!=null?n.concat([t]):null,Wc(4,4,Dv.bind(null,e,t),n)}function xh(){}function Ov(t,e){var n=Pn();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Ch(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Lv(t,e){var n=Pn();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Ch(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function Mv(t,e,n){return wr&21?(qn(n,e)||(n=zg(),ot.lanes|=n,xr|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,nn=!0),t.memoizedState=n)}function Bb(t,e){var n=qe;qe=n!==0&&4>n?n:4,t(!0);var i=Ml.transition;Ml.transition={};try{t(!1),e()}finally{qe=n,Ml.transition=i}}function jv(){return Pn().memoizedState}function zb(t,e,n){var i=Yi(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Fv(t))Uv(e,n);else if(n=kv(t,e,n,i),n!==null){var r=Ht();$n(n,t,i,r),Bv(n,e,i)}}function Vb(t,e,n){var i=Yi(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Fv(t))Uv(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,qn(a,o)){var c=e.interleaved;c===null?(r.next=r,vh(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}n=kv(t,e,r,i),n!==null&&(r=Ht(),$n(n,t,i,r),Bv(n,e,i))}}function Fv(t){var e=t.alternate;return t===ot||e!==null&&e===ot}function Uv(t,e){ko=yc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Bv(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,ih(t,n)}}var kc={readContext:In,useCallback:Ft,useContext:Ft,useEffect:Ft,useImperativeHandle:Ft,useInsertionEffect:Ft,useLayoutEffect:Ft,useMemo:Ft,useReducer:Ft,useRef:Ft,useState:Ft,useDebugValue:Ft,useDeferredValue:Ft,useTransition:Ft,useMutableSource:Ft,useSyncExternalStore:Ft,useId:Ft,unstable_isNewReconciler:!1},Wb={readContext:In,useCallback:function(t,e){return Qn().memoizedState=[t,e===void 0?null:e],t},useContext:In,useEffect:dp,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Na(4194308,4,Dv.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Na(4194308,4,t,e)},useInsertionEffect:function(t,e){return Na(4,2,t,e)},useMemo:function(t,e){var n=Qn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Qn();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=zb.bind(null,ot,t),[i.memoizedState,t]},useRef:function(t){var e=Qn();return t={current:t},e.memoizedState=t},useState:lp,useDebugValue:xh,useDeferredValue:function(t){return Qn().memoizedState=t},useTransition:function(){var t=lp(!1),e=t[0];return t=Bb.bind(null,t[1]),Qn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=ot,r=Qn();if(nt){if(n===void 0)throw Error(j(407));n=n()}else{if(n=e(),Dt===null)throw Error(j(349));wr&30||Ev(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,dp(xv.bind(null,i,s,t),[t]),i.flags|=2048,Vo(9,wv.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=Qn(),e=Dt.identifierPrefix;if(nt){var n=Si,i=ki;n=(i&~(1<<32-Wn(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=Bo++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=Ub++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},$b={readContext:In,useCallback:Ov,useContext:In,useEffect:wh,useImperativeHandle:Nv,useInsertionEffect:_v,useLayoutEffect:Av,useMemo:Lv,useReducer:jl,useRef:Pv,useState:function(){return jl(zo)},useDebugValue:xh,useDeferredValue:function(t){var e=Pn();return Mv(e,Et.memoizedState,t)},useTransition:function(){var t=jl(zo)[0],e=Pn().memoizedState;return[t,e]},useMutableSource:Cv,useSyncExternalStore:Tv,useId:jv,unstable_isNewReconciler:!1},qb={readContext:In,useCallback:Ov,useContext:In,useEffect:wh,useImperativeHandle:Nv,useInsertionEffect:_v,useLayoutEffect:Av,useMemo:Lv,useReducer:Fl,useRef:Pv,useState:function(){return Fl(zo)},useDebugValue:xh,useDeferredValue:function(t){var e=Pn();return Et===null?e.memoizedState=t:Mv(e,Et.memoizedState,t)},useTransition:function(){var t=Fl(zo)[0],e=Pn().memoizedState;return[t,e]},useMutableSource:Cv,useSyncExternalStore:Tv,useId:jv,unstable_isNewReconciler:!1};function Nn(t,e){if(t&&t.defaultProps){e=at({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Vd(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:at({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var $c={isMounted:function(t){return(t=t._reactInternals)?Dr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Ht(),r=Yi(t),s=bi(i,r);s.payload=e,n!=null&&(s.callback=n),e=Gi(t,s,r),e!==null&&($n(e,t,r,i),Aa(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Ht(),r=Yi(t),s=bi(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Gi(t,s,r),e!==null&&($n(e,t,r,i),Aa(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ht(),i=Yi(t),r=bi(n,i);r.tag=2,e!=null&&(r.callback=e),e=Gi(t,r,i),e!==null&&($n(e,t,i,n),Aa(e,t,i))}};function up(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!Oo(n,i)||!Oo(r,s):!0}function zv(t,e,n){var i=!1,r=nr,s=e.contextType;return typeof s=="object"&&s!==null?s=In(s):(r=an(e)?Tr:zt.current,i=e.contextTypes,s=(i=i!=null)?bs(t,r):nr),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=$c,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function hp(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&$c.enqueueReplaceState(e,e.state,null)}function Wd(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},yh(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=In(s):(s=an(e)?Tr:zt.current,r.context=bs(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Vd(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&$c.enqueueReplaceState(r,r.state,null),gc(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function ws(t,e){try{var n="",i=e;do n+=kS(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function Ul(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function $d(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Hb=typeof WeakMap=="function"?WeakMap:Map;function Vv(t,e,n){n=bi(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){bc||(bc=!0,eu=i),$d(t,e)},n}function Wv(t,e,n){n=bi(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){$d(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){$d(t,e),typeof i!="function"&&(Ji===null?Ji=new Set([this]):Ji.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function fp(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new Hb;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=oC.bind(null,t,e,n),e.then(t,t))}function pp(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function mp(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=bi(-1,1),e.tag=2,Gi(n,e,1))),n.lanes|=1),t)}var Kb=Ri.ReactCurrentOwner,nn=!1;function Wt(t,e,n,i){e.child=t===null?yv(e,null,n,i):Ts(e,t.child,n,i)}function gp(t,e,n,i,r){n=n.render;var s=e.ref;return os(e,r),i=Th(t,e,n,i,s,r),n=Eh(),t!==null&&!nn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,wi(t,e,r)):(nt&&n&&uh(e),e.flags|=1,Wt(t,e,i,r),e.child)}function vp(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!Oh(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,$v(t,e,s,i,r)):(t=ja(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Oo,n(o,i)&&t.ref===e.ref)return wi(t,e,r)}return e.flags|=1,t=Qi(s,i),t.ref=e.ref,t.return=e,e.child=t}function $v(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(Oo(s,i)&&t.ref===e.ref)if(nn=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(nn=!0);else return e.lanes=t.lanes,wi(t,e,r)}return qd(t,e,n,i,r)}function qv(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ye(Xr,hn),hn|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ye(Xr,hn),hn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,Ye(Xr,hn),hn|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,Ye(Xr,hn),hn|=i;return Wt(t,e,r,n),e.child}function Hv(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function qd(t,e,n,i,r){var s=an(n)?Tr:zt.current;return s=bs(e,s),os(e,r),n=Th(t,e,n,i,s,r),i=Eh(),t!==null&&!nn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,wi(t,e,r)):(nt&&i&&uh(e),e.flags|=1,Wt(t,e,n,r),e.child)}function yp(t,e,n,i,r){if(an(n)){var s=!0;uc(e)}else s=!1;if(os(e,r),e.stateNode===null)Oa(t,e),zv(e,n,i),Wd(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=n.contextType;typeof l=="object"&&l!==null?l=In(l):(l=an(n)?Tr:zt.current,l=bs(e,l));var d=n.getDerivedStateFromProps,h=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||c!==l)&&hp(e,o,i,l),Mi=!1;var f=e.memoizedState;o.state=f,gc(e,i,o,r),c=e.memoizedState,a!==i||f!==c||on.current||Mi?(typeof d=="function"&&(Vd(e,n,d,i),c=e.memoizedState),(a=Mi||up(e,n,a,i,f,c,l))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=c),o.props=i,o.state=c,o.context=l,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,Sv(t,e),a=e.memoizedProps,l=e.type===e.elementType?a:Nn(e.type,a),o.props=l,h=e.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=In(c):(c=an(n)?Tr:zt.current,c=bs(e,c));var p=n.getDerivedStateFromProps;(d=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==c)&&hp(e,o,i,c),Mi=!1,f=e.memoizedState,o.state=f,gc(e,i,o,r);var y=e.memoizedState;a!==h||f!==y||on.current||Mi?(typeof p=="function"&&(Vd(e,n,p,i),y=e.memoizedState),(l=Mi||up(e,n,l,i,f,y,c)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,y,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,y,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=y),o.props=i,o.state=y,o.context=c,i=l):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),i=!1)}return Hd(t,e,n,i,s,r)}function Hd(t,e,n,i,r,s){Hv(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&ip(e,n,!1),wi(t,e,s);i=e.stateNode,Kb.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=Ts(e,t.child,null,s),e.child=Ts(e,null,a,s)):Wt(t,e,a,s),e.memoizedState=i.state,r&&ip(e,n,!0),e.child}function Kv(t){var e=t.stateNode;e.pendingContext?np(t,e.pendingContext,e.pendingContext!==e.context):e.context&&np(t,e.context,!1),kh(t,e.containerInfo)}function kp(t,e,n,i,r){return Cs(),fh(r),e.flags|=256,Wt(t,e,n,i),e.child}var Kd={dehydrated:null,treeContext:null,retryLane:0};function Gd(t){return{baseLanes:t,cachePool:null,transitions:null}}function Gv(t,e,n){var i=e.pendingProps,r=st.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),Ye(st,r&1),t===null)return Bd(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Kc(o,i,0,null),t=br(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Gd(n),e.memoizedState=Kd,t):Rh(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return Gb(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var c={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=c,e.deletions=null):(i=Qi(r,c),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=Qi(a,s):(s=br(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?Gd(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Kd,i}return s=t.child,t=s.sibling,i=Qi(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function Rh(t,e){return e=Kc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Sa(t,e,n,i){return i!==null&&fh(i),Ts(e,t.child,null,n),t=Rh(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Gb(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=Ul(Error(j(422))),Sa(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=Kc({mode:"visible",children:i.children},r,0,null),s=br(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&Ts(e,t.child,null,o),e.child.memoizedState=Gd(o),e.memoizedState=Kd,s);if(!(e.mode&1))return Sa(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(j(419)),i=Ul(s,i,void 0),Sa(t,e,o,i)}if(a=(o&t.childLanes)!==0,nn||a){if(i=Dt,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,Ei(t,r),$n(i,t,r,-1))}return Nh(),i=Ul(Error(j(421))),Sa(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=aC.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,fn=Ki(r.nextSibling),mn=e,nt=!0,jn=null,t!==null&&(Tn[En++]=ki,Tn[En++]=Si,Tn[En++]=Er,ki=t.id,Si=t.overflow,Er=e),e=Rh(e,i.children),e.flags|=4096,e)}function Sp(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),zd(t.return,e,n)}function Bl(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function Jv(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Wt(t,e,i.children,n),i=st.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Sp(t,n,e);else if(t.tag===19)Sp(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(Ye(st,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&vc(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Bl(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&vc(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Bl(e,!0,n,null,s);break;case"together":Bl(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Oa(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function wi(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),xr|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(j(153));if(e.child!==null){for(t=e.child,n=Qi(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Qi(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Jb(t,e,n){switch(e.tag){case 3:Kv(e),Cs();break;case 5:bv(e);break;case 1:an(e.type)&&uc(e);break;case 4:kh(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Ye(pc,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Ye(st,st.current&1),e.flags|=128,null):n&e.child.childLanes?Gv(t,e,n):(Ye(st,st.current&1),t=wi(t,e,n),t!==null?t.sibling:null);Ye(st,st.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return Jv(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Ye(st,st.current),i)break;return null;case 22:case 23:return e.lanes=0,qv(t,e,n)}return wi(t,e,n)}var Yv,Jd,Qv,Xv;Yv=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Jd=function(){};Qv=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,kr(ni.current);var s=null;switch(n){case"input":r=vd(t,r),i=vd(t,i),s=[];break;case"select":r=at({},r,{value:void 0}),i=at({},i,{value:void 0}),s=[];break;case"textarea":r=Sd(t,r),i=Sd(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=lc)}Cd(n,i);var o;n=null;for(l in r)if(!i.hasOwnProperty(l)&&r.hasOwnProperty(l)&&r[l]!=null)if(l==="style"){var a=r[l];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Ro.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in i){var c=i[l];if(a=r!=null?r[l]:void 0,i.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Ro.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&Xe("scroll",t),s||a===c||(s=[])):(s=s||[]).push(l,c))}n&&(s=s||[]).push("style",n);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};Xv=function(t,e,n,i){n!==i&&(e.flags|=4)};function Js(t,e){if(!nt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Ut(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function Yb(t,e,n){var i=e.pendingProps;switch(hh(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ut(e),null;case 1:return an(e.type)&&dc(),Ut(e),null;case 3:return i=e.stateNode,Es(),Ze(on),Ze(zt),bh(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(ya(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,jn!==null&&(iu(jn),jn=null))),Jd(t,e),Ut(e),null;case 5:Sh(e);var r=kr(Uo.current);if(n=e.type,t!==null&&e.stateNode!=null)Qv(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(j(166));return Ut(e),null}if(t=kr(ni.current),ya(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[ei]=e,i[jo]=s,t=(e.mode&1)!==0,n){case"dialog":Xe("cancel",i),Xe("close",i);break;case"iframe":case"object":case"embed":Xe("load",i);break;case"video":case"audio":for(r=0;r<ao.length;r++)Xe(ao[r],i);break;case"source":Xe("error",i);break;case"img":case"image":case"link":Xe("error",i),Xe("load",i);break;case"details":Xe("toggle",i);break;case"input":Pf(i,s),Xe("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Xe("invalid",i);break;case"textarea":Af(i,s),Xe("invalid",i)}Cd(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&va(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&va(i.textContent,a,t),r=["children",""+a]):Ro.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Xe("scroll",i)}switch(n){case"input":la(i),_f(i,s,!0);break;case"textarea":la(i),Df(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=lc)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=xg(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[ei]=e,t[jo]=i,Yv(t,e,!1,!1),e.stateNode=t;e:{switch(o=Td(n,i),n){case"dialog":Xe("cancel",t),Xe("close",t),r=i;break;case"iframe":case"object":case"embed":Xe("load",t),r=i;break;case"video":case"audio":for(r=0;r<ao.length;r++)Xe(ao[r],t);r=i;break;case"source":Xe("error",t),r=i;break;case"img":case"image":case"link":Xe("error",t),Xe("load",t),r=i;break;case"details":Xe("toggle",t),r=i;break;case"input":Pf(t,i),r=vd(t,i),Xe("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=at({},i,{value:void 0}),Xe("invalid",t);break;case"textarea":Af(t,i),r=Sd(t,i),Xe("invalid",t);break;default:r=i}Cd(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?Pg(t,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Rg(t,c)):s==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Io(t,c):typeof c=="number"&&Io(t,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Ro.hasOwnProperty(s)?c!=null&&s==="onScroll"&&Xe("scroll",t):c!=null&&Qu(t,s,c,o))}switch(n){case"input":la(t),_f(t,i,!1);break;case"textarea":la(t),Df(t);break;case"option":i.value!=null&&t.setAttribute("value",""+tr(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?ns(t,!!i.multiple,s,!1):i.defaultValue!=null&&ns(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=lc)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ut(e),null;case 6:if(t&&e.stateNode!=null)Xv(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(j(166));if(n=kr(Uo.current),kr(ni.current),ya(e)){if(i=e.stateNode,n=e.memoizedProps,i[ei]=e,(s=i.nodeValue!==n)&&(t=mn,t!==null))switch(t.tag){case 3:va(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&va(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[ei]=e,e.stateNode=i}return Ut(e),null;case 13:if(Ze(st),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(nt&&fn!==null&&e.mode&1&&!(e.flags&128))gv(),Cs(),e.flags|=98560,s=!1;else if(s=ya(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(j(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(j(317));s[ei]=e}else Cs(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ut(e),s=!1}else jn!==null&&(iu(jn),jn=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||st.current&1?xt===0&&(xt=3):Nh())),e.updateQueue!==null&&(e.flags|=4),Ut(e),null);case 4:return Es(),Jd(t,e),t===null&&Lo(e.stateNode.containerInfo),Ut(e),null;case 10:return gh(e.type._context),Ut(e),null;case 17:return an(e.type)&&dc(),Ut(e),null;case 19:if(Ze(st),s=e.memoizedState,s===null)return Ut(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)Js(s,!1);else{if(xt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=vc(t),o!==null){for(e.flags|=128,Js(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ye(st,st.current&1|2),e.child}t=t.sibling}s.tail!==null&&vt()>xs&&(e.flags|=128,i=!0,Js(s,!1),e.lanes=4194304)}else{if(!i)if(t=vc(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Js(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!nt)return Ut(e),null}else 2*vt()-s.renderingStartTime>xs&&n!==1073741824&&(e.flags|=128,i=!0,Js(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=vt(),e.sibling=null,n=st.current,Ye(st,i?n&1|2:n&1),e):(Ut(e),null);case 22:case 23:return Dh(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?hn&1073741824&&(Ut(e),e.subtreeFlags&6&&(e.flags|=8192)):Ut(e),null;case 24:return null;case 25:return null}throw Error(j(156,e.tag))}function Qb(t,e){switch(hh(e),e.tag){case 1:return an(e.type)&&dc(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Es(),Ze(on),Ze(zt),bh(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Sh(e),null;case 13:if(Ze(st),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(j(340));Cs()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ze(st),null;case 4:return Es(),null;case 10:return gh(e.type._context),null;case 22:case 23:return Dh(),null;case 24:return null;default:return null}}var ba=!1,Bt=!1,Xb=typeof WeakSet=="function"?WeakSet:Set,re=null;function Qr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){ut(t,e,i)}else n.current=null}function Yd(t,e,n){try{n()}catch(i){ut(t,e,i)}}var bp=!1;function Zb(t,e){if(Nd=oc,t=iv(),dh(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,l=0,d=0,h=t,f=null;t:for(;;){for(var p;h!==n||r!==0&&h.nodeType!==3||(a=o+r),h!==s||i!==0&&h.nodeType!==3||(c=o+i),h.nodeType===3&&(o+=h.nodeValue.length),(p=h.firstChild)!==null;)f=h,h=p;for(;;){if(h===t)break t;if(f===n&&++l===r&&(a=o),f===s&&++d===i&&(c=o),(p=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=p}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Od={focusedElem:t,selectionRange:n},oc=!1,re=e;re!==null;)if(e=re,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,re=t;else for(;re!==null;){e=re;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var v=y.memoizedProps,T=y.memoizedState,g=e.stateNode,m=g.getSnapshotBeforeUpdate(e.elementType===e.type?v:Nn(e.type,v),T);g.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(j(163))}}catch(k){ut(e,e.return,k)}if(t=e.sibling,t!==null){t.return=e.return,re=t;break}re=e.return}return y=bp,bp=!1,y}function So(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&Yd(e,n,s)}r=r.next}while(r!==i)}}function qc(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function Qd(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Zv(t){var e=t.alternate;e!==null&&(t.alternate=null,Zv(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ei],delete e[jo],delete e[jd],delete e[Lb],delete e[Mb])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function ey(t){return t.tag===5||t.tag===3||t.tag===4}function Cp(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||ey(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Xd(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=lc));else if(i!==4&&(t=t.child,t!==null))for(Xd(t,e,n),t=t.sibling;t!==null;)Xd(t,e,n),t=t.sibling}function Zd(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Zd(t,e,n),t=t.sibling;t!==null;)Zd(t,e,n),t=t.sibling}var Nt=null,Ln=!1;function Pi(t,e,n){for(n=n.child;n!==null;)ty(t,e,n),n=n.sibling}function ty(t,e,n){if(ti&&typeof ti.onCommitFiberUnmount=="function")try{ti.onCommitFiberUnmount(jc,n)}catch{}switch(n.tag){case 5:Bt||Qr(n,e);case 6:var i=Nt,r=Ln;Nt=null,Pi(t,e,n),Nt=i,Ln=r,Nt!==null&&(Ln?(t=Nt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Nt.removeChild(n.stateNode));break;case 18:Nt!==null&&(Ln?(t=Nt,n=n.stateNode,t.nodeType===8?Nl(t.parentNode,n):t.nodeType===1&&Nl(t,n),Do(t)):Nl(Nt,n.stateNode));break;case 4:i=Nt,r=Ln,Nt=n.stateNode.containerInfo,Ln=!0,Pi(t,e,n),Nt=i,Ln=r;break;case 0:case 11:case 14:case 15:if(!Bt&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Yd(n,e,o),r=r.next}while(r!==i)}Pi(t,e,n);break;case 1:if(!Bt&&(Qr(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){ut(n,e,a)}Pi(t,e,n);break;case 21:Pi(t,e,n);break;case 22:n.mode&1?(Bt=(i=Bt)||n.memoizedState!==null,Pi(t,e,n),Bt=i):Pi(t,e,n);break;default:Pi(t,e,n)}}function Tp(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Xb),e.forEach(function(i){var r=cC.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function An(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Nt=a.stateNode,Ln=!1;break e;case 3:Nt=a.stateNode.containerInfo,Ln=!0;break e;case 4:Nt=a.stateNode.containerInfo,Ln=!0;break e}a=a.return}if(Nt===null)throw Error(j(160));ty(s,o,r),Nt=null,Ln=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(l){ut(r,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)ny(e,t),e=e.sibling}function ny(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(An(e,t),Gn(t),i&4){try{So(3,t,t.return),qc(3,t)}catch(v){ut(t,t.return,v)}try{So(5,t,t.return)}catch(v){ut(t,t.return,v)}}break;case 1:An(e,t),Gn(t),i&512&&n!==null&&Qr(n,n.return);break;case 5:if(An(e,t),Gn(t),i&512&&n!==null&&Qr(n,n.return),t.flags&32){var r=t.stateNode;try{Io(r,"")}catch(v){ut(t,t.return,v)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&Eg(r,s),Td(a,o);var l=Td(a,s);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];d==="style"?Pg(r,h):d==="dangerouslySetInnerHTML"?Rg(r,h):d==="children"?Io(r,h):Qu(r,d,h,l)}switch(a){case"input":yd(r,s);break;case"textarea":wg(r,s);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?ns(r,!!s.multiple,p,!1):f!==!!s.multiple&&(s.defaultValue!=null?ns(r,!!s.multiple,s.defaultValue,!0):ns(r,!!s.multiple,s.multiple?[]:"",!1))}r[jo]=s}catch(v){ut(t,t.return,v)}}break;case 6:if(An(e,t),Gn(t),i&4){if(t.stateNode===null)throw Error(j(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(v){ut(t,t.return,v)}}break;case 3:if(An(e,t),Gn(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Do(e.containerInfo)}catch(v){ut(t,t.return,v)}break;case 4:An(e,t),Gn(t);break;case 13:An(e,t),Gn(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(_h=vt())),i&4&&Tp(t);break;case 22:if(d=n!==null&&n.memoizedState!==null,t.mode&1?(Bt=(l=Bt)||d,An(e,t),Bt=l):An(e,t),Gn(t),i&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!d&&t.mode&1)for(re=t,d=t.child;d!==null;){for(h=re=d;re!==null;){switch(f=re,p=f.child,f.tag){case 0:case 11:case 14:case 15:So(4,f,f.return);break;case 1:Qr(f,f.return);var y=f.stateNode;if(typeof y.componentWillUnmount=="function"){i=f,n=f.return;try{e=i,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(v){ut(i,n,v)}}break;case 5:Qr(f,f.return);break;case 22:if(f.memoizedState!==null){wp(h);continue}}p!==null?(p.return=f,re=p):wp(h)}d=d.sibling}e:for(d=null,h=t;;){if(h.tag===5){if(d===null){d=h;try{r=h.stateNode,l?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=Ig("display",o))}catch(v){ut(t,t.return,v)}}}else if(h.tag===6){if(d===null)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(v){ut(t,t.return,v)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:An(e,t),Gn(t),i&4&&Tp(t);break;case 21:break;default:An(e,t),Gn(t)}}function Gn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(ey(n)){var i=n;break e}n=n.return}throw Error(j(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Io(r,""),i.flags&=-33);var s=Cp(t);Zd(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Cp(t);Xd(t,a,o);break;default:throw Error(j(161))}}catch(c){ut(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function eC(t,e,n){re=t,iy(t)}function iy(t,e,n){for(var i=(t.mode&1)!==0;re!==null;){var r=re,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||ba;if(!o){var a=r.alternate,c=a!==null&&a.memoizedState!==null||Bt;a=ba;var l=Bt;if(ba=o,(Bt=c)&&!l)for(re=r;re!==null;)o=re,c=o.child,o.tag===22&&o.memoizedState!==null?xp(r):c!==null?(c.return=o,re=c):xp(r);for(;s!==null;)re=s,iy(s),s=s.sibling;re=r,ba=a,Bt=l}Ep(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,re=s):Ep(t)}}function Ep(t){for(;re!==null;){var e=re;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Bt||qc(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Bt)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Nn(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&cp(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}cp(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var d=l.memoizedState;if(d!==null){var h=d.dehydrated;h!==null&&Do(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(j(163))}Bt||e.flags&512&&Qd(e)}catch(f){ut(e,e.return,f)}}if(e===t){re=null;break}if(n=e.sibling,n!==null){n.return=e.return,re=n;break}re=e.return}}function wp(t){for(;re!==null;){var e=re;if(e===t){re=null;break}var n=e.sibling;if(n!==null){n.return=e.return,re=n;break}re=e.return}}function xp(t){for(;re!==null;){var e=re;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{qc(4,e)}catch(c){ut(e,n,c)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(c){ut(e,r,c)}}var s=e.return;try{Qd(e)}catch(c){ut(e,s,c)}break;case 5:var o=e.return;try{Qd(e)}catch(c){ut(e,o,c)}}}catch(c){ut(e,e.return,c)}if(e===t){re=null;break}var a=e.sibling;if(a!==null){a.return=e.return,re=a;break}re=e.return}}var tC=Math.ceil,Sc=Ri.ReactCurrentDispatcher,Ih=Ri.ReactCurrentOwner,Rn=Ri.ReactCurrentBatchConfig,Be=0,Dt=null,bt=null,Mt=0,hn=0,Xr=ar(0),xt=0,Wo=null,xr=0,Hc=0,Ph=0,bo=null,en=null,_h=0,xs=1/0,ui=null,bc=!1,eu=null,Ji=null,Ca=!1,zi=null,Cc=0,Co=0,tu=null,La=-1,Ma=0;function Ht(){return Be&6?vt():La!==-1?La:La=vt()}function Yi(t){return t.mode&1?Be&2&&Mt!==0?Mt&-Mt:Fb.transition!==null?(Ma===0&&(Ma=zg()),Ma):(t=qe,t!==0||(t=window.event,t=t===void 0?16:Gg(t.type)),t):1}function $n(t,e,n,i){if(50<Co)throw Co=0,tu=null,Error(j(185));ea(t,n,i),(!(Be&2)||t!==Dt)&&(t===Dt&&(!(Be&2)&&(Hc|=n),xt===4&&Fi(t,Mt)),cn(t,i),n===1&&Be===0&&!(e.mode&1)&&(xs=vt()+500,Vc&&cr()))}function cn(t,e){var n=t.callbackNode;FS(t,e);var i=sc(t,t===Dt?Mt:0);if(i===0)n!==null&&Lf(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&Lf(n),e===1)t.tag===0?jb(Rp.bind(null,t)):fv(Rp.bind(null,t)),Nb(function(){!(Be&6)&&cr()}),n=null;else{switch(Vg(i)){case 1:n=nh;break;case 4:n=Ug;break;case 16:n=rc;break;case 536870912:n=Bg;break;default:n=rc}n=uy(n,ry.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function ry(t,e){if(La=-1,Ma=0,Be&6)throw Error(j(327));var n=t.callbackNode;if(as()&&t.callbackNode!==n)return null;var i=sc(t,t===Dt?Mt:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Tc(t,i);else{e=i;var r=Be;Be|=2;var s=oy();(Dt!==t||Mt!==e)&&(ui=null,xs=vt()+500,Sr(t,e));do try{rC();break}catch(a){sy(t,a)}while(!0);mh(),Sc.current=s,Be=r,bt!==null?e=0:(Dt=null,Mt=0,e=xt)}if(e!==0){if(e===2&&(r=Id(t),r!==0&&(i=r,e=nu(t,r))),e===1)throw n=Wo,Sr(t,0),Fi(t,i),cn(t,vt()),n;if(e===6)Fi(t,i);else{if(r=t.current.alternate,!(i&30)&&!nC(r)&&(e=Tc(t,i),e===2&&(s=Id(t),s!==0&&(i=s,e=nu(t,s))),e===1))throw n=Wo,Sr(t,0),Fi(t,i),cn(t,vt()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(j(345));case 2:pr(t,en,ui);break;case 3:if(Fi(t,i),(i&130023424)===i&&(e=_h+500-vt(),10<e)){if(sc(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Ht(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Md(pr.bind(null,t,en,ui),e);break}pr(t,en,ui);break;case 4:if(Fi(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-Wn(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=vt()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*tC(i/1960))-i,10<i){t.timeoutHandle=Md(pr.bind(null,t,en,ui),i);break}pr(t,en,ui);break;case 5:pr(t,en,ui);break;default:throw Error(j(329))}}}return cn(t,vt()),t.callbackNode===n?ry.bind(null,t):null}function nu(t,e){var n=bo;return t.current.memoizedState.isDehydrated&&(Sr(t,e).flags|=256),t=Tc(t,e),t!==2&&(e=en,en=n,e!==null&&iu(e)),t}function iu(t){en===null?en=t:en.push.apply(en,t)}function nC(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!qn(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Fi(t,e){for(e&=~Ph,e&=~Hc,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Wn(e),i=1<<n;t[n]=-1,e&=~i}}function Rp(t){if(Be&6)throw Error(j(327));as();var e=sc(t,0);if(!(e&1))return cn(t,vt()),null;var n=Tc(t,e);if(t.tag!==0&&n===2){var i=Id(t);i!==0&&(e=i,n=nu(t,i))}if(n===1)throw n=Wo,Sr(t,0),Fi(t,e),cn(t,vt()),n;if(n===6)throw Error(j(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,pr(t,en,ui),cn(t,vt()),null}function Ah(t,e){var n=Be;Be|=1;try{return t(e)}finally{Be=n,Be===0&&(xs=vt()+500,Vc&&cr())}}function Rr(t){zi!==null&&zi.tag===0&&!(Be&6)&&as();var e=Be;Be|=1;var n=Rn.transition,i=qe;try{if(Rn.transition=null,qe=1,t)return t()}finally{qe=i,Rn.transition=n,Be=e,!(Be&6)&&cr()}}function Dh(){hn=Xr.current,Ze(Xr)}function Sr(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Db(n)),bt!==null)for(n=bt.return;n!==null;){var i=n;switch(hh(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&dc();break;case 3:Es(),Ze(on),Ze(zt),bh();break;case 5:Sh(i);break;case 4:Es();break;case 13:Ze(st);break;case 19:Ze(st);break;case 10:gh(i.type._context);break;case 22:case 23:Dh()}n=n.return}if(Dt=t,bt=t=Qi(t.current,null),Mt=hn=e,xt=0,Wo=null,Ph=Hc=xr=0,en=bo=null,yr!==null){for(e=0;e<yr.length;e++)if(n=yr[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}yr=null}return t}function sy(t,e){do{var n=bt;try{if(mh(),Da.current=kc,yc){for(var i=ot.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}yc=!1}if(wr=0,Pt=Et=ot=null,ko=!1,Bo=0,Ih.current=null,n===null||n.return===null){xt=1,Wo=e,bt=null;break}e:{var s=t,o=n.return,a=n,c=e;if(e=Mt,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,d=a,h=d.tag;if(!(d.mode&1)&&(h===0||h===11||h===15)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=pp(o);if(p!==null){p.flags&=-257,mp(p,o,a,s,e),p.mode&1&&fp(s,l,e),e=p,c=l;var y=e.updateQueue;if(y===null){var v=new Set;v.add(c),e.updateQueue=v}else y.add(c);break e}else{if(!(e&1)){fp(s,l,e),Nh();break e}c=Error(j(426))}}else if(nt&&a.mode&1){var T=pp(o);if(T!==null){!(T.flags&65536)&&(T.flags|=256),mp(T,o,a,s,e),fh(ws(c,a));break e}}s=c=ws(c,a),xt!==4&&(xt=2),bo===null?bo=[s]:bo.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var g=Vv(s,c,e);ap(s,g);break e;case 1:a=c;var m=s.type,S=s.stateNode;if(!(s.flags&128)&&(typeof m.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Ji===null||!Ji.has(S)))){s.flags|=65536,e&=-e,s.lanes|=e;var k=Wv(s,a,e);ap(s,k);break e}}s=s.return}while(s!==null)}cy(n)}catch(E){e=E,bt===n&&n!==null&&(bt=n=n.return);continue}break}while(!0)}function oy(){var t=Sc.current;return Sc.current=kc,t===null?kc:t}function Nh(){(xt===0||xt===3||xt===2)&&(xt=4),Dt===null||!(xr&268435455)&&!(Hc&268435455)||Fi(Dt,Mt)}function Tc(t,e){var n=Be;Be|=2;var i=oy();(Dt!==t||Mt!==e)&&(ui=null,Sr(t,e));do try{iC();break}catch(r){sy(t,r)}while(!0);if(mh(),Be=n,Sc.current=i,bt!==null)throw Error(j(261));return Dt=null,Mt=0,xt}function iC(){for(;bt!==null;)ay(bt)}function rC(){for(;bt!==null&&!PS();)ay(bt)}function ay(t){var e=dy(t.alternate,t,hn);t.memoizedProps=t.pendingProps,e===null?cy(t):bt=e,Ih.current=null}function cy(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Qb(n,e),n!==null){n.flags&=32767,bt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{xt=6,bt=null;return}}else if(n=Yb(n,e,hn),n!==null){bt=n;return}if(e=e.sibling,e!==null){bt=e;return}bt=e=t}while(e!==null);xt===0&&(xt=5)}function pr(t,e,n){var i=qe,r=Rn.transition;try{Rn.transition=null,qe=1,sC(t,e,n,i)}finally{Rn.transition=r,qe=i}return null}function sC(t,e,n,i){do as();while(zi!==null);if(Be&6)throw Error(j(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(j(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(US(t,s),t===Dt&&(bt=Dt=null,Mt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ca||(Ca=!0,uy(rc,function(){return as(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Rn.transition,Rn.transition=null;var o=qe;qe=1;var a=Be;Be|=4,Ih.current=null,Zb(t,n),ny(n,t),wb(Od),oc=!!Nd,Od=Nd=null,t.current=n,eC(n),_S(),Be=a,qe=o,Rn.transition=s}else t.current=n;if(Ca&&(Ca=!1,zi=t,Cc=r),s=t.pendingLanes,s===0&&(Ji=null),NS(n.stateNode),cn(t,vt()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(bc)throw bc=!1,t=eu,eu=null,t;return Cc&1&&t.tag!==0&&as(),s=t.pendingLanes,s&1?t===tu?Co++:(Co=0,tu=t):Co=0,cr(),null}function as(){if(zi!==null){var t=Vg(Cc),e=Rn.transition,n=qe;try{if(Rn.transition=null,qe=16>t?16:t,zi===null)var i=!1;else{if(t=zi,zi=null,Cc=0,Be&6)throw Error(j(331));var r=Be;for(Be|=4,re=t.current;re!==null;){var s=re,o=s.child;if(re.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(re=l;re!==null;){var d=re;switch(d.tag){case 0:case 11:case 15:So(8,d,s)}var h=d.child;if(h!==null)h.return=d,re=h;else for(;re!==null;){d=re;var f=d.sibling,p=d.return;if(Zv(d),d===l){re=null;break}if(f!==null){f.return=p,re=f;break}re=p}}}var y=s.alternate;if(y!==null){var v=y.child;if(v!==null){y.child=null;do{var T=v.sibling;v.sibling=null,v=T}while(v!==null)}}re=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,re=o;else e:for(;re!==null;){if(s=re,s.flags&2048)switch(s.tag){case 0:case 11:case 15:So(9,s,s.return)}var g=s.sibling;if(g!==null){g.return=s.return,re=g;break e}re=s.return}}var m=t.current;for(re=m;re!==null;){o=re;var S=o.child;if(o.subtreeFlags&2064&&S!==null)S.return=o,re=S;else e:for(o=m;re!==null;){if(a=re,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:qc(9,a)}}catch(E){ut(a,a.return,E)}if(a===o){re=null;break e}var k=a.sibling;if(k!==null){k.return=a.return,re=k;break e}re=a.return}}if(Be=r,cr(),ti&&typeof ti.onPostCommitFiberRoot=="function")try{ti.onPostCommitFiberRoot(jc,t)}catch{}i=!0}return i}finally{qe=n,Rn.transition=e}}return!1}function Ip(t,e,n){e=ws(n,e),e=Vv(t,e,1),t=Gi(t,e,1),e=Ht(),t!==null&&(ea(t,1,e),cn(t,e))}function ut(t,e,n){if(t.tag===3)Ip(t,t,n);else for(;e!==null;){if(e.tag===3){Ip(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Ji===null||!Ji.has(i))){t=ws(n,t),t=Wv(e,t,1),e=Gi(e,t,1),t=Ht(),e!==null&&(ea(e,1,t),cn(e,t));break}}e=e.return}}function oC(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Ht(),t.pingedLanes|=t.suspendedLanes&n,Dt===t&&(Mt&n)===n&&(xt===4||xt===3&&(Mt&130023424)===Mt&&500>vt()-_h?Sr(t,0):Ph|=n),cn(t,e)}function ly(t,e){e===0&&(t.mode&1?(e=ha,ha<<=1,!(ha&130023424)&&(ha=4194304)):e=1);var n=Ht();t=Ei(t,e),t!==null&&(ea(t,e,n),cn(t,n))}function aC(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),ly(t,n)}function cC(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(j(314))}i!==null&&i.delete(e),ly(t,n)}var dy;dy=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||on.current)nn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return nn=!1,Jb(t,e,n);nn=!!(t.flags&131072)}else nn=!1,nt&&e.flags&1048576&&pv(e,fc,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Oa(t,e),t=e.pendingProps;var r=bs(e,zt.current);os(e,n),r=Th(null,e,i,t,r,n);var s=Eh();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,an(i)?(s=!0,uc(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,yh(e),r.updater=$c,e.stateNode=r,r._reactInternals=e,Wd(e,i,t,n),e=Hd(null,e,i,!0,s,n)):(e.tag=0,nt&&s&&uh(e),Wt(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Oa(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=dC(i),t=Nn(i,t),r){case 0:e=qd(null,e,i,t,n);break e;case 1:e=yp(null,e,i,t,n);break e;case 11:e=gp(null,e,i,t,n);break e;case 14:e=vp(null,e,i,Nn(i.type,t),n);break e}throw Error(j(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Nn(i,r),qd(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Nn(i,r),yp(t,e,i,r,n);case 3:e:{if(Kv(e),t===null)throw Error(j(387));i=e.pendingProps,s=e.memoizedState,r=s.element,Sv(t,e),gc(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=ws(Error(j(423)),e),e=kp(t,e,i,n,r);break e}else if(i!==r){r=ws(Error(j(424)),e),e=kp(t,e,i,n,r);break e}else for(fn=Ki(e.stateNode.containerInfo.firstChild),mn=e,nt=!0,jn=null,n=yv(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Cs(),i===r){e=wi(t,e,n);break e}Wt(t,e,i,n)}e=e.child}return e;case 5:return bv(e),t===null&&Bd(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,Ld(i,r)?o=null:s!==null&&Ld(i,s)&&(e.flags|=32),Hv(t,e),Wt(t,e,o,n),e.child;case 6:return t===null&&Bd(e),null;case 13:return Gv(t,e,n);case 4:return kh(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Ts(e,null,i,n):Wt(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Nn(i,r),gp(t,e,i,r,n);case 7:return Wt(t,e,e.pendingProps,n),e.child;case 8:return Wt(t,e,e.pendingProps.children,n),e.child;case 12:return Wt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,Ye(pc,i._currentValue),i._currentValue=o,s!==null)if(qn(s.value,o)){if(s.children===r.children&&!on.current){e=wi(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===i){if(s.tag===1){c=bi(-1,n&-n),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var d=l.pending;d===null?c.next=c:(c.next=d.next,d.next=c),l.pending=c}}s.lanes|=n,c=s.alternate,c!==null&&(c.lanes|=n),zd(s.return,n,e),a.lanes|=n;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(j(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),zd(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Wt(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,os(e,n),r=In(r),i=i(r),e.flags|=1,Wt(t,e,i,n),e.child;case 14:return i=e.type,r=Nn(i,e.pendingProps),r=Nn(i.type,r),vp(t,e,i,r,n);case 15:return $v(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Nn(i,r),Oa(t,e),e.tag=1,an(i)?(t=!0,uc(e)):t=!1,os(e,n),zv(e,i,r),Wd(e,i,r,n),Hd(null,e,i,!0,t,n);case 19:return Jv(t,e,n);case 22:return qv(t,e,n)}throw Error(j(156,e.tag))};function uy(t,e){return Fg(t,e)}function lC(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wn(t,e,n,i){return new lC(t,e,n,i)}function Oh(t){return t=t.prototype,!(!t||!t.isReactComponent)}function dC(t){if(typeof t=="function")return Oh(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Zu)return 11;if(t===eh)return 14}return 2}function Qi(t,e){var n=t.alternate;return n===null?(n=wn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function ja(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")Oh(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Vr:return br(n.children,r,s,e);case Xu:o=8,r|=8;break;case fd:return t=wn(12,n,e,r|2),t.elementType=fd,t.lanes=s,t;case pd:return t=wn(13,n,e,r),t.elementType=pd,t.lanes=s,t;case md:return t=wn(19,n,e,r),t.elementType=md,t.lanes=s,t;case bg:return Kc(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case kg:o=10;break e;case Sg:o=9;break e;case Zu:o=11;break e;case eh:o=14;break e;case Li:o=16,i=null;break e}throw Error(j(130,t==null?t:typeof t,""))}return e=wn(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function br(t,e,n,i){return t=wn(7,t,i,e),t.lanes=n,t}function Kc(t,e,n,i){return t=wn(22,t,i,e),t.elementType=bg,t.lanes=n,t.stateNode={isHidden:!1},t}function zl(t,e,n){return t=wn(6,t,null,e),t.lanes=n,t}function Vl(t,e,n){return e=wn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function uC(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Cl(0),this.expirationTimes=Cl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Cl(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Lh(t,e,n,i,r,s,o,a,c){return t=new uC(t,e,n,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=wn(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},yh(s),t}function hC(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:zr,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function hy(t){if(!t)return nr;t=t._reactInternals;e:{if(Dr(t)!==t||t.tag!==1)throw Error(j(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(an(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(j(171))}if(t.tag===1){var n=t.type;if(an(n))return hv(t,n,e)}return e}function fy(t,e,n,i,r,s,o,a,c){return t=Lh(n,i,!0,t,r,s,o,a,c),t.context=hy(null),n=t.current,i=Ht(),r=Yi(n),s=bi(i,r),s.callback=e??null,Gi(n,s,r),t.current.lanes=r,ea(t,r,i),cn(t,i),t}function Gc(t,e,n,i){var r=e.current,s=Ht(),o=Yi(r);return n=hy(n),e.context===null?e.context=n:e.pendingContext=n,e=bi(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Gi(r,e,o),t!==null&&($n(t,r,o,s),Aa(t,r,o)),o}function Ec(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Pp(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Mh(t,e){Pp(t,e),(t=t.alternate)&&Pp(t,e)}function fC(){return null}var py=typeof reportError=="function"?reportError:function(t){console.error(t)};function jh(t){this._internalRoot=t}Jc.prototype.render=jh.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(j(409));Gc(t,e,null,null)};Jc.prototype.unmount=jh.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Rr(function(){Gc(null,t,null,null)}),e[Ti]=null}};function Jc(t){this._internalRoot=t}Jc.prototype.unstable_scheduleHydration=function(t){if(t){var e=qg();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ji.length&&e!==0&&e<ji[n].priority;n++);ji.splice(n,0,t),n===0&&Kg(t)}};function Fh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Yc(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function _p(){}function pC(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var l=Ec(o);s.call(l)}}var o=fy(e,i,t,0,null,!1,!1,"",_p);return t._reactRootContainer=o,t[Ti]=o.current,Lo(t.nodeType===8?t.parentNode:t),Rr(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var l=Ec(c);a.call(l)}}var c=Lh(t,0,!1,null,null,!1,!1,"",_p);return t._reactRootContainer=c,t[Ti]=c.current,Lo(t.nodeType===8?t.parentNode:t),Rr(function(){Gc(e,c,n,i)}),c}function Qc(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var c=Ec(o);a.call(c)}}Gc(e,o,t,r)}else o=pC(n,e,t,r,i);return Ec(o)}Wg=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=oo(e.pendingLanes);n!==0&&(ih(e,n|1),cn(e,vt()),!(Be&6)&&(xs=vt()+500,cr()))}break;case 13:Rr(function(){var i=Ei(t,1);if(i!==null){var r=Ht();$n(i,t,1,r)}}),Mh(t,1)}};rh=function(t){if(t.tag===13){var e=Ei(t,134217728);if(e!==null){var n=Ht();$n(e,t,134217728,n)}Mh(t,134217728)}};$g=function(t){if(t.tag===13){var e=Yi(t),n=Ei(t,e);if(n!==null){var i=Ht();$n(n,t,e,i)}Mh(t,e)}};qg=function(){return qe};Hg=function(t,e){var n=qe;try{return qe=t,e()}finally{qe=n}};wd=function(t,e,n){switch(e){case"input":if(yd(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=zc(i);if(!r)throw Error(j(90));Tg(i),yd(i,r)}}}break;case"textarea":wg(t,n);break;case"select":e=n.value,e!=null&&ns(t,!!n.multiple,e,!1)}};Dg=Ah;Ng=Rr;var mC={usingClientEntryPoint:!1,Events:[na,Hr,zc,_g,Ag,Ah]},Ys={findFiberByHostInstance:vr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},gC={bundleType:Ys.bundleType,version:Ys.version,rendererPackageName:Ys.rendererPackageName,rendererConfig:Ys.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ri.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Mg(t),t===null?null:t.stateNode},findFiberByHostInstance:Ys.findFiberByHostInstance||fC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ta=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ta.isDisabled&&Ta.supportsFiber)try{jc=Ta.inject(gC),ti=Ta}catch{}}vn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mC;vn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Fh(e))throw Error(j(200));return hC(t,e,null,n)};vn.createRoot=function(t,e){if(!Fh(t))throw Error(j(299));var n=!1,i="",r=py;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Lh(t,1,!1,null,null,n,!1,i,r),t[Ti]=e.current,Lo(t.nodeType===8?t.parentNode:t),new jh(e)};vn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(j(188)):(t=Object.keys(t).join(","),Error(j(268,t)));return t=Mg(e),t=t===null?null:t.stateNode,t};vn.flushSync=function(t){return Rr(t)};vn.hydrate=function(t,e,n){if(!Yc(e))throw Error(j(200));return Qc(null,t,e,!0,n)};vn.hydrateRoot=function(t,e,n){if(!Fh(t))throw Error(j(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=py;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=fy(e,null,t,1,n??null,r,!1,s,o),t[Ti]=e.current,Lo(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Jc(e)};vn.render=function(t,e,n){if(!Yc(e))throw Error(j(200));return Qc(null,t,e,!1,n)};vn.unmountComponentAtNode=function(t){if(!Yc(t))throw Error(j(40));return t._reactRootContainer?(Rr(function(){Qc(null,null,t,!1,function(){t._reactRootContainer=null,t[Ti]=null})}),!0):!1};vn.unstable_batchedUpdates=Ah;vn.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Yc(n))throw Error(j(200));if(t==null||t._reactInternals===void 0)throw Error(j(38));return Qc(t,e,n,!1,i)};vn.version="18.3.1-next-f1338f8080-20240426";function my(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(my)}catch(t){console.error(t)}}my(),mg.exports=vn;var vC=mg.exports,Ap=vC;ec.createRoot=Ap.createRoot,ec.hydrateRoot=Ap.hydrateRoot;/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $o(){return $o=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},$o.apply(this,arguments)}var Vi;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Vi||(Vi={}));const Dp="popstate";function yC(t){t===void 0&&(t={});function e(i,r){let{pathname:s,search:o,hash:a}=i.location;return ru("",{pathname:s,search:o,hash:a},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(i,r){return typeof r=="string"?r:gy(r)}return SC(e,n,null,t)}function Ct(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Uh(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function kC(){return Math.random().toString(36).substr(2,8)}function Np(t,e){return{usr:t.state,key:t.key,idx:e}}function ru(t,e,n,i){return n===void 0&&(n=null),$o({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Ls(e):e,{state:n,key:e&&e.key||i||kC()})}function gy(t){let{pathname:e="/",search:n="",hash:i=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function Ls(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substr(i),t=t.substr(0,i)),t&&(e.pathname=t)}return e}function SC(t,e,n,i){i===void 0&&(i={});let{window:r=document.defaultView,v5Compat:s=!1}=i,o=r.history,a=Vi.Pop,c=null,l=d();l==null&&(l=0,o.replaceState($o({},o.state,{idx:l}),""));function d(){return(o.state||{idx:null}).idx}function h(){a=Vi.Pop;let T=d(),g=T==null?null:T-l;l=T,c&&c({action:a,location:v.location,delta:g})}function f(T,g){a=Vi.Push;let m=ru(v.location,T,g);l=d()+1;let S=Np(m,l),k=v.createHref(m);try{o.pushState(S,"",k)}catch(E){if(E instanceof DOMException&&E.name==="DataCloneError")throw E;r.location.assign(k)}s&&c&&c({action:a,location:v.location,delta:1})}function p(T,g){a=Vi.Replace;let m=ru(v.location,T,g);l=d();let S=Np(m,l),k=v.createHref(m);o.replaceState(S,"",k),s&&c&&c({action:a,location:v.location,delta:0})}function y(T){let g=r.location.origin!=="null"?r.location.origin:r.location.href,m=typeof T=="string"?T:gy(T);return m=m.replace(/ $/,"%20"),Ct(g,"No window.location.(origin|href) available to create URL for href: "+m),new URL(m,g)}let v={get action(){return a},get location(){return t(r,o)},listen(T){if(c)throw new Error("A history only accepts one active listener");return r.addEventListener(Dp,h),c=T,()=>{r.removeEventListener(Dp,h),c=null}},createHref(T){return e(r,T)},createURL:y,encodeLocation(T){let g=y(T);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:f,replace:p,go(T){return o.go(T)}};return v}var Op;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Op||(Op={}));function bC(t,e,n){return n===void 0&&(n="/"),CC(t,e,n)}function CC(t,e,n,i){let r=typeof e=="string"?Ls(e):e,s=ky(r.pathname||"/",n);if(s==null)return null;let o=vy(t);TC(o);let a=null;for(let c=0;a==null&&c<o.length;++c){let l=LC(s);a=DC(o[c],l)}return a}function vy(t,e,n,i){e===void 0&&(e=[]),n===void 0&&(n=[]),i===void 0&&(i="");let r=(s,o,a)=>{let c={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};c.relativePath.startsWith("/")&&(Ct(c.relativePath.startsWith(i),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(i.length));let l=Cr([i,c.relativePath]),d=n.concat(c);s.children&&s.children.length>0&&(Ct(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),vy(s.children,e,d,l)),!(s.path==null&&!s.index)&&e.push({path:l,score:_C(l,s.index),routesMeta:d})};return t.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))r(s,o);else for(let c of yy(s.path))r(s,o,c)}),e}function yy(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,r=n.endsWith("?"),s=n.replace(/\?$/,"");if(i.length===0)return r?[s,""]:[s];let o=yy(i.join("/")),a=[];return a.push(...o.map(c=>c===""?s:[s,c].join("/"))),r&&a.push(...o),a.map(c=>t.startsWith("/")&&c===""?"/":c)}function TC(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:AC(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}const EC=/^:[\w-]+$/,wC=3,xC=2,RC=1,IC=10,PC=-2,Lp=t=>t==="*";function _C(t,e){let n=t.split("/"),i=n.length;return n.some(Lp)&&(i+=PC),e&&(i+=xC),n.filter(r=>!Lp(r)).reduce((r,s)=>r+(EC.test(s)?wC:s===""?RC:IC),i)}function AC(t,e){return t.length===e.length&&t.slice(0,-1).every((i,r)=>i===e[r])?t[t.length-1]-e[e.length-1]:0}function DC(t,e,n){let{routesMeta:i}=t,r={},s="/",o=[];for(let a=0;a<i.length;++a){let c=i[a],l=a===i.length-1,d=s==="/"?e:e.slice(s.length)||"/",h=NC({path:c.relativePath,caseSensitive:c.caseSensitive,end:l},d),f=c.route;if(!h)return null;Object.assign(r,h.params),o.push({params:r,pathname:Cr([s,h.pathname]),pathnameBase:BC(Cr([s,h.pathnameBase])),route:f}),h.pathnameBase!=="/"&&(s=Cr([s,h.pathnameBase]))}return o}function NC(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=OC(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let s=r[0],o=s.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:i.reduce((l,d,h)=>{let{paramName:f,isOptional:p}=d;if(f==="*"){let v=a[h]||"";o=s.slice(0,s.length-v.length).replace(/(.)\/+$/,"$1")}const y=a[h];return p&&!y?l[f]=void 0:l[f]=(y||"").replace(/%2F/g,"/"),l},{}),pathname:s,pathnameBase:o,pattern:t}}function OC(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),Uh(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let i=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,c)=>(i.push({paramName:a,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(i.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function LC(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Uh(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function ky(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}const MC=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,jC=t=>MC.test(t);function FC(t,e){e===void 0&&(e="/");let{pathname:n,search:i="",hash:r=""}=typeof t=="string"?Ls(t):t,s;if(n)if(jC(n))s=n;else{if(n.includes("//")){let o=n;n=n.replace(/\/\/+/g,"/"),Uh(!1,"Pathnames cannot have embedded double slashes - normalizing "+(o+" -> "+n))}n.startsWith("/")?s=Mp(n.substring(1),"/"):s=Mp(n,e)}else s=e;return{pathname:s,search:zC(i),hash:VC(r)}}function Mp(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function Wl(t,e,n,i){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function UC(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Sy(t,e){let n=UC(t);return e?n.map((i,r)=>r===n.length-1?i.pathname:i.pathnameBase):n.map(i=>i.pathnameBase)}function by(t,e,n,i){i===void 0&&(i=!1);let r;typeof t=="string"?r=Ls(t):(r=$o({},t),Ct(!r.pathname||!r.pathname.includes("?"),Wl("?","pathname","search",r)),Ct(!r.pathname||!r.pathname.includes("#"),Wl("#","pathname","hash",r)),Ct(!r.search||!r.search.includes("#"),Wl("#","search","hash",r)));let s=t===""||r.pathname==="",o=s?"/":r.pathname,a;if(o==null)a=n;else{let h=e.length-1;if(!i&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),h-=1;r.pathname=f.join("/")}a=h>=0?e[h]:"/"}let c=FC(r,a),l=o&&o!=="/"&&o.endsWith("/"),d=(s||o===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(l||d)&&(c.pathname+="/"),c}const Cr=t=>t.join("/").replace(/\/\/+/g,"/"),BC=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),zC=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,VC=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function WC(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const Cy=["post","put","patch","delete"];new Set(Cy);const $C=["get",...Cy];new Set($C);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function qo(){return qo=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},qo.apply(this,arguments)}const Bh=w.createContext(null),qC=w.createContext(null),ra=w.createContext(null),Xc=w.createContext(null),Nr=w.createContext({outlet:null,matches:[],isDataRoute:!1}),Ty=w.createContext(null);function sa(){return w.useContext(Xc)!=null}function Zc(){return sa()||Ct(!1),w.useContext(Xc).location}function Ey(t){w.useContext(ra).static||w.useLayoutEffect(t)}function Or(){let{isDataRoute:t}=w.useContext(Nr);return t?rT():HC()}function HC(){sa()||Ct(!1);let t=w.useContext(Bh),{basename:e,future:n,navigator:i}=w.useContext(ra),{matches:r}=w.useContext(Nr),{pathname:s}=Zc(),o=JSON.stringify(Sy(r,n.v7_relativeSplatPath)),a=w.useRef(!1);return Ey(()=>{a.current=!0}),w.useCallback(function(l,d){if(d===void 0&&(d={}),!a.current)return;if(typeof l=="number"){i.go(l);return}let h=by(l,JSON.parse(o),s,d.relative==="path");t==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:Cr([e,h.pathname])),(d.replace?i.replace:i.push)(h,d.state,d)},[e,i,o,s,t])}function KC(t,e){return GC(t,e)}function GC(t,e,n,i){sa()||Ct(!1);let{navigator:r}=w.useContext(ra),{matches:s}=w.useContext(Nr),o=s[s.length-1],a=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let l=Zc(),d;if(e){var h;let T=typeof e=="string"?Ls(e):e;c==="/"||(h=T.pathname)!=null&&h.startsWith(c)||Ct(!1),d=T}else d=l;let f=d.pathname||"/",p=f;if(c!=="/"){let T=c.replace(/^\//,"").split("/");p="/"+f.replace(/^\//,"").split("/").slice(T.length).join("/")}let y=bC(t,{pathname:p}),v=ZC(y&&y.map(T=>Object.assign({},T,{params:Object.assign({},a,T.params),pathname:Cr([c,r.encodeLocation?r.encodeLocation(T.pathname).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?c:Cr([c,r.encodeLocation?r.encodeLocation(T.pathnameBase).pathname:T.pathnameBase])})),s,n,i);return e&&v?w.createElement(Xc.Provider,{value:{location:qo({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:Vi.Pop}},v):v}function JC(){let t=iT(),e=WC(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return w.createElement(w.Fragment,null,w.createElement("h2",null,"Unexpected Application Error!"),w.createElement("h3",{style:{fontStyle:"italic"}},e),n?w.createElement("pre",{style:r},n):null,null)}const YC=w.createElement(JC,null);class QC extends w.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?w.createElement(Nr.Provider,{value:this.props.routeContext},w.createElement(Ty.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function XC(t){let{routeContext:e,match:n,children:i}=t,r=w.useContext(Bh);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),w.createElement(Nr.Provider,{value:e},i)}function ZC(t,e,n,i){var r;if(e===void 0&&(e=[]),n===void 0&&(n=null),i===void 0&&(i=null),t==null){var s;if(!n)return null;if(n.errors)t=n.matches;else if((s=i)!=null&&s.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,a=(r=n)==null?void 0:r.errors;if(a!=null){let d=o.findIndex(h=>h.route.id&&(a==null?void 0:a[h.route.id])!==void 0);d>=0||Ct(!1),o=o.slice(0,Math.min(o.length,d+1))}let c=!1,l=-1;if(n&&i&&i.v7_partialHydration)for(let d=0;d<o.length;d++){let h=o[d];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(l=d),h.route.id){let{loaderData:f,errors:p}=n,y=h.route.loader&&f[h.route.id]===void 0&&(!p||p[h.route.id]===void 0);if(h.route.lazy||y){c=!0,l>=0?o=o.slice(0,l+1):o=[o[0]];break}}}return o.reduceRight((d,h,f)=>{let p,y=!1,v=null,T=null;n&&(p=a&&h.route.id?a[h.route.id]:void 0,v=h.route.errorElement||YC,c&&(l<0&&f===0?(sT("route-fallback"),y=!0,T=null):l===f&&(y=!0,T=h.route.hydrateFallbackElement||null)));let g=e.concat(o.slice(0,f+1)),m=()=>{let S;return p?S=v:y?S=T:h.route.Component?S=w.createElement(h.route.Component,null):h.route.element?S=h.route.element:S=d,w.createElement(XC,{match:h,routeContext:{outlet:d,matches:g,isDataRoute:n!=null},children:S})};return n&&(h.route.ErrorBoundary||h.route.errorElement||f===0)?w.createElement(QC,{location:n.location,revalidation:n.revalidation,component:v,error:p,children:m(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):m()},null)}var wy=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(wy||{}),xy=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(xy||{});function eT(t){let e=w.useContext(Bh);return e||Ct(!1),e}function tT(t){let e=w.useContext(qC);return e||Ct(!1),e}function nT(t){let e=w.useContext(Nr);return e||Ct(!1),e}function Ry(t){let e=nT(),n=e.matches[e.matches.length-1];return n.route.id||Ct(!1),n.route.id}function iT(){var t;let e=w.useContext(Ty),n=tT(),i=Ry();return e!==void 0?e:(t=n.errors)==null?void 0:t[i]}function rT(){let{router:t}=eT(wy.UseNavigateStable),e=Ry(xy.UseNavigateStable),n=w.useRef(!1);return Ey(()=>{n.current=!0}),w.useCallback(function(r,s){s===void 0&&(s={}),n.current&&(typeof r=="number"?t.navigate(r):t.navigate(r,qo({fromRouteId:e},s)))},[t,e])}const jp={};function sT(t,e,n){jp[t]||(jp[t]=!0)}function oT(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function Iy(t){let{to:e,replace:n,state:i,relative:r}=t;sa()||Ct(!1);let{future:s,static:o}=w.useContext(ra),{matches:a}=w.useContext(Nr),{pathname:c}=Zc(),l=Or(),d=by(e,Sy(a,s.v7_relativeSplatPath),c,r==="path"),h=JSON.stringify(d);return w.useEffect(()=>l(JSON.parse(h),{replace:n,state:i,relative:r}),[l,h,r,n,i]),null}function co(t){Ct(!1)}function aT(t){let{basename:e="/",children:n=null,location:i,navigationType:r=Vi.Pop,navigator:s,static:o=!1,future:a}=t;sa()&&Ct(!1);let c=e.replace(/^\/*/,"/"),l=w.useMemo(()=>({basename:c,navigator:s,static:o,future:qo({v7_relativeSplatPath:!1},a)}),[c,a,s,o]);typeof i=="string"&&(i=Ls(i));let{pathname:d="/",search:h="",hash:f="",state:p=null,key:y="default"}=i,v=w.useMemo(()=>{let T=ky(d,c);return T==null?null:{location:{pathname:T,search:h,hash:f,state:p,key:y},navigationType:r}},[c,d,h,f,p,y,r]);return v==null?null:w.createElement(ra.Provider,{value:l},w.createElement(Xc.Provider,{children:n,value:v}))}function cT(t){let{children:e,location:n}=t;return KC(su(e),n)}new Promise(()=>{});function su(t,e){e===void 0&&(e=[]);let n=[];return w.Children.forEach(t,(i,r)=>{if(!w.isValidElement(i))return;let s=[...e,r];if(i.type===w.Fragment){n.push.apply(n,su(i.props.children,s));return}i.type!==co&&Ct(!1),!i.props.index||!i.props.children||Ct(!1);let o={id:i.props.id||s.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(o.children=su(i.props.children,s)),n.push(o)}),n}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const lT="6";try{window.__reactRouterVersion=lT}catch{}const dT="startTransition",Fp=oS[dT];function uT(t){let{basename:e,children:n,future:i,window:r}=t,s=w.useRef();s.current==null&&(s.current=yC({window:r,v5Compat:!0}));let o=s.current,[a,c]=w.useState({action:o.action,location:o.location}),{v7_startTransition:l}=i||{},d=w.useCallback(h=>{l&&Fp?Fp(()=>c(h)):c(h)},[c,l]);return w.useLayoutEffect(()=>o.listen(d),[o,d]),w.useEffect(()=>oT(i),[i]),w.createElement(aT,{basename:e,children:n,location:a.location,navigationType:a.action,navigator:o,future:i})}var Up;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Up||(Up={}));var Bp;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(Bp||(Bp={}));const hT="application/json";var pi,Zt,vs,ys,Zn,ks,$e,On,G,Fa,Py,_y,Ay,Dy,ou,Ny,au,Oy,Ly,Ua,lo,cu,Di,My,lu,Ni,Ba,uo,Jn,du;class fT{constructor(e){Sn(this,G);Sn(this,pi,[]);Sn(this,Zt);Sn(this,vs,!0);Sn(this,ys);Sn(this,Zn,te(this,G,du).call(this,console.info));Sn(this,ks,te(this,G,du).call(this,console.warn));Sn(this,$e,{enable:!0,callbackList:[],interval:5});Sn(this,On);de(this,"didInitialize",!1);de(this,"authenticated",!1);de(this,"loginRequired",!1);de(this,"responseMode","fragment");de(this,"responseType","code");de(this,"flow","standard");de(this,"timeSkew",null);de(this,"redirectUri");de(this,"silentCheckSsoRedirectUri");de(this,"silentCheckSsoFallback",!0);de(this,"pkceMethod","S256");de(this,"enableLogging",!1);de(this,"logoutMethod","GET");de(this,"scope");de(this,"messageReceiveTimeout",1e4);de(this,"idToken");de(this,"idTokenParsed");de(this,"token");de(this,"tokenParsed");de(this,"refreshToken");de(this,"refreshTokenParsed");de(this,"clientId");de(this,"sessionId");de(this,"subject");de(this,"authServerUrl");de(this,"realm");de(this,"realmAccess");de(this,"resourceAccess");de(this,"profile");de(this,"userInfo");de(this,"endpoints");de(this,"tokenTimeoutHandle");de(this,"onAuthSuccess");de(this,"onAuthError");de(this,"onAuthRefreshSuccess");de(this,"onAuthRefreshError");de(this,"onTokenExpired");de(this,"onAuthLogout");de(this,"onReady");de(this,"onActionUpdate");de(this,"init",async(e={})=>{var i;if(this.didInitialize)throw new Error("A 'Keycloak' instance can only be initialized once.");this.didInitialize=!0,Ii(this,ys,ST());const n=["default","cordova","cordova-native"];if(typeof e.adapter=="string"&&n.includes(e.adapter)?Ii(this,Zt,te(this,G,Fa).call(this,e.adapter)):typeof e.adapter=="object"?Ii(this,Zt,e.adapter):"Cordova"in window||"cordova"in window?Ii(this,Zt,te(this,G,Fa).call(this,"cordova")):Ii(this,Zt,te(this,G,Fa).call(this,"default")),typeof e.useNonce<"u"&&Ii(this,vs,e.useNonce),typeof e.checkLoginIframe<"u"&&(ae(this,$e).enable=e.checkLoginIframe),e.checkLoginIframeInterval&&(ae(this,$e).interval=e.checkLoginIframeInterval),e.onLoad==="login-required"&&(this.loginRequired=!0),e.responseMode)if(e.responseMode==="query"||e.responseMode==="fragment")this.responseMode=e.responseMode;else throw new Error("Invalid value for responseMode");if(e.flow){switch(e.flow){case"standard":this.responseType="code";break;case"implicit":this.responseType="id_token token";break;case"hybrid":this.responseType="code id_token token";break;default:throw new Error("Invalid value for flow")}this.flow=e.flow}if(typeof e.timeSkew=="number"&&(this.timeSkew=e.timeSkew),e.redirectUri&&(this.redirectUri=e.redirectUri),e.silentCheckSsoRedirectUri&&(this.silentCheckSsoRedirectUri=e.silentCheckSsoRedirectUri),typeof e.silentCheckSsoFallback=="boolean"&&(this.silentCheckSsoFallback=e.silentCheckSsoFallback),typeof e.pkceMethod<"u"){if(e.pkceMethod!=="S256"&&e.pkceMethod!==!1)throw new TypeError(`Invalid value for pkceMethod', expected 'S256' or false but got ${e.pkceMethod}.`);this.pkceMethod=e.pkceMethod}return typeof e.enableLogging=="boolean"&&(this.enableLogging=e.enableLogging),e.logoutMethod==="POST"&&(this.logoutMethod="POST"),typeof e.scope=="string"&&(this.scope=e.scope),typeof e.messageReceiveTimeout=="number"&&e.messageReceiveTimeout>0&&(this.messageReceiveTimeout=e.messageReceiveTimeout),await te(this,G,Dy).call(this),await te(this,G,Oy).call(this),await te(this,G,Ly).call(this,e),(i=this.onReady)==null||i.call(this,this.authenticated),this.authenticated});de(this,"login",e=>ae(this,Zt).login(e));de(this,"createLoginUrl",async e=>{const n=zp(),i=zp(),r=ae(this,Zt).redirectUri(e),s={state:n,nonce:i,redirectUri:r,loginOptions:e};e!=null&&e.prompt&&(s.prompt=e.prompt);const o=(e==null?void 0:e.action)==="register"?this.endpoints.register():this.endpoints.authorize();let a=(e==null?void 0:e.scope)||this.scope;const c=a?a.split(" "):[];c.includes("openid")||c.unshift("openid"),a=c.join(" ");const l=new URLSearchParams([["client_id",this.clientId],["redirect_uri",r],["state",n],["response_mode",this.responseMode],["response_type",this.responseType],["scope",a]]);if(ae(this,vs)&&l.append("nonce",i),e!=null&&e.prompt&&l.append("prompt",e.prompt),typeof(e==null?void 0:e.maxAge)=="number"&&l.append("max_age",e.maxAge.toString()),e!=null&&e.loginHint&&l.append("login_hint",e.loginHint),e!=null&&e.idpHint&&l.append("kc_idp_hint",e.idpHint),e!=null&&e.action&&e.action!=="register"&&l.append("kc_action",e.action),e!=null&&e.locale&&l.append("ui_locales",e.locale),e!=null&&e.acr&&l.append("claims",pT(e.acr)),e!=null&&e.acrValues&&l.append("acr_values",e.acrValues),this.pkceMethod)try{const d=mT(96),h=await gT(this.pkceMethod,d);s.pkceCodeVerifier=d,l.append("code_challenge",h),l.append("code_challenge_method",this.pkceMethod)}catch(d){throw new Error("Failed to generate PKCE challenge.",{cause:d})}return ae(this,ys).add(s),`${o}?${l.toString()}`});de(this,"logout",e=>ae(this,Zt).logout(e));de(this,"createLogoutUrl",e=>{const n=(e==null?void 0:e.logoutMethod)??this.logoutMethod,i=this.endpoints.logout();if(n==="POST")return i;const r=new URLSearchParams([["client_id",this.clientId],["post_logout_redirect_uri",ae(this,Zt).redirectUri(e)]]);return this.idToken&&r.append("id_token_hint",this.idToken),`${i}?${r.toString()}`});de(this,"register",e=>ae(this,Zt).register(e));de(this,"createRegisterUrl",e=>this.createLoginUrl({...e,action:"register"}));de(this,"createAccountUrl",e=>{const n=te(this,G,Jn).call(this);if(!n)throw new Error("Unable to create account URL, make sure the adapter is not configured using a generic OIDC provider.");const i=new URLSearchParams([["referrer",this.clientId],["referrer_uri",ae(this,Zt).redirectUri(e)]]);return`${n}/account?${i.toString()}`});de(this,"accountManagement",()=>ae(this,Zt).accountManagement());de(this,"hasRealmRole",e=>{const n=this.realmAccess;return!!n&&n.roles.indexOf(e)>=0});de(this,"hasResourceRole",(e,n)=>{if(!this.resourceAccess)return!1;const i=this.resourceAccess[n||this.clientId];return!!i&&i.roles.indexOf(e)>=0});de(this,"loadUserProfile",async()=>{const e=te(this,G,Jn).call(this);if(!e)throw new Error("Unable to load user profile, make sure the adapter is not configured using a generic OIDC provider.");const n=`${e}/account`,i=await Rs(n,{headers:[Vp(this.token)]});return this.profile=i});de(this,"loadUserInfo",async()=>{const e=this.endpoints.userinfo(),n=await Rs(e,{headers:[Vp(this.token)]});return this.userInfo=n});de(this,"isTokenExpired",e=>{if(!this.tokenParsed||!this.refreshToken&&this.flow!=="implicit")throw new Error("Not authenticated");if(this.timeSkew==null)return ae(this,Zn).call(this,"[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;if(typeof this.tokenParsed.exp!="number")return!1;let n=this.tokenParsed.exp-Math.ceil(new Date().getTime()/1e3)+this.timeSkew;if(e){if(isNaN(e))throw new Error("Invalid minValidity");n-=e}return n<0});de(this,"updateToken",async e=>{var o,a;if(!this.refreshToken)throw new Error("Unable to update token, no refresh token available.");e=e||5,ae(this,$e).enable&&await te(this,G,lo).call(this);let n=!1;if(e===-1?(n=!0,ae(this,Zn).call(this,"[KEYCLOAK] Refreshing token: forced refresh")):(!this.tokenParsed||this.isTokenExpired(e))&&(n=!0,ae(this,Zn).call(this,"[KEYCLOAK] Refreshing token: token expired")),!n)return!1;const{promise:i,resolve:r,reject:s}=Promise.withResolvers();if(ae(this,pi).push({resolve:r,reject:s}),ae(this,pi).length===1){const c=this.endpoints.token();let l=new Date().getTime();try{const d=await _T(c,this.refreshToken,this.clientId);ae(this,Zn).call(this,"[KEYCLOAK] Token refreshed"),l=(l+new Date().getTime())/2,te(this,G,uo).call(this,d.access_token,d.refresh_token,d.id_token,l),(o=this.onAuthRefreshSuccess)==null||o.call(this);for(let h=ae(this,pi).pop();h!=null;h=ae(this,pi).pop())h.resolve(!0)}catch(d){ae(this,ks).call(this,"[KEYCLOAK] Failed to refresh token"),d instanceof By&&d.response.status===400&&this.clearToken(),(a=this.onAuthRefreshError)==null||a.call(this);for(let h=ae(this,pi).pop();h!=null;h=ae(this,pi).pop())h.reject(d)}}return await i});de(this,"clearToken",()=>{var e;this.token&&(te(this,G,uo).call(this),(e=this.onAuthLogout)==null||e.call(this),this.loginRequired&&this.login())});if(typeof e!="string"&&!mu(e))throw new Error("The 'Keycloak' constructor must be provided with a configuration object, or a URL to a JSON configuration file.");if(mu(e)){const n="oidcProvider"in e?["clientId"]:["url","realm","clientId"];for(const i of n)if(!(i in e))throw new Error(`The configuration object is missing the required '${i}' property.`)}globalThis.isSecureContext||ae(this,ks).call(this,`[KEYCLOAK] Keycloak JS must be used in a 'secure context' to function properly as it relies on browser APIs that are otherwise not available.
Continuing to run your application insecurely will lead to unexpected behavior and breakage.

For more information see: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts`),Ii(this,On,e)}}pi=new WeakMap,Zt=new WeakMap,vs=new WeakMap,ys=new WeakMap,Zn=new WeakMap,ks=new WeakMap,$e=new WeakMap,On=new WeakMap,G=new WeakSet,Fa=function(e){if(e==="default")return te(this,G,Py).call(this);if(e==="cordova")return ae(this,$e).enable=!1,te(this,G,_y).call(this);if(e==="cordova-native")return ae(this,$e).enable=!1,te(this,G,Ay).call(this);throw new Error("invalid adapter type: "+e)},Py=function(){const e=n=>(n==null?void 0:n.redirectUri)||this.redirectUri||globalThis.location.href;return{login:async n=>(window.location.assign(await this.createLoginUrl(n)),await new Promise(()=>{})),logout:async n=>{if(((n==null?void 0:n.logoutMethod)??this.logoutMethod)==="GET"){window.location.replace(this.createLogoutUrl(n));return}const r=document.createElement("form");r.setAttribute("method","POST"),r.setAttribute("action",this.createLogoutUrl(n)),r.style.display="none";const s={id_token_hint:this.idToken,client_id:this.clientId,post_logout_redirect_uri:e(n)};for(const[o,a]of Object.entries(s)){const c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("name",o),c.setAttribute("value",a),r.appendChild(c)}document.body.appendChild(r),r.submit()},register:async n=>(window.location.assign(await this.createRegisterUrl(n)),await new Promise(()=>{})),accountManagement:async()=>{const n=this.createAccountUrl();if(typeof n<"u")window.location.href=n;else throw new Error("Not supported by the OIDC server");return await new Promise(()=>{})},redirectUri:e}},_y=function(){const e=(o,a,c)=>window.cordova&&window.cordova.InAppBrowser?window.cordova.InAppBrowser.open(o,a,c):window.open(o,a,c),n=o=>o&&o.cordovaOptions?Object.keys(o.cordovaOptions).reduce((a,c)=>(a[c]=o.cordovaOptions[c],a),{}):{},i=o=>Object.keys(o).reduce((a,c)=>(a.push(c+"="+o[c]),a),[]).join(","),r=o=>{const a=n(o);return a.location="no",o&&o.prompt==="none"&&(a.hidden="yes"),i(a)},s=()=>this.redirectUri||"http://localhost";return{login:async o=>{const a=r(o),c=await this.createLoginUrl(o),l=e(c,"_blank",a);let d=!1,h=!1;function f(){h=!0,l.close()}return await new Promise((p,y)=>{l.addEventListener("loadstart",async v=>{if(v.url.indexOf(s())===0){const T=te(this,G,Di).call(this,v.url);try{await te(this,G,Ni).call(this,T),p()}catch(g){y(g)}f(),d=!0}}),l.addEventListener("loaderror",async v=>{if(!d)if(v.url.indexOf(s())===0){const T=te(this,G,Di).call(this,v.url);try{await te(this,G,Ni).call(this,T),p()}catch(g){y(g)}f(),d=!0}else y(new Error("Unable to process login.")),f()}),l.addEventListener("exit",function(v){h||y(new Error("User closed the login window."))})})},logout:async o=>{const a=this.createLogoutUrl(o),c=e(a,"_blank","location=no,hidden=yes,clearcache=yes");let l=!1;c.addEventListener("loadstart",d=>{d.url.indexOf(s())===0&&c.close()}),c.addEventListener("loaderror",d=>{d.url.indexOf(s())===0||(l=!0),c.close()}),await new Promise((d,h)=>{c.addEventListener("exit",()=>{l?h(new Error("User closed the login window.")):(this.clearToken(),d())})})},register:async o=>{const a=await this.createRegisterUrl(),c=r(o),l=e(a,"_blank",c);await new Promise((h,f)=>{l.addEventListener("loadstart",async p=>{if(p.url.indexOf(s())===0){l.close();const y=te(this,G,Di).call(this,p.url);try{await te(this,G,Ni).call(this,y),h()}catch(v){f(v)}}})})},accountManagement:async()=>{const o=this.createAccountUrl();if(typeof o<"u"){const a=e(o,"_blank","location=no");a.addEventListener("loadstart",function(c){c.url.indexOf(s())===0&&a.close()})}else throw new Error("Not supported by the OIDC server")},redirectUri:()=>s()}},Ay=function(){return{login:async e=>{const n=await this.createLoginUrl(e);await new Promise((i,r)=>{universalLinks.subscribe("keycloak",async s=>{universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close();const o=te(this,G,Di).call(this,s.url);try{await te(this,G,Ni).call(this,o),i()}catch(a){r(a)}}),window.cordova.plugins.browsertab.openUrl(n)})},logout:async e=>{const n=this.createLogoutUrl(e);await new Promise(i=>{universalLinks.subscribe("keycloak",()=>{universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),this.clearToken(),i()}),window.cordova.plugins.browsertab.openUrl(n)})},register:async e=>{const n=await this.createRegisterUrl(e);await new Promise((i,r)=>{universalLinks.subscribe("keycloak",async s=>{universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close();const o=te(this,G,Di).call(this,s.url);try{await te(this,G,Ni).call(this,o),i()}catch(a){r(a)}}),window.cordova.plugins.browsertab.openUrl(n)})},accountManagement:async()=>{const e=this.createAccountUrl();if(typeof e<"u")window.cordova.plugins.browsertab.openUrl(e);else throw new Error("Not supported by the OIDC server")},redirectUri:e=>e&&e.redirectUri?e.redirectUri:this.redirectUri?this.redirectUri:"http://localhost"}},Dy=async function(){if(typeof ae(this,On)=="string"){const e=await RT(ae(this,On));this.authServerUrl=e["auth-server-url"],this.realm=e.realm,this.clientId=e.resource,te(this,G,ou).call(this)}else this.clientId=ae(this,On).clientId,"oidcProvider"in ae(this,On)?await te(this,G,Ny).call(this,ae(this,On).oidcProvider):(this.authServerUrl=ae(this,On).url,this.realm=ae(this,On).realm,te(this,G,ou).call(this))},ou=function(){this.endpoints={authorize:()=>te(this,G,Jn).call(this)+"/protocol/openid-connect/auth",token:()=>te(this,G,Jn).call(this)+"/protocol/openid-connect/token",logout:()=>te(this,G,Jn).call(this)+"/protocol/openid-connect/logout",checkSessionIframe:()=>te(this,G,Jn).call(this)+"/protocol/openid-connect/login-status-iframe.html",thirdPartyCookiesIframe:()=>te(this,G,Jn).call(this)+"/protocol/openid-connect/3p-cookies/step1.html",register:()=>te(this,G,Jn).call(this)+"/protocol/openid-connect/registrations",userinfo:()=>te(this,G,Jn).call(this)+"/protocol/openid-connect/userinfo"}},Ny=async function(e){if(typeof e=="string"){const n=`${Wp(e)}/.well-known/openid-configuration`,i=await IT(n);te(this,G,au).call(this,i)}else te(this,G,au).call(this,e)},au=function(e){this.endpoints={authorize(){return e.authorization_endpoint},token(){return e.token_endpoint},logout(){if(!e.end_session_endpoint)throw new Error("Not supported by the OIDC server");return e.end_session_endpoint},checkSessionIframe(){if(!e.check_session_iframe)throw new Error("Not supported by the OIDC server");return e.check_session_iframe},register(){throw new Error('Redirection to "Register user" page not supported in standard OIDC mode')},userinfo(){if(!e.userinfo_endpoint)throw new Error("Not supported by the OIDC server");return e.userinfo_endpoint}}},Oy=async function(){if(!ae(this,$e).enable&&!this.silentCheckSsoRedirectUri||typeof this.endpoints.thirdPartyCookiesIframe!="function")return;const e=document.createElement("iframe");e.setAttribute("src",this.endpoints.thirdPartyCookiesIframe()),e.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),e.setAttribute("title","keycloak-3p-check-iframe"),e.style.display="none",document.body.appendChild(e);const n=new Promise(i=>{const r=s=>{e.contentWindow===s.source&&(s.data!=="supported"&&s.data!=="unsupported"||(s.data==="unsupported"&&(ae(this,ks).call(this,`[KEYCLOAK] Your browser is blocking access to 3rd-party cookies, this means:

 - It is not possible to retrieve tokens without redirecting to the Keycloak server (a.k.a. no support for silent authentication).
 - It is not possible to automatically detect changes to the session status (such as the user logging out in another tab).

For more information see: https://www.keycloak.org/securing-apps/javascript-adapter#_modern_browsers`),ae(this,$e).enable=!1,this.silentCheckSsoFallback&&(this.silentCheckSsoRedirectUri=void 0)),document.body.removeChild(e),window.removeEventListener("message",r),i()))};window.addEventListener("message",r,!1)});return await kT(n,this.messageReceiveTimeout,"Timeout when waiting for 3rd party check iframe message.")},Ly=async function(e){var s,o,a;const n=te(this,G,Di).call(this,window.location.href);if(n!=null&&n.newUrl&&window.history.replaceState(window.history.state,"",n.newUrl),n&&n.valid){await te(this,G,Ua).call(this),await te(this,G,Ni).call(this,n);return}const i=async c=>{const l={};c||(l.prompt="none"),e.locale&&(l.locale=e.locale),await this.login(l)},r=async()=>{switch(e.onLoad){case"check-sso":ae(this,$e).enable?(await te(this,G,Ua).call(this),await te(this,G,lo).call(this)||(this.silentCheckSsoRedirectUri?await te(this,G,cu).call(this):await i(!1))):this.silentCheckSsoRedirectUri?await te(this,G,cu).call(this):await i(!1);break;case"login-required":await i(!0);break;default:throw new Error("Invalid value for onLoad")}};if(e.token&&e.refreshToken)if(te(this,G,uo).call(this,e.token,e.refreshToken,e.idToken),ae(this,$e).enable)await te(this,G,Ua).call(this),await te(this,G,lo).call(this)&&((s=this.onAuthSuccess)==null||s.call(this),te(this,G,Ba).call(this));else try{await this.updateToken(-1),(o=this.onAuthSuccess)==null||o.call(this)}catch(c){if((a=this.onAuthError)==null||a.call(this),e.onLoad)await r();else throw c}else e.onLoad&&await r()},Ua=async function(){if(!ae(this,$e).enable||ae(this,$e).iframe)return;const e=document.createElement("iframe");ae(this,$e).iframe=e,e.setAttribute("src",this.endpoints.checkSessionIframe()),e.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),e.setAttribute("title","keycloak-session-iframe"),e.style.display="none",document.body.appendChild(e);const n=r=>{var o;if(r.origin!==ae(this,$e).iframeOrigin||((o=ae(this,$e).iframe)==null?void 0:o.contentWindow)!==r.source||!(r.data==="unchanged"||r.data==="changed"||r.data==="error"))return;r.data!=="unchanged"&&this.clearToken();const s=ae(this,$e).callbackList;ae(this,$e).callbackList=[];for(const a of s.reverse())r.data==="error"?a(new Error("Error while checking login iframe")):a(null,r.data==="unchanged")};window.addEventListener("message",n,!1),await new Promise(r=>{e.addEventListener("load",()=>{const s=this.endpoints.authorize();s.startsWith("/")?ae(this,$e).iframeOrigin=globalThis.location.origin:ae(this,$e).iframeOrigin=new URL(s).origin,r()})})},lo=async function(){if(!ae(this,$e).iframe||!ae(this,$e).iframeOrigin)return;const e=`${this.clientId} ${this.sessionId?this.sessionId:""}`,n=ae(this,$e).iframeOrigin;return await new Promise((r,s)=>{var a,c;const o=(l,d)=>l?s(l):r(d);ae(this,$e).callbackList.push(o),ae(this,$e).callbackList.length===1&&((c=(a=ae(this,$e).iframe)==null?void 0:a.contentWindow)==null||c.postMessage(e,n))})},cu=async function(){const e=document.createElement("iframe"),n=await this.createLoginUrl({prompt:"none",redirectUri:this.silentCheckSsoRedirectUri});return e.setAttribute("src",n),e.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),e.setAttribute("title","keycloak-silent-check-sso"),e.style.display="none",document.body.appendChild(e),await new Promise((i,r)=>{const s=async o=>{if(o.origin!==window.location.origin||e.contentWindow!==o.source)return;const a=te(this,G,Di).call(this,o.data);try{await te(this,G,Ni).call(this,a),i()}catch(c){r(c)}document.body.removeChild(e),window.removeEventListener("message",s)};window.addEventListener("message",s)})},Di=function(e){const n=te(this,G,My).call(this,e);if(!n)return;const i=ae(this,ys).get(n.state);return i&&(n.valid=!0,n.redirectUri=i.redirectUri,n.storedNonce=i.nonce,n.prompt=i.prompt,n.pkceCodeVerifier=i.pkceCodeVerifier,n.loginOptions=i.loginOptions),n},My=function(e){let n=[];switch(this.flow){case"standard":n=["code","state","session_state","kc_action_status","kc_action","iss"];break;case"implicit":n=["access_token","token_type","id_token","state","session_state","expires_in","kc_action_status","kc_action","iss"];break;case"hybrid":n=["access_token","token_type","id_token","code","state","session_state","expires_in","kc_action_status","kc_action","iss"];break}n.push("error"),n.push("error_description"),n.push("error_uri");const i=new URL(e);let r="",s;if(this.responseMode==="query"&&i.searchParams.size>0?(s=te(this,G,lu).call(this,i.search,n),i.search=s.paramsString,r=i.toString()):this.responseMode==="fragment"&&i.hash.length>0&&(s=te(this,G,lu).call(this,i.hash.substring(1),n),i.hash=s.paramsString,r=i.toString()),s!=null&&s.oauthParams){if(this.flow==="standard"||this.flow==="hybrid"){if((s.oauthParams.code||s.oauthParams.error)&&s.oauthParams.state)return s.oauthParams.newUrl=r,s.oauthParams}else if(this.flow==="implicit"&&(s.oauthParams.access_token||s.oauthParams.error)&&s.oauthParams.state)return s.oauthParams.newUrl=r,s.oauthParams}},lu=function(e,n){const i=new URLSearchParams(e),r={};for(const[s,o]of Array.from(i.entries()))n.includes(s)&&(r[s]=o,i.delete(s));return{paramsString:i.toString(),oauthParams:r}},Ni=async function(e){var a,c,l,d;const{code:n,error:i,prompt:r}=e;let s=new Date().getTime();const o=(h,f,p)=>{if(s=(s+new Date().getTime())/2,te(this,G,uo).call(this,h,f,p,s),ae(this,vs)&&this.idTokenParsed&&this.idTokenParsed.nonce!==e.storedNonce)throw ae(this,Zn).call(this,"[KEYCLOAK] Invalid nonce, clearing token"),this.clearToken(),new Error("Invalid nonce.")};if(e.kc_action_status&&this.onActionUpdate&&this.onActionUpdate(e.kc_action_status,e.kc_action),i){if(r!=="none")if(e.error_description&&e.error_description==="authentication_expired")await this.login(e.loginOptions);else{const h={error:i,error_description:e.error_description};throw(a=this.onAuthError)==null||a.call(this,h),h}return}else this.flow!=="standard"&&(e.access_token||e.id_token)&&(o(e.access_token,void 0,e.id_token),(c=this.onAuthSuccess)==null||c.call(this));if(this.flow!=="implicit"&&n)try{const h=await PT(this.endpoints.token(),n,this.clientId,e.redirectUri,e.pkceCodeVerifier);o(h.access_token,h.refresh_token,h.id_token),this.flow==="standard"&&((l=this.onAuthSuccess)==null||l.call(this)),te(this,G,Ba).call(this)}catch(h){throw(d=this.onAuthError)==null||d.call(this),h}},Ba=async function(){ae(this,$e).enable&&this.token&&(await DT(ae(this,$e).interval*1e3),await te(this,G,lo).call(this)&&await te(this,G,Ba).call(this))},uo=function(e,n,i,r){if(this.tokenTimeoutHandle&&(clearTimeout(this.tokenTimeoutHandle),this.tokenTimeoutHandle=void 0),n?(this.refreshToken=n,this.refreshTokenParsed=$l(n)):(delete this.refreshToken,delete this.refreshTokenParsed),i?(this.idToken=i,this.idTokenParsed=$l(i)):(delete this.idToken,delete this.idTokenParsed),e){if(this.token=e,this.tokenParsed=$l(e),this.sessionId=this.tokenParsed.sid,this.authenticated=!0,this.subject=this.tokenParsed.sub,this.realmAccess=this.tokenParsed.realm_access,this.resourceAccess=this.tokenParsed.resource_access,r&&(this.timeSkew=Math.floor(r/1e3)-this.tokenParsed.iat),this.timeSkew!==null&&(ae(this,Zn).call(this,"[KEYCLOAK] Estimated time difference between browser and server is "+this.timeSkew+" seconds"),this.onTokenExpired)){const s=(this.tokenParsed.exp-new Date().getTime()/1e3+this.timeSkew)*1e3;ae(this,Zn).call(this,"[KEYCLOAK] Token expires in "+Math.round(s/1e3)+" s"),s<=0?this.onTokenExpired():this.tokenTimeoutHandle=window.setTimeout(this.onTokenExpired,s)}}else delete this.token,delete this.tokenParsed,delete this.subject,delete this.realmAccess,delete this.resourceAccess,this.authenticated=!1},Jn=function(){if(!(typeof this.authServerUrl>"u"))return`${Wp(this.authServerUrl)}/realms/${encodeURIComponent(this.realm)}`},du=function(e){return n=>{this.enableLogging&&e.call(console,n)}};function zp(){if(typeof crypto>"u"||typeof crypto.randomUUID>"u")throw new Error("Web Crypto API is not available.");return crypto.randomUUID()}function pT(t){return JSON.stringify({id_token:{acr:t}})}function mT(t){return vT(t,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789")}async function gT(t,e){if(t!=="S256")throw new TypeError(`Invalid value for 'pkceMethod', expected 'S256' but got '${t}'.`);const n=new Uint8Array(await ET(e));return TT(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function vT(t,e){const n=yT(t),i=new Array(t);for(let r=0;r<t;r++)i[r]=e.charCodeAt(n[r]%e.length);return String.fromCharCode.apply(null,i)}function yT(t){if(typeof crypto>"u"||typeof crypto.getRandomValues>"u")throw new Error("Web Crypto API is not available.");return crypto.getRandomValues(new Uint8Array(t))}function kT(t,e,n){let i;const r=new Promise(function(s,o){i=window.setTimeout(function(){o(new Error(n))},e)});return Promise.race([t,r]).finally(function(){clearTimeout(i)})}function ST(){try{return new bT}catch{return new CT}}const cs="kc-callback-";var _n,uu,jy,hu,Fy;class bT{constructor(){Sn(this,_n);globalThis.localStorage.setItem("kc-test","test"),globalThis.localStorage.removeItem("kc-test")}get(e){if(!e)return null;te(this,_n,uu).call(this);const n=cs+e,i=globalThis.localStorage.getItem(n);return i?(globalThis.localStorage.removeItem(n),JSON.parse(i)):null}add(e){te(this,_n,uu).call(this);const n=cs+e.state,i=JSON.stringify({...e,expires:Date.now()+60*60*1e3});try{globalThis.localStorage.setItem(n,i)}catch{te(this,_n,jy).call(this),globalThis.localStorage.setItem(n,i)}}}_n=new WeakSet,uu=function(){const e=Date.now();for(const[n,i]of te(this,_n,hu).call(this)){const r=te(this,_n,Fy).call(this,i);(r===null||r<e)&&globalThis.localStorage.removeItem(n)}},jy=function(){for(const[e]of te(this,_n,hu).call(this))globalThis.localStorage.removeItem(e)},hu=function(){return Object.entries(globalThis.localStorage).filter(([e])=>e.startsWith(cs))},Fy=function(e){let n;try{n=JSON.parse(e)}catch{return null}return mu(n)&&"expires"in n&&typeof n.expires=="number"?n.expires:null};var oi,Uy,fu,pu;class CT{constructor(){Sn(this,oi)}get(e){if(!e)return null;const n=te(this,oi,Uy).call(this,cs+e);return te(this,oi,fu).call(this,cs+e,"",te(this,oi,pu).call(this,-100)),n?JSON.parse(n):null}add(e){te(this,oi,fu).call(this,cs+e.state,JSON.stringify(e),te(this,oi,pu).call(this,60))}}oi=new WeakSet,Uy=function(e){const n=e+"=",i=document.cookie.split(";");for(let r=0;r<i.length;r++){let s=i[r];for(;s.charAt(0)===" ";)s=s.substring(1);if(s.indexOf(n)===0)return s.substring(n.length,s.length)}return""},fu=function(e,n,i){const r=e+"="+n+"; expires="+i.toUTCString()+"; ";document.cookie=r},pu=function(e){const n=new Date;return n.setTime(n.getTime()+e*60*1e3),n};function TT(t){const e=String.fromCodePoint(...t);return btoa(e)}async function ET(t){const n=new TextEncoder().encode(t);if(typeof crypto>"u"||typeof crypto.subtle>"u")throw new Error("Web Crypto API is not available.");return await crypto.subtle.digest("SHA-256",n)}function $l(t){const[,e]=t.split(".");if(typeof e!="string")throw new Error("Unable to decode token, payload not found.");let n;try{n=wT(e)}catch(i){throw new Error("Unable to decode token, payload is not a valid Base64URL value.",{cause:i})}try{return JSON.parse(n)}catch(i){throw new Error("Unable to decode token, payload is not a valid JSON value.",{cause:i})}}function wT(t){let e=t.replaceAll("-","+").replaceAll("_","/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("Input is not of the correct length.")}try{return xT(e)}catch{return atob(e)}}function xT(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,n)=>{let i=n.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i}))}function mu(t){return typeof t=="object"&&t!==null}async function RT(t){return await Rs(t)}async function IT(t){return await Rs(t)}async function PT(t,e,n,i,r){const s=new URLSearchParams([["code",e],["grant_type","authorization_code"],["client_id",n],["redirect_uri",i]]);return r&&s.append("code_verifier",r),await Rs(t,{method:"POST",credentials:"include",body:s})}async function _T(t,e,n){const i=new URLSearchParams([["grant_type","refresh_token"],["refresh_token",e],["client_id",n]]);return await Rs(t,{method:"POST",credentials:"include",body:i})}async function Rs(t,e={}){const n=new Headers(e.headers);return n.set("Accept",hT),await(await AT(t,{...e,headers:n})).json()}async function AT(t,e){const n=await fetch(t,e);if(!n.ok)throw new By("Server responded with an invalid status.",{response:n});return n}function Vp(t){if(!t)throw new Error("Unable to build authorization header, token is not set, make sure the user is authenticated.");return["Authorization",`bearer ${t}`]}function Wp(t){return t.endsWith("/")?t.slice(0,-1):t}class By extends Error{constructor(n,i){super(n,i);de(this,"response");this.response=i.response}}const DT=t=>new Promise(e=>setTimeout(e,t)),Ms=localStorage.getItem("useMockAuth")==="true"||!1;let ir,Is=!1;Ms||(ir=new fT({url:"http://localhost:8080",realm:"intent-platform",clientId:"intent-frontend"}));const NT=()=>Ms?(console.log("Using mock authentication (Keycloak disabled)"),Is=!0,Promise.resolve(!0)):(console.log("Initializing Keycloak..."),ir.init({onLoad:"check-sso",pkceMethod:"S256",checkLoginIframe:!1,checkLoginIframeInterval:5}).then(t=>(console.log("Keycloak init resolved, authenticated:",t),t||(console.log("Not authenticated - redirecting to Keycloak login"),ir.login({redirectUri:window.location.origin+window.location.pathname}),!1))).catch(t=>(console.error("Keycloak initialization error:",t),console.warn("Keycloak not available - falling back to mock auth"),Is=!0,localStorage.setItem("useMockAuth","true"),Promise.resolve(!0)))),OT=()=>{if(Is||Ms){console.log("[Mock Auth] Login called");return}return ir.login()},LT=()=>{if(Is||Ms){console.log("[Mock Auth] Logout called"),localStorage.removeItem("useMockAuth");return}return ir.logout()},zh=()=>Is||Ms?!0:!!ir.token,Vh=()=>{var e,n;if(Is||Ms)return localStorage.getItem("mockRole")||"buyer";const t=((n=(e=ir.tokenParsed)==null?void 0:e.realm_access)==null?void 0:n.roles)||[];return t.includes("buyer")?"buyer":t.includes("seller")?"seller":t.includes("agent")?"agent":null},xe=ir||{token:"mock-token",tokenParsed:{name:"Developer",preferred_username:"dev",realm_access:{roles:["buyer"]}}};function MT(){const t=Or();return w.useEffect(()=>{if(zh()){t("/dashboard");return}OT()},[t]),u.jsx("p",{children:"Redirecting to login..."})}function jT(){const t=Vh(),e=Or(),n=Zc(),i=l=>n.pathname===l,r=t==="buyer",s=t==="seller",o=t==="agent",a=t==="admin"||t==="superuser",c=l=>({padding:"12px 20px",cursor:"pointer",backgroundColor:l?"#F1F3F5":"transparent",borderLeft:l?"3px solid #111827":"3px solid transparent",fontWeight:l?600:400,color:l?"#111827":"#4B5563",fontSize:14});return u.jsxs("div",{style:{width:240,background:"#FAFBFC",borderRight:"1px solid #E5E7EB",padding:0,height:"100vh",display:"flex",flexDirection:"column"},children:[u.jsx("div",{style:{padding:"20px",borderBottom:"1px solid #E5E7EB",display:"flex",alignItems:"center",gap:10},children:u.jsx("div",{style:{fontSize:24,fontWeight:700,color:"#111827",letterSpacing:-.5},children:"UIP"})}),u.jsx("nav",{style:{flex:1,padding:"16px 0"},children:u.jsxs("ul",{style:{listStyle:"none",padding:0,margin:0},children:[u.jsx("li",{style:c(i("/intent")),onClick:()=>e("/intent"),children:" Intent"}),r&&u.jsxs(u.Fragment,{children:[u.jsx("li",{style:{...c(i("/history")),cursor:"not-allowed",opacity:.5},children:" My History"}),u.jsx("li",{style:{...c(i("/evidence")),cursor:"not-allowed",opacity:.5},children:" My Evidence"})]}),s&&u.jsxs(u.Fragment,{children:[u.jsx("li",{style:{...c(i("/properties")),cursor:"not-allowed",opacity:.5},children:" My Properties"}),u.jsx("li",{style:{...c(i("/history")),cursor:"not-allowed",opacity:.5},children:" History"}),u.jsx("li",{style:{...c(i("/evidence")),cursor:"not-allowed",opacity:.5},children:" Evidence"})]}),o&&u.jsxs(u.Fragment,{children:[u.jsx("li",{style:c(i("/dashboard")),onClick:()=>e("/dashboard"),children:" Assigned Intents"}),u.jsx("li",{style:{...c(i("/actions")),cursor:"not-allowed",opacity:.5},children:" Actions"}),u.jsx("li",{style:{...c(i("/history")),cursor:"not-allowed",opacity:.5},children:" History"}),u.jsx("li",{style:{...c(i("/evidence")),cursor:"not-allowed",opacity:.5},children:" Evidence"})]}),a&&u.jsxs(u.Fragment,{children:[u.jsx("li",{style:c(i("/dashboard")),onClick:()=>e("/dashboard"),children:" All Intents"}),u.jsx("li",{style:{...c(i("/compliance")),cursor:"not-allowed",opacity:.5},children:" Compliance"}),u.jsx("li",{style:{...c(i("/policies")),cursor:"not-allowed",opacity:.5},children:" Policies"}),u.jsx("li",{style:{...c(i("/evidence")),cursor:"not-allowed",opacity:.5},children:" Evidence"}),u.jsx("li",{style:{...c(i("/system")),cursor:"not-allowed",opacity:.5},children:" System"})]})]})}),u.jsxs("div",{style:{padding:"16px 20px",borderTop:"1px solid #E5E7EB",fontSize:12,color:"#6B7280"},children:["Role: ",u.jsx("strong",{style:{color:"#111827"},children:(t==null?void 0:t.toUpperCase())||"USER"})]})]})}function FT(){const t=Or(),e=Vh(),n=xe.tokenParsed,i=(n==null?void 0:n.preferred_username)||(n==null?void 0:n.name)||"User";return u.jsx("div",{style:{height:50,borderBottom:"1px solid #E5E7EB",display:"flex",justifyContent:"flex-end",alignItems:"center",padding:"0 24px",background:"#FAFBFC"},children:u.jsx("div",{style:{display:"flex",alignItems:"center",gap:12},children:u.jsx("div",{style:{width:32,height:32,borderRadius:"50%",backgroundColor:"#111827",color:"#FFFFFF",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:600,cursor:"pointer"},onClick:()=>{LT(),t("/")},title:`${i} (${(e==null?void 0:e.toUpperCase())||"USER"}) - Click to logout`,children:i.charAt(0).toUpperCase()})})})}function Ho({children:t,noPadding:e=!1}){return u.jsxs("div",{style:{display:"flex",height:"100vh",background:"#F6F7F9"},children:[u.jsx(jT,{}),u.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",background:"#F6F7F9"},children:[u.jsx(FT,{}),u.jsx("div",{style:e?{}:{padding:20,background:"#F6F7F9"},children:t})]})]})}const UT="modulepreload",BT=function(t){return"/"+t},$p={},zy=function(e,n,i){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));r=Promise.allSettled(n.map(c=>{if(c=BT(c),c in $p)return;$p[c]=!0;const l=c.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=l?"stylesheet":UT,l||(h.as="script"),h.crossOrigin="",h.href=c,a&&h.setAttribute("nonce",a),document.head.appendChild(h),l)return new Promise((f,p)=>{h.addEventListener("load",f),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})},zT=!1,VT="http://localhost:7001",WT="http://localhost:7002",el="http://localhost:7003",gu="http://localhost:7004",$T="http://localhost:7005",qT="http://localhost:7006",Vy="http://localhost:7007",qp="http://localhost:11434";async function un(t){try{const e=await fetch(`${Vy}/v1/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({intentId:t.intentId||"unknown",engine:"VOICE_AGENT_ENGINE",eventType:t.eventType,actorId:t.actorId||"default-user",tenantId:t.tenantId||"default-tenant",payload:t.payload||{},reason:t.reason,confidence:t.confidence||"HIGH"})});if(!e.ok){const n=await e.text();console.warn(`[Voice Agent Evidence] Failed to emit evidence (status: ${e.status}): ${n}`)}}catch(e){const n=e.message||String(e);n.includes("fetch")||n.includes("ECONNREFUSED")?console.warn(`[Voice Agent Evidence] Evidence Engine not available (non-blocking): ${n}`):console.warn(`[Voice Agent Evidence] Error emitting evidence (non-blocking): ${n}`)}}async function Wh(t){const e=await fetch(`${VT}/v1/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){const n=await e.text();throw new Error(`Intent analysis failed: ${n}`)}return e.json()}async function vu(t){const e=await fetch(`${WT}/v1/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({intentId:t.id,tenantId:t.tenantId||"default-tenant",actorId:t.actorId||"default-user",intentType:t.type,location:t.payload.location,budget:t.payload.budget,area:t.payload.area,propertyId:t.payload.propertyId})});if(!e.ok){const n=await e.text();throw new Error(`Compliance check failed: ${n}`)}return e.json()}async function Wy(t,e,n=[]){const i=await fetch(`${el}/v1/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({intent:{id:t.id,type:t.type,payload:t.payload,complianceStatus:e},existingDecisions:n})});if(!i.ok){const r=await i.text();throw new Error(`Decision engine failed: ${r}`)}return i.json()}async function Br(t,e,n,i=[]){var r,s;try{const o=zT?`${gu}/action/execute`:`${gu}/v1/execute`;console.log("[Action Engine] Fetching actions from:",o),console.log("[Action Engine] Request payload:",{intent:(t==null?void 0:t.id)||(t==null?void 0:t.type),decisionsCount:(e==null?void 0:e.length)||0,lifecycleState:n,existingActionsCount:(i==null?void 0:i.length)||0});const a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({intent:{id:t.id,type:t.type,payload:t.payload},decisions:e||[],lifecycleState:n||"AWAITING_DECISIONS",existingActions:i||[]})});if(!a.ok){const l=await a.text();if(console.error("[Action Engine] Error response:",a.status,l),a.status===404||l.includes("ECONNREFUSED"))return console.warn("[Action Engine] Action engine not available, returning empty actions"),{actions:[],nextLifecycleState:n};throw new Error(`Action engine failed (${a.status}): ${l}`)}const c=await a.json();return console.log("[Action Engine] Response received:",{actionsCount:((r=c.actions)==null?void 0:r.length)||0,nextLifecycleState:c.nextLifecycleState,actions:(s=c.actions)==null?void 0:s.map(l=>({id:l.actionId,desc:l.description,outcome:l.outcome}))}),c}catch(o){const a=o.message||String(o);if(a.includes("fetch")||a.includes("ECONNREFUSED")||a.includes("Failed to fetch")||a.includes("NetworkError"))return console.warn("[Action Engine] Action engine not available (non-blocking):",a),{actions:[],nextLifecycleState:n};throw console.error("[Action Engine] Unexpected error:",o),o}}async function $h(t,e){try{const n=await fetch(`${el}/v1/intent/resume?userId=${encodeURIComponent(t)}&tenantId=${encodeURIComponent(e)}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok){if(n.status===0||n.status>=500)return console.warn("Decision Engine not available for resume check"),{hasOpenIntent:!1,resumable:!1};const i=await n.text();throw new Error(`Resume check failed: ${i}`)}return n.json()}catch(n){if(n.message.includes("Failed to fetch")||n.message.includes("ERR_CONNECTION_REFUSED"))return console.warn("Decision Engine not running - resume check skipped"),{hasOpenIntent:!1,resumable:!1};throw n}}async function $y(t,e,n,i=!1){const r=await fetch(`${el}/v1/decision/${t}/select`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({optionId:e,confirm:i,userId:n})});if(!r.ok){const s=await r.text();throw new Error(`Decision selection failed: ${s}`)}return r.json()}async function HT(t,e,n,i){const r=await fetch(`${el}/v1/decision/${t}/change`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newOptionId:e,reason:n,userId:i})});if(!r.ok){const s=await r.text();throw new Error(`Decision change failed: ${s}`)}return r.json()}async function yu(t,e,n,i=null,r=null){const s={outcome:e,userId:n};i&&(s.reason=i),r&&(s.scheduledFor=r);try{const o=new AbortController,a=setTimeout(()=>o.abort(),1e4),c=await fetch(`${gu}/v1/action/${t}/outcome`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),signal:o.signal});if(clearTimeout(a),!c.ok){const l=await c.text();throw new Error(`Action outcome update failed: ${l}`)}return c.json()}catch(o){throw o.name==="AbortError"?new Error("Action Engine request timed out. Please check if Action Engine is running on port 7004."):o.message.includes("Failed to fetch")||o.message.includes("ERR_CONNECTION_REFUSED")?new Error("Action Engine is not running. Please start the Action Engine on port 7004."):o}}async function Hp(t,e,n=[]){try{const i=await fetch(`${$T}/v1/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({intentId:t.id,intentType:t.type,complianceResult:e,intentPayload:t.payload,decisions:n,tenantId:t.tenantId||"default-tenant",actorId:t.actorId||"default-user"})});if(!i.ok){if(i.status===0||i.status>=500)return console.warn("Risk Engine not available"),null;const r=await i.text();throw new Error(`Risk evaluation failed: ${r}`)}return i.json()}catch(i){if(i.message.includes("Failed to fetch")||i.message.includes("ERR_CONNECTION_REFUSED"))return console.warn("Risk Engine not running - risk evaluation skipped"),null;throw i}}async function Qs(t,e,n,i=[]){try{const r=await fetch(`${qT}/v1/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({intentId:t.id,intentType:t.type,complianceResult:e,riskResult:n||void 0,decisions:i,tenantId:t.tenantId||"default-tenant",actorId:t.actorId||"default-user"})});if(!r.ok){if(r.status===0||r.status>=500)return console.warn("Explainability Engine not available"),null;const s=await r.text();throw new Error(`Explainability failed: ${s}`)}return r.json()}catch(r){if(r.message.includes("Failed to fetch")||r.message.includes("ERR_CONNECTION_REFUSED"))return console.warn("Explainability Engine not running - explanation skipped"),null;throw r}}async function KT(t){try{const e=await fetch(`${Vy}/v1/intent/${t}/evidence`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok){if(e.status===0||e.status>=500)return console.warn("Evidence Engine not available"),[];const n=await e.text();throw new Error(`Evidence retrieval failed: ${n}`)}return e.json()}catch(e){if(e.message.includes("Failed to fetch")||e.message.includes("ERR_CONNECTION_REFUSED"))return console.warn("Evidence Engine not running - evidence retrieval skipped"),[];throw e}}async function ku(t,e){try{try{if(!(await fetch(`${qp}/api/tags`,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok)return console.warn("[RAG Integration] Ollama health check failed - skipping RAG query"),null}catch(o){return console.warn("[RAG Integration] Ollama not accessible - skipping RAG query:",o.message),null}const{getRAGFactory:n}=await zy(async()=>{const{getRAGFactory:o}=await import("./rag-factory-D1aenl58.js");return{getRAGFactory:o}},[]),i=n({baseUrl:qp,model:"llama3",timeout:6e4}),r={intent_type:t.type||"UNKNOWN",extracted_entities:t.extractedInfo||t.payload||{},country:e||"IN",context:{lifecycle_state:t.lifecycleState}};return await i.query(r)}catch(n){return console.warn("[RAG Integration] RAG query failed (non-blocking):",n),null}}function GT(t){var c,l,d,h,f;const e=((c=t.extractedInfo)==null?void 0:c.location)||((l=t.payload)==null?void 0:l.location)||((d=t.extractedInfo)==null?void 0:d.city)||((h=t.extractedInfo)==null?void 0:h.state)||((f=t.extractedInfo)==null?void 0:f.country)||"",n=t.text||t.originalText||"",i=e.toLowerCase(),r=n.toLowerCase(),s=`${i} ${r}`,o=["vizag","visakhapatnam","mumbai","bombay","delhi","new delhi","bangalore","bengaluru","chennai","madras","hyderabad","pune","kolkata","calcutta","ahmedabad","surat","jaipur","lucknow","kanpur","nagpur","indore","thane","bhopal","visakhapatnam","patna","vadodara","ghaziabad","ludhiana","agra","nashik","andhra pradesh","maharashtra","karnataka","tamil nadu","gujarat","rajasthan","uttar pradesh","west bengal","bihar","madhya pradesh","punjab","haryana","odisha","kerala","assam","jharkhand","india","indian","bharat","hindustan","lakh","lakhs","crore","crores","rupee","rupees","inr",""],a=["austin","new york","nyc","los angeles","la","chicago","houston","phoenix","philadelphia","san antonio","san diego","dallas","san jose","seattle","denver","boston","washington","miami","atlanta","detroit","minneapolis","portland","las vegas","nashville","orlando","charlotte","san francisco","columbus","texas","california","florida","new york","pennsylvania","illinois","ohio","georgia","north carolina","michigan","new jersey","virginia","washington","arizona","massachusetts","tennessee","indiana","missouri","maryland","wisconsin","colorado","minnesota","usa","us","united states","america","american","dollar","dollars","usd","$"];for(const p of o)if(s.includes(p))return"IN";for(const p of a)if(s.includes(p))return"US";return"IN"}function JT(){const t=Or(),[e,n]=w.useState(null),[i,r]=w.useState([]),[s,o]=w.useState([]),[a,c]=w.useState(!0);return w.useEffect(()=>{$h().then(l=>{l!=null&&l.hasOpenIntent&&n(l),c(!1)}).catch(()=>c(!1))},[]),w.useEffect(()=>{e||(r([{id:"dec-1",type:"PROPERTY_SELECTION",status:"PENDING",recommendation:"Property A - Best match for your budget",risk:"LOW"}]),o([{id:"act-1",description:"Schedule site visit",status:"PENDING",deadline:"2024-12-28"},{id:"act-2",description:"Upload income documents",status:"PENDING",deadline:"2024-12-30"}]))},[e]),a?u.jsx(Ho,{children:u.jsx("div",{style:{padding:40,textAlign:"center",color:"#A0A0A0"},children:"Loading..."})}):u.jsx(Ho,{children:u.jsxs("div",{style:{padding:30,maxWidth:1200,margin:"0 auto"},children:[e?u.jsxs("div",{style:{padding:24,backgroundColor:"#FFFFFF",borderRadius:8,border:"1px solid #E5E7EB",marginBottom:24},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:16},children:[u.jsxs("div",{children:[u.jsx("h2",{style:{margin:0,color:"#EAEAEA",fontSize:20,fontWeight:600},children:"Active Intent"}),u.jsx("p",{style:{margin:"8px 0 0",color:"#A0A0A0",fontSize:14},children:e.message||"Buy a home in Vizag for 50 lakhs"})]}),u.jsx("button",{onClick:()=>t("/intent"),style:{padding:"8px 16px",backgroundColor:"#2563EB",color:"#FFFFFF",border:"none",borderRadius:6,cursor:"pointer",fontWeight:600,fontSize:14},children:"Resume"})]}),u.jsx("div",{style:{display:"flex",gap:12,marginTop:16},children:["Intent","Compliance","Decisions","Actions"].map((l,d)=>u.jsx("div",{style:{flex:1,padding:8,backgroundColor:d<2?"#181818":"#121212",borderRadius:4,textAlign:"center",fontSize:12,color:d<2?"#EAEAEA":"#A0A0A0",border:d<2?"1px solid #5B84C4":"1px solid #242424"},children:l},d))})]}):u.jsx("div",{style:{padding:24,backgroundColor:"#FFFFFF",borderRadius:8,border:"1px solid #E5E7EB",marginBottom:24,textAlign:"center"},children:u.jsxs("p",{style:{color:"#A0A0A0",margin:0},children:["No active intent."," ",u.jsx("button",{onClick:()=>t("/intent"),style:{background:"none",border:"none",color:"#5B84C4",cursor:"pointer",textDecoration:"underline",fontSize:14},children:"Start a new intent"})]})}),i.length>0&&u.jsxs("div",{style:{padding:24,backgroundColor:"#FFFFFF",borderRadius:8,border:"1px solid #E5E7EB",marginBottom:24},children:[u.jsx("h3",{style:{margin:"0 0 16px",color:"#EAEAEA",fontSize:18,fontWeight:600},children:"Decisions Awaiting Me"}),u.jsx("div",{style:{display:"grid",gap:12},children:i.map(l=>u.jsxs("div",{style:{padding:16,backgroundColor:"#F9FAFB",borderRadius:6,border:"1px solid #E1E4E8"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:8},children:[u.jsxs("div",{children:[u.jsx("div",{style:{color:"#EAEAEA",fontWeight:600,marginBottom:4},children:l.type.replace(/_/g," ")}),u.jsx("div",{style:{color:"#A0A0A0",fontSize:14},children:l.recommendation})]}),u.jsxs("span",{style:{padding:"4px 8px",backgroundColor:l.risk==="HIGH"?"#C24B4B":l.risk==="MEDIUM"?"#C8A24D":"#3FA36C",color:"#FFFFFF",borderRadius:4,fontSize:11,fontWeight:600},children:[l.risk," RISK"]})]}),u.jsx("button",{onClick:()=>t("/intent"),style:{marginTop:12,padding:"8px 16px",backgroundColor:"#2563EB",color:"#FFFFFF",border:"none",borderRadius:6,cursor:"pointer",fontWeight:600,fontSize:13,width:"100%"},children:"Review Decision"})]},l.id))})]}),s.length>0&&u.jsxs("div",{style:{padding:24,backgroundColor:"#FFFFFF",borderRadius:8,border:"1px solid #E5E7EB",marginBottom:24},children:[u.jsx("h3",{style:{margin:"0 0 16px",color:"#EAEAEA",fontSize:18,fontWeight:600},children:"Actions In Progress"}),u.jsx("div",{style:{display:"grid",gap:12},children:s.map(l=>u.jsxs("div",{style:{padding:16,backgroundColor:"#F9FAFB",borderRadius:6,border:"1px solid #E1E4E8",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{children:[u.jsx("div",{style:{color:"#EAEAEA",fontWeight:500,marginBottom:4},children:l.description}),u.jsxs("div",{style:{color:"#A0A0A0",fontSize:12},children:["Deadline: ",new Date(l.deadline).toLocaleDateString()]})]}),u.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#242424",color:"#6B7280",borderRadius:4,fontSize:11,fontWeight:500},children:l.status})]},l.id))})]}),u.jsxs("details",{style:{padding:24,backgroundColor:"#FFFFFF",borderRadius:8,border:"1px solid #E5E7EB"},children:[u.jsx("summary",{style:{cursor:"pointer",color:"#111827",fontWeight:600,fontSize:18,marginBottom:16,userSelect:"none"},children:"Knowledge & Risk"}),u.jsxs("div",{style:{marginTop:16,paddingTop:16,borderTop:"1px solid #242424"},children:[u.jsx("div",{style:{color:"#A0A0A0",fontSize:14,marginBottom:12},children:"Market insights and risk analysis will appear here when you have an active intent."}),u.jsxs("div",{style:{display:"flex",gap:8},children:[u.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#F9FAFB",border:"1px solid #E1E4E8",borderRadius:4,fontSize:12,color:"#6B7280"},children:"India RAG"}),u.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#F9FAFB",border:"1px solid #E1E4E8",borderRadius:4,fontSize:12,color:"#6B7280"},children:"US RAG"})]})]})]})]})})}function YT(){const t=Or(),[e]=w.useState([{id:"prop-1",address:"123 Main St, Vizag",status:"ACTIVE",compliance:"COMPLIANT",risk:"LOW",buyers:3},{id:"prop-2",address:"456 Oak Ave, Mumbai",status:"PENDING",compliance:"REVIEW",risk:"MEDIUM",buyers:1}]),[n]=w.useState([{id:"buyer-1",property:"123 Main St, Vizag",stage:"viewing",interest:"HIGH"},{id:"buyer-2",property:"123 Main St, Vizag",stage:"negotiation",interest:"MEDIUM"}]),[i]=w.useState([{id:"act-1",description:"Upload property title document",property:"456 Oak Ave, Mumbai",priority:"HIGH",deadline:"2024-12-27"},{id:"act-2",description:"Approve site visit request",property:"123 Main St, Vizag",priority:"MEDIUM",deadline:"2024-12-28"}]);return u.jsx(Ho,{children:u.jsxs("div",{style:{padding:30,maxWidth:1200,margin:"0 auto"},children:[u.jsxs("div",{style:{padding:24,backgroundColor:"#FFFFFF",borderRadius:8,border:"1px solid #242424",marginBottom:24},children:[u.jsx("h2",{style:{margin:"0 0 20px",color:"#EAEAEA",fontSize:20,fontWeight:600},children:"Property Overview"}),u.jsx("div",{style:{display:"grid",gap:16},children:e.map(r=>u.jsx("div",{style:{padding:20,backgroundColor:"#181818",borderRadius:6,border:"1px solid #E5E7EB"},children:u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:12},children:[u.jsxs("div",{children:[u.jsx("div",{style:{color:"#EAEAEA",fontWeight:600,fontSize:16,marginBottom:4},children:r.address}),u.jsxs("div",{style:{display:"flex",gap:12,marginTop:8},children:[u.jsx("span",{style:{padding:"4px 8px",backgroundColor:r.status==="ACTIVE"?"#3FA36C":"#C8A24D",color:"#0A0A0A",borderRadius:4,fontSize:11,fontWeight:600},children:r.status}),u.jsx("span",{style:{padding:"4px 8px",backgroundColor:r.compliance==="COMPLIANT"?"#3FA36C":"#C8A24D",color:"#0A0A0A",borderRadius:4,fontSize:11,fontWeight:600},children:r.compliance}),u.jsxs("span",{style:{padding:"4px 8px",backgroundColor:r.risk==="HIGH"?"#C24B4B":r.risk==="MEDIUM"?"#C8A24D":"#3FA36C",color:"#0A0A0A",borderRadius:4,fontSize:11,fontWeight:600},children:[r.risk," RISK"]})]})]}),u.jsxs("div",{style:{textAlign:"right"},children:[u.jsx("div",{style:{color:"#A0A0A0",fontSize:12,marginBottom:4},children:"Interested Buyers"}),u.jsx("div",{style:{color:"#EAEAEA",fontSize:20,fontWeight:600},children:r.buyers})]})]})},r.id))})]}),u.jsxs("div",{style:{padding:24,backgroundColor:"#FFFFFF",borderRadius:8,border:"1px solid #242424",marginBottom:24},children:[u.jsx("h3",{style:{margin:"0 0 16px",color:"#EAEAEA",fontSize:18,fontWeight:600},children:"Buyer Activity"}),u.jsx("div",{style:{display:"grid",gap:12},children:n.map(r=>u.jsx("div",{style:{padding:16,backgroundColor:"#181818",borderRadius:6,border:"1px solid #E5E7EB"},children:u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{children:[u.jsx("div",{style:{color:"#EAEAEA",fontWeight:500,marginBottom:4},children:r.property}),u.jsxs("div",{style:{color:"#A0A0A0",fontSize:12},children:["Stage: ",r.stage,"  Interest: ",r.interest]})]}),u.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#242424",color:"#6B7280",borderRadius:4,fontSize:11,fontWeight:500,textTransform:"capitalize"},children:r.stage})]})},r.id))})]}),u.jsxs("div",{style:{padding:24,backgroundColor:"#FFFFFF",borderRadius:8,border:"1px solid #242424",marginBottom:24},children:[u.jsx("h3",{style:{margin:"0 0 16px",color:"#EAEAEA",fontSize:18,fontWeight:600},children:"Required Actions"}),u.jsx("div",{style:{display:"grid",gap:12},children:i.map(r=>u.jsxs("div",{style:{padding:16,backgroundColor:"#181818",borderRadius:6,border:"1px solid #E5E7EB"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:8},children:[u.jsxs("div",{children:[u.jsx("div",{style:{color:"#EAEAEA",fontWeight:500,marginBottom:4},children:r.description}),u.jsxs("div",{style:{color:"#A0A0A0",fontSize:12},children:[r.property,"  Deadline: ",new Date(r.deadline).toLocaleDateString()]})]}),u.jsx("span",{style:{padding:"4px 8px",backgroundColor:r.priority==="HIGH"?"#C24B4B":"#C8A24D",color:"#0A0A0A",borderRadius:4,fontSize:11,fontWeight:600},children:r.priority})]}),u.jsx("button",{onClick:()=>t("/intent"),style:{marginTop:12,padding:"8px 16px",backgroundColor:"#5B84C4",color:"#0A0A0A",border:"none",borderRadius:6,cursor:"pointer",fontWeight:600,fontSize:13,width:"100%"},children:"Take Action"})]},r.id))})]}),u.jsxs("details",{style:{padding:24,backgroundColor:"#FFFFFF",borderRadius:8,border:"1px solid #242424"},children:[u.jsx("summary",{style:{cursor:"pointer",color:"#111827",fontWeight:600,fontSize:18,marginBottom:16,userSelect:"none"},children:"Evidence & Compliance"}),u.jsxs("div",{style:{marginTop:16,paddingTop:16,borderTop:"1px solid #242424"},children:[u.jsx("div",{style:{color:"#A0A0A0",fontSize:14,marginBottom:12},children:"Proof of disclosures and legal records will appear here."}),u.jsxs("div",{style:{display:"flex",gap:8},children:[u.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#181818",border:"1px solid #E5E7EB",borderRadius:4,fontSize:12,color:"#6B7280"},children:"Disclosure Records"}),u.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#181818",border:"1px solid #E5E7EB",borderRadius:4,fontSize:12,color:"#6B7280"},children:"Legal Compliance"})]})]})]})]})})}function QT(){const t=Or(),[e]=w.useState([{id:"intent-1",buyer:"John Doe",property:"123 Main St, Vizag",stage:"DECISIONS",priority:"HIGH",risk:"LOW"},{id:"intent-2",buyer:"Jane Smith",property:"456 Oak Ave, Mumbai",stage:"ACTIONS",priority:"MEDIUM",risk:"MEDIUM"}]),[n]=w.useState([{id:"act-1",description:"Schedule site visit for John Doe",intent:"intent-1",deadline:"2024-12-27",risk:"LOW"},{id:"act-2",description:"Contact bank for loan verification",intent:"intent-2",deadline:"2024-12-28",risk:"MEDIUM"},{id:"act-3",description:"Verify property documents",intent:"intent-2",deadline:"2024-12-29",risk:"HIGH"}]),[i]=w.useState([{id:"alert-1",type:"BLOCKED",intent:"intent-3",reason:"Missing title document",severity:"HIGH"},{id:"alert-2",type:"MISSING_DOCS",intent:"intent-4",reason:"Income proof required",severity:"MEDIUM"}]);return u.jsx(Ho,{children:u.jsxs("div",{style:{padding:30,maxWidth:1200,margin:"0 auto"},children:[u.jsxs("div",{style:{padding:24,backgroundColor:"#FFFFFF",borderRadius:8,border:"1px solid #242424",marginBottom:24},children:[u.jsx("h2",{style:{margin:"0 0 20px",color:"#EAEAEA",fontSize:20,fontWeight:600},children:"Assigned Intents"}),u.jsx("div",{style:{display:"grid",gap:16},children:e.map(r=>u.jsxs("div",{style:{padding:20,backgroundColor:"#181818",borderRadius:6,border:"1px solid #E5E7EB"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:12},children:[u.jsxs("div",{children:[u.jsx("div",{style:{color:"#EAEAEA",fontWeight:600,fontSize:16,marginBottom:4},children:r.buyer}),u.jsx("div",{style:{color:"#A0A0A0",fontSize:14,marginBottom:8},children:r.property}),u.jsxs("div",{style:{display:"flex",gap:8},children:[u.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#242424",color:"#6B7280",borderRadius:4,fontSize:11,fontWeight:500,textTransform:"capitalize"},children:r.stage}),u.jsxs("span",{style:{padding:"4px 8px",backgroundColor:r.risk==="HIGH"?"#C24B4B":r.risk==="MEDIUM"?"#C8A24D":"#3FA36C",color:"#0A0A0A",borderRadius:4,fontSize:11,fontWeight:600},children:[r.risk," RISK"]})]})]}),u.jsx("span",{style:{padding:"4px 8px",backgroundColor:r.priority==="HIGH"?"#C24B4B":"#C8A24D",color:"#0A0A0A",borderRadius:4,fontSize:11,fontWeight:600},children:r.priority})]}),u.jsx("button",{onClick:()=>t("/intent"),style:{marginTop:12,padding:"8px 16px",backgroundColor:"#5B84C4",color:"#0A0A0A",border:"none",borderRadius:6,cursor:"pointer",fontWeight:600,fontSize:13,width:"100%"},children:"View Intent"})]},r.id))})]}),u.jsxs("div",{style:{padding:24,backgroundColor:"#FFFFFF",borderRadius:8,border:"1px solid #242424",marginBottom:24},children:[u.jsx("h3",{style:{margin:"0 0 16px",color:"#EAEAEA",fontSize:18,fontWeight:600},children:"Actions Queue"}),u.jsx("div",{style:{display:"grid",gap:12},children:n.map(r=>u.jsxs("div",{style:{padding:16,backgroundColor:"#181818",borderRadius:6,border:"1px solid #E5E7EB"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:8},children:[u.jsxs("div",{children:[u.jsx("div",{style:{color:"#EAEAEA",fontWeight:500,marginBottom:4},children:r.description}),u.jsxs("div",{style:{color:"#A0A0A0",fontSize:12},children:["Deadline: ",new Date(r.deadline).toLocaleDateString()]})]}),u.jsxs("span",{style:{padding:"4px 8px",backgroundColor:r.risk==="HIGH"?"#C24B4B":r.risk==="MEDIUM"?"#C8A24D":"#3FA36C",color:"#0A0A0A",borderRadius:4,fontSize:11,fontWeight:600},children:[r.risk," RISK"]})]}),u.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[u.jsx("button",{onClick:()=>t("/intent"),style:{flex:1,padding:"8px 16px",backgroundColor:"#5B84C4",color:"#0A0A0A",border:"none",borderRadius:6,cursor:"pointer",fontWeight:600,fontSize:13},children:"Update"}),u.jsx("button",{style:{flex:1,padding:"8px 16px",backgroundColor:"#242424",color:"#6B7280",border:"none",borderRadius:6,cursor:"pointer",fontWeight:600,fontSize:13},children:"Voice Update"})]})]},r.id))})]}),i.length>0&&u.jsxs("div",{style:{padding:24,backgroundColor:"#FFFFFF",borderRadius:8,border:"1px solid #242424",marginBottom:24},children:[u.jsx("h3",{style:{margin:"0 0 16px",color:"#EAEAEA",fontSize:18,fontWeight:600},children:"Compliance Alerts"}),u.jsx("div",{style:{display:"grid",gap:12},children:i.map(r=>u.jsx("div",{style:{padding:16,backgroundColor:r.severity==="HIGH"?"#1A0A0A":"#181818",borderRadius:6,border:`1px solid ${r.severity==="HIGH"?"#C24B4B":"#C8A24D"}`},children:u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[u.jsxs("div",{children:[u.jsx("div",{style:{color:"#EAEAEA",fontWeight:600,marginBottom:4},children:r.type.replace(/_/g," ")}),u.jsx("div",{style:{color:"#A0A0A0",fontSize:14},children:r.reason})]}),u.jsx("span",{style:{padding:"4px 8px",backgroundColor:r.severity==="HIGH"?"#C24B4B":"#C8A24D",color:"#0A0A0A",borderRadius:4,fontSize:11,fontWeight:600},children:r.severity})]})},r.id))})]}),u.jsxs("details",{style:{padding:24,backgroundColor:"#FFFFFF",borderRadius:8,border:"1px solid #242424"},children:[u.jsx("summary",{style:{cursor:"pointer",color:"#111827",fontWeight:600,fontSize:18,marginBottom:16,userSelect:"none"},children:"Evidence Timeline"}),u.jsxs("div",{style:{marginTop:16,paddingTop:16,borderTop:"1px solid #242424"},children:[u.jsx("div",{style:{color:"#A0A0A0",fontSize:14,marginBottom:12},children:"Proof of work and immutable logs will appear here."}),u.jsxs("div",{style:{display:"flex",gap:8},children:[u.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#181818",border:"1px solid #E5E7EB",borderRadius:4,fontSize:12,color:"#6B7280"},children:"Work Logs"}),u.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#181818",border:"1px solid #E5E7EB",borderRadius:4,fontSize:12,color:"#6B7280"},children:"Immutable Records"})]})]})]})]})})}function XT(){const[t]=w.useState({engines:[{name:"Intent Engine",status:"HEALTHY",latency:"45ms"},{name:"Compliance Engine",status:"HEALTHY",latency:"120ms"},{name:"Risk Engine",status:"WARNING",latency:"250ms"},{name:"Decision Engine",status:"HEALTHY",latency:"80ms"},{name:"Evidence Engine",status:"HEALTHY",latency:"30ms"}],failures:2,last24h:0}),[e]=w.useState({active:"v2.1.0",lastUpdated:"2024-12-20",impactedIntents:45}),[n]=w.useState({LOW:120,MEDIUM:35,HIGH:8,trend:"Stable"}),[i]=w.useState({verified:163,total:163,status:"INTEGRITY_OK"});return u.jsx(Ho,{children:u.jsxs("div",{style:{padding:30,maxWidth:1200,margin:"0 auto"},children:[u.jsxs("div",{style:{padding:24,backgroundColor:"#FFFFFF",borderRadius:8,border:"1px solid #E5E7EB",marginBottom:24},children:[u.jsx("h2",{style:{margin:"0 0 20px",color:"#EAEAEA",fontSize:20,fontWeight:600},children:"System Health"}),u.jsx("div",{style:{display:"grid",gap:12,marginBottom:16},children:t.engines.map(r=>u.jsxs("div",{style:{padding:16,backgroundColor:"#F9FAFB",borderRadius:6,border:"1px solid #E5E7EB",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{children:[u.jsx("div",{style:{color:"#EAEAEA",fontWeight:500,marginBottom:4},children:r.name}),u.jsxs("div",{style:{color:"#A0A0A0",fontSize:12},children:["Latency: ",r.latency]})]}),u.jsx("span",{style:{padding:"4px 8px",backgroundColor:r.status==="HEALTHY"?"#16A34A":r.status==="WARNING"?"#D97706":"#DC2626",color:"#FFFFFF",borderRadius:4,fontSize:11,fontWeight:600},children:r.status})]},r.name))}),u.jsxs("div",{style:{display:"flex",gap:16,paddingTop:16,borderTop:"1px solid #242424"},children:[u.jsxs("div",{children:[u.jsx("div",{style:{color:"#A0A0A0",fontSize:12,marginBottom:4},children:"Total Failures"}),u.jsx("div",{style:{color:"#EAEAEA",fontSize:20,fontWeight:600},children:t.failures})]}),u.jsxs("div",{children:[u.jsx("div",{style:{color:"#A0A0A0",fontSize:12,marginBottom:4},children:"Last 24h"}),u.jsx("div",{style:{color:"#EAEAEA",fontSize:20,fontWeight:600},children:t.last24h})]})]})]}),u.jsxs("div",{style:{padding:24,backgroundColor:"#FFFFFF",borderRadius:8,border:"1px solid #E5E7EB",marginBottom:24},children:[u.jsx("h3",{style:{margin:"0 0 16px",color:"#EAEAEA",fontSize:18,fontWeight:600},children:"Policy Versions"}),u.jsx("div",{style:{padding:16,backgroundColor:"#181818",borderRadius:6,border:"1px solid #242424"},children:u.jsxs("div",{style:{display:"grid",gap:12},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{children:[u.jsx("div",{style:{color:"#EAEAEA",fontWeight:500,marginBottom:4},children:"Active Policy Set"}),u.jsx("div",{style:{color:"#A0A0A0",fontSize:14},children:e.active})]}),u.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#16A34A",color:"#FFFFFF",borderRadius:4,fontSize:11,fontWeight:600},children:"ACTIVE"})]}),u.jsxs("div",{style:{paddingTop:12,borderTop:"1px solid #242424"},children:[u.jsx("div",{style:{color:"#A0A0A0",fontSize:12,marginBottom:4},children:"Last Updated"}),u.jsx("div",{style:{color:"#EAEAEA",fontSize:14},children:new Date(e.lastUpdated).toLocaleDateString()})]}),u.jsxs("div",{style:{paddingTop:12,borderTop:"1px solid #242424"},children:[u.jsx("div",{style:{color:"#A0A0A0",fontSize:12,marginBottom:4},children:"Impacted Intents"}),u.jsx("div",{style:{color:"#EAEAEA",fontSize:20,fontWeight:600},children:e.impactedIntents})]})]})})]}),u.jsxs("div",{style:{padding:24,backgroundColor:"#FFFFFF",borderRadius:8,border:"1px solid #E5E7EB",marginBottom:24},children:[u.jsx("h3",{style:{margin:"0 0 16px",color:"#EAEAEA",fontSize:18,fontWeight:600},children:"Risk Distribution"}),u.jsxs("div",{style:{display:"grid",gap:12},children:[u.jsxs("div",{style:{padding:16,backgroundColor:"#181818",borderRadius:6,border:"1px solid #E5E7EB",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{children:[u.jsx("div",{style:{color:"#EAEAEA",fontWeight:500},children:"LOW"}),u.jsx("div",{style:{color:"#A0A0A0",fontSize:12},children:"Risk Level"})]}),u.jsx("div",{style:{color:"#3FA36C",fontSize:24,fontWeight:600},children:n.LOW})]}),u.jsxs("div",{style:{padding:16,backgroundColor:"#181818",borderRadius:6,border:"1px solid #E5E7EB",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{children:[u.jsx("div",{style:{color:"#EAEAEA",fontWeight:500},children:"MEDIUM"}),u.jsx("div",{style:{color:"#A0A0A0",fontSize:12},children:"Risk Level"})]}),u.jsx("div",{style:{color:"#C8A24D",fontSize:24,fontWeight:600},children:n.MEDIUM})]}),u.jsxs("div",{style:{padding:16,backgroundColor:"#181818",borderRadius:6,border:"1px solid #E5E7EB",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsxs("div",{children:[u.jsx("div",{style:{color:"#EAEAEA",fontWeight:500},children:"HIGH"}),u.jsx("div",{style:{color:"#A0A0A0",fontSize:12},children:"Risk Level"})]}),u.jsx("div",{style:{color:"#C24B4B",fontSize:24,fontWeight:600},children:n.HIGH})]}),u.jsxs("div",{style:{padding:16,backgroundColor:"#181818",borderRadius:6,border:"1px solid #E5E7EB",marginTop:8},children:[u.jsx("div",{style:{color:"#A0A0A0",fontSize:12,marginBottom:4},children:"Trend"}),u.jsx("div",{style:{color:"#EAEAEA",fontSize:14,fontWeight:500},children:n.trend})]})]})]}),u.jsxs("div",{style:{padding:24,backgroundColor:"#FFFFFF",borderRadius:8,border:"1px solid #E5E7EB"},children:[u.jsx("h3",{style:{margin:"0 0 16px",color:"#EAEAEA",fontSize:18,fontWeight:600},children:"Evidence Integrity"}),u.jsxs("div",{style:{padding:16,backgroundColor:"#181818",borderRadius:6,border:"1px solid #242424"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[u.jsxs("div",{children:[u.jsx("div",{style:{color:"#EAEAEA",fontWeight:500,marginBottom:4},children:"Hash Verification"}),u.jsxs("div",{style:{color:"#A0A0A0",fontSize:14},children:[i.verified," / ",i.total," verified"]})]}),u.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#3FA36C",color:"#0A0A0A",borderRadius:4,fontSize:11,fontWeight:600},children:i.status.replace(/_/g," ")})]}),u.jsxs("div",{style:{paddingTop:12,borderTop:"1px solid #242424"},children:[u.jsx("div",{style:{color:"#A0A0A0",fontSize:12,marginBottom:4},children:"Audit Completeness"}),u.jsx("div",{style:{color:"#EAEAEA",fontSize:14},children:"100% - All intents have complete audit trails"})]})]})]})]})})}function ZT(){const t=Vh();switch(t){case"buyer":return u.jsx(JT,{});case"seller":return u.jsx(YT,{});case"agent":return u.jsx(QT,{});case"admin":case"superuser":return u.jsx(XT,{});default:return u.jsxs("div",{style:{padding:40,textAlign:"center",color:"#A0A0A0"},children:["Unauthorized - No dashboard available for role: ",t]})}}function eE(){return u.jsx(ZT,{})}function tE(t){let e=t.toLowerCase().trim();return e=e.replace(/\s+/g," "),Object.entries({won:"one",to:"two",for:"four",ate:"eight",reed:"read",red:"read",decisive:"decision",explain:"explanation",comply:"compliance",risky:"risk",step:"step",steps:"step"}).forEach(([i,r])=>{const s=new RegExp(`\\b${i}\\b`,"gi");e=e.replace(s,r)}),e}function nE(t){const e=tE(t);if(console.log("[Voice Command Parser] Parsing command:",e),console.log("[Voice Command Parser] Raw command (for debugging):",t),e.includes("read")||e.includes("red")||e.includes("reed")||e.includes("recent")&&(e.includes("one")||e.includes("1")||e.includes("two")||e.includes("2"))||e.includes("read")&&(e.includes("first")||e.includes("second")||e.includes("third"))||e.includes("red")&&e.includes("decision")||e.includes("reed")&&e.includes("decision")){if(e.includes("read")&&(e.includes("decision")||e.includes("recent"))||e.includes("red")&&e.includes("decision")||e.includes("reed")&&e.includes("decision")||e.includes("read")&&(e.includes("first")||e.includes("second")||e.includes("third"))&&!e.includes("action")){let a=e.match(/read\s+(?:the\s+)?(?:first|second|third|fourth|fifth|1st|2nd|3rd|4th|5th)\s+decision/i)||e.match(/read\s+decision\s+(one|won|two|to|three|four|five|1|2|3|4|5|first|second|third|agent|property|bank|loan)/i)||e.match(/read\s+(agent|property|bank|loan)\s+decision/i)||e.match(/read\s+recent\s+(one|won|two|to|three|four|five|1|2|3|4|5)/i)||e.match(/read\s+(?:the\s+)?decision/i),c=null;return a&&(c=a[1]?a[1].toLowerCase():null,c&&(c={won:"one",to:"two",for:"four",first:"one","1st":"one",second:"two","2nd":"two",third:"three","3rd":"three",fourth:"four","4th":"four",fifth:"five","5th":"five"}[c]||c)),console.log("[Voice Command Parser] Matched: read decision",c||"(most recent)"),{type:"read",target:"decision",identifier:c,confirmation:!1,action:"read_decision"}}if(e.includes("read")&&e.includes("action")){const a=e.match(/read\s+action\s+(one|two|three|four|five|1|2|3|4|5|[a-z\s]+?)(?:\s+action|$)/i),c=a?a[1].trim().toLowerCase():null;return console.log("[Voice Command Parser] Matched: read action",c||"(most recent)"),{type:"read",target:"action",identifier:c,confirmation:!1,action:"read_action"}}if(e.includes("read")&&e.includes("explanation")||e.includes("read")&&e.includes("why")||e.includes("why was this recommended")||e.includes("explain this"))return console.log("[Voice Command Parser] Matched: read explanation"),{type:"read",target:"explanation",identifier:null,confirmation:!1,action:"read_explanation"};if(e.includes("read")&&(e.includes("intent")||e.includes("summary"))||e.includes("what is my intent")||e.includes("read my intent"))return console.log("[Voice Command Parser] Matched: read intent"),{type:"read",target:"intent",identifier:null,confirmation:!1,action:"read_intent"};if(e.includes("read")&&e.includes("compliance"))return console.log("[Voice Command Parser] Matched: read compliance"),{type:"read",target:"compliance",identifier:null,confirmation:!1,action:"read_compliance"};if(e.includes("read")&&e.includes("risk"))return console.log("[Voice Command Parser] Matched: read risk"),{type:"read",target:"risk",identifier:null,confirmation:!1,action:"read_risk"};if(e.includes("read")&&(e.includes("next")||e.includes("step"))||e.includes("what's next")||e.includes("what is next")||e.includes("what are the next steps"))return console.log("[Voice Command Parser] Matched: read next step"),{type:"read",target:"next_step",identifier:null,confirmation:!1,action:"read_next_step"};if(e.includes("read")&&(e.includes("this")||e.includes("current")||e.includes("recent")||e.includes("it"))||e.includes("what does this say")||e.includes("what does it say"))return console.log("[Voice Command Parser] Matched: read current"),{type:"read",target:"current",identifier:null,confirmation:!1,action:"read_current"}}const n=e.trim();if(e.includes("scroll")&&e.includes("up")&&!e.includes("down")||/^go\s+up$/i.test(n)||/^move\s+up$/i.test(n)||e.includes("scroll upward")&&!e.includes("down")||/scroll\s+up\b/i.test(e)&&!e.includes("down"))return console.log("[Voice Command Parser] Matched: scroll up (command:",e,")"),{type:"scroll",direction:"up",confirmation:!1,action:"scroll_up"};const r=e.trim(),s=e.includes("scroll")&&e.includes("down")&&!e.includes("up")||/^go\s+down$/i.test(r)||/^move\s+down$/i.test(r)||e.includes("scroll downward")&&!e.includes("up")||/scroll\s+down\b/i.test(e)&&!e.includes("up");if((e.trim()==="scroll down"||e.trim()==="scrolldown")&&(console.warn("[Voice Command Parser] WARNING: 'scroll down' detected - this might be a mis-transcription of 'read decision'"),console.log("[Voice Command Parser] If you said 'read decision', the speech recognition may have mis-transcribed it.")),s)return console.log("[Voice Command Parser] Matched: scroll down (command:",e,")"),{type:"scroll",direction:"down",confirmation:!1,action:"scroll_down"};if(e.includes("select")||e.includes("choose")){const o=e.match(/(?:select|choose)\s+(?:agent|property|option|bank|loan)\s*([a-z0-9]+)/i)||e.match(/(?:select|choose)\s+([a-z0-9]+)/i);if(o){const a=o[1].toLowerCase();return console.log("[Voice Command Parser] Matched: select decision option:",a),{type:"select_decision",option:a,confirmation:!0,action:"select_decision"}}}if(e.includes("confirm")&&(e.includes("decision")||e.includes("selection")))return console.log("[Voice Command Parser] Matched: confirm decision"),{type:"confirm_decision",confirmation:!1,action:"confirm_decision"};if(e.includes("mark")&&e.includes("action")&&e.includes("as")||e.includes("complete")&&e.includes("action")||e.includes("skip")&&e.includes("action")||e.includes("fail")&&e.includes("action")){let o=null;e.includes("completed")||e.includes("complete")?o="COMPLETED":e.includes("failed")||e.includes("fail")?o="FAILED":e.includes("skipped")||e.includes("skip")?o="SKIPPED":e.includes("blocked")||e.includes("block")?o="BLOCKED":(e.includes("rescheduled")||e.includes("reschedule"))&&(o="RESCHEDULED");const a=e.match(/(?:mark|complete|skip|fail)\s+action\s+([a-z0-9\s]+?)(?:\s+as|\s+completed|\s+failed|\s+skipped|$)/i)||e.match(/action\s+([a-z0-9\s]+?)(?:\s+as|\s+completed|\s+failed|\s+skipped|$)/i);if(o&&a){const c=a[1].trim().toLowerCase();return console.log("[Voice Command Parser] Matched: update action outcome:",c,o),{type:"update_action_outcome",actionIdentifier:c,outcomeType:o,confirmation:!0,action:"update_action_outcome"}}}return e==="cancel"||e==="abort"?(console.log("[Voice Command Parser] Matched: cancel"),{type:"cancel",confirmation:!1,action:"cancel"}):(console.log("[Voice Command Parser] No match - treating as intent input"),{type:"unknown",confirmation:!1,action:null})}class iE{constructor(e,n){this.tree={intentId:e,rootEntity:{id:`buyer_${e}`,type:"BUYER",name:n,status:"ACTIVE",metadata:{},actions:{chat:!1,documents:!0,videoCall:!1,actions:!1}},entities:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),version:1}}addEntityFromDecision(e,n,i,r,s={}){const o=this.tree.entities.find(c=>c.id===i);if(o)return o.status==="PENDING"&&(o.status="SELECTED",o.selectedAt=new Date().toISOString(),o.metadata={...o.metadata,...s}),{intentId:this.tree.intentId,entityType:n,entityId:i,entityName:r,decisionId:e,timestamp:new Date().toISOString(),metadata:s};const a={id:i,type:n,name:r,status:"SELECTED",selectedAt:new Date().toISOString(),metadata:s,actions:this.getDefaultActions(n)};return this.tree.entities.push(a),this.tree.updatedAt=new Date().toISOString(),this.tree.version++,{intentId:this.tree.intentId,entityType:n,entityId:i,entityName:r,decisionId:e,timestamp:new Date().toISOString(),metadata:s}}confirmEntity(e,n){const i=this.tree.entities.find(r=>r.id===e);if(!i)throw new Error(`Entity ${e} not found`);return i.status="CONFIRMED",i.confirmedAt=new Date().toISOString(),this.tree.updatedAt=new Date().toISOString(),this.tree.version++,{intentId:this.tree.intentId,entityId:e,timestamp:new Date().toISOString(),confirmedBy:n}}getDefaultActions(e){switch(e){case"AGENT":return{chat:!0,documents:!0,videoCall:!0,actions:!0};case"BANK":return{chat:!0,documents:!0,videoCall:!1,actions:!0};case"PROPERTY":return{chat:!1,documents:!0,videoCall:!1,actions:!0};default:return{chat:!1,documents:!1,videoCall:!1,actions:!1}}}build(){return{...this.tree}}getHierarchicalTree(){const e={...this.tree.rootEntity};return e.children=this.tree.entities.filter(n=>n.status!=="PENDING"),e}}function rE({intentId:t,buyerName:e,decisions:n}){const[i,r]=w.useState(null),[s,o]=w.useState(null),a=d=>({SELECT_AGENT:"AGENT",SELECT_LENDER:"BANK",SELECT_BANK:"BANK",SELECT_PROPERTY:"PROPERTY",SELECT_LAWYER:"LAWYER",SELECT_INSPECTOR:"INSPECTOR",SELECT_INSURANCE:"INSURANCE"})[d]||null,c=w.useCallback(()=>{if(!t||!e){r(null),o(null);return}const d=new iE(t,e);n.forEach(f=>{var v;const p=a(f.decisionType||f.type);if(!p)return;const y=(v=f.options)==null?void 0:v.find(T=>T.id===f.selectedOptionId);if(y){const T=`${p.toLowerCase()}_${y.id}`,g=y.label||y.name||"Unknown";d.addEntityFromDecision(f.decisionId||f.id,p,T,g,{decisionId:f.decisionId||f.id,optionId:y.id,...y}),(f.status==="CONFIRMED"||f.isConfirmed)&&d.confirmEntity(T,"system")}});const h=d.build();r(h),o(d.getHierarchicalTree())},[t,e,n]);w.useEffect(()=>{c()},[c]);const l=w.useCallback(d=>{console.log("[ProgressionTree] Entity action:",d)},[t]);return{tree:i||null,hierarchicalTree:s||null,handleEntityAction:l,rebuildTree:c}}const Kp="http://localhost:7008",zn={INTENT_CREATED:"INTENT_CREATED",COMPLIANCE_RESULT:"COMPLIANCE_RESULT",DECISION_GENERATED:"DECISION_GENERATED",DECISION_CONFIRMED:"DECISION_CONFIRMED",INITIAL_CONFIRMATION:"INITIAL_CONFIRMATION",DECISION_CHANGED:"DECISION_CHANGED",ACTION_COMPLETED:"ACTION_COMPLETED",ACTION_CONFIRMED:"ACTION_CONFIRMED",ACTION_FAILED:"ACTION_FAILED",ACTION_RESCHEDULED:"ACTION_RESCHEDULED",INTENT_COMPLETED:"INTENT_COMPLETED"};function sE(t){switch(t){case"COMPLETED":return zn.ACTION_COMPLETED;case"CONFIRMED":return zn.ACTION_CONFIRMED;case"FAILED":return zn.ACTION_FAILED;case"RESCHEDULED":return zn.ACTION_RESCHEDULED;default:return null}}async function lr({to:t,template:e,data:n,subject:i,html:r,text:s,generateDocx:o=!1}){console.log(`[Email Service] Attempting to send email - Template: ${e}, To: ${Array.isArray(t)?t.join(", "):t}, URL: ${Kp}`);try{const a=Array.isArray(t)?t:[t],c=a.map(p=>fetch(`${Kp}/v1/send`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:p,template:e,data:n,subject:i,html:r,text:s,generateDocx:o})})),l=await Promise.allSettled(c),d=await Promise.all(l.map(async(p,y)=>{if(p.status==="fulfilled"){const v=p.value;if(v.ok){const T=await v.json();return{success:!0,recipient:a[y],result:T}}else{const T=await v.text();return{success:!1,recipient:a[y],error:T}}}else return{success:!1,recipient:a[y],error:p.reason}})),h=d.filter(p=>p.success).length,f=d.filter(p=>!p.success).length;return h>0&&console.log(`[Email Service] Email sent successfully: ${e} to ${h} recipient(s)`),f>0&&console.warn(`[Email Service] Failed to send ${e} to ${f} recipient(s)`),{success:h>0,results:d}}catch(a){const c=a.message||String(a);return c.includes("fetch")||c.includes("ECONNREFUSED")?console.warn(`[Email Service] Email service not available (non-blocking): ${c}`):console.warn(`[Email Service] Error sending email (non-blocking): ${c}`),{success:!1,error:c}}}async function oE({userEmail:t,agent:e,lender:n,property:i,downPayment:r,intentId:s}){const o=" Intent Confirmation - Your Selections",a=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
      <h2 style="color: #2563eb;">Intent Confirmation</h2>
      <p>Your selections have been confirmed:</p>
      <ul style="line-height: 1.8;">
        <li><strong>Agent:</strong> ${e||"Not selected"}</li>
        <li><strong>Lender:</strong> ${n||"Not selected"}</li>
        <li><strong>Property:</strong> ${i||"Not selected"}</li>
        <li><strong>Down Payment:</strong> ${r||"Not selected"}</li>
      </ul>
      <p style="margin-top: 20px; color: #6b7280;">
        Your intent ID: <code>${s}</code>
      </p>
      <p style="margin-top: 20px;">
        You will receive email notifications for each action as they progress.
      </p>
    </div>
  `,c=`
Intent Confirmation

Your selections have been confirmed:
- Agent: ${e||"Not selected"}
- Lender: ${n||"Not selected"}
- Property: ${i||"Not selected"}
- Down Payment: ${r||"Not selected"}

Intent ID: ${s}

You will receive email notifications for each action as they progress.
  `;return lr({to:t,template:zn.INITIAL_CONFIRMATION,subject:o,html:a,text:c,data:{agent:e,lender:n,property:i,downPayment:r,intentId:s}})}async function aE({userEmail:t,action:e,status:n,reason:i,scheduledFor:r,intentId:s}){const o=sE(n);if(!o)return console.warn(`[Email Service] No email template for status: ${n}`),{success:!1,error:"Unknown status"};const a={COMPLETED:"",CONFIRMED:"",FAILED:"",RESCHEDULED:""}[n]||"",c={COMPLETED:"Completed",CONFIRMED:"Confirmed",FAILED:"Failed",RESCHEDULED:"Rescheduled"}[n]||n,l=`${a} Action ${c}: ${e.description||e.name||"Action"}`;let d=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
      <h2 style="color: ${n==="COMPLETED"||n==="CONFIRMED"?"#16a34a":n==="FAILED"?"#dc2626":"#d97706"};">
        ${a} Action ${c}
      </h2>
      <p><strong>Action:</strong> ${e.description||e.name||"Action"}</p>
  `;i&&(d+=`<p><strong>Reason:</strong> ${i}</p>`),r&&(d+=`<p><strong>Scheduled For:</strong> ${new Date(r).toLocaleString()}</p>`),d+=`
      <p style="margin-top: 20px; color: #6b7280;">
        Intent ID: <code>${s}</code>
      </p>
      <p style="margin-top: 20px;">
        ${n==="COMPLETED"||n==="CONFIRMED"?"The next action in your workflow will now be unlocked.":n==="RESCHEDULED"?"This action has been rescheduled. You will be notified when it's time to proceed.":"Please review and take necessary action."}
      </p>
    </div>
  `;const h=`
${a} Action ${c}

Action: ${e.description||e.name||"Action"}
${i?`Reason: ${i}
`:""}${r?`Scheduled For: ${new Date(r).toLocaleString()}
`:""}
Intent ID: ${s}

${n==="COMPLETED"||n==="CONFIRMED"?"The next action in your workflow will now be unlocked.":n==="RESCHEDULED"?"This action has been rescheduled. You will be notified when it's time to proceed.":"Please review and take necessary action."}
  `;return lr({to:t,template:o,subject:l,html:d,text:h,data:{actionId:e.actionId||e.id,actionName:e.description||e.name,status:n,reason:i,scheduledFor:r,intentId:s}})}const Gp={SELECT_PROPERTY:1,SELECT_AGENT:2,SELECT_LENDER:3,DOWN_PAYMENT_STRATEGY:4};function cE(t){const e=["SELECT_PROPERTY","SELECT_AGENT","SELECT_LENDER","DOWN_PAYMENT_STRATEGY"];return t.filter(i=>i.evolutionState==="CONFIRMED"&&e.includes(i.type)).length===e.length}function lE(t){const e={agent:null,lender:null,property:null,downPayment:null};return t.forEach(n=>{var i;if(n.evolutionState==="CONFIRMED"&&n.selectedOptionId){const r=(i=n.options)==null?void 0:i.find(o=>o.id===n.selectedOptionId),s=(r==null?void 0:r.label)||(r==null?void 0:r.id)||n.selectedOptionId;switch(n.type){case"SELECT_PROPERTY":e.property=s;break;case"SELECT_AGENT":e.agent=s;break;case"SELECT_LENDER":e.lender=s;break;case"DOWN_PAYMENT_STRATEGY":e.downPayment=s;break}}}),e}async function dE({userEmail:t,intent:e,intentId:n}){var l,d,h,f;const i=" Intent Created - Analysis Complete",r=e.type||"Property Intent",s=((l=e.payload)==null?void 0:l.location)||((d=e.extractedInfo)==null?void 0:d.location)||"Not specified",o=(h=e.payload)!=null&&h.budget?`${(e.payload.budget/1e5).toFixed(0)}L`:"Not specified",a=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
      <h2 style="color: #2563eb;">Intent Created</h2>
      <p>Your intent has been successfully analyzed:</p>
      <ul style="line-height: 1.8;">
        <li><strong>Intent Type:</strong> ${r}</li>
        <li><strong>Location:</strong> ${s}</li>
        <li><strong>Budget:</strong> ${o}</li>
      </ul>
      <p style="margin-top: 20px; color: #6b7280;">
        Intent ID: <code>${n}</code>
      </p>
      <p style="margin-top: 20px;">
        Next steps: Compliance check and decision generation will follow.
      </p>
    </div>
  `,c=`
Intent Created

Your intent has been successfully analyzed:
- Intent Type: ${r}
- Location: ${s}
- Budget: ${o}

Intent ID: ${n}

Next steps: Compliance check and decision generation will follow.
  `;return lr({to:t,template:zn.INTENT_CREATED,subject:i,html:a,text:c,data:{intentId:n,intentType:r,location:s,budget:(f=e.payload)==null?void 0:f.budget}})}async function uE({userEmail:t,compliance:e,intentId:n}){const i=e.decision||"UNKNOWN",r=i==="ALLOW"?"":i==="DENY"?"":"",s=`${r} Compliance Check: ${i}`,o=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
      <h2 style="color: ${i==="ALLOW"?"#16a34a":i==="DENY"?"#dc2626":"#d97706"};">
        ${r} Compliance Check Result
      </h2>
      <p><strong>Decision:</strong> ${i}</p>
      <p><strong>Reason:</strong> ${e.reason||"N/A"}</p>
      ${e.checks&&e.checks.length>0?`
        <h3 style="margin-top: 20px;">Checks Performed:</h3>
        <ul style="line-height: 1.8;">
          ${e.checks.map(c=>`
            <li>
              <strong>${c.check}:</strong> ${c.passed?" PASS":" FAIL"}
              ${c.reason?`<br><span style="color: #6b7280; font-size: 0.9em;">${c.reason}</span>`:""}
            </li>
          `).join("")}
        </ul>
      `:""}
      <p style="margin-top: 20px; color: #6b7280;">
        Intent ID: <code>${n}</code>
      </p>
      <p style="margin-top: 20px;">
        ${i==="ALLOW"?"Your intent is compliant. You can proceed with decisions.":i==="DENY"?"Your intent is not compliant. Please review and adjust your requirements.":"Your intent requires review. Please wait for further instructions."}
      </p>
    </div>
  `,a=`
${r} Compliance Check Result

Decision: ${i}
Reason: ${e.reason||"N/A"}

${e.checks&&e.checks.length>0?`
Checks Performed:
${e.checks.map(c=>`- ${c.check}: ${c.passed?"PASS":"FAIL"}${c.reason?` (${c.reason})`:""}`).join(`
`)}
`:""}

Intent ID: ${n}

${i==="ALLOW"?"Your intent is compliant. You can proceed with decisions.":i==="DENY"?"Your intent is not compliant. Please review and adjust your requirements.":"Your intent requires review. Please wait for further instructions."}
  `;return lr({to:t,template:zn.COMPLIANCE_RESULT,subject:s,html:o,text:a,data:{intentId:n,compliance:e}})}async function hE({userEmail:t,decisions:e,intentId:n}){const i=e.length,r=e.filter(c=>c.evolutionState!=="CONFIRMED").length,s=` ${i} Decision${i>1?"s":""} Generated`,o=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
      <h2 style="color: #8b5cf6;">Decisions Generated</h2>
      <p><strong>${i} decision${i>1?"s":""} generated.</strong></p>
      <p>${r>0?`${r} pending your review.`:"All decisions confirmed."}</p>
      
      <h3 style="margin-top: 20px;">Decision Types:</h3>
      <ul style="line-height: 1.8;">
        ${e.map(c=>{var l;return`
          <li>
            <strong>${((l=c.type)==null?void 0:l.replace(/_/g," "))||"Decision"}:</strong>
            ${c.evolutionState==="CONFIRMED"?" Confirmed":" Pending"}
            ${c.recommendation?`<br><span style="color: #d97706; font-size: 0.9em;"> Recommended: ${c.recommendation}</span>`:""}
          </li>
        `}).join("")}
      </ul>
      
      <p style="margin-top: 20px; color: #6b7280;">
        Intent ID: <code>${n}</code>
      </p>
      <p style="margin-top: 20px;">
        Please review and confirm your decisions in the Intent Platform.
      </p>
    </div>
  `,a=`
Decisions Generated

${i} decision${i>1?"s":""} generated.
${r>0?`${r} pending your review.`:"All decisions confirmed."}

Decision Types:
${e.map(c=>{var l;return`- ${((l=c.type)==null?void 0:l.replace(/_/g," "))||"Decision"}: ${c.evolutionState==="CONFIRMED"?"Confirmed":"Pending"}`}).join(`
`)}

Intent ID: ${n}

Please review and confirm your decisions in the Intent Platform.
  `;return lr({to:t,template:zn.DECISION_GENERATED,subject:s,html:o,text:a,data:{intentId:n,decisionsCount:i,pendingCount:r,decisions:e}})}async function fE({userEmail:t,decision:e,intentId:n,decisions:i=[]}){var p;const{getDecisionEmailRecipients:r}=await zy(async()=>{const{getDecisionEmailRecipients:y}=await import("./emailRecipients-J82p2SRj.js");return{getDecisionEmailRecipients:y}},[]),s=r(e.type,e,t),o=e.type||"Decision",a=((p=e.options)==null?void 0:p.find(y=>y.id===e.selectedOptionId))||e.selectedOption||{label:e.selectedOptionId||"N/A"},c=a.label||a.name||e.selectedOptionId,l=e.confidence?`${(e.confidence*100).toFixed(0)}%`:"N/A",d=` Decision Confirmed: ${o}`,h=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
      <h2 style="color: #16a34a;">Decision Confirmed</h2>
      <p><strong>Decision Type:</strong> ${o.replace(/_/g," ")}</p>
      <p><strong>Selected Option:</strong> ${c}</p>
      <p><strong>Confidence:</strong> ${l}</p>
      ${e.decidedBy?`<p><strong>Decided By:</strong> ${e.decidedBy}</p>`:""}
      ${e.decisionMethod?`<p><strong>Method:</strong> ${e.decisionMethod}</p>`:""}
      <p style="margin-top: 20px; color: #6b7280;">
        Intent ID: <code>${n}</code>
      </p>
      <p style="margin-top: 20px;">
        This decision has been confirmed. Next steps will be unlocked as dependencies are met.
      </p>
    </div>
  `,f=`
Decision Confirmed

Decision Type: ${o.replace(/_/g," ")}
Selected Option: ${c}
Confidence: ${l}
${e.decidedBy?`Decided By: ${e.decidedBy}`:""}
${e.decisionMethod?`Method: ${e.decisionMethod}`:""}

Intent ID: ${n}

This decision has been confirmed. Next steps will be unlocked as dependencies are met.
  `;return lr({to:s,template:zn.DECISION_CONFIRMED,subject:d,html:h,text:f,data:{intentId:n,decisionType:o,selectedOption:c,confidence:l,decision:e}})}async function pE({userEmail:t,decision:e,newOption:n,reason:i,intentId:r}){var f;const s=e.type||"Decision",o=((f=e.options)==null?void 0:f.find(p=>p.id===e.previousOptionId))||e.previousOption||{label:"Previous selection"},a=(n==null?void 0:n.label)||(n==null?void 0:n.name)||e.selectedOptionId,c=o.label||o.name||"Previous selection",l=` Decision Changed: ${s}`,d=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
      <h2 style="color: #d97706;">Decision Changed</h2>
      <p><strong>Decision Type:</strong> ${s.replace(/_/g," ")}</p>
      <p><strong>Previous Selection:</strong> ${c}</p>
      <p><strong>New Selection:</strong> ${a}</p>
      ${i?`<p><strong>Reason for Change:</strong> ${i}</p>`:""}
      ${e.decidedBy?`<p><strong>Changed By:</strong> ${e.decidedBy}</p>`:""}
      <p style="margin-top: 20px; color: #6b7280;">
        Intent ID: <code>${r}</code>
      </p>
      <p style="margin-top: 20px;">
        This decision change has been logged in the audit trail.
      </p>
    </div>
  `,h=`
Decision Changed

Decision Type: ${s.replace(/_/g," ")}
Previous Selection: ${c}
New Selection: ${a}
${i?`Reason for Change: ${i}`:""}
${e.decidedBy?`Changed By: ${e.decidedBy}`:""}

Intent ID: ${r}

This decision change has been logged in the audit trail.
  `;return lr({to:t,template:zn.DECISION_CHANGED,subject:l,html:d,text:h,data:{intentId:r,decisionType:s,oldOption:c,newOption:a,reason:i,decision:e}})}async function Jp({userEmail:t,intent:e,decisions:n,actions:i,intentId:r}){var h,f,p,y,v;const s=" Intent Completed - Final Report",o=i.filter(T=>T.outcome==="COMPLETED"||T.outcome==="CONFIRMED"),a=n.filter(T=>T.evolutionState==="CONFIRMED"),c=`
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
      <h2 style="color: #16a34a;"> Intent Completed</h2>
      <p>Congratulations! Your intent has been successfully completed.</p>
      
      <h3 style="margin-top: 20px;">Summary:</h3>
      <ul style="line-height: 1.8;">
        <li><strong>Intent Type:</strong> ${e.type||"N/A"}</li>
        <li><strong>Location:</strong> ${((h=e.payload)==null?void 0:h.location)||"N/A"}</li>
        <li><strong>Decisions Confirmed:</strong> ${a.length}</li>
        <li><strong>Actions Completed:</strong> ${o.length}</li>
      </ul>
      
      <p style="margin-top: 20px; color: #6b7280;">
        Intent ID: <code>${r}</code>
      </p>
      <p style="margin-top: 20px;">
        A detailed report (DOCX) is attached to this email with complete intent information.
      </p>
    </div>
  `,l=`
 Intent Completed

Congratulations! Your intent has been successfully completed.

Summary:
- Intent Type: ${e.type||"N/A"}
- Location: ${((f=e.payload)==null?void 0:f.location)||"N/A"}
- Decisions Confirmed: ${a.length}
- Actions Completed: ${o.length}

Intent ID: ${r}

A detailed report (DOCX) is attached to this email with complete intent information.
  `,d={intentId:r,intentType:e.type,location:((p=e.payload)==null?void 0:p.location)||((y=e.extractedInfo)==null?void 0:y.location),budget:(v=e.payload)==null?void 0:v.budget,decisions:n.map(T=>({type:T.type,selectedOptionId:T.selectedOptionId,options:T.options,selectedOption:T.selectedOption,evolutionState:T.evolutionState,confidence:T.confidence})),actions:i.map(T=>({actionId:T.actionId,description:T.description||T.name,status:T.status,outcome:T.outcome})),compliance:e.compliance,createdAt:e.createdAt,completedAt:new Date().toISOString()};return lr({to:t,template:zn.INTENT_COMPLETED,subject:s,html:c,text:l,data:d,generateDocx:!0})}var Yp={};function mE(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var gE=Object.defineProperty,vE=(t,e,n)=>e in t?gE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Qp=(t,e,n)=>vE(t,typeof e!="symbol"?e+"":e,n);class Kt{constructor(){Qp(this,"_locking"),Qp(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}}function ht(t,e){if(!t)throw new Error(e)}const yE=34028234663852886e22,kE=-34028234663852886e22,SE=4294967295,bE=2147483647,CE=-2147483648;function za(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>bE||t<CE)throw new Error("invalid int 32: "+t)}function Su(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>SE||t<0)throw new Error("invalid uint 32: "+t)}function qy(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>yE||t<kE))throw new Error("invalid float 32: "+t)}const Hy=Symbol("@bufbuild/protobuf/enum-type");function TE(t){const e=t[Hy];return ht(e,"missing enum type on enum object"),e}function Ky(t,e,n,i){t[Hy]=Gy(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function Gy(t,e,n){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const a=Jy(o);s.push(a),i[o.name]=a,r[o.no]=a}return{typeName:t,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function EE(t,e,n){const i={};for(const r of e){const s=Jy(r);i[s.localName]=s.no,i[s.no]=s.localName}return Ky(i,t,e),i}function Jy(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class qh{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(n);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(n);return r.readMessage(i,e,s,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function wE(t,e,n,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new qh),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return t.util.equals(o,a,c)}}),o}function xE(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function ql(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),c=(a?o|128:o)&255;if(n.push(c),!a)return}const i=t>>>28&15|(e&7)<<4,r=!!(e>>3);if(n.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),c=(a?o|128:o)&255;if(n.push(c),!a)return}n.push(e>>>31&1)}}const Va=4294967296;function Xp(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function s(o,a){const c=Number(t.slice(o,a));r*=n,i=i*n+c,i>=Va&&(r=r+(i/Va|0),i=i%Va)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?Qy(i,r):Hh(i,r)}function RE(t,e){let n=Hh(t,e);const i=n.hi&2147483648;i&&(n=Qy(n.lo,n.hi));const r=Yy(n.lo,n.hi);return i?"-"+r:r}function Yy(t,e){if({lo:t,hi:e}=IE(t,e),e<=2097151)return String(Va*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let s=n+i*6777216+r*6710656,o=i+r*8147497,a=r*2;const c=1e7;return s>=c&&(o+=Math.floor(s/c),s%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+Zp(o)+Zp(s)}function IE(t,e){return{lo:t>>>0,hi:e>>>0}}function Hh(t,e){return{lo:t|0,hi:e|0}}function Qy(t,e){return e=~e,t?t=~t+1:e+=1,Hh(t,e)}const Zp=t=>{const e=String(t);return"0000000".slice(e.length)+e};function em(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function PE(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function _E(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof Yp!="object"||Yp.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>s||l<r)throw new Error("int64 invalid: ".concat(c));return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<o)throw new Error("uint64 invalid: ".concat(c));return l},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigInt64(0,!0)},uDec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigUint64(0,!0)}}}const n=r=>ht(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>ht(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),Xp(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),Xp(r)},dec(r,s){return RE(r,s)},uDec(r,s){return Yy(r,s)}}}const it=_E();var O;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(O||(O={}));var rr;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(rr||(rr={}));function _i(t,e,n){if(e===n)return!0;if(t==O.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case O.UINT64:case O.FIXED64:case O.INT64:case O.SFIXED64:case O.SINT64:return e==n}return!1}function Ps(t,e){switch(t){case O.BOOL:return!1;case O.UINT64:case O.FIXED64:case O.INT64:case O.SFIXED64:case O.SINT64:return e==0?it.zero:"0";case O.DOUBLE:case O.FLOAT:return 0;case O.BYTES:return new Uint8Array(0);case O.STRING:return"";default:return 0}}function Xy(t,e){switch(t){case O.BOOL:return e===!1;case O.STRING:return e==="";case O.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var yt;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(yt||(yt={}));class AE{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Su(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return za(e),em(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){qy(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Su(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){za(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return za(e),e=(e<<1^e>>31)>>>0,em(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=it.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=it.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=it.enc(e);return ql(n.lo,n.hi,this.buf),this}sint64(e){let n=it.enc(e),i=n.hi>>31,r=n.lo<<1^i,s=(n.hi<<1|n.lo>>>31)^i;return ql(r,s,this.buf),this}uint64(e){let n=it.uEnc(e);return ql(n.lo,n.hi,this.buf),this}}class DE{constructor(e,n){this.varint64=xE,this.uint32=PE,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case yt.Varint:for(;this.buf[this.pos++]&128;);break;case yt.Bit64:this.pos+=4;case yt.Bit32:this.pos+=4;break;case yt.LengthDelimited:let r=this.uint32();this.pos+=r;break;case yt.StartGroup:for(;;){const[s,o]=this.tag();if(o===yt.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return it.dec(...this.varint64())}uint64(){return it.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,it.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return it.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return it.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function NE(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),r=t.util.newFieldList([s]).list()[0]}return r},runtime:t}}function Zy(t){const e=t.field.localName,n=Object.create(null);return n[e]=OE(t),[n,()=>n[e]]}function OE(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Ps(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function LE(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let mi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),tl=[];for(let t=0;t<mi.length;t++)tl[mi[t].charCodeAt(0)]=t;tl[45]=mi.indexOf("+");tl[95]=mi.indexOf("/");const e0={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,s,o=0;for(let a=0;a<t.length;a++){if(s=tl[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:n[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:n[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:n[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let s=0;s<t.length;s++)switch(i=t[s],n){case 0:e+=mi[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=mi[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=mi[r|i>>6],e+=mi[i&63],n=0;break}return n&&(e+=mi[r],e+="=",n==1&&(e+="=")),e}};function ME(t,e,n){n0(e,t);const i=e.runtime.bin.makeReadOptions(n),r=LE(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=Zy(e);for(const a of r)e.runtime.bin.readField(s,i.readerFactory(a.data),e.field,a.wireType,i);return o()}function jE(t,e,n,i){n0(e,t);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(t0(t,e)){const l=t.getType().runtime.bin.listUnknownFields(t).filter(d=>d.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const d of l)t.getType().runtime.bin.onUnknownField(t,d.no,d.wireType,d.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const c=r.readerFactory(o.finish());for(;c.pos<c.len;){const[l,d]=c.tag(),h=c.skip(d,l);t.getType().runtime.bin.onUnknownField(t,l,d,h)}}function t0(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function n0(t,e){ht(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function i0(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!Xy(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function tm(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?Ps(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function gi(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(qh.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function r0(t,e){return gi(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}O.DOUBLE,O.FLOAT,O.INT64,O.UINT64,O.INT32,O.UINT32,O.BOOL,O.STRING,O.BYTES;const nm={ignoreUnknownFields:!1},im={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function FE(t){return t?Object.assign(Object.assign({},nm),t):nm}function UE(t){return t?Object.assign(Object.assign({},im),t):im}const wc=Symbol(),Wa=Symbol();function BE(){return{makeReadOptions:FE,makeWriteOptions:UE,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Xn(e)));i=i??new t;const r=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const c=t.fields.findJsonName(o);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const l=r.get(c.oneof);if(l!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(l,'", "').concat(o,'"'));r.set(c.oneof,o)}rm(i,a,c,n,t)}else{let l=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const d=s.findExtension(o.substring(1,o.length-1));if(d&&d.extendee.typeName==t.typeName){l=!0;const[h,f]=Zy(d);rm(h,a,d.field,n,d),jE(i,d,f(),n)}}if(!l&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!i0(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!VE(r))continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName],a=sm(r,o,e);a!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&t0(t,a)){const c=ME(t,a,e),l=sm(a.field,c,e);l!==void 0&&(i[a.field.jsonName]=l)}}}catch(s){const o=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return i},readScalar(t,e,n){return To(t,e,n??rr.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||Xy(t,e)))return $a(t,e)},debug:Xn}}function Xn(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function rm(t,e,n,i,r){let s=n.localName;if(n.repeated){if(ht(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xn(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xn(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,i));break;case"enum":const c=Hl(n.T,a,i.ignoreUnknownFields,!0);c!==Wa&&o.push(c);break;case"scalar":try{o.push(To(n.T,a,n.L,!0))}catch(l){let d="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xn(a));throw l instanceof Error&&l.message.length>0&&(d+=": ".concat(l.message)),new Error(d)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xn(e)));const o=t[s];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let l;try{l=zE(n.K,a)}catch(d){let h="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xn(e));throw d instanceof Error&&d.message.length>0&&(h+=": ".concat(d.message)),new Error(h)}switch(n.V.kind){case"message":o[l]=n.V.T.fromJson(c,i);break;case"enum":const d=Hl(n.V.T,c,i.ignoreUnknownFields,!0);d!==Wa&&(o[l]=d);break;case"scalar":try{o[l]=To(n.V.T,c,rr.BIGINT,!0)}catch(h){let f="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xn(e));throw h instanceof Error&&h.message.length>0&&(f+=": ".concat(h.message)),new Error(f)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];gi(a)?a.fromJson(e,i):(t[s]=a=o.fromJson(e,i),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const c=Hl(n.T,e,i.ignoreUnknownFields,!1);switch(c){case wc:tm(n,t);break;case Wa:break;default:t[s]=c;break}break;case"scalar":try{const l=To(n.T,e,n.L,!1);switch(l){case wc:tm(n,t);break;default:t[s]=l;break}}catch(l){let d="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Xn(e));throw l instanceof Error&&l.message.length>0&&(d+=": ".concat(l.message)),new Error(d)}break}}function zE(t,e){if(t===O.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return To(t,e,rr.BIGINT,!0).toString()}function To(t,e,n,i){if(e===null)return i?Ps(t,n):wc;switch(t){case O.DOUBLE:case O.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==O.FLOAT&&qy(r),r;case O.INT32:case O.FIXED32:case O.SFIXED32:case O.SINT32:case O.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==O.UINT32||t==O.FIXED32?Su(s):za(s),s;case O.INT64:case O.SFIXED64:case O.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=it.parse(e);return n?o.toString():o;case O.FIXED64:case O.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=it.uParse(e);return n?a.toString():a;case O.BOOL:if(typeof e!="boolean")break;return e;case O.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case O.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return e0.dec(e)}throw new Error}function Hl(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:wc;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return Wa;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Xn(e)))}function VE(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function sm(t,e,n){if(t.kind=="map"){ht(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of r)i[o.toString()]=$a(t.V.T,a);break;case"message":for(const[o,a]of r)i[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of r)i[o.toString()]=Kl(s,a,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){ht(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push($a(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(Kl(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return $a(t.T,e);case"enum":return Kl(t.T,e,n.enumAsInteger);case"message":return r0(t.T,e).toJson(n)}}function Kl(t,e,n){var i;if(ht(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function $a(t,e){switch(t){case O.INT32:case O.SFIXED32:case O.SINT32:case O.FIXED32:case O.UINT32:return ht(typeof e=="number"),e;case O.FLOAT:case O.DOUBLE:return ht(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case O.STRING:return ht(typeof e=="string"),e;case O.BOOL:return ht(typeof e=="boolean"),e;case O.UINT64:case O.FIXED64:case O.INT64:case O.SFIXED64:case O.SINT64:return ht(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case O.BYTES:return ht(e instanceof Uint8Array),e0.enc(e)}}const Fr=Symbol("@bufbuild/protobuf/unknown-fields"),om={readUnknownFields:!0,readerFactory:t=>new DE(t)},am={writeUnknownFields:!0,writerFactory:()=>new AE};function WE(t){return t?Object.assign(Object.assign({},om),t):om}function $E(t){return t?Object.assign(Object.assign({},am),t):am}function qE(){return{makeReadOptions:WE,makeWriteOptions:$E,listUnknownFields(t){var e;return(e=t[Fr])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[Fr]},writeUnknownFields(t,e){const i=t[Fr];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[Fr])||(r[Fr]=[]),r[Fr].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const s=t.getType(),o=r?e.len:e.pos+n;let a,c;for(;e.pos<o&&([a,c]=e.tag(),!(r===!0&&c==yt.EndGroup));){const l=s.fields.find(a);if(!l){const d=e.skip(c,a);i.readUnknownFields&&this.onUnknownField(t,a,c,d);continue}cm(t,e,l,c,i)}if(r&&(c!=yt.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:cm,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!i0(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const s=r.oneof?t[r.oneof.localName].value:t[r.localName];lm(r,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&lm(t,e,n,i)}}}function cm(t,e,n,i,r){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?O.INT32:n.T;let c=xc;if(n.kind=="scalar"&&n.L>0&&(c=KE),s){let f=t[o];if(i==yt.LengthDelimited&&a!=O.STRING&&a!=O.BYTES){let y=e.uint32()+e.pos;for(;e.pos<y;)f.push(c(e,a))}else f.push(c(e,a))}else t[o]=c(e,a);break;case"message":const l=n.T;s?t[o].push(qa(e,new l,r,n)):gi(t[o])?qa(e,t[o],r,n):(t[o]=qa(e,new l,r,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=l.fieldWrapper.unwrapField(t[o])));break;case"map":let[d,h]=HE(n,e,r);t[o][d]=h;break}}function qa(t,e,n,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,t,s?i.no:t.uint32(),n,s),e}function HE(t,e,n){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[a]=e.tag();switch(a){case 1:s=xc(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=xc(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=qa(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=Ps(t.K,rr.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=Ps(t.V.T,rr.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function KE(t,e){const n=xc(t,e);return typeof n=="bigint"?n.toString():n}function xc(t,e){switch(e){case O.STRING:return t.string();case O.BOOL:return t.bool();case O.DOUBLE:return t.double();case O.FLOAT:return t.float();case O.INT32:return t.int32();case O.INT64:return t.int64();case O.UINT64:return t.uint64();case O.FIXED64:return t.fixed64();case O.BYTES:return t.bytes();case O.FIXED32:return t.fixed32();case O.SFIXED32:return t.sfixed32();case O.SFIXED64:return t.sfixed64();case O.SINT64:return t.sint64();case O.UINT32:return t.uint32();case O.SINT32:return t.sint32()}}function lm(t,e,n,i){ht(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?O.INT32:t.T;if(r)if(ht(Array.isArray(e)),t.packed)JE(n,s,t.no,e);else for(const o of e)Eo(n,s,t.no,o);else Eo(n,s,t.no,e);break;case"message":if(r){ht(Array.isArray(e));for(const o of e)dm(n,i,t,o)}else dm(n,i,t,e);break;case"map":ht(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))GE(n,i,t,o,a);break}}function GE(t,e,n,i,r){t.tag(n.no,yt.LengthDelimited),t.fork();let s=i;switch(n.K){case O.INT32:case O.FIXED32:case O.UINT32:case O.SFIXED32:case O.SINT32:s=Number.parseInt(i);break;case O.BOOL:ht(i=="true"||i=="false"),s=i=="true";break}switch(Eo(t,n.K,1,s),n.V.kind){case"scalar":Eo(t,n.V.T,2,r);break;case"enum":Eo(t,O.INT32,2,r);break;case"message":ht(r!==void 0),t.tag(2,yt.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function dm(t,e,n,i){const r=r0(n.T,i);n.delimited?t.tag(n.no,yt.StartGroup).raw(r.toBinary(e)).tag(n.no,yt.EndGroup):t.tag(n.no,yt.LengthDelimited).bytes(r.toBinary(e))}function Eo(t,e,n,i){ht(i!==void 0);let[r,s]=s0(e);t.tag(n,r)[s](i)}function JE(t,e,n,i){if(!i.length)return;t.tag(n,yt.LengthDelimited).fork();let[,r]=s0(e);for(let s=0;s<i.length;s++)t[r](i[s]);t.join()}function s0(t){let e=yt.Varint;switch(t){case O.BYTES:case O.STRING:e=yt.LengthDelimited;break;case O.DOUBLE:case O.FIXED64:case O.SFIXED64:e=yt.Bit64;break;case O.FIXED32:case O.SFIXED32:case O.FLOAT:e=yt.Bit32;break}const n=O[t].toLowerCase();return[e,n]}function YE(){return{setEnumType:Ky,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,s=e,o=t;if(o[r]!=null)switch(i.kind){case"oneof":const a=o[r].case;if(a===void 0)continue;const c=i.findField(a);let l=o[r].value;c&&c.kind=="message"&&!gi(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===O.BYTES&&(l=Xs(l)),s[r]={case:a,value:l};break;case"scalar":case"enum":let d=o[r];i.T===O.BYTES&&(d=i.repeated?d.map(Xs):Xs(d)),s[r]=d;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===O.BYTES)for(const[p,y]of Object.entries(o[r]))s[r][p]=Xs(y);else Object.assign(s[r],o[r]);break;case"message":const f=i.V.T;for(const p of Object.keys(o[r])){let y=o[r][p];f.fieldWrapper||(y=new f(y)),s[r][p]=y}break}break;case"message":const h=i.T;if(i.repeated)s[r]=o[r].map(f=>gi(f,h)?f:new h(f));else{const f=o[r];h.fieldWrapper?h.typeName==="google.protobuf.BytesValue"?s[r]=Xs(f):s[r]=f:s[r]=gi(f,h)?f:new h(f)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],s=n[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,a)=>i.T.equals(o,s[a]));case"scalar":return r.every((o,a)=>_i(i.T,o,s[a]));case"enum":return r.every((o,a)=>_i(O.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let o=r,a=s;return i.T.fieldWrapper&&(o!==void 0&&!gi(o)&&(o=i.T.fieldWrapper.wrapField(o)),a!==void 0&&!gi(a)&&(a=i.T.fieldWrapper.wrapField(a))),i.T.equals(o,a);case"enum":return _i(O.INT32,r,s);case"scalar":return _i(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const c=i.findField(r.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(r.value,s.value);case"enum":return _i(O.INT32,r.value,s.value);case"scalar":return _i(c.T,r.value,s.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const l=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const d=i.V.T;return l.every(f=>d.equals(r[f],s[f]));case"enum":return l.every(f=>_i(O.INT32,r[f],s[f]));case"scalar":const h=i.V.T;return l.every(f=>_i(h,r[f],s[f]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const s=t[r.localName];let o;if(r.repeated)o=s.map(Ea);else if(r.kind=="map"){o=i[r.localName];for(const[a,c]of Object.entries(s))o[a]=Ea(c)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:Ea(s.value)}:{case:void 0}:o=Ea(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function Ea(t){if(t===void 0)return t;if(gi(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function Xs(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function QE(t,e,n){return{syntax:t,json:BE(),bin:qE(),util:Object.assign(Object.assign({},YE()),{newFieldList:e,initFields:n}),makeMessageType(i,r,s){return wE(this,i,r,s)},makeEnum:EE,makeEnumType:Gy,getEnumType:TE,makeExtension(i,r,s){return NE(this,i,r,s)}}}class XE{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function o0(t,e){const n=a0(t);return e?n:rw(iw(n))}function ZE(t){return o0(t,!1)}const ew=a0;function a0(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const tw=new Set(["constructor","toString","toJSON","valueOf"]),nw=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),c0=t=>"".concat(t,"$"),iw=t=>nw.has(t)?c0(t):t,rw=t=>tw.has(t)?c0(t):t;class sw{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=ZE(e)}addField(e){ht(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function ow(t,e){var n,i,r,s,o,a;const c=[];let l;for(const d of typeof t=="function"?t():t){const h=d;if(h.localName=o0(d.name,d.oneof!==void 0),h.jsonName=(n=d.jsonName)!==null&&n!==void 0?n:ew(d.name),h.repeated=(i=d.repeated)!==null&&i!==void 0?i:!1,d.kind=="scalar"&&(h.L=(r=d.L)!==null&&r!==void 0?r:rr.BIGINT),h.delimited=(s=d.delimited)!==null&&s!==void 0?s:!1,h.req=(o=d.req)!==null&&o!==void 0?o:!1,h.opt=(a=d.opt)!==null&&a!==void 0?a:!1,d.packed===void 0&&(h.packed=d.kind=="enum"||d.kind=="scalar"&&d.T!=O.BYTES&&d.T!=O.STRING),d.oneof!==void 0){const f=typeof d.oneof=="string"?d.oneof:d.oneof.name;(!l||l.name!=f)&&(l=new sw(f)),h.oneof=l,l.addField(h)}c.push(h)}return c}const R=QE("proto3",t=>new XE(t,e=>ow(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Ps(e.T,e.L);break}}});class tn extends qh{constructor(e){super(),this.seconds=it.zero,this.nanos=0,R.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(R.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=it.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return tn.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new tn({seconds:it.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new tn().fromBinary(e,n)}static fromJson(e,n){return new tn().fromJson(e,n)}static fromJsonString(e,n){return new tn().fromJsonString(e,n)}static equals(e,n){return R.util.equals(tn,e,n)}}tn.runtime=R;tn.typeName="google.protobuf.Timestamp";tn.fields=R.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const aw=R.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:tn},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:cw,repeated:!0},{no:5,name:"events",kind:"message",T:dw,repeated:!0}]),cw=R.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:lw,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),lw=R.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:tn},{no:3,name:"value",kind:"scalar",T:2}]),dw=R.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:tn},{no:7,name:"normalized_end_timestamp",kind:"message",T:tn,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),l0=R.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Fn=R.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),St=R.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Kh=R.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),ho=R.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Ko=R.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Vn=R.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),mr=R.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),uw=R.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),_t=R.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),nl=R.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Rc,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:C0}]),Rc=R.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),hw=R.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:R.getEnumType(St),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Ir=R.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:R.getEnumType(ls)},{no:4,name:"tracks",kind:"message",T:Zr,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:hw},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:R.getEnumType(Go)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:R.getEnumType(Vn)},{no:18,name:"kind_details",kind:"enum",T:R.getEnumType(fw),repeated:!0}]),ls=R.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Go=R.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),fw=R.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),wt=R.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),pw=R.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Xi,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:R.getEnumType(d0)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),Zr=R.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:R.getEnumType(Fn)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:R.getEnumType(St)},{no:10,name:"layers",kind:"message",T:Xi,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:pw,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:R.getEnumType(wt)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:C0},{no:19,name:"audio_features",kind:"enum",T:R.getEnumType(_t),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:R.getEnumType(l0)}]),Xi=R.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:R.getEnumType(Kh)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),d0=R.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),qt=R.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:R.getEnumType(Ae)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Gh,oneof:"value"},{no:3,name:"speaker",kind:"message",T:mw,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:p0,oneof:"value"},{no:7,name:"transcription",kind:"message",T:gw,oneof:"value"},{no:8,name:"metrics",kind:"message",T:aw,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Ic,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Jh,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Yh,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Qh,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Pc,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:_c,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Ac,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:u0,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),Ae=R.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),u0=R.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:R.getEnumType(wt)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),h0=R.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Gh,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:Ic,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:Jh,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:Yh,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:Qh,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:Pc,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:_c,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:Ac,oneof:"value"}]),mw=R.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:f0,repeated:!0}]),f0=R.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Gh=R.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),p0=R.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),gw=R.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:vw,repeated:!0}]),vw=R.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Ic=R.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),Jh=R.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Yh=R.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Qh=R.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:m0,oneof:"value"}]),m0=R.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),g0=R.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),v0=R.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:R.getEnumType(y0)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),y0=R.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),k0=R.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:R.getEnumType(S0)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),S0=R.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),b0=R.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:um},{no:2,name:"screen",kind:"message",T:um},{no:3,name:"resume_connection",kind:"enum",T:R.getEnumType(Ko)},{no:4,name:"disabled_codecs",kind:"message",T:yw},{no:5,name:"force_relay",kind:"enum",T:R.getEnumType(Ko)}]),um=R.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:R.getEnumType(Ko)}]),yw=R.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Rc,repeated:!0},{no:2,name:"publish",kind:"message",T:Rc,repeated:!0}]),C0=R.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),bu=R.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),T0=R.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:R.getEnumType(bu)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),E0=R.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Pc=R.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:R.getEnumType(wt)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:T0,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:E0,oneof:"content_header"}],{localName:"DataStream_Header"}),_c=R.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Ac=R.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),kw=R.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),Un=R.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Cu=R.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),Sw=R.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),bw=R.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:sr,oneof:"message"},{no:2,name:"answer",kind:"message",T:sr,oneof:"message"},{no:3,name:"trickle",kind:"message",T:il,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Jo,oneof:"message"},{no:5,name:"mute",kind:"message",T:rl,oneof:"message"},{no:6,name:"subscription",kind:"message",T:sl,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:w0,oneof:"message"},{no:8,name:"leave",kind:"message",T:ol,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:R0,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:_0,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:nf,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Yn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:ef,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:N0,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Zh,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:x0,oneof:"message"}]),hm=R.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:Cw,oneof:"message"},{no:2,name:"answer",kind:"message",T:sr,oneof:"message"},{no:3,name:"offer",kind:"message",T:sr,oneof:"message"},{no:4,name:"trickle",kind:"message",T:il,oneof:"message"},{no:5,name:"update",kind:"message",T:ww,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Xh,oneof:"message"},{no:8,name:"leave",kind:"message",T:ol,oneof:"message"},{no:9,name:"mute",kind:"message",T:rl,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:xw,oneof:"message"},{no:11,name:"room_update",kind:"message",T:Rw,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:Pw,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:Aw,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:Nw,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:Lw,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:Ew,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:Tw,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:jw,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:Bw,oneof:"message"},{no:22,name:"request_response",kind:"message",T:zw,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:Vw,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:Mw,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:Hw,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:Ow,oneof:"message"}]),Tu=R.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Xi,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:R.getEnumType(d0)}]),Jo=R.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:R.getEnumType(Fn)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:R.getEnumType(St)},{no:9,name:"layers",kind:"message",T:Xi,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Tu,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:R.getEnumType(wt)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:R.getEnumType(l0)},{no:17,name:"audio_features",kind:"enum",T:R.getEnumType(_t),repeated:!0}]),il=R.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:R.getEnumType(Un)},{no:3,name:"final",kind:"scalar",T:8}]),rl=R.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),Cw=R.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:nl},{no:2,name:"participant",kind:"message",T:Ir},{no:3,name:"other_participants",kind:"message",T:Ir,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:I0,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:b0},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:v0},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Rc,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),Tw=R.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:I0,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:b0},{no:3,name:"server_info",kind:"message",T:v0},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),Xh=R.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Zr}]),Ew=R.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),sr=R.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),ww=R.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Ir,repeated:!0}]),sl=R.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:g0,repeated:!0}]),w0=R.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:R.getEnumType(Kh)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Zh=R.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:R.getEnumType(_t),repeated:!0}]),x0=R.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),ol=R.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:R.getEnumType(Vn)},{no:3,name:"action",kind:"enum",T:R.getEnumType(ds)},{no:4,name:"regions",kind:"message",T:Fw}]),ds=R.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),R0=R.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Xi,repeated:!0}]),ef=R.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),I0=R.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),xw=R.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:f0,repeated:!0}]),Rw=R.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:nl}]),Iw=R.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:R.getEnumType(ho)},{no:3,name:"score",kind:"scalar",T:2}]),Pw=R.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:Iw,repeated:!0}]),_w=R.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:R.getEnumType(Cu)}]),Aw=R.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:_w,repeated:!0}]),tf=R.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:R.getEnumType(Kh)},{no:2,name:"enabled",kind:"scalar",T:8}]),Dw=R.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:tf,repeated:!0}]),Nw=R.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:tf,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:Dw,repeated:!0}]),Ow=R.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:kw,repeated:!0}]),P0=R.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),_0=R.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:P0,repeated:!0}]),Lw=R.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),Mw=R.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:nl},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Ir},{no:4,name:"other_participants",kind:"message",T:Ir,repeated:!0}]),nf=R.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:sr},{no:2,name:"subscription",kind:"message",T:sl},{no:3,name:"publish_tracks",kind:"message",T:Xh,repeated:!0},{no:4,name:"data_channels",kind:"message",T:D0,repeated:!0},{no:5,name:"offer",kind:"message",T:sr},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:A0,repeated:!0}]),A0=R.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),D0=R.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:R.getEnumType(Un)}]),Yn=R.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:R.getEnumType(Sw),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),N0=R.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),jw=R.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),Fw=R.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:Uw,repeated:!0}]),Uw=R.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),Bw=R.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:R.getEnumType(uw)}]),zw=R.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:R.getEnumType(rf)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:il,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Jo,oneof:"request"},{no:6,name:"mute",kind:"message",T:rl,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:ef,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:Zh,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:x0,oneof:"request"}]),rf=R.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),Vw=R.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),O0=R.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),Ww=R.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:k0},{no:2,name:"connection_settings",kind:"message",T:O0},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:Jo,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:sr},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:R.getEnumType(mr)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:nf}]),$w=R.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:R.getEnumType(qw)},{no:2,name:"join_request",kind:"scalar",T:12}]),qw=R.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),Hw=R.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function Kw(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ha={exports:{}},Gw=Ha.exports,fm;function Jw(){return fm||(fm=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(Gw,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(v,T){var g=v[T];if(typeof g.bind=="function")return g.bind(v);try{return Function.prototype.bind.call(g,v)}catch{return function(){return Function.prototype.apply.apply(g,[v,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&i?c:console[v]!==void 0?a(console,v):console.log!==void 0?a(console,"log"):e}function d(){for(var v=this.getLevel(),T=0;T<r.length;T++){var g=r[T];this[g]=T<v?e:this.methodFactory(g,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function h(v){return function(){typeof console!==n&&(d.call(this),this[v].apply(this,arguments))}}function f(v,T,g){return l(v)||h.apply(this,arguments)}function p(v,T){var g=this,m,S,k,E="loglevel";typeof v=="string"?E+=":"+v:typeof v=="symbol"&&(E=void 0);function x(X){var ce=(r[X]||"silent").toUpperCase();if(!(typeof window===n||!E)){try{window.localStorage[E]=ce;return}catch{}try{window.document.cookie=encodeURIComponent(E)+"="+ce+";"}catch{}}}function I(){var X;if(!(typeof window===n||!E)){try{X=window.localStorage[E]}catch{}if(typeof X===n)try{var ce=window.document.cookie,Pe=encodeURIComponent(E),Qe=ce.indexOf(Pe+"=");Qe!==-1&&(X=/^([^;]+)/.exec(ce.slice(Qe+Pe.length+1))[1])}catch{}return g.levels[X]===void 0&&(X=void 0),X}}function _(){if(!(typeof window===n||!E)){try{window.localStorage.removeItem(E)}catch{}try{window.document.cookie=encodeURIComponent(E)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function F(X){var ce=X;if(typeof ce=="string"&&g.levels[ce.toUpperCase()]!==void 0&&(ce=g.levels[ce.toUpperCase()]),typeof ce=="number"&&ce>=0&&ce<=g.levels.SILENT)return ce;throw new TypeError("log.setLevel() called with invalid level: "+X)}g.name=v,g.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},g.methodFactory=T||f,g.getLevel=function(){return k??S??m},g.setLevel=function(X,ce){return k=F(X),ce!==!1&&x(k),d.call(g)},g.setDefaultLevel=function(X){S=F(X),I()||g.setLevel(X,!1)},g.resetLevel=function(){k=null,_(),d.call(g)},g.enableAll=function(X){g.setLevel(g.levels.TRACE,X)},g.disableAll=function(X){g.setLevel(g.levels.SILENT,X)},g.rebuild=function(){if(o!==g&&(m=F(o.getLevel())),d.call(g),o===g)for(var X in s)s[X].rebuild()},m=F(o?o.getLevel():"WARN");var D=I();D!=null&&(k=F(D)),d.call(g)}o=new p,o.getLogger=function(T){if(typeof T!="symbol"&&typeof T!="string"||T==="")throw new TypeError("You must supply a name when creating a logger.");var g=s[T];return g||(g=s[T]=new p(T,o.methodFactory)),g};var y=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=y),o},o.getLoggers=function(){return s},o.default=o,o})}(Ha)),Ha.exports}var al=Jw(),Eu;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(Eu||(Eu={}));var Hn;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(Hn||(Hn={}));let Ie=al.getLogger("livekit");Object.values(Hn).map(t=>al.getLogger(t));Ie.setDefaultLevel(Eu.info);function xi(t){const e=al.getLogger(t);return e.setDefaultLevel(Ie.getLevel()),e}const Yw=al.getLogger("lk-e2ee"),Zs=7e3,Qw=[0,300,2*2*300,3*3*300,4*4*300,Zs,Zs,Zs,Zs,Zs];class Xw{constructor(e){this._retryDelays=e!==void 0?[...e]:Qw}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function Zw(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function b(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{l(i.next(d))}catch(h){o(h)}}function c(d){try{l(i.throw(d))}catch(h){o(h)}}function l(d){d.done?s(d.value):r(d.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function pm(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function vi(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof pm=="function"?pm(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}var wa={exports:{}},mm;function ex(){if(mm)return wa.exports;mm=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(E,x,I){return Function.prototype.apply.call(E,x,I)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(E){return Object.getOwnPropertyNames(E).concat(Object.getOwnPropertySymbols(E))}:n=function(E){return Object.getOwnPropertyNames(E)};function i(k){console&&console.warn&&console.warn(k)}var r=Number.isNaN||function(E){return E!==E};function s(){s.init.call(this)}wa.exports=s,wa.exports.once=g,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(k){if(typeof k!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof k)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(k){if(typeof k!="number"||k<0||r(k))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+k+".");o=k}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(E){if(typeof E!="number"||E<0||r(E))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+E+".");return this._maxListeners=E,this};function c(k){return k._maxListeners===void 0?s.defaultMaxListeners:k._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(E){for(var x=[],I=1;I<arguments.length;I++)x.push(arguments[I]);var _=E==="error",F=this._events;if(F!==void 0)_=_&&F.error===void 0;else if(!_)return!1;if(_){var D;if(x.length>0&&(D=x[0]),D instanceof Error)throw D;var X=new Error("Unhandled error."+(D?" ("+D.message+")":""));throw X.context=D,X}var ce=F[E];if(ce===void 0)return!1;if(typeof ce=="function")e(ce,this,x);else for(var Pe=ce.length,Qe=y(ce,Pe),I=0;I<Pe;++I)e(Qe[I],this,x);return!0};function l(k,E,x,I){var _,F,D;if(a(x),F=k._events,F===void 0?(F=k._events=Object.create(null),k._eventsCount=0):(F.newListener!==void 0&&(k.emit("newListener",E,x.listener?x.listener:x),F=k._events),D=F[E]),D===void 0)D=F[E]=x,++k._eventsCount;else if(typeof D=="function"?D=F[E]=I?[x,D]:[D,x]:I?D.unshift(x):D.push(x),_=c(k),_>0&&D.length>_&&!D.warned){D.warned=!0;var X=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(E)+" listeners added. Use emitter.setMaxListeners() to increase limit");X.name="MaxListenersExceededWarning",X.emitter=k,X.type=E,X.count=D.length,i(X)}return k}s.prototype.addListener=function(E,x){return l(this,E,x,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(E,x){return l(this,E,x,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(k,E,x){var I={fired:!1,wrapFn:void 0,target:k,type:E,listener:x},_=d.bind(I);return _.listener=x,I.wrapFn=_,_}s.prototype.once=function(E,x){return a(x),this.on(E,h(this,E,x)),this},s.prototype.prependOnceListener=function(E,x){return a(x),this.prependListener(E,h(this,E,x)),this},s.prototype.removeListener=function(E,x){var I,_,F,D,X;if(a(x),_=this._events,_===void 0)return this;if(I=_[E],I===void 0)return this;if(I===x||I.listener===x)--this._eventsCount===0?this._events=Object.create(null):(delete _[E],_.removeListener&&this.emit("removeListener",E,I.listener||x));else if(typeof I!="function"){for(F=-1,D=I.length-1;D>=0;D--)if(I[D]===x||I[D].listener===x){X=I[D].listener,F=D;break}if(F<0)return this;F===0?I.shift():v(I,F),I.length===1&&(_[E]=I[0]),_.removeListener!==void 0&&this.emit("removeListener",E,X||x)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(E){var x,I,_;if(I=this._events,I===void 0)return this;if(I.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):I[E]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete I[E]),this;if(arguments.length===0){var F=Object.keys(I),D;for(_=0;_<F.length;++_)D=F[_],D!=="removeListener"&&this.removeAllListeners(D);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(x=I[E],typeof x=="function")this.removeListener(E,x);else if(x!==void 0)for(_=x.length-1;_>=0;_--)this.removeListener(E,x[_]);return this};function f(k,E,x){var I=k._events;if(I===void 0)return[];var _=I[E];return _===void 0?[]:typeof _=="function"?x?[_.listener||_]:[_]:x?T(_):y(_,_.length)}s.prototype.listeners=function(E){return f(this,E,!0)},s.prototype.rawListeners=function(E){return f(this,E,!1)},s.listenerCount=function(k,E){return typeof k.listenerCount=="function"?k.listenerCount(E):p.call(k,E)},s.prototype.listenerCount=p;function p(k){var E=this._events;if(E!==void 0){var x=E[k];if(typeof x=="function")return 1;if(x!==void 0)return x.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function y(k,E){for(var x=new Array(E),I=0;I<E;++I)x[I]=k[I];return x}function v(k,E){for(;E+1<k.length;E++)k[E]=k[E+1];k.pop()}function T(k){for(var E=new Array(k.length),x=0;x<E.length;++x)E[x]=k[x].listener||k[x];return E}function g(k,E){return new Promise(function(x,I){function _(D){k.removeListener(E,F),I(D)}function F(){typeof k.removeListener=="function"&&k.removeListener("error",_),x([].slice.call(arguments))}S(k,E,F,{once:!0}),E!=="error"&&m(k,_,{once:!0})})}function m(k,E,x){typeof k.on=="function"&&S(k,"error",E,x)}function S(k,E,x,I){if(typeof k.on=="function")I.once?k.once(E,x):k.on(E,x);else if(typeof k.addEventListener=="function")k.addEventListener(E,function _(F){I.once&&k.removeEventListener(E,_),x(F)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof k)}return wa.exports}var ai=ex();let L0=!0,M0=!0;function fo(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function Lr(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return r.apply(this,arguments);const c=l=>{const d=n(l);d&&(a.handleEvent?a.handleEvent(d):a(d))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),r.apply(this,[o,c])};const s=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function tx(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(L0=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function nx(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(M0=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function j0(){if(typeof window=="object"){if(L0)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function sf(t,e){M0&&console.warn(t+" is deprecated, please use "+e+" instead.")}function ix(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(fo(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(fo(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(fo(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=fo(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function gm(t){return Object.prototype.toString.call(t)==="[object Object]"}function F0(t){return gm(t)?Object.keys(t).reduce(function(e,n){const i=gm(t[n]),r=i?F0(t[n]):t[n],s=i&&!Object.keys(r).length;return r===void 0||s?e:Object.assign(e,{[n]:r})},{}):t}function wu(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?wu(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{wu(t,t.get(r),n)})}))}function vm(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===i&&a.trackId===o.id&&wu(t,a,r)})}),r}const ym=j0;function U0(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const d=typeof a[l]=="object"?a[l]:{ideal:a[l]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const h=function(f,p){return f?f+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(d.ideal!==void 0){c.optional=c.optional||[];let f={};typeof d.ideal=="number"?(f[h("min",l)]=d.ideal,c.optional.push(f),f={},f[h("max",l)]=d.ideal,c.optional.push(f)):(f[h("",l)]=d.ideal,c.optional.push(f))}d.exact!==void 0&&typeof d.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",l)]=d.exact):["min","max"].forEach(f=>{d[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(f,l)]=d[f])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},r=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(d,h,f){h in d&&!(f in d)&&(d[f]=d[h],delete d[h])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const d=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!d)){delete a.video.facingMode;let h;if(l.exact==="environment"||l.ideal==="environment"?h=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(y=>y.kind==="videoinput");let p=f.find(y=>h.some(v=>y.label.toLowerCase().includes(v)));return!p&&f.length&&h.includes("back")&&(p=f[f.length-1]),p&&(a.video.deviceId=l.exact?{exact:p.deviceId}:{ideal:p.deviceId}),a.video=i(a.video),ym("chrome: "+JSON.stringify(a)),c(a)})}a.video=i(a.video)}return ym("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){r(a,d=>{n.webkitGetUserMedia(d,c,h=>{l&&l(s(h))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,l=>a(l).then(d=>{if(l.audio&&!d.getAudioTracks().length||l.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return d},d=>Promise.reject(s(d))))}}}function B0(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function z0(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):s={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.id):s={track:r};const o=new Event("track");o.track=r,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Lr(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function V0(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let l=r.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function W0(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>vm(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Lr(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>vm(s,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,s,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(s?o=!0:s=a),a.track===i)),o||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function $0(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(h=>h.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function q0(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return $0(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(h=>this._reverseStreams[h.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(h=>{if(this.getSenders().find(p=>p.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const h=new t.MediaStream(d.getTracks());this._streams[d.id]=h,this._reverseStreams[h.id]=d,d=h}i.apply(this,[d])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(v=>v===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const y=this._streams[h.id];if(y)y.addTrack(d),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new t.MediaStream([d]);this._streams[h.id]=v,this._reverseStreams[v.id]=h,this.addStream(v)}return this.getSenders().find(v=>v.track===d)};function s(l,d){let h=d.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const p=l._reverseStreams[f],y=l._streams[p.id];h=h.replace(new RegExp(y.id,"g"),p.id)}),new RTCSessionDescription({type:d.type,sdp:h})}function o(l,d){let h=d.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const p=l._reverseStreams[f],y=l._streams[p.id];h=h.replace(new RegExp(p.id,"g"),y.id)}),new RTCSessionDescription({type:d.type,sdp:h})}["createOffer","createAnswer"].forEach(function(l){const d=t.RTCPeerConnection.prototype[l],h={[l](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[y=>{const v=s(this,y);f[0].apply(null,[v])},y=>{f[1]&&f[1].apply(null,y)},arguments[2]]):d.apply(this,arguments).then(y=>s(this,y))}};t.RTCPeerConnection.prototype[l]=h[l]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(d._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(v=>d.track===v)&&(f=this._streams[p])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function xu(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function H0(t,e){Lr(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var km=Object.freeze({__proto__:null,fixNegotiationNeeded:H0,shimAddTrackRemoveTrack:q0,shimAddTrackRemoveTrackWithNative:$0,shimGetSendersWithDtmf:V0,shimGetUserMedia:U0,shimMediaStream:B0,shimOnTrack:z0,shimPeerConnection:xu,shimSenderReceiverGetStats:W0});function K0(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,o){sf("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function rx(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function G0(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ru(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=o[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return i.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((d,h)=>{c.set(h,Object.assign({},d,{type:n[d.type]||d.type}))})}return c}).then(o,a)}}function J0(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Y0(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Lr(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Q0(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){sf("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function X0(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Z0(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function ek(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function tk(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function nk(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var Sm=Object.freeze({__proto__:null,shimAddTransceiver:Z0,shimCreateAnswer:nk,shimCreateOffer:tk,shimGetDisplayMedia:rx,shimGetParameters:ek,shimGetUserMedia:K0,shimOnTrack:G0,shimPeerConnection:Ru,shimRTCDataChannel:X0,shimReceiverGetStats:Y0,shimRemoveStream:Q0,shimSenderGetStats:J0});function ik(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function rk(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function sk(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,d){const h=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[h]);return d?(f.then(l,d),Promise.resolve()):f},e.createAnswer=function(l,d){const h=arguments.length>=2?arguments[2]:arguments[0],f=i.apply(this,[h]);return d?(f.then(l,d),Promise.resolve()):f};let a=function(c,l,d){const h=r.apply(this,[c]);return d?(h.then(l,d),Promise.resolve()):h};e.setLocalDescription=a,a=function(c,l,d){const h=s.apply(this,[c]);return d?(h.then(l,d),Promise.resolve()):h},e.setRemoteDescription=a,a=function(c,l,d){const h=o.apply(this,[c]);return d?(h.then(l,d),Promise.resolve()):h},e.addIceCandidate=a}function ok(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(ak(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}).bind(e))}function ak(t){return t&&t.video!==void 0?Object.assign({},t,{video:F0(t.video)}):t}function ck(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];a.urls===void 0&&a.url?(sf("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(i.iceServers[o])}i.iceServers=s}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function lk(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function dk(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function uk(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var bm=Object.freeze({__proto__:null,shimAudioContext:uk,shimCallbacksAPI:sk,shimConstraints:ak,shimCreateOfferLegacy:dk,shimGetUserMedia:ok,shimLocalStreamsAPI:ik,shimRTCIceServerUrls:ck,shimRemoteStreamsAPI:rk,shimTrackEventTransceiver:lk}),Gl={exports:{}},Cm;function sx(){return Cm||(Cm=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,s)=>(s>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)r=s[o].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");i.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const d=e.parseRtpMap(l),h=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(d.parameters=h.length?e.parseFmtp(h[0]):{},d.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),i.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(d.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(d=>d.type===c.type&&d.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let s=0;return i.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const d=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(y=>parseInt(y,10)));d.length>0&&d[0].length>1&&d[0][0]===c&&(l=d[0][1]),r.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let p={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&l&&(p.rtx={ssrc:l}),i.push(p),s&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(p))}}),i.length===0&&c&&i.push({ssrc:c});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,i.forEach(f=>{f.maxBitrate=h})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const o=i!==void 0?i:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e}(Gl)),Gl.exports}var hk=sx(),us=Kw(hk),ox=mE({__proto__:null,default:us},[hk]);function Ka(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),s=us.parseCandidate(i.candidate);for(const o in s)o in r||Object.defineProperty(r,o,{value:s[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,Lr(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Iu(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Lr(t,"icecandidate",e=>{if(e.candidate){const n=us.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Ga(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=us.splitSections(a.sdp);return c.shift(),c.some(l=>{const d=us.parseMLine(l);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},i=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},r=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const d=us.matchPrefix(a.sdp,"a=max-message-size:");return d.length>0?l=parseInt(d[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),l=r(c),d=s(arguments[0],c);let h;l===0&&d===0?h=Number.POSITIVE_INFINITY:l===0||d===0?h=Math.max(l,d):h=Math.min(l,d);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return h}}),this._sctp=f}return o.apply(this,arguments)}}function Ja(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},Lr(t,"datachannel",i=>(e(i.channel,i.target),i))}function Pu(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",r);s.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function _u(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return n.apply(this,arguments)}}function Ya(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Qa(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var ax=Object.freeze({__proto__:null,removeExtmapAllowMixed:_u,shimAddIceCandidateNullOrEmpty:Ya,shimConnectionState:Pu,shimMaxMessageSize:Ga,shimParameterlessSetLocalDescription:Qa,shimRTCIceCandidate:Ka,shimRTCIceCandidateRelayProtocol:Iu,shimSendThrowTypeError:Ja});function cx(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=j0,i=ix(t),r={browserDetails:i,commonShim:ax,extractVersion:fo,disableLog:tx,disableWarnings:nx,sdp:ox};switch(i.browser){case"chrome":if(!km||!xu||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=km,Ya(t,i),Qa(t),U0(t,i),B0(t),xu(t,i),z0(t),q0(t,i),V0(t),W0(t),H0(t,i),Ka(t),Iu(t),Pu(t),Ga(t,i),Ja(t),_u(t,i);break;case"firefox":if(!Sm||!Ru||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Sm,Ya(t,i),Qa(t),K0(t,i),Ru(t,i),G0(t),Q0(t),J0(t),Y0(t),X0(t),Z0(t),ek(t),tk(t),nk(t),Ka(t),Pu(t),Ga(t,i),Ja(t);break;case"safari":if(!bm||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=bm,Ya(t,i),Qa(t),ck(t),dk(t),sk(t),ik(t),rk(t),lk(t),ok(t),uk(t),Ka(t),Iu(t),Ga(t,i),Ja(t),_u(t,i);break;default:n("Unsupported browser!");break}return r}cx({window:typeof window>"u"?void 0:window});class rn extends Promise{constructor(e){super(e)}catch(e){return super.catch(e)}static reject(e){return super.reject(e)}static all(e){return super.all(e)}static race(e){return super.race(e)}}const lx=/version\/(\d+(\.?_?\d+)+)/i;let Jl;function ln(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(Jl===void 0||e){const i=dx.find(r=>{let{test:s}=r;return s.test(n)});Jl=i==null?void 0:i.describe(n)}return Jl}const dx=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:Xa(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Yl(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:Xa(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Yl(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:Xa(lx,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:Yl(t)}}}];function Xa(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function Yl(t){return t.includes("mac os")?Xa(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var ux="2.17.0";const hx=ux,fx=16;class ci extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var Ge;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout",t[t.WebSocket=6]="WebSocket",t[t.ServiceNotFound=7]="ServiceNotFound"})(Ge||(Ge={}));class fe extends ci{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=Ge[n]}static notAllowed(e,n,i){return new fe(e,Ge.NotAllowed,n,i)}static timeout(e){return new fe(e,Ge.Timeout)}static leaveRequest(e,n){return new fe(e,Ge.LeaveRequest,void 0,n)}static internal(e,n){return new fe(e,Ge.InternalError,void 0,n)}static cancelled(e){return new fe(e,Ge.Cancelled)}static serverUnreachable(e,n){return new fe(e,Ge.ServerUnreachable,n)}static websocket(e,n,i){return new fe(e,Ge.WebSocket,n,i)}static serviceNotFound(e,n){return new fe(e,Ge.ServiceNotFound,void 0,n)}}class of extends ci{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class yi extends ci{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class px extends ci{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class gt extends ci{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class hs extends ci{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class Tm extends ci{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class Em extends ci{constructor(e,n){super(15,e),this.name="SignalRequestError",this.reason=n,this.reasonName=typeof n=="string"?n:rf[n]}}var $t;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})($t||($t={}));class Cn extends ci{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=$t[n]}}class Ur extends ci{constructor(e){super(18,e),this.name="SignalReconnectError"}}var Dc;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(Dc||(Dc={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(Dc||(Dc={}));class Ot{}Ot.setTimeout=function(){return setTimeout(...arguments)};Ot.setInterval=function(){return setInterval(...arguments)};Ot.clearTimeout=function(){return clearTimeout(...arguments)};Ot.clearInterval=function(){return clearInterval(...arguments)};var U;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(U||(U={}));var Q;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(Q||(Q={}));var K;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(K||(K={}));var B;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(B||(B={}));function mx(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}class He{constructor(e,n,i,r,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const gx=["vp8","h264"],vx=["vp8","h264","vp9","av1","h265"];function yx(t){return!!gx.find(e=>e===t)}const kx=yx;var wm;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(wm||(wm={}));var Au;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(Au||(Au={}));const Yo={h90:new He(160,90,9e4,20),h180:new He(320,180,16e4,20),h216:new He(384,216,18e4,20),h360:new He(640,360,45e4,20),h540:new He(960,540,8e5,25),h720:new He(1280,720,17e5,30),h1080:new He(1920,1080,3e6,30),h1440:new He(2560,1440,5e6,30),h2160:new He(3840,2160,8e6,30)},Du={h120:new He(160,120,7e4,20),h180:new He(240,180,125e3,20),h240:new He(320,240,14e4,20),h360:new He(480,360,33e4,20),h480:new He(640,480,5e5,20),h540:new He(720,540,6e5,25),h720:new He(960,720,13e5,30),h1080:new He(1440,1080,23e5,30),h1440:new He(1920,1440,38e5,30)},af={h360fps3:new He(640,360,2e5,3,"medium"),h360fps15:new He(640,360,4e5,15,"medium"),h720fps5:new He(1280,720,8e5,5,"medium"),h720fps15:new He(1280,720,15e5,15,"medium"),h720fps30:new He(1280,720,2e6,30,"medium"),h1080fps15:new He(1920,1080,25e5,15,"medium"),h1080fps30:new He(1920,1080,5e6,30,"medium"),original:new He(0,0,7e6,30,"medium")};function fk(t,e,n){var i,r,s,o;const{optionsWithoutProcessor:a,audioProcessor:c,videoProcessor:l}=gk(t??{}),d=e==null?void 0:e.processor,h=n==null?void 0:n.processor,f=a??{};return f.audio===!0&&(f.audio={}),f.video===!0&&(f.video={}),f.audio&&(Nu(f.audio,e),(i=(s=f.audio).deviceId)!==null&&i!==void 0||(s.deviceId={ideal:"default"}),(c||d)&&(f.audio.processor=c??d)),f.video&&(Nu(f.video,n),(r=(o=f.video).deviceId)!==null&&r!==void 0||(o.deviceId={ideal:"default"}),(l||h)&&(f.video.processor=l??h)),f}function Nu(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function cf(t){var e,n,i,r;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,c=t.video;Object.keys(c).forEach(l=>{switch(l){case"resolution":Nu(a,c.resolution);break;default:a[l]=c[l]}}),s.video=o,(e=(i=s.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(r=s.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function pk(t){return b(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=mk();if(i){const r=i.createAnalyser();r.fftSize=2048;const s=r.frequencyBinCount,o=new Uint8Array(s);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield Lt(n),r.getByteTimeDomainData(o);const c=o.some(l=>l!==128&&l!==0);return i.close(),!c}return!1}()})}function mk(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>b(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}finally{(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var r;n.state==="closed"&&((r=window.document.body)===null||r===void 0||r.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function Sx(t){return t==="audioinput"?N.Source.Microphone:t==="videoinput"?N.Source.Camera:N.Source.Unknown}function Ou(t){return t===N.Source.Microphone?"audioinput":t===N.Source.Camera?"videoinput":void 0}function bx(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,_r()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function wo(t){return t.split("/")[1].toLowerCase()}function Cx(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new Xh({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function De(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?De(t.track):{})}}function Tx(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function Ex(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const s of i)t[s]!==e[s]&&(r[s]=(n=e[s])!==null&&n!==void 0?n:"");return r}function gk(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:mx(e)}}function wx(t){switch(t){case St.CAMERA:return N.Source.Camera;case St.MICROPHONE:return N.Source.Microphone;case St.SCREEN_SHARE:return N.Source.ScreenShare;case St.SCREEN_SHARE_AUDIO:return N.Source.ScreenShareAudio;default:return N.Source.Unknown}}function xm(t,e){return t.width*t.height<e.width*e.height}function xx(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}const Rx=5e3,eo=[];var pn;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(pn||(pn={}));class N extends ai.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=N.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Ie,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),Rx):this.handleAppVisibilityChanged()},this.log=xi((r=i.loggerName)!==null&&r!==void 0?r:Hn.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=N.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),De(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===N.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===N.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(eo.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&eo.splice(eo.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),es(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(r?B.AudioPlaybackStarted:B.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(r?B.AudioPlaybackFailed:B.VideoPlaybackFailed,s):s.name==="AbortError"?Ie.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):Ie.warn("could not playback ".concat(r?"audio":"video"),s),r&&e&&i.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(B.ElementAttached,e),e}detach(e){try{if(e){fs(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(B.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{fs(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(B.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=xi(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),eo.forEach(i=>{i.parentElement||(n=!1)}),n&&eo.push(e)}}handleAppVisibilityChanged(){return b(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===N.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){sn()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){sn()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function es(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!_r()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(_r()||Pr())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function fs(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(l){switch(l){case e.Audio:return Fn.AUDIO;case e.Video:return Fn.VIDEO;default:return Fn.DATA}}t.kindToProto=r;function s(l){switch(l){case Fn.AUDIO:return e.Audio;case Fn.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(l){switch(l){case n.Camera:return St.CAMERA;case n.Microphone:return St.MICROPHONE;case n.ScreenShare:return St.SCREEN_SHARE;case n.ScreenShareAudio:return St.SCREEN_SHARE_AUDIO;default:return St.UNKNOWN}}t.sourceToProto=o;function a(l){switch(l){case St.CAMERA:return n.Camera;case St.MICROPHONE:return n.Microphone;case St.SCREEN_SHARE:return n.ScreenShare;case St.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function c(l){switch(l){case Cu.ACTIVE:return i.Active;case Cu.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=c})(N||(N={}));const Ix="|",Rm="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function Px(t){const e=t.split(Ix);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function Lt(t){return new rn(e=>Ot.setTimeout(e,t))}function Lu(){return"addTransceiver"in RTCPeerConnection.prototype}function Mu(){return"addTrack"in RTCPeerConnection.prototype}function _x(){if(!("getCapabilities"in RTCRtpSender)||_r()||Pr())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function Ax(){if(!("getCapabilities"in RTCRtpSender)||Pr())return!1;if(_r()){const n=ln();if(n!=null&&n.version&&si(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&si(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function Bn(t){return t==="av1"||t==="vp9"}function ju(t){return!document||Qo()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function Dx(){return typeof RTCPeerConnection>"u"?!1:Lu()||Mu()}function Pr(){var t;return((t=ln())===null||t===void 0?void 0:t.name)==="Firefox"}function Im(){const t=ln();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function _r(){var t;return((t=ln())===null||t===void 0?void 0:t.name)==="Safari"}function Qo(){const t=ln();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function Nx(){const t=ln();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&si(t.osVersion,"17")>=0}function Ox(t){return t||(t=ln()),(t==null?void 0:t.name)==="Safari"&&si(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&si(t.osVersion,"18.3")>0}function vk(){var t,e;return sn()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function Lx(){const t=ln(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&si(t.osVersion,e)>=0?!0:t.name==="Safari"&&si(t.version,e)>=0}function sn(){return typeof document<"u"}function ri(){return navigator.product=="ReactNative"}function _s(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function Ql(t){return _s(t)?t.hostname.split(".")[0]:null}function yk(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function kk(){if(!ri())return;let t=yk();if(t)return t.platform}function Pm(){if(sn())return window.devicePixelRatio;if(ri()){let t=yk();if(t)return t.devicePixelRatio}return 1}function si(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let s=0;s<r;++s){const o=parseInt(n[s],10),a=parseInt(i[s],10);if(o>a)return 1;if(o<a)return-1;if(s===r-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function Mx(t){for(const e of t)e.target.handleResize(e)}function jx(t){for(const e of t)e.target.handleVisibilityChanged(e)}let Xl=null;const _m=()=>(Xl||(Xl=new ResizeObserver(Mx)),Xl);let Zl=null;const Am=()=>(Zl||(Zl=new IntersectionObserver(jx,{root:null,rootMargin:"0px"})),Zl);function Fx(){var t;const e=new k0({sdk:S0.JS,protocol:fx,version:hx});return ri()&&(e.os=(t=kk())!==null&&t!==void 0?t:""),e}function Dm(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const s=r.getContext("2d");s==null||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=r.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let to;function ed(){if(!to){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[to]=i.stream.getAudioTracks(),!to)throw Error("Could not get empty media stream audio track");to.enabled=!1}return to.clone()}class xn{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>b(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function Ux(t){return vx.includes(t)}function Zi(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function Bx(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function Xo(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function zx(t,e){return t.segments.map(n=>{let{id:i,text:r,language:s,startTime:o,endTime:a,final:c}=n;var l;const d=(l=e.get(i))!==null&&l!==void 0?l:Date.now(),h=Date.now();return c?e.delete(i):e.set(i,d),{id:i,text:r,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:c,language:s,firstReceivedTime:d,lastReceivedTime:h}})}function Vx(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function Nm(t){switch(t.reason){case Ge.LeaveRequest:return t.context;case Ge.Cancelled:return Vn.CLIENT_INITIATED;case Ge.NotAllowed:return Vn.USER_REJECTED;case Ge.ServerUnreachable:return Vn.JOIN_FAILURE;default:return Vn.UNKNOWN_REASON}}function Za(t){return t!==void 0?Number(t):void 0}function gr(t){return t!==void 0?BigInt(t):void 0}function ps(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function ii(t){return!!t&&t.kind==N.Kind.Audio}function dr(t){return!!t&&t.kind==N.Kind.Video}function Ai(t){return ps(t)&&dr(t)}function di(t){return ps(t)&&ii(t)}function Fu(t){return!!t&&!t.isLocal}function Wx(t){return!!t&&!t.isLocal}function td(t){return Fu(t)&&dr(t)}function $x(t){return t.isLocal}function qx(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const s=i[r];if(s!==void 0&&(s&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function Hx(t){var e;const n=t.get("Cache-Control");if(n){const i=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function Kx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=Gx(t,e);return n?i:lf(i,"v1")}function Gx(t,e){const n=new URL(Bx(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),lf(n,"rtc")}function Jx(t){const e=new URL(Xo(t));return lf(e,"validate")}function Sk(t){return t.endsWith("/")?t:"".concat(t,"/")}function lf(t,e){return t.pathname="".concat(Sk(t.pathname)).concat(e),t}function Om(t){if(typeof t=="string")return hm.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return hm.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function Yx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const Qx=10,no="lk_e2ee",Xx="LKFrameEncryptionKey",Zx={sharedKey:!1,ratchetSalt:Xx,ratchetWindowSize:8,failureTolerance:Qx,keyringSize:16};var er;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(er||(er={}));var Lm;(function(t){t.KeyRatcheted="keyRatcheted"})(Lm||(Lm={}));var Wi;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(Wi||(Wi={}));var Mm;(function(t){t.Error="cryptorError"})(Mm||(Mm={}));function e1(){return t1()||Uu()}function Uu(){return typeof window.RTCRtpScriptTransform<"u"}function t1(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function n1(t){var e,n,i,r,s;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="transcription"&&((s=t.value)===null||s===void 0?void 0:s.case)!=="encryptedPacket")return new h0({value:t.value})}class QR extends ai.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{Ie.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},Zx),e),this.on(er.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(er.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(er.RatchetRequest,e,n)}}var jm;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(jm||(jm={}));class i1 extends ai.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var r,s;const{kind:o,data:a}=i.data;switch(o){case"error":if(Ie.error(a.error.message),a.uuid){const d=this.decryptDataRequests.get(a.uuid);if(d!=null&&d.reject){d.reject(a.error);break}const h=this.encryptDataRequests.get(a.uuid);if(h!=null&&h.reject){h.reject(a.error);break}}this.emit(Wi.EncryptionError,a.error,a.participantIdentity);break;case"initAck":a.enabled&&this.keyProvider.getKeys().forEach(d=>{this.postKey(d)});break;case"enable":if(a.enabled&&this.keyProvider.getKeys().forEach(d=>{this.postKey(d)}),this.encryptionEnabled!==a.enabled&&a.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(Wi.ParticipantEncryptionStatusChanged,a.enabled,this.room.localParticipant),this.encryptionEnabled=a.enabled;else if(a.participantIdentity){const d=(s=this.room)===null||s===void 0?void 0:s.getParticipantByIdentity(a.participantIdentity);if(!d)throw TypeError("couldn't set encryption status, participant not found".concat(a.participantIdentity));this.emit(Wi.ParticipantEncryptionStatusChanged,a.enabled,d)}break;case"ratchetKey":this.keyProvider.emit(er.KeyRatcheted,a.ratchetResult,a.participantIdentity,a.keyIndex);break;case"decryptDataResponse":const c=this.decryptDataRequests.get(a.uuid);c!=null&&c.resolve&&c.resolve(a);break;case"encryptDataResponse":const l=this.encryptDataRequests.get(a.uuid);l!=null&&l.resolve&&l.resolve(a);break}},this.onWorkerError=i=>{Ie.error("e2ee worker encountered an error:",{error:i.error}),this.emit(Wi.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!e1())throw new of("tried to setup end-to-end encryption on an unsupported browser");if(Ie.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:Yw.getLevel()}};this.worker&&(Ie.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){Ie.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?Ie.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(K.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(U.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==wt.NONE,r.identity)),e.on(U.ConnectionStateChanged,i=>{i===Ve.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==wt.NONE,r.identity)})})}).on(U.TrackUnsubscribed,(i,r,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:i.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(U.TrackSubscribed,(i,r,s)=>{this.setupE2EEReceiver(i,s.identity,r.trackInfo)}).on(U.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(Q.LocalSenderCreated,(i,r)=>b(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),e.localParticipant.on(Q.LocalTrackPublished,i=>{if(!dr(i.track)||!Qo())return;const r={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:wo(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}),n.on(er.SetKey,i=>this.postKey(i)).on(er.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}encryptData(e){return b(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},r=new xn;return r.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,r),this.worker.postMessage(i),r.promise})}handleEncryptedData(e,n,i,r){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const s=crypto.randomUUID(),o={kind:"decryptDataRequest",data:{uuid:s,payload:e,iv:n,participantIdentity:i,keyIndex:r}},a=new xn;return a.onFinally=()=>{this.decryptDataRequests.delete(s)},this.decryptDataRequests.set(s,a),this.worker.postMessage(o),a.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?wo(i.mimeType):void 0)}}setupE2EESender(e,n){if(!ps(e)||!n){n||Ie.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return b(this,void 0,void 0,function*(){if(this.worker){if(Uu()&&!Im()){const s={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(no in e&&r){const c={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(c);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const c=e.createEncodedStreams();e.writableStream=c.writable,s=c.writable,e.readableStream=c.readable,o=c.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:r,participantIdentity:i,isReuse:no in e}};this.worker.postMessage(a,[o,s])}e[no]=!0}})}handleSender(e,n,i){var r;if(!(no in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Uu()&&!Im()){Ie.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{Ie.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[s.readable,s.writable])}e[no]=!0}}}const r1=500,s1=15e3;class ms{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new ms),this._instance}addFailedConnectionAttempt(e){var n;const i=new URL(e),r=Ql(i);if(!r)return;let s=(n=this.failedConnectionAttempts.get(r))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(r,s+1),this.backOffPromises.set(r,Lt(Math.min(r1*Math.pow(2,s),s1)))}getBackOffPromise(e){const n=new URL(e),i=n&&Ql(n);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),i=n&&Ql(n);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}ms._instance=null;const nd="default";class At{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new At),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=At.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){Ie.debug("awaiting getUserMedia promise");try{n?yield At.userMediaPromiseMap.get(n):yield Promise.all(At.userMediaPromiseMap.values())}catch{Ie.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(r&&!(_r()&&i.hasDeviceInUse(n))&&(o.filter(c=>c.kind===n).length===0||o.some(c=>{const l=c.label==="",d=n?c.kind===n:!0;return l&&d}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},l=yield navigator.mediaDevices.getUserMedia(c);o=yield navigator.mediaDevices.enumerateDevices(),l.getTracks().forEach(d=>{d.stop()})}return i._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,i){return b(this,void 0,void 0,function*(){if(n!==nd)return n;const r=yield this.getDevices(e),s=r.find(a=>a.deviceId===nd);if(!s){Ie.warn("could not reliably determine default device");return}const o=r.find(a=>a.deviceId!==nd&&a.groupId===(i??s.groupId));if(!o){Ie.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?At.userMediaPromiseMap.has(e):At.userMediaPromiseMap.size>0}}At.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];At.userMediaPromiseMap=new Map;var xo;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(xo||(xo={}));class o1{constructor(){this.pendingTasks=new Map,this.taskMutex=new Kt,this.nextTaskIndex=0}run(e){return b(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:xo.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=xo.RUNNING,yield e()}finally{n.status=xo.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return b(this,void 0,void 0,function*(){return this.run(()=>b(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class a1{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,r;if(!((i=n.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const s=new WebSocket(e,(r=n.protocols)!==null&&r!==void 0?r:[]);s.binaryType="arraybuffer",this.ws=s;const o=function(){let{closeCode:a,reason:c}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return s.close(a,c)};this.opened=new rn((a,c)=>{const l=()=>{c(fe.websocket("Encountered websocket error during connection establishment"))};s.onopen=()=>{a({readable:new ReadableStream({start(d){s.onmessage=h=>{let{data:f}=h;return d.enqueue(f)},s.onerror=h=>d.error(h)},cancel:o}),writable:new WritableStream({write(d){s.send(d)},abort(){s.close()},close:o}),protocol:s.protocol,extensions:s.extensions}),s.removeEventListener("error",l)},s.addEventListener("error",l)}),this.closed=new rn((a,c)=>{const l=()=>b(this,void 0,void 0,function*(){const d=new rn(f=>{s.readyState!==WebSocket.CLOSED&&s.addEventListener("close",p=>{f(p)},{once:!0})}),h=yield rn.race([Lt(250),d]);h?a(h):c(fe.websocket("Encountered unspecified websocket error without a timely close event"))});s.onclose=d=>{let{code:h,reason:f}=d;a({closeCode:h,reason:f}),s.removeEventListener("error",l)},s.addEventListener("error",l)}),n.signal&&(n.signal.onabort=()=>s.close()),this.close=o}}const c1=["syncState","trickle","offer","answer","simulate","leave"];function l1(t){const e=c1.indexOf(t.case)>=0;return Ie.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var Ke;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(Ke||(Ke={}));const d1=250;class df{get currentState(){return this.state}get isDisconnected(){return this.state===Ke.DISCONNECTING||this.state===Ke.DISCONNECTED}get isEstablishingConnection(){return this.state===Ke.CONNECTING||this.state===Ke.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=Ke.DISCONNECTED,this.log=Ie,this._requestId=0,this.useV0SignalPath=!1,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=xi((i=n.loggerName)!==null&&i!==void 0?i:Hn.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new o1,this.queuedRequests=[],this.closingLock=new Kt,this.connectionLock=new Kt,this.state=Ke.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return b(this,arguments,void 0,function(s,o,a,c){var l=this;let d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return function*(){return l.state=Ke.CONNECTING,l.options=a,yield l.connect(s,o,a,c,d)}()})}reconnect(e,n,i,r){return b(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=Ke.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}),void 0,this.useV0SignalPath)})}connect(e,n,i,r){return b(this,arguments,void 0,function(s,o,a,c){var l=this;let d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return function*(){const h=yield l.connectionLock.lock();l.connectOptions=a,l.useV0SignalPath=d;const f=Fx(),p=d?u1(o,f,a):h1(o,f,a),y=Kx(s,p,d).toString(),v=Jx(y).toString();return new Promise((T,g)=>b(l,void 0,void 0,function*(){var m,S;try{let k=!1;const E=D=>b(this,void 0,void 0,function*(){if(k)return;k=!0;const X=D instanceof Event?D.currentTarget:D,ce=Yx(X,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(ce)).catch(Pe=>{this.log.error(Pe),this.close()}):this.close(),x(),g(fe.cancelled(ce))});c==null||c.addEventListener("abort",E);const x=()=>{clearTimeout(I),c==null||c.removeEventListener("abort",E)},I=setTimeout(()=>{E(fe.timeout("room connection has timed out (signal)"))},a.websocketTimeout),_=(D,X)=>{this.handleSignalConnected(D,I,X)},F=new URL(y);F.searchParams.has("access_token")&&F.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(F),Object.assign({reconnect:a.reconnect,reconnectReason:a.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new a1(y);try{this.ws.closed.then(We=>{var Tt;this.isEstablishingConnection&&g(fe.internal("Websocket got closed during a (re)connection attempt: ".concat(We.reason))),We.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:We.reason,code:We.closeCode,wasClean:We.closeCode===1e3,state:this.state})),this.state===Ke.CONNECTED&&this.handleOnClose((Tt=We.reason)!==null&&Tt!==void 0?Tt:"Unexpected WS error"))}).catch(We=>{this.isEstablishingConnection&&g(fe.internal("Websocket error during a (re)connection attempt: ".concat(We)))});const D=yield this.ws.opened.catch(We=>b(this,void 0,void 0,function*(){if(this.state!==Ke.CONNECTED){this.state=Ke.DISCONNECTED,clearTimeout(I);const Tt=yield this.handleConnectionError(We,v);g(Tt);return}this.handleWSError(We),g(We)}));if(clearTimeout(I),!D)return;const X=D.readable.getReader();this.streamWriter=D.writable.getWriter();const ce=yield X.read();if(X.releaseLock(),!ce.value)throw fe.internal("no message received as first message");const Pe=Om(ce.value),Qe=this.validateFirstMessage(Pe,(m=a.reconnect)!==null&&m!==void 0?m:!1);if(!Qe.isValid){g(Qe.error);return}((S=Pe.message)===null||S===void 0?void 0:S.case)==="join"&&(this.pingTimeoutDuration=Pe.message.value.pingTimeout,this.pingIntervalDuration=Pe.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const Rt=Qe.shouldProcessFirstMessage?Pe:void 0;_(D,Rt),T(Qe.response)}catch(D){g(D)}finally{x()}}finally{h()}}))}()})}startReadingLoop(e,n){return b(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield Lt(this.signalLatency));const{done:i,value:r}=yield e.read();if(i)break;const s=Om(r);this.handleSignalResponse(s)}})}close(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return function*(){if([Ke.DISCONNECTING||Ke.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=Ke.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const s=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([s,Lt(d1)])}}catch(s){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:s}))}finally{n&&(e.state=Ke.DISCONNECTED),r()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:ts(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:ts(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new il({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new rl({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return b(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new ef({requestId:a,metadata:i,name:r,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new R0({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new _0({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:it.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new N0({timestamp:it.parse(Date.now()),rtt:it.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new Zh({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new ol({reason:Vn.CLIENT_INITIATED,action:ds.DISCONNECT})})}sendRequest(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!r&&!l1(n)&&i.state===Ke.RECONNECTING){i.queuedRequests.push(()=>b(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield Lt(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const o=new bw({message:n});try{i.useJSON?yield i.streamWriter.write(o.toJsonString()):yield i.streamWriter.write(o.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(r.case==="answer"){const o=Fm(r.value);this.onAnswer&&this.onAnswer(o,r.value.id,r.value.midToTrackId)}else if(r.case==="offer"){const o=Fm(r.value);this.onOffer&&this.onOffer(o,r.value.id,r.value.midToTrackId)}else if(r.case==="trickle"){const o=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(o,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):r.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(r.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return b(this,void 0,void 0,function*(){if(this.state===Ke.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Ot.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Ot.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Ot.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Ot.clearInterval(this.pingInterval)}handleSignalConnected(e,n,i){this.state=Ke.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,n){var i,r,s,o,a;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===Ke.RECONNECTING&&((r=e.message)===null||r===void 0?void 0:r.case)!=="leave"?((s=e.message)===null||s===void 0?void 0:s.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((o=e.message)===null||o===void 0?void 0:o.case)==="leave"?{isValid:!1,error:fe.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:n?{isValid:!1,error:fe.internal("Unexpected first message")}:{isValid:!1,error:fe.internal("did not receive join response, got ".concat((a=e.message)===null||a===void 0?void 0:a.case," instead"))}}handleConnectionError(e,n){return b(this,void 0,void 0,function*(){try{const i=yield fetch(n);switch(i.status){case 404:return fe.serviceNotFound("v1 RTC path not found. Consider upgrading your LiveKit server version","v0-rtc");case 401:case 403:const r=yield i.text();return fe.notAllowed(r,i.status);default:break}return e instanceof fe?e:fe.internal("Encountered unknown websocket error during connection: ".concat(e),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof fe?i:fe.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function Fm(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function ts(t,e){return new sr({sdp:t.sdp,type:t.type,id:e})}function u1(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",ri()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}function h1(t,e,n){const i=new URLSearchParams;i.set("access_token",t);const r=new Ww({clientInfo:e,connectionSettings:new O0({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(r.reconnectReason=n.reconnectReason);const s=new $w({joinRequest:r.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(s.toBinary()))),i}class Um{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class f1{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,s]of i.entries())n.push(e(s,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var Dn={},id={},rd={exports:{}},Bm;function uf(){if(Bm)return rd.exports;Bm=1;var t=rd.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),rd.exports}var zm;function p1(){return zm||(zm=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,d){if(d&&!l)c[d]=e(a[1]);else for(var h=0;h<l.length;h+=1)a[h+1]!=null&&(c[l[h]]=e(a[h+1]))},i=function(a,c,l){var d=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:d&&!c[a.name]&&(c[a.name]={});var h=a.push?{}:d?c[a.name]:c;n(l.match(a.reg),h,a.names,a.name),a.push&&c[a.push].push(h)},r=uf(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],d=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(h){var f=h[0],p=h.slice(2);f==="m"&&(l.push({rtp:[],fmtp:[]}),d=l[l.length-1]);for(var y=0;y<(r[f]||[]).length;y+=1){var v=r[f][y];if(v.reg.test(p))return i(v,d,p)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),d=0;d<l.length;d+=3)c.push({component:l[d],ip:l[d+1],port:l[d+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var d,h=!1;return l[0]!=="~"?d=e(l):(d=e(l.substring(1,l.length)),h=!0),{scid:d,paused:h}})})}}(id)),id}var sd,Vm;function m1(){if(Vm)return sd;Vm=1;var t=uf(),e=/%[sdv%]/g,n=function(o){var a=1,c=arguments,l=c.length;return o.replace(e,function(d){if(a>=l)return d;var h=c[a];switch(a+=1,d){case"%%":return"%";case"%s":return String(h);case"%d":return Number(h);case"%v":return""}})},i=function(o,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,d=[o+"="+l];if(a.names)for(var h=0;h<a.names.length;h+=1){var f=a.names[h];a.name?d.push(c[a.name][f]):d.push(c[a.names[h]])}else d.push(c[a.name]);return n.apply(null,d)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return sd=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(h){h.payloads==null&&(h.payloads="")});var c=a.outerOrder||r,l=a.innerOrder||s,d=[];return c.forEach(function(h){t[h].forEach(function(f){f.name in o&&o[f.name]!=null?d.push(i(h,f,o)):f.push in o&&o[f.push]!=null&&o[f.push].forEach(function(p){d.push(i(h,f,p))})})}),o.media.forEach(function(h){d.push(i("m",t.m[0],h)),l.forEach(function(f){t[f].forEach(function(p){p.name in h&&h[p.name]!=null?d.push(i(f,p,h)):p.push in h&&h[p.push]!=null&&h[p.push].forEach(function(y){d.push(i(f,p,y))})})})}),d.join(`\r
`)+`\r
`},sd}var Wm;function g1(){if(Wm)return Dn;Wm=1;var t=p1(),e=m1(),n=uf();return Dn.grammar=n,Dn.write=e,Dn.parse=t.parse,Dn.parseParams=t.parseParams,Dn.parseFmtpConfig=t.parseFmtpConfig,Dn.parsePayloads=t.parsePayloads,Dn.parseRemoteCandidates=t.parseRemoteCandidates,Dn.parseImageAttributes=t.parseImageAttributes,Dn.parseSimulcastStreamList=t.parseSimulcastStreamList,Dn}var Oi=g1();function hf(t,e,n){var i,r,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(i=n.isImmediate)!=null&&i,a=(r=n.callback)!=null&&r,c=n.maxWait,l=Date.now(),d=[];function h(){if(c!==void 0){var p=Date.now()-l;if(p+e>=c)return c-p}return e}var f=function(){var p=[].slice.call(arguments),y=this;return new Promise(function(v,T){var g=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,l=Date.now(),!o){var S=t.apply(y,p);a&&a(S),d.forEach(function(k){return(0,k.resolve)(S)}),d=[]}},h()),g){var m=t.apply(y,p);return a&&a(m),v(m)}d.push({resolve:v,reject:T})})};return f.cancel=function(p){s!==void 0&&clearTimeout(s),d.forEach(function(y){return(0,y.reject)(p)}),d=[]},f}const v1=.7,y1=20,gs={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class $m extends ai.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=Ie,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=hf(r=>b(this,void 0,void 0,function*(){this.emit(gs.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(r)r(s);else throw s}}),y1),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=xi((i=n.loggerName)!==null&&i!==void 0?i:Hn.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new Kt}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return b(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return b(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:s,nackMids:o}=k1(e);this.remoteStereoMids=s,this.remoteNackMids=o}else if(e.type==="answer"){const s=Oi.parse((i=e.sdp)!==null&&i!==void 0?i:"");s.media.forEach(o=>{const a=ff(o.mid);o.type==="audio"&&this.trackBitrates.some(c=>{if(!c.transceiver||a!=c.transceiver.mid)return!1;let l=0;if(o.rtp.some(h=>h.codec.toUpperCase()===c.codec.toUpperCase()?(l=h.payload,!0):!1),l===0)return!0;let d=!1;for(const h of o.fmtp)if(h.payload===l){h.config=h.config.split(";").filter(f=>!f.includes("maxaveragebitrate")).join(";"),c.maxbr>0&&(h.config+=";maxaveragebitrate=".concat(c.maxbr*1e3)),d=!0;break}return d||c.maxbr>0&&o.fmtp.push({payload:l,config:"maxaveragebitrate=".concat(c.maxbr*1e3)}),!0})}),r=Oi.write(s)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(gs.NegotiationComplete),e.sdp&&Oi.parse(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(gs.RTPVideoPayloadTypes,o.rtp)})),!0})}createAndSendOffer(e){return b(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const o=Oi.parse((n=s.sdp)!==null&&n!==void 0?n:"");if(o.media.forEach(a=>{Hm(a),a.type==="audio"?qm(a,["all"],[]):a.type==="video"&&this.trackBitrates.some(c=>{if(!a.msid||!c.cid||!a.msid.includes(c.cid))return!1;let l=0;if(a.rtp.some(h=>h.codec.toUpperCase()===c.codec.toUpperCase()?(l=h.payload,!0):!1),l===0||(Bn(c.codec)&&!_r()&&this.ensureVideoDDExtensionForSVC(a,o),!Bn(c.codec)))return!0;const d=Math.round(c.maxbr*v1);for(const h of a.fmtp)if(h.payload===l){h.config.includes("x-google-start-bitrate")||(h.config+=";x-google-start-bitrate=".concat(d));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(s,Oi.write(o)),this.onOffer(s,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return b(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=Oi.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{Hm(r),r.type==="audio"&&qm(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Oi.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new gt("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new gt("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return b(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":r.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return r.get(o)})}setMungedSDP(e,n,i){return b(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let s="unknown error";r instanceof Error?s=r.message:typeof r=="string"&&(s=r);const o={error:s,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new hs(s)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(o=>o.uri===Rm))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var c;a.type==="video"&&((c=a.ext)===null||c===void 0||c.forEach(l=>{l.value>o&&(o=l.value)}))}),this.ddExtID=o+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:Rm})}}}function qm(t,e,n){const i=ff(t.mid);let r=0;t.rtp.some(s=>s.codec==="opus"?(r=s.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(i)&&!t.rtcpFb.some(s=>s.payload===r&&s.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&t.fmtp.some(s=>s.payload===r?(s.config.includes("stereo=1")||(s.config+=";stereo=1"),!0):!1))}function k1(t){var e;const n=[],i=[],r=Oi.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return r.media.forEach(o=>{var a;const c=ff(o.mid);o.type==="audio"&&(o.rtp.some(l=>l.codec==="opus"?(s=l.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(l=>l.payload===s&&l.type==="nack")&&i.push(c),o.fmtp.some(l=>l.payload===s?(l.config.includes("sprop-stereo=1")&&n.push(c),!0):!1))}),{stereoMids:n,nackMids:i}}function Hm(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function ff(t){return typeof t=="number"?t.toFixed(0):t}const Bu="vp8",S1={audioPreset:Au.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:af.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Bu,backupCodec:!0,preConnectBuffer:!1},bk={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Ck={deviceId:{ideal:"default"},resolution:Yo.h720.resolution},b1={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new Xw,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!0},pf={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var dt;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(dt||(dt={}));class C1{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}get mode(){return this._mode}constructor(e,n,i){var r;this.peerConnectionTimeout=pf.peerConnectionTimeout,this.log=Ie,this.updateState=()=>{var s,o;const a=this.state,c=this.requiredTransports.map(l=>l.getConnectionState());c.every(l=>l==="connected")?this.state=dt.CONNECTED:c.some(l=>l==="failed")?this.state=dt.FAILED:c.some(l=>l==="connecting")?this.state=dt.CONNECTING:c.every(l=>l==="closed")?this.state=dt.CLOSED:c.some(l=>l==="closed")?this.state=dt.CLOSING:c.every(l=>l==="new")&&(this.state=dt.NEW),a!==this.state&&(this.log.debug("pc state change: from ".concat(dt[a]," to ").concat(dt[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),(o=this.subscriber)===null||o===void 0?void 0:o.getConnectionState()))},this.log=xi((r=i.loggerName)!==null&&r!==void 0?r:Hn.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new $m(e,i),this._mode=n,n!=="publisher-only"&&(this.subscriber=new $m(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Un.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Un.PUBLISHER)},this.publisher.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=(s,o)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,s,o)},this.state=dt.NEW,this.connectionLock=new Kt,this.remoteOfferLock=new Kt}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return b(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const i of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(i)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return b(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return b(this,void 0,void 0,function*(){var i;n===Un.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return b(this,void 0,void 0,function*(){var i,r,s;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const o=yield this.remoteOfferLock.lock();try{return(yield(r=this.subscriber)===null||r===void 0?void 0:r.setRemoteDescription(e,n))?yield(s=this.subscriber)===null||s===void 0?void 0:s.createAndSetAnswer():void 0}finally{o()}})}updateConfiguration(e,n){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return b(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(s=>this.ensureTransportConnected(s,e,n)))}finally{r()}})}negotiate(e){return b(this,void 0,void 0,function*(){return new rn((n,i)=>b(this,void 0,void 0,function*(){const r=setTimeout(()=>{i(new hs("negotiation timed out"))},this.peerConnectionTimeout),s=()=>{clearTimeout(r),i(new hs("negotiation aborted"))};e.signal.addEventListener("abort",s),this.publisher.once(gs.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(gs.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(r),o instanceof Error?i(o):i(new Error(String(o)))})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(r=>r.receiver===e);return i==null?void 0:i.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===Un.PUBLISHER?this.publisher.getConnectedAddress():e===Un.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return b(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((c,l)=>b(s,void 0,void 0,function*(){const d=()=>{this.log.warn("abort transport connection",this.logContext),Ot.clearTimeout(h),l(fe.cancelled("room connection has been cancelled"))};r!=null&&r.signal.aborted&&d(),r==null||r.signal.addEventListener("abort",d);const h=Ot.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",d),l(fe.internal("could not establish pc connection"))},o);for(;this.state!==dt.CONNECTED;)if(yield Lt(50),r!=null&&r.signal.aborted){l(fe.cancelled("room connection has been cancelled"));return}Ot.clearTimeout(h),r==null||r.signal.removeEventListener("abort",d),c()}))}()})}}const Tk=5e3,T1=3e4;class Ue{static fetchRegionSettings(e,n,i){return b(this,void 0,void 0,function*(){const r=yield Ue.fetchLock.lock();try{const s=yield fetch("".concat(E1(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:i});if(s.ok){const o=Hx(s.headers),a=o?o*1e3:Tk;return{regionSettings:yield s.json(),updatedAtInMs:Date.now(),maxAgeInMs:a}}else throw s.status===401?fe.notAllowed("Could not fetch region settings: ".concat(s.statusText),s.status):fe.internal("Could not fetch region settings: ".concat(s.statusText))}catch(s){throw s instanceof fe?s:i!=null&&i.aborted?fe.cancelled("Region fetching was aborted"):fe.serverUnreachable("Could not fetch region settings, ".concat(s instanceof Error?"".concat(s.name,": ").concat(s.message):s))}finally{r()}})}static scheduleRefetch(e,n,i){return b(this,void 0,void 0,function*(){const r=Ue.settingsTimeouts.get(e.hostname);clearTimeout(r),Ue.settingsTimeouts.set(e.hostname,setTimeout(()=>b(this,void 0,void 0,function*(){try{const s=yield Ue.fetchRegionSettings(e,n);Ue.updateCachedRegionSettings(e,n,s)}catch(s){if(s instanceof fe&&s.reason===Ge.NotAllowed){Ie.debug("token is not valid, cancelling auto region refresh");return}Ie.debug("auto refetching of region settings failed",{error:s}),Ue.scheduleRefetch(e,n,i)}}),i))})}static updateCachedRegionSettings(e,n,i){Ue.cache.set(e.hostname,i),Ue.scheduleRefetch(e,n,i.maxAgeInMs)}static stopRefetch(e){const n=Ue.settingsTimeouts.get(e);n&&(clearTimeout(n),Ue.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=Ue.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const i=Ue.connectionTrackers.get(e);i&&i.connectionCount===0&&(Ie.debug("stopping region refetch after disconnect delay",{hostname:e}),Ue.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},T1))}static cancelCleanup(e){const n=Ue.connectionTrackers.get(e);n!=null&&n.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=Ue.connectionTrackers.get(e);n||(n={connectionCount:0},Ue.connectionTrackers.set(e,n)),n.connectionCount++,Ue.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=Ue.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&Ue.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return _s(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return b(this,void 0,void 0,function*(){return Ue.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return b(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=Ue.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),Ue.updateCachedRegionSettings(this.serverUrl,this.token,n));const i=n.regionSettings.regions.filter(r=>!this.attemptedRegions.find(s=>s.url===r.url));if(i.length>0){const r=i[0];return this.attemptedRegions.push(r),Ie.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){Ue.updateCachedRegionSettings(this.serverUrl,this.token,e)}}Ue.cache=new Map;Ue.settingsTimeouts=new Map;Ue.connectionTrackers=new Map;Ue.fetchLock=new Kt;function E1(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class ft extends Error{constructor(e,n,i){super(n),this.code=e,this.message=Km(n,ft.MAX_MESSAGE_BYTES),this.data=i?Km(i,ft.MAX_DATA_BYTES):void 0}static fromProto(e){return new ft(e.code,e.message,e.data)}toProto(){return new m0({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new ft(ft.ErrorCode[e],ft.ErrorMessage[e],n)}}ft.MAX_MESSAGE_BYTES=256;ft.MAX_DATA_BYTES=15360;ft.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};ft.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const Ek=15360;function mf(t){return new TextEncoder().encode(t).length}function Km(t,e){if(mf(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const s=Math.floor((n+i+1)/2);r.encode(t.slice(0,s)).length<=e?n=s:i=s-1}return t.slice(0,n)}const gf=2e3;function cl(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const vf=typeof MediaRecorder<"u";class w1{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const x1=vf?MediaRecorder:w1;class R1 extends x1{constructor(e,n){if(!vf)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const s=()=>r===void 0,o=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r==null||r.close(),r=void 0},a=c=>{r==null||r.error(c),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r=void 0};this.byteStream=new ReadableStream({start:c=>{r=c,i=l=>b(this,void 0,void 0,function*(){let d;if(l.data.arrayBuffer){const h=yield l.data.arrayBuffer();d=new Uint8Array(h)}else if(l.data.byteArray)d=l.data.byteArray;else throw new Error("no data available!");s()||c.enqueue(d)}),this.addEventListener("dataavailable",i)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",a)}}function I1(){return vf}const P1=1e3,_1=1e4;class wk extends N{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=hf(()=>b(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>b(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(B.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Kt,this.pauseUpstreamLock=new Kt,this.trackChangeLock=new Kt,this.trackChangeLock.lock().then(o=>b(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{o()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==N.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return b(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{fs(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(es(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{es(r??e,s)}))})}waitForDimensions(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:P1;return function*(){var i;if(e.kind===N.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=ln())===null||i===void 0?void 0:i.os)==="iOS"&&(yield Lt(10));const r=Date.now();for(;Date.now()-r<n;){const s=e.dimensions;if(s)return s;yield Lt(50)}throw new yi("unable to get track dimensions after timeout")}()})}setDeviceId(e){return b(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Zi(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),Zi(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===N.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),s=e.kind===N.Kind.Audio?"audioinput":"videoinput";return n?At.getInstance().normalizeDeviceId(s,i,r):i}()})}mute(){return b(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return b(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return b(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new yi("unable to replace an unpublished track");let r,s;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,s=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),s&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return b(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,s=Zw(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===N.Kind.Video?o.video=i||r?{deviceId:i,facingMode:r}:!0:o.audio=i?Object.assign({deviceId:i},s):!0,this.attachedElements.forEach(l=>{fs(this.mediaStreamTrack,l)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return this.kind===N.Kind.Video&&(yield c.applyConstraints(s)),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(B.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?B.Muted:B.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return b(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),vk()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return b(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(B.UpstreamPaused,this);const i=ln();if((i==null?void 0:i.name)==="Safari"&&si(i.version,"12.0")<0)throw new of("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return b(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(B.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return b(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),c={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(c),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(es(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(l=>{l instanceof DOMException&&l.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:l})),setTimeout(()=>{a.play().catch(d=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:d}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:l}))}),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const l of i.attachedElements)l!==i.processorElement&&r&&(fs(i._mediaStreamTrack,l),es(i.processor.processedTrack,l));yield(s=i.sender)===null||s===void 0?void 0:s.replaceTrack(i.processor.processedTrack)}i.emit(B.TrackProcessorUpdate,i.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}}()})}internalStopProcessor(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(B.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!I1()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new R1(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},_1)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class Nc extends wk{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,N.Kind.Audio,n,i,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>b(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=cl(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(B.AudioTrackFeatureUpdate,this,_t.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(B.AudioTrackFeatureUpdate,this,_t.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return b(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===N.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return b(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Zi(this._constraints.deviceId);return this.source===N.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return b(this,void 0,void 0,function*(){let n;if(e){const i=cf({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return b(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){sn()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},gf)))}setProcessor(e){return b(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!ri()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(B.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return b(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return b(this,void 0,void 0,function*(){const e=yield pk(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(B.AudioSilenceDetected)),e})}}function A1(t,e,n){switch(t.kind){case"audio":return new Nc(t,e,!1,void 0,n);case"video":return new Oc(t,e,!1,n);default:throw new yi("unsupported track type: ".concat(t.kind))}}const D1=Object.values(Yo),N1=Object.values(Du),O1=Object.values(af),L1=[Yo.h180,Yo.h360],M1=[Du.h180,Du.h360],j1=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new He(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),zu=["q","h","f"];function Vu(t,e,n,i){var r,s;let o=i==null?void 0:i.videoEncoding;t&&(o=i==null?void 0:i.screenShareEncoding);const a=i==null?void 0:i.simulcast,c=i==null?void 0:i.scalabilityMode,l=i==null?void 0:i.videoCodec;if(!o&&!a&&!c||!e||!n)return[{}];o||(o=U1(t,e,n,l),Ie.debug("using video encoding",o));const d=o.maxFramerate,h=new He(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&Bn(l)){const y=new xk(c),v=[];if(y.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const T=ln();if(Qo()||ri()||(T==null?void 0:T.name)==="Chrome"&&si(T==null?void 0:T.version,"113")<0){const g=y.suffix=="h"?2:3,m=Ox(T);for(let S=0;S<y.spatial;S+=1)v.push({rid:zu[2-S],maxBitrate:o.maxBitrate/Math.pow(g,S),maxFramerate:h.encoding.maxFramerate,scaleResolutionDownBy:m?Math.pow(2,S):void 0});v[0].scalabilityMode=c}else v.push({maxBitrate:o.maxBitrate,maxFramerate:h.encoding.maxFramerate,scalabilityMode:c});return h.encoding.priority&&(v[0].priority=h.encoding.priority,v[0].networkPriority=h.encoding.priority),Ie.debug("using svc encoding",{encodings:v}),v}if(!a)return[o];let f=[];t?f=(r=Jm(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:Gm(t,h):f=(s=Jm(i==null?void 0:i.videoSimulcastLayers))!==null&&s!==void 0?s:Gm(t,h);let p;if(f.length>0){const y=f[0];f.length>1&&([,p]=f);const v=Math.max(e,n);if(v>=960&&p)return od(e,n,[y,p,h],d);if(v>=480)return od(e,n,[y,h],d)}return od(e,n,[h])}function F1(t,e,n){var i,r,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&Ie.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),c=(i=a.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,l=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===N.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),Vu(t.source===N.Source.ScreenShare,c,l,n)}function U1(t,e,n,i){const r=B1(t,e,n);let{encoding:s}=r[0];const o=Math.max(e,n);for(let a=0;a<r.length;a+=1){const c=r[a];if(s=c.encoding,c.width>=o)break}if(i)switch(i){case"av1":case"h265":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function B1(t,e,n){if(t)return O1;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?D1:N1}function Gm(t,e){if(t)return j1(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?L1:M1}function od(t,e,n,i){const r=[];if(n.forEach((s,o)=>{if(o>=zu.length)return;const a=Math.min(t,e),l={rid:zu[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},d=i&&s.encoding.maxFramerate?Math.min(i,s.encoding.maxFramerate):s.encoding.maxFramerate;d&&(l.maxFramerate=d);const h=Pr()||o===0;s.encoding.priority&&h&&(l.priority=s.encoding.priority,l.networkPriority=s.encoding.priority),r.push(l)}),ri()&&kk()==="ios"){let s;r.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;r.forEach(a=>{var c;a.maxFramerate!=s&&(o&&(o=!1,Ie.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Ie.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(s)),a.maxFramerate=s)})}return r}function Jm(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class xk{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function z1(t){return t.source===N.Source.ScreenShare||t.constraints.height&&Zi(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const V1=5e3;class Oc extends wk{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,N.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>b(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const o=new Map(s.map(c=>[c.rid,c])),a=s.some(c=>c.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(B.CpuConstrained)),this.prevStats){let c=0;o.forEach((l,d)=>{var h;const f=(h=this.prevStats)===null||h===void 0?void 0:h.get(d);c+=cl(l,f)}),this._currentBitrate=c}this.prevStats=o}),this.senderLock=new Kt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!sn())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},gf))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return b(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,c=vi(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0)s=l.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(d){i={error:d}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return b(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,c=vi(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0){s=l.value,a=!1;const d=s;yield(o=d.sender)===null||o===void 0?void 0:o.replaceTrack(d.mediaStreamTrack)}}catch(d){i={error:d}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return b(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===N.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return b(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===N.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return b(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var s;if(r.type==="outbound-rtp"){const o={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(s=r.rid)!==null&&s!==void 0?s:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},a=i.get(r.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((r,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=r.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let i=pn.LOW;i<=pn.HIGH;i+=1)n.push(new tf({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(Bn(this.codec),n)}restartTrack(e){return b(this,void 0,void 0,function*(){var n,i,r,s,o;let a;if(e){const h=cf({video:e});typeof h.video!="boolean"&&(a=h.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var c=!0,l=vi(this.simulcastCodecs.values()),d;d=yield l.next(),n=d.done,!n;c=!0){s=d.value,c=!1;const h=s;h.sender&&((o=h.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(h.mediaStreamTrack=this.mediaStreamTrack.clone(),yield h.sender.replaceTrack(h.mediaStreamTrack))}}catch(h){i={error:h}}finally{try{!c&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return b(this,arguments,void 0,function(i){var r=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,c,l,d,h;if(yield n.setProcessor.call(r,i,s),!((d=r.processor)===null||d===void 0)&&d.processedTrack)try{for(var f=!0,p=vi(r.simulcastCodecs.values()),y;y=yield p.next(),o=y.done,!o;f=!0)l=y.value,f=!1,yield(h=l.sender)===null||h===void 0?void 0:h.replaceTrack(r.processor.processedTrack)}catch(v){a={error:v}}finally{try{!f&&!o&&(c=p.return)&&(yield c.call(p))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return b(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},V1))}setPublishingCodecs(e){return b(this,void 0,void 0,function*(){var n,i,r,s,o,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(Bn(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(n=!0,i=vi(e);r=yield i.next(),s=r.done,!s;n=!0){c=r.value,n=!1;const d=c;if(!this.codec||this.codec===d.codec)yield this.setPublishingLayers(Bn(d.codec),d.qualities);else{const h=this.simulcastCodecs.get(d.codec);if(this.log.debug("try setPublishingCodec for ".concat(d.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:h})),!h||!h.sender){for(const f of d.qualities)if(f.enabled){l.push(d.codec);break}}else h.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(d.codec),this.logContext),yield Ym(h.sender,h.encodings,d.qualities,this.senderLock,Bn(d.codec),this.log,this.logContext))}}}catch(d){o={error:d}}finally{try{!n&&!s&&(a=i.return)&&(yield a.call(i))}finally{if(o)throw o.error}}return l})}setPublishingLayers(e,n){return b(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield Ym(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return b(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var s;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:r===0&&Bn(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return b(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),vk()&&this.isInBackground&&this.source===N.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Ym(t,e,n,i,r,s,o){return b(this,void 0,void 0,function*(){const a=yield i.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:l}=c;if(!l)return;if(l.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:l,senderEncodings:e}));return}let d=!1;!1&&l[0].scalabilityMode||(r&&n.some(p=>p.enabled)&&n.forEach(p=>p.enabled=!0),l.forEach((f,p)=>{var y;let v=(y=f.rid)!==null&&y!==void 0?y:"";v===""&&(v="q");const T=Rk(v),g=n.find(m=>m.quality===T);g&&f.active!==g.enabled&&(d=!0,f.active=g.enabled,s.debug("setting layer ".concat(g.quality," to ").concat(f.active?"enabled":"disabled"),o),Pr()&&(g.enabled?(f.scaleResolutionDownBy=e[p].scaleResolutionDownBy,f.maxBitrate=e[p].maxBitrate,f.maxFrameRate=e[p].maxFrameRate):(f.scaleResolutionDownBy=4,f.maxBitrate=10,f.maxFrameRate=2)))})),d&&(c.encodings=l,s.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:c.encodings})),yield t.setParameters(c))}finally{a()}})}function Rk(t){switch(t){case"f":return pn.HIGH;case"h":return pn.MEDIUM;case"q":return pn.LOW;default:return pn.HIGH}}function Qm(t,e,n,i){if(!n)return[new Xi({quality:pn.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,s=new xk(r),o=[],a=s.suffix=="h"?1.5:2,c=s.suffix=="h"?2:3;for(let l=0;l<s.spatial;l+=1)o.push(new Xi({quality:Math.min(pn.HIGH,s.spatial-1)-l,width:Math.ceil(t/Math.pow(a,l)),height:Math.ceil(e/Math.pow(a,l)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return o}return n.map(r=>{var s,o,a;const c=(s=r.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let l=Rk((o=r.rid)!==null&&o!==void 0?o:"");return new Xi({quality:l,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(a=r.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const Xm="_lossy",Zm="_reliable",W1=2*1e3,ad="leave-reconnect",$1=3e4,q1=8*1024,H1=256*1024;var bn;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(bn||(bn={}));class K1 extends ai.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=pf.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=bn.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Ie,this.reliableDataSequence=1,this.reliableMessageBuffer=new Um,this.reliableReceivedState=new f1($1),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>b(this,[i],void 0,function(r){var s=this;let{channel:o}=r;return function*(){if(o){if(o.label===Zm)s.reliableDCSub=o;else if(o.label===Xm)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=i=>b(this,void 0,void 0,function*(){var r,s,o,a,c;const l=yield this.dataProcessLock.lock();try{let d;if(i.data instanceof ArrayBuffer)d=i.data;else if(i.data instanceof Blob)d=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const h=qt.fromBinary(new Uint8Array(d));if(h.sequence>0&&h.participantSid!==""){const f=this.reliableReceivedState.get(h.participantSid);if(f&&h.sequence<=f)return;this.reliableReceivedState.set(h.participantSid,h.sequence)}if(((r=h.value)===null||r===void 0?void 0:r.case)==="speaker")this.emit(K.ActiveSpeakersUpdate,h.value.value.speakers);else if(((s=h.value)===null||s===void 0?void 0:s.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const f=yield(o=this.e2eeManager)===null||o===void 0?void 0:o.handleEncryptedData(h.value.value.encryptedValue,h.value.value.iv,h.participantIdentity,h.value.value.keyIndex),p=h0.fromBinary(f.payload),y=new qt({value:p.value,participantIdentity:h.participantIdentity,participantSid:h.participantSid});((a=y.value)===null||a===void 0?void 0:a.case)==="user"&&eg(y,y.value.value),this.emit(K.DataPacketReceived,y,h.value.value.encryptionType)}else((c=h.value)===null||c===void 0?void 0:c.case)==="user"&&eg(h,h.value.value),this.emit(K.DataPacketReceived,h,wt.NONE)}finally{l()}}),this.handleDataError=i=>{const s=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:o}=i.error;this.log.error("DataChannel error on ".concat(s,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const s=i.currentTarget.maxRetransmits===0?Ae.LOSSY:Ae.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(K.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}i===ad&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Ot.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===bn.Connected&&i();const s=()=>{this.off(K.Disconnected,o),i()},o=()=>{this.off(K.Restarted,s),r()};this.once(K.Restarted,s),this.once(K.Disconnected,o)}),this.updateAndEmitDCBufferStatus=i=>{if(i===Ae.RELIABLE){const s=this.dataChannelForKind(i);s&&this.reliableMessageBuffer.alignBufferedAmount(s.bufferedAmount)}const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(K.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>b(this,void 0,void 0,function*(){!this.url||!(yield fetch(Xo(this.url),{method:"HEAD"}).then(r=>r.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===Ke.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===Ke.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(mr.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>b(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(Xo(this.url),{method:"HEAD"}),Lt(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=xi((n=e.loggerName)!==null&&n!==void 0?n:Hn.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new df(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Kt,this.dataProcessLock=new Kt,this.dcBufferStatus=new Map([[Ae.LOSSY,!0],[Ae.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(K.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(K.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(K.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(K.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(K.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(K.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(K.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(K.SignalRequestResponse,i)}get logContext(){var e,n,i,r,s,o;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:this.participantSid}}join(e,n,i,r){return b(this,arguments,void 0,function(s,o,a,c){var l=this;let d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return function*(){l.url=s,l.token=o,l.signalOpts=a,l.maxJoinAttempts=a.maxRetries;try{l.joinAttempts+=1,l.setupSignalClientCallbacks();const h=yield l.client.join(s,o,a,c,d);return l._isClosed=!1,l.latestJoinResponse=h,l.subscriberPrimary=h.subscriberPrimary,l.pcManager||(yield l.configure(h,!d)),(!l.subscriberPrimary||h.fastPublish)&&l.negotiate().catch(f=>{Ie.error(f,l.logContext)}),l.registerOnLineListener(),l.clientConfiguration=h.clientConfiguration,l.emit(K.SignalConnected,h),h}catch(h){if(h instanceof fe){if(h.reason===Ge.ServerUnreachable){if(l.log.warn("Couldn't connect to server, attempt ".concat(l.joinAttempts," of ").concat(l.maxJoinAttempts),l.logContext),l.joinAttempts<l.maxJoinAttempts)return l.join(s,o,a,c,d)}else if(h.reason===Ge.ServiceNotFound)return l.log.warn("Initial connection failed: ".concat(h.message,"  Retrying")),l.join(s,o,a,c,!0)}throw h}}()})}close(){return b(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(K.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return b(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new Um,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return b(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new yi("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(fe.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(r),n(s)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return b(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e,n){return b(this,void 0,void 0,function*(){var i,r;if(this.pcManager&&this.pcManager.currentState!==dt.NEW)return;this.participantSid=(i=e.participant)===null||i===void 0?void 0:i.sid;const s=this.makeRTCConfiguration(e);this.pcManager=new C1(s,n?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(K.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(o,a)=>{this.client.sendIceCandidate(o,a)},this.pcManager.onPublisherOffer=(o,a)=>{this.client.sendOffer(o,a)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(o,a,c)=>b(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(o),this.logContext),["closed","disconnected","failed"].includes(a)&&(this.publisherConnectionPromise=void 0),o===dt.CONNECTED){const h=this.pcState===bn.New;this.pcState=bn.Connected,h&&this.emit(K.Connected,e)}else o===dt.FAILED&&(this.pcState===bn.Connected||this.pcState===bn.Reconnecting)&&(this.pcState=bn.Disconnected,this.handleDisconnect("peerconnection failed",c==="failed"?mr.RR_SUBSCRIBER_FAILED:mr.RR_PUBLISHER_FAILED));const l=this.client.isDisconnected||this.client.currentState===Ke.RECONNECTING,d=[dt.FAILED,dt.CLOSING,dt.CLOSED].includes(o);l&&d&&!this._isClosed&&this.emit(K.Offline)}),this.pcManager.onTrack=o=>{o.streams.length!==0&&this.emit(K.MediaTrackAdded,o.track,o.streams[0],o.receiver)},G1((r=e.serverInfo)===null||r===void 0?void 0:r.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,i)=>b(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,i)=>b(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=i;const r=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);r&&this.client.sendAnswer(r,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(K.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(K.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(K.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(K.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(K.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,i;const r={direction:"recvonly"};for(let s=0;s<e.numAudios;s++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",r);for(let s=0;s<e.numVideos;s++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",r);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",mr.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:Tk,regionSettings:e.regions})),e.action){case ds.DISCONNECT:this.emit(K.Disconnected,e==null?void 0:e.reason),this.close();break;case ds.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(ad);break;case ds.RESUME:this.handleDisconnect(ad)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),r.push(o)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Ko.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Xm,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Zm,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(Ae.LOSSY);if(e){const n=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(n,q1),H1)}},1e3))}createSender(e,n,i){return b(this,void 0,void 0,function*(){if(Lu())return yield this.createTransceiverRTCRtpSender(e,n,i);if(Mu())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new gt("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return b(this,void 0,void 0,function*(){if(Lu())return this.createSimulcastTransceiverSender(e,n,i,r);if(Mu())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new gt("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return b(this,void 0,void 0,function*(){if(!this.pcManager)throw new gt("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),dr(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:r};return i&&(s.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,i,r){return b(this,void 0,void 0,function*(){if(!this.pcManager)throw new gt("publisher is closed");const s={direction:"sendonly"};r&&(s.sendEncodings=r);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return b(this,void 0,void 0,function*(){if(!this.pcManager)throw new gt("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return b(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){Ie.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===Ko.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:dt.NEW)===dt.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof gt?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof Ur||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",mr.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(K.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return b(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new gt("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(K.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Ur;s=yield this.join(e??this.url,this.token,this.signalOpts,void 0,!this.options.singlePeerConnection)}catch(o){throw o instanceof fe&&o.reason===Ge.NotAllowed?new gt("could not reconnect, token might be expired"):new Ur}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(K.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==Ke.CONNECTED)throw new Ur("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(K.Restarted)}catch(s){const o=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),s}})}resumeConnection(e){return b(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new gt("could not reconnect, url or token not saved");if(!this.pcManager)throw new gt("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(K.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let s="";throw r instanceof Error&&(s=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof fe&&r.reason===Ge.NotAllowed?new gt("could not reconnect, token might be expired"):r instanceof fe&&r.reason===Ge.LeaveRequest?r:new Ur(s)}if(this.emit(K.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Ke.CONNECTED)throw new Ur("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(K.Resumed)})}waitForPCInitialConnection(e,n){return b(this,void 0,void 0,function*(){if(!this.pcManager)throw new gt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return b(this,void 0,void 0,function*(){this.pcState=bn.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Lt(W1),!this.pcManager)throw new gt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=bn.Connected}catch(e){throw this.pcState=bn.Disconnected,fe.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,n,i,r){return b(this,void 0,void 0,function*(){const s=new qt({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcResponse",value:new Qh({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(s,Ae.RELIABLE)})}publishRpcAck(e,n){return b(this,void 0,void 0,function*(){const i=new qt({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcAck",value:new Yh({requestId:n})}});yield this.sendDataPacket(i,Ae.RELIABLE)})}sendDataPacket(e,n){return b(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const s=n1(e);if(s){const o=yield this.e2eeManager.encryptData(s.toBinary());e.value={case:"encryptedPacket",value:new u0({encryptedValue:o.payload,iv:o.iv,keyIndex:o.keyIndex})}}}n===Ae.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===Ae.RELIABLE)yield this.waitForBufferStatusLow(n),this.reliableMessageBuffer.push({data:i,sequence:e.sequence});else{if(!this.isBufferStatusLow(n)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return b(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(Ae.RELIABLE);const n=this.dataChannelForKind(Ae.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(Ae.RELIABLE)})}waitForBufferStatusLow(e){return new rn((n,i)=>b(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i(new gt("engine closed"));for(this.once(K.Closing,r);!this.dcBufferStatus.get(e);)yield Lt(10);this.off(K.Closing,r),n()}}))}ensureDataTransportConnected(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!i.pcManager)throw new gt("PC manager is closed");const o=r?i.pcManager.subscriber:i.pcManager.publisher,a=r?"Subscriber":"Publisher";if(!o)throw fe.internal("".concat(a," connection not set"));let c=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),c=!0),!c&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&i.negotiate().catch(h=>{Ie.error(h,i.logContext)});const l=i.dataChannelForKind(n,r);if((l==null?void 0:l.readyState)==="open")return;const d=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<d;){if(o.isICEConnected&&((s=i.dataChannelForKind(n,r))===null||s===void 0?void 0:s.readyState)==="open")return;yield Lt(50)}throw fe.internal("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()))}()})}ensurePublisherConnected(e){return b(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==dt.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return b(this,void 0,void 0,function*(){return new rn((e,n)=>b(this,void 0,void 0,function*(){if(!this.pcManager){n(new hs("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n(new hs("cannot negotiate on closed engine")),this.on(K.Closing,r),this.pcManager.publisher.once(gs.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const c=a.codec.toLowerCase();Ux(c)&&o.set(a.payload,c)}),this.emit(K.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(i),e()}catch(s){s instanceof hs&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",mr.RR_UNKNOWN),s instanceof Error?n(s):n(new Error(String(s)))}finally{this.off(K.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===Ae.LOSSY)return this.lossyDCSub;if(e===Ae.RELIABLE)return this.reliableDCSub}else{if(e===Ae.LOSSY)return this.lossyDC;if(e===Ae.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r,s,o;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const a=this.pcManager.publisher.getLocalDescription(),c=this.pcManager.publisher.getRemoteDescription(),l=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),d=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getLocalDescription(),h=(o=(s=this.signalOpts)===null||s===void 0?void 0:s.autoSubscribe)!==null&&o!==void 0?o:!0,f=new Array,p=new Array;e.forEach(y=>{y.isDesired!==h&&f.push(y.trackSid),y.isEnabled||p.push(y.trackSid)}),this.client.sendSyncState(new nf({answer:this.pcManager.mode==="publisher-only"?c?ts({sdp:c.sdp,type:c.type}):void 0:d?ts({sdp:d.sdp,type:d.type}):void 0,offer:this.pcManager.mode==="publisher-only"?a?ts({sdp:a.sdp,type:a.type}):void 0:l?ts({sdp:l.sdp,type:l.type}):void 0,subscription:new sl({trackSids:f,subscribe:!h,participantTracks:[]}),publishTracks:Cx(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:p,datachannelReceiveStates:this.reliableReceivedState.map((y,v)=>new A0({publisherSid:v,lastSeq:y}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new D0({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(Ae.LOSSY),Un.PUBLISHER),n(this.dataChannelForKind(Ae.RELIABLE),Un.PUBLISHER),n(this.dataChannelForKind(Ae.LOSSY,!0),Un.SUBSCRIBER),n(this.dataChannelForKind(Ae.RELIABLE,!0),Un.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Ot.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){sn()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){sn()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const i=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(i){const r=Object.entries(this.midToTrackId).find(s=>{let[o]=s;return o===i});if(r)return r[1]}}}function G1(t){return t!==void 0&&t>13}function eg(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class Ik{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new Cn("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),$t.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new Cn("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),$t.LengthExceeded)}}constructor(e,n,i,r){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class J1 extends Ik{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new xn,i=null,r=null;if(this.signal){const o=this.signal;r=()=>{var a;(a=n.reject)===null||a===void 0||a.call(n,o.reason)},o.addEventListener("abort",r),i=o}const s=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>b(this,void 0,void 0,function*(){var o,a;try{const{done:c,value:l}=yield Promise.race([e.read(),n.promise,(a=(o=this.outOfBandFailureRejectingFuture)===null||o===void 0?void 0:o.promise)!==null&&a!==void 0?a:new Promise(()=>{})]);return c?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(l),{done:!1,value:l.content})}catch(c){throw s(),c}}),return(){return b(this,void 0,void 0,function*(){return s(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a=new Set;const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var l=!0,d=vi(c),h;h=yield d.next(),i=h.done,!i;l=!0){o=h.value,l=!1;const f=o;a.add(f)}}catch(f){r={error:f}}finally{try{!l&&!i&&(s=d.return)&&(yield s.call(d))}finally{if(r)throw r.error}}return Array.from(a)}()})}}class Y1 extends Ik{constructor(e,n,i,r){super(e,n,i,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=Za(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new xn,r=null,s=null;if(this.signal){const a=this.signal;s=()=>{var c;(c=i.reject)===null||c===void 0||c.call(i,a.reason)},a.addEventListener("abort",s),r=a}const o=()=>{e.releaseLock(),r&&s&&r.removeEventListener("abort",s),this.signal=void 0};return{next:()=>b(this,void 0,void 0,function*(){var a,c;try{const{done:l,value:d}=yield Promise.race([e.read(),i.promise,(c=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&c!==void 0?c:new Promise(()=>{})]);if(l)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(d);let h;try{h=n.decode(d.content)}catch(f){throw new Cn("Cannot decode datastream chunk ".concat(d.chunkIndex," as text: ").concat(f),$t.DecodeFailed)}return{done:!1,value:h}}}catch(l){throw o(),l}}),return(){return b(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a="";const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var l=!0,d=vi(c),h;h=yield d.next(),i=h.done,!i;l=!0)o=h.value,l=!1,a+=o}catch(f){r={error:f}}finally{try{!l&&!i&&(s=d.return)&&(yield s.call(d))}finally{if(r)throw r.error}}return a}()})}}class Q1{constructor(){this.log=Ie,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new Cn('A text stream handler for topic "'.concat(e,'" has already been set.'),$t.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new Cn('A byte stream handler for topic "'.concat(e,'" has already been set.'),$t.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,r,s;const o=Array.from(this.textStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e),a=Array.from(this.byteStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e);if(o.length>0||a.length>0){const c=new Cn("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),$t.AbnormalEnd);for(const[l,d]of a)(i=(n=d.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,c),this.byteStreamControllers.delete(l);for(const[l,d]of o)(s=(r=d.outOfBandFailureRejectingFuture).reject)===null||s===void 0||s.call(r,c),this.textStreamControllers.delete(l)}}handleDataStreamPacket(e,n){return b(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,i){return b(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const s=this.byteStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let o;const a=new xn;a.promise.catch(d=>{this.log.error(d)});const c={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Za(e.timestamp),attributes:e.attributes,encryptionType:i},l=new ReadableStream({start:d=>{if(o=d,this.textStreamControllers.has(e.streamId))throw new Cn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),$t.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:c,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new J1(c,l,Za(e.totalLength),a),{identity:n})}else if(e.contentHeader.case==="textHeader"){const s=this.textStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let o;const a=new xn;a.promise.catch(d=>{this.log.error(d)});const c={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i},l=new ReadableStream({start:d=>{if(o=d,this.textStreamControllers.has(e.streamId))throw new Cn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),$t.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:c,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new Y1(c,l,Za(e.totalLength),a),{identity:n})}})}handleStreamChunk(e,n){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new Cn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),$t.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new Cn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),$t.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e))}handleStreamTrailer(e,n){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new Cn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),$t.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new Cn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),$t.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class Pk{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return b(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class X1 extends Pk{}class Z1 extends Pk{}const tg=15e3;class eR{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return b(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),c=new Array(a?a.length+1:1).fill(0),l=(h,f)=>{var p;c[f]=h;const y=c.reduce((v,T)=>v+T,0);(p=n==null?void 0:n.onProgress)===null||p===void 0||p.call(n,y)},d=yield this.streamText({streamId:r,totalSize:o,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield d.write(e),l(1,0),yield d.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((h,f)=>b(this,void 0,void 0,function*(){return this._sendFile(a[f],h,{topic:n.topic,mimeType:h.type,onProgress:p=>{l(p,f+1)}})})))),d.info})}streamText(e){return b(this,void 0,void 0,function*(){var n,i,r;const s=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),o={id:s,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes,encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?wt.GCM:wt.NONE},a=new Pc({streamId:s,mimeType:o.mimeType,topic:o.topic,timestamp:gr(o.timestamp),totalLength:gr(e==null?void 0:e.totalSize),attributes:o.attributes,contentHeader:{case:"textHeader",value:new T0({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?bu.UPDATE:bu.CREATE})}}),c=e==null?void 0:e.destinationIdentities,l=new qt({destinationIdentities:c,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(l,Ae.RELIABLE);let d=0;const h=this.engine,f=new WritableStream({write(v){return b(this,void 0,void 0,function*(){for(const T of qx(v,tg)){const g=new _c({content:T,streamId:s,chunkIndex:gr(d)}),m=new qt({destinationIdentities:c,value:{case:"streamChunk",value:g}});yield h.sendDataPacket(m,Ae.RELIABLE),d+=1}})},close(){return b(this,void 0,void 0,function*(){const v=new Ac({streamId:s}),T=new qt({destinationIdentities:c,value:{case:"streamTrailer",value:v}});yield h.sendDataPacket(T,Ae.RELIABLE)})},abort(v){console.log("Sink error:",v)}});let p=()=>b(this,void 0,void 0,function*(){yield y.close()});h.once(K.Closing,p);const y=new X1(f,o,()=>this.engine.off(K.Closing,p));return y})}sendFile(e,n){return b(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return b(this,void 0,void 0,function*(){var r;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:c}=yield o.read();if(a)break;yield s.write(c)}return yield s.close(),s.info})}streamBytes(e){return b(this,void 0,void 0,function*(){var n,i,r,s,o,a;const c=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),l=e==null?void 0:e.destinationIdentities,d={id:c,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(s=e==null?void 0:e.name)!==null&&s!==void 0?s:"unknown",encryptionType:!((o=this.engine.e2eeManager)===null||o===void 0)&&o.isDataChannelEncryptionEnabled?wt.GCM:wt.NONE},h=new Pc({totalLength:gr((a=d.size)!==null&&a!==void 0?a:0),mimeType:d.mimeType,streamId:c,topic:d.topic,timestamp:gr(Date.now()),attributes:d.attributes,contentHeader:{case:"byteHeader",value:new E0({name:d.name})}}),f=new qt({destinationIdentities:l,value:{case:"streamHeader",value:h}});yield this.engine.sendDataPacket(f,Ae.RELIABLE);let p=0;const y=new Kt,v=this.engine,T=this.log,g=new WritableStream({write(S){return b(this,void 0,void 0,function*(){const k=yield y.lock();let E=0;try{for(;E<S.byteLength;){const x=S.slice(E,E+tg),I=new qt({destinationIdentities:l,value:{case:"streamChunk",value:new _c({content:x,streamId:c,chunkIndex:gr(p)})}});yield v.sendDataPacket(I,Ae.RELIABLE),p+=1,E+=x.byteLength}}finally{k()}})},close(){return b(this,void 0,void 0,function*(){const S=new Ac({streamId:c}),k=new qt({destinationIdentities:l,value:{case:"streamTrailer",value:S}});yield v.sendDataPacket(k,Ae.RELIABLE)})},abort(S){T.error("Sink error:",S)}});return new Z1(g,d)})}}class _k extends N{constructor(e,n,i,r,s){super(e,i,s),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?B.Muted:B.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(B.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return b(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),gf)),Tx()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:s}=i;s&&this.rtpTimestamp!==s&&(this.emit(B.TimeSyncUpdate,{timestamp:r,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class tR extends _k{constructor(e,n,i,r,s,o){super(e,n,N.Kind.Audio,i,o),this.monitorReceiver=()=>b(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=cl(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;ri()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(ri())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return b(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(ju(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&ju(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(B.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(B.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return b(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const cd=100;class nR extends _k{constructor(e,n,i,r,s){super(e,n,N.Kind.Video,i,s),this.elementInfos=[],this.monitorReceiver=()=>b(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=cl(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=hf(()=>{this.updateDimensions()},cd),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===N.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?fs(this._mediaStreamTrack,n):es(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new iR(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return b(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(i=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&r.set(s.id,s)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return b(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,i;const r=this.elementInfos.reduce((c,l)=>Math.max(c,l.visibilityChangedAt||0),0),s=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,o=this.elementInfos.some(c=>c.pictureInPicture),a=this.elementInfos.some(c=>c.visible)&&!s||o;if(!(this.lastVisible===a&&!e)){if(!a&&Date.now()-r<cd){Ot.setTimeout(()=>{this.updateVisibility()},cd);return}this.lastVisible=a,this.emit(B.VisibilityChanged,a,this)}}updateDimensions(){var e,n;let i=0,r=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,c=o.height()*s;a+c>i+r&&(i=a,r=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(B.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?Pm():n||(Pm()>2?2:1)}}class iR{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:s,isIntersecting:o}=i;s===this.element&&(this.isIntersecting=o,this.isPiP=io(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,s;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=io(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=io(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??Wu(e),this.isPiP=sn()&&io(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=Wu(this.element),this.isPiP=io(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Am().observe(this.element),_m().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,s;(e=Am())===null||e===void 0||e.unobserve(this.element),(n=_m())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(s=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function io(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?Wu(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function Wu(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+s>n.pageXOffset&&!a&&c!=="none"}class fi extends ai.EventEmitter{constructor(e,n,i,r){var s;super(),this.metadataMuted=!1,this.encryption=wt.NONE,this.log=Ie,this.handleMuted=()=>{this.emit(B.Muted)},this.handleUnmuted=()=>{this.emit(B.Unmuted)},this.log=xi((s=r==null?void 0:r.loggerName)!==null&&s!==void 0?s:Hn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=N.Source.Unknown}setTrack(e){this.track&&(this.track.off(B.Muted,this.handleMuted),this.track.off(B.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(B.Muted,this.handleMuted),e.on(B.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),De(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==wt.NONE}get audioTrack(){if(ii(this.track))return this.track}get videoTrack(){if(dr(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=N.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===N.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(fi||(fi={}));class $u extends fi{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(B.Ended)},this.handleCpuConstrained=()=>{this.track&&dr(this.track)&&this.emit(B.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(B.Ended,this.handleTrackEnded),this.track.off(B.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(B.Ended,this.handleTrackEnded),e.on(B.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return b(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return b(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return b(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return b(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(ii(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(_t.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(_t.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(_t.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(_t.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(_t.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(_t.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function oa(t,e){return b(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:s}=gk(t);let o=s.audio,a=s.video;if(i&&typeof s.audio=="object"&&(s.audio.processor=i),r&&typeof s.video=="object"&&(s.video.processor=r),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const h=s.audio.deviceId;s.audio.deviceId={exact:h},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:h}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const h=s.video.deviceId;s.video.deviceId={exact:h},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:h}})}s.audio===!0?s.audio={deviceId:"default"}:typeof s.audio=="object"&&s.audio!==null&&(s.audio=Object.assign(Object.assign({},s.audio),{deviceId:s.audio.deviceId||"default"})),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const c=fk(s,bk,Ck),l=cf(c),d=navigator.mediaDevices.getUserMedia(l);s.audio&&(At.userMediaPromiseMap.set("audioinput",d),d.catch(()=>At.userMediaPromiseMap.delete("audioinput"))),s.video&&(At.userMediaPromiseMap.set("videoinput",d),d.catch(()=>At.userMediaPromiseMap.delete("videoinput")));try{const h=yield d;return yield Promise.all(h.getTracks().map(f=>b(this,void 0,void 0,function*(){const p=f.kind==="audio";let y=p?c.audio:c.video;(typeof y=="boolean"||!y)&&(y={});let v;const T=p?l.audio:l.video;typeof T!="boolean"&&(v=T);const g=f.getSettings().deviceId;v!=null&&v.deviceId&&Zi(v.deviceId)!==g?v.deviceId=g:v||(v={deviceId:g});const m=A1(f,v,e);return m.kind===N.Kind.Video?m.source=N.Source.Camera:m.kind===N.Kind.Audio&&(m.source=N.Source.Microphone),m.mediaStream=h,ii(m)&&i?yield m.setProcessor(i):dr(m)&&r&&(yield m.setProcessor(r)),m})))}catch(h){if(!n)throw h;return oa(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function rR(t){return b(this,void 0,void 0,function*(){return(yield oa({audio:!1,video:!0}))[0]})}function sR(t){return b(this,void 0,void 0,function*(){return(yield oa({audio:!0,video:!1}))[0]})}var Ui;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(Ui||(Ui={}));function oR(t){switch(t){case ho.EXCELLENT:return Ui.Excellent;case ho.GOOD:return Ui.Good;case ho.POOR:return Ui.Poor;case ho.LOST:return Ui.Lost;default:return Ui.Unknown}}class Ak extends ai.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===Go.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===ls.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Go.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Ui.Unknown,this.log=Ie,this.log=xi((c=o==null?void 0:o.loggerName)!==null&&c!==void 0?c:Hn.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new xn,this.once(Q.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(N.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(N.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(N.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===ls.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==ls.ACTIVE&&this.emit(Q.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(Q.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(Q.ParticipantNameChanged,e)}_setAttributes(e){const n=Ex(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(Q.AttributesChanged,n)}setPermissions(e){var n,i,r,s,o,a;const c=this.permissions,l=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((d,h)=>{var f;return d!==((f=this.permissions)===null||f===void 0?void 0:f.canPublishSources[h])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,l&&this.emit(Q.ParticipantPermissionsChanged,c),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(Q.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=oR(e),n!==this._connectionQuality&&this.emit(Q.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>ii(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(B.Muted,()=>{this.emit(Q.TrackMuted,e)}),e.on(B.Unmuted,()=>{this.emit(Q.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case N.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case N.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function aR(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new P0({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class cR extends Ak{constructor(e,n,i,r,s,o){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=wt.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new xn)},this.handleReconnected=()=>{var a,c;(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.resolve)===null||c===void 0||c.call(a),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var a,c,l,d,h,f;this.reconnectFuture&&(this.reconnectFuture.promise.catch(p=>this.log.warn(p.message,this.logContext)),(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.reject)===null||c===void 0||c.call(a,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((d=(l=this.signalConnectedFuture).reject)===null||d===void 0||d.call(l,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(f=(h=this.activeAgentFuture)===null||h===void 0?void 0:h.reject)===null||f===void 0||f.call(h,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=a=>{var c,l;a.participant&&this.updateInfo(a.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new xn),(l=(c=this.signalConnectedFuture).resolve)===null||l===void 0||l.call(c)},this.handleSignalRequestResponse=a=>{const{requestId:c,reason:l,message:d}=a,h=this.pendingSignalRequests.get(c);h&&(l!==rf.OK&&h.reject(new Em(d,l)),this.pendingSignalRequests.delete(c))},this.handleDataPacket=a=>{switch(a.value.case){case"rpcResponse":let c=a.value.value,l=null,d=null;c.value.case==="payload"?l=c.value.value:c.value.case==="error"&&(d=ft.fromProto(c.value.value)),this.handleIncomingRpcResponse(c.requestId,l,d);break;case"rpcAck":let h=a.value.value;this.handleIncomingRpcAck(h.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(a=>aR(a)))},this.onTrackUnmuted=a=>{this.onTrackMuted(a,a.isUpstreamPaused)},this.onTrackMuted=(a,c)=>{if(c===void 0&&(c=!0),!a.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),De(a)));return}this.engine.updateMuteStatus(a.sid,c)},this.onTrackUpstreamPaused=a=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),De(a))),this.onTrackMuted(a,!0)},this.onTrackUpstreamResumed=a=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),De(a))),this.onTrackMuted(a,a.isMuted)},this.onTrackFeatureUpdate=a=>{const c=this.audioTrackPublications.get(a.sid);if(!c){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(a.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(c.trackSid,c.getTrackFeatures())},this.onTrackCpuConstrained=(a,c)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),De(c))),this.emit(Q.LocalTrackCpuConstrained,a,c)},this.handleSubscribedQualityUpdate=a=>b(this,void 0,void 0,function*(){var c,l,d,h,f;if(!(!((f=this.roomOptions)===null||f===void 0)&&f.dynacast))return;const p=this.videoTrackPublications.get(a.trackSid);if(!p){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}if(!p.videoTrack)return;const y=yield p.videoTrack.setPublishingCodecs(a.subscribedCodecs);try{for(var v=!0,T=vi(y),g;g=yield T.next(),c=g.done,!c;v=!0){h=g.value,v=!1;const m=h;kx(m)&&(this.log.debug("publish ".concat(m," for ").concat(p.videoTrack.sid),Object.assign(Object.assign({},this.logContext),De(p))),yield this.publishAdditionalCodecForTrack(p.videoTrack,m,p.options))}}catch(m){l={error:m}}finally{try{!v&&!c&&(d=T.return)&&(yield d.call(T))}finally{if(l)throw l.error}}}),this.handleLocalTrackUnpublished=a=>{const c=this.trackPublications.get(a.trackSid);if(!c){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}this.unpublishTrack(c.track)},this.handleTrackEnded=a=>b(this,void 0,void 0,function*(){if(a.source===N.Source.ScreenShare||a.source===N.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),De(a))),this.unpublishTrack(a);else if(a.isUserProvided)yield a.mute();else if(di(a)||Ai(a))try{if(sn())try{const c=yield navigator==null?void 0:navigator.permissions.query({name:a.source===N.Source.Camera?"camera":"microphone"});if(c&&c.state==="denied")throw this.log.warn("user has revoked access to ".concat(a.source),Object.assign(Object.assign({},this.logContext),De(a))),c.onchange=()=>{c.state!=="denied"&&(a.isMuted||a.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}a.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),De(a))),di(a)?yield a.restartTrack({deviceId:"default"}):yield a.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),De(a))),yield a.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s,this.roomOutgoingDataStreamManager=o}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==wt.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(K.RemoteMute,(i,r)=>{const s=this.trackPublications.get(i);!s||!s.track||(r?s.mute():s.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(K.Connected,this.handleReconnected).on(K.SignalConnected,this.handleSignalConnected).on(K.SignalRestarted,this.handleReconnected).on(K.SignalResumed,this.handleReconnected).on(K.Restarting,this.handleReconnecting).on(K.Resuming,this.handleReconnecting).on(K.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(K.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(K.Closing,this.handleClosing).on(K.SignalRequestResponse,this.handleSignalRequestResponse).on(K.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return b(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return b(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return b(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return b(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:s,attributes:o}=n;return function*(){return new rn((a,c)=>b(i,void 0,void 0,function*(){var l,d;try{let h=!1;const f=yield this.engine.client.sendUpdateLocalMetadata((l=r??this.metadata)!==null&&l!==void 0?l:"",(d=s??this.name)!==null&&d!==void 0?d:"",o),p=performance.now();for(this.pendingSignalRequests.set(f,{resolve:a,reject:y=>{c(y),h=!0},values:{name:s,metadata:r,attributes:o}});performance.now()-p<5e3&&!h;){if((!s||this.name===s)&&(!r||this.metadata===r)&&(!o||Object.entries(o).every(y=>{let[v,T]=y;return this.attributes[v]===T||T===""&&!this.attributes[v]}))){this.pendingSignalRequests.delete(f),a();return}yield Lt(50)}c(new Em("Request to update local metadata timed out","TimeoutError"))}catch(h){h instanceof Error?c(h):c(new Error(String(h)))}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(N.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(N.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(N.Source.ScreenShare,e,n,i)}setE2EEEnabled(e){return b(this,void 0,void 0,function*(){this.encryptionType=e?wt.GCM:wt.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return b(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(e)){const l=yield this.waitForPendingPublicationOfSource(e);return l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield l==null?void 0:l.unmute(),l}this.pendingPublishing.add(e);try{switch(e){case N.Source.Camera:c=yield this.createTracks({video:(s=i)!==null&&s!==void 0?s:!0});break;case N.Source.Microphone:c=yield this.createTracks({audio:(o=i)!==null&&o!==void 0?o:!0});break;case N.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},i));break;default:throw new yi(e)}}catch(l){throw c==null||c.forEach(d=>{d.stop()}),l instanceof Error&&this.emit(Q.MediaDevicesError,l,Ou(e)),this.pendingPublishing.delete(e),l}for(const l of c){const d=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===N.Source.Microphone&&ii(l)&&d.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),l.startPreConnectBuffer())}try{const l=[];for(const h of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),De(h))),l.push(this.publishTrack(h,r));[a]=yield Promise.all(l)}catch(l){throw c==null||c.forEach(d=>{d.stop()}),l}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===N.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(N.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return b(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(N.Source.Camera)||this.pendingPublishing.has(N.Source.Microphone))){this.pendingPublishing.add(N.Source.Camera),this.pendingPublishing.add(N.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(N.Source.Camera),this.pendingPublishing.delete(N.Source.Microphone)}}})}createTracks(e){return b(this,void 0,void 0,function*(){var n,i;e??(e={});const r=fk(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield oa(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(ii(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=N.Source.Microphone,this.emit(Q.AudioStreamAcquired)),dr(a)&&(this.cameraError=void 0,a.source=N.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return b(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new of("getDisplayMedia not supported");e.resolution===void 0&&!Nx()&&(e.resolution=af.h1080fps30.resolution);const n=bx(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new yi("no video track found");const s=new Oc(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=N.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(i.getAudioTracks().length>0){this.emit(Q.AudioStreamAcquired);const a=new Nc(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=N.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return b(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return b(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,c,l,d;di(i)&&i.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),ps(i)&&s.pendingPublishPromises.has(i)&&(yield s.pendingPublishPromises.get(i));let h;if(i instanceof MediaStreamTrack)h=i.getConstraints();else{h=i.constraints;let g;switch(i.source){case N.Source.Microphone:g="audioinput";break;case N.Source.Camera:g="videoinput"}g&&s.activeDeviceMap.has(g)&&(h=Object.assign(Object.assign({},h),{deviceId:s.activeDeviceMap.get(g)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Nc(i,h,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":i=new Oc(i,h,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new yi("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let f;if(s.trackPublications.forEach(g=>{g.track&&g.track===i&&(f=g)}),f)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),De(f))),f;const p=Object.assign(Object.assign({},s.roomOptions.publishDefaults),r),y="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,v=(c=p.forceStereo)!==null&&c!==void 0?c:y;v&&(p.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),De(i))),p.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(l=p.dtx)!==null&&l!==void 0||(p.dtx=!1),(d=p.red)!==null&&d!==void 0||(p.red=!1)),!Lx()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),p.simulcast=!1),p.source&&(i.source=p.source);const T=new Promise((g,m)=>b(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==Ke.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:De(i)}));let S=!1;const k=setTimeout(()=>{S=!0,i.stop(),m(new Tm("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(k),S)return;const E=yield this.publish(i,p,v);g(E)}else try{const S=yield this.publish(i,p,v);g(S)}catch(S){m(S)}}catch(S){m(S)}}));s.pendingPublishPromises.set(i,T);try{return yield T}catch(g){throw g}finally{s.pendingPublishPromises.delete(i)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new xn),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),De(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>wx(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),De(e))),!1)}publish(e,n,i){return b(this,void 0,void 0,function*(){var r,s,o,a,c,l,d,h,f,p;if(!this.hasPermissionsToPublish(e))throw new Tm("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(F=>ps(e)&&F.source===e.source)&&e.source!==N.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),De(e))),n.stopMicTrackOnMute&&ii(e)&&(e.stopOnMute=!0),e.source===N.Source.ScreenShare&&Pr()&&(n.simulcast=!1),n.videoCodec==="av1"&&!_x()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!Ax()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=Bu),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(F=>n.videoCodec===wo(F.mime))||(n.videoCodec=wo(this.enabledPublishVideoCodecs[0].mime)));const v=n.videoCodec;e.on(B.Muted,this.onTrackMuted),e.on(B.Unmuted,this.onTrackUnmuted),e.on(B.Ended,this.handleTrackEnded),e.on(B.UpstreamPaused,this.onTrackUpstreamPaused),e.on(B.UpstreamResumed,this.onTrackUpstreamResumed),e.on(B.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const T=[],g=!(!((r=n.dtx)!==null&&r!==void 0)||r),m=e.getSourceTrackSettings();m.autoGainControl&&T.push(_t.TF_AUTO_GAIN_CONTROL),m.echoCancellation&&T.push(_t.TF_ECHO_CANCELLATION),m.noiseSuppression&&T.push(_t.TF_NOISE_SUPPRESSION),m.channelCount&&m.channelCount>1&&T.push(_t.TF_STEREO),g&&T.push(_t.TF_NO_DTX),di(e)&&e.hasPreConnectBuffer&&T.push(_t.TF_PRECONNECT_BUFFER);const S=new Jo({cid:e.mediaStreamTrack.id,name:n.name,type:N.kindToProto(e.kind),muted:e.isMuted,source:N.sourceToProto(e.source),disableDtx:g,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:T});let k;if(e.kind===N.Kind.Video){let F={width:0,height:0};try{F=yield e.waitForDimensions()}catch{const X=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:Yo.h720.resolution;F={width:X.width,height:X.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),De(e)),{dims:F}))}S.width=F.width,S.height=F.height,Ai(e)&&(Bn(v)&&(e.source===N.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),De(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),S.simulcastCodecs=[new Tu({codec:v,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:Bu}),n.backupCodec&&v!==n.backupCodec.codec&&S.encryption===wt.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),S.simulcastCodecs.push(new Tu({codec:n.backupCodec.codec,cid:""})))),k=Vu(e.source===N.Source.ScreenShare,S.width,S.height,n),S.layers=Qm(S.width,S.height,k,Bn(n.videoCodec))}else e.kind===N.Kind.Audio&&(k=[{maxBitrate:(l=n.audioPreset)===null||l===void 0?void 0:l.maxBitrate,priority:(h=(d=n.audioPreset)===null||d===void 0?void 0:d.priority)!==null&&h!==void 0?h:"high",networkPriority:(p=(f=n.audioPreset)===null||f===void 0?void 0:f.priority)!==null&&p!==void 0?p:"high"}]);if(!this.engine||this.engine.isClosed)throw new gt("cannot publish track when not connected");const E=()=>b(this,void 0,void 0,function*(){var F,D,X;if(!this.engine.pcManager)throw new gt("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,k),this.emit(Q.LocalSenderCreated,e.sender,e),Ai(e)&&((F=n.degradationPreference)!==null&&F!==void 0||(n.degradationPreference=z1(e)),e.setDegradationPreference(n.degradationPreference)),k)if(Pr()&&e.kind===N.Kind.Audio){let ce;for(const Pe of this.engine.pcManager.publisher.getTransceivers())if(Pe.sender===e.sender){ce=Pe;break}ce&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:ce,codec:"opus",maxbr:!((D=k[0])===null||D===void 0)&&D.maxBitrate?k[0].maxBitrate/1e3:0})}else e.codec&&Bn(e.codec)&&(!((X=k[0])===null||X===void 0)&&X.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:S.cid,codec:e.codec,maxbr:k[0].maxBitrate/1e3});yield this.engine.negotiate()});let x;const I=new Promise((F,D)=>b(this,void 0,void 0,function*(){var X;try{x=yield this.engine.addTrack(S),F(x)}catch(ce){e.sender&&(!((X=this.engine.pcManager)===null||X===void 0)&&X.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(Pe=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),De(e)),{error:Pe}))})),D(ce)}}));if(this.enabledPublishVideoCodecs.length>0)x=(yield Promise.all([I,E()]))[0];else{x=yield I;let F;if(x.codecs.forEach(D=>{F===void 0&&(F=D.mimeType)}),F&&e.kind===N.Kind.Video){const D=wo(F);D!==v&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),De(e)),{codec:D})),n.videoCodec=D,k=Vu(e.source===N.Source.ScreenShare,S.width,S.height,n))}yield E()}const _=new $u(e.kind,x,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(_.on(B.CpuConstrained,F=>this.onTrackCpuConstrained(F,_)),_.options=n,e.sid=x.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:k,trackInfo:x})),Ai(e)?e.startMonitor(this.engine.client):di(e)&&e.startMonitor(),this.addTrackPublication(_),this.emit(Q.LocalTrackPublished,_),di(e)&&x.audioFeatures.includes(_t.TF_PRECONNECT_BUFFER)){const F=e.getPreConnectBuffer(),D=e.getPreConnectBufferMimeType();this.on(Q.LocalTrackSubscribed,X=>{if(X.trackSid===x.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),De(e))),e.stopPreConnectBuffer()}}),F&&new Promise((ce,Pe)=>b(this,void 0,void 0,function*(){var Qe,Rt,We,Tt,J,ue;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),De(e)));const pt=setTimeout(()=>{Pe(new Error("agent not active within 10 seconds"))},1e4),ct=yield this.waitUntilActiveAgentPresent();clearTimeout(pt),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),De(e)));const H=yield this.streamBytes({name:"preconnect-buffer",mimeType:D,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[ct.identity],attributes:{trackId:_.trackSid,sampleRate:String((J=m.sampleRate)!==null&&J!==void 0?J:"48000"),channels:String((ue=m.channelCount)!==null&&ue!==void 0?ue:"1")}});try{for(var z=!0,Le=vi(F),Ee;Ee=yield Le.next(),Qe=Ee.done,!Qe;z=!0){Tt=Ee.value,z=!1;const ye=Tt;yield H.write(ye)}}catch(ye){Rt={error:ye}}finally{try{!z&&!Qe&&(We=Le.return)&&(yield We.call(Le))}finally{if(Rt)throw Rt.error}}yield H.close(),ce()}catch(pt){Pe(pt)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),De(e)))}).catch(ce=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),De(e)),{error:ce}))})}return _})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return b(this,void 0,void 0,function*(){var r;if(this.encryptionType!==wt.NONE)return;let s;if(this.trackPublications.forEach(p=>{p.track&&p.track===e&&(s=p)}),!s)throw new yi("track is not published");if(!Ai(e))throw new yi("track is not a video track");const o=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),a=F1(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),De(e)));return}const c=e.addSimulcastTrack(n,a);if(!c)return;const l=new Jo({cid:c.mediaStreamTrack.id,type:N.kindToProto(e.kind),muted:e.isMuted,source:N.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=Qm(l.width,l.height,a),!this.engine||this.engine.isClosed)throw new gt("cannot publish track when not connected");const d=()=>b(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,o,a),yield this.engine.negotiate()}),f=(yield Promise.all([this.engine.addTrack(l),d()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:f}))})}unpublishTrack(e,n){return b(this,void 0,void 0,function*(){var i,r;if(ps(e)){const l=this.pendingPublishPromises.get(e);l&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),De(e))),yield l)}const s=this.getPublicationForTrack(e),o=s?De(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(B.Muted,this.onTrackMuted),e.off(B.Unmuted,this.onTrackUnmuted),e.off(B.Ended,this.handleTrackEnded),e.off(B.UpstreamPaused,this.onTrackUpstreamPaused),e.off(B.UpstreamResumed,this.onTrackUpstreamResumed),e.off(B.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let a=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<dt.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),Ai(e)){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(a=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:l}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case N.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case N.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(Q.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return b(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new rn((s,o)=>b(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),a.push(c))}),yield Promise.all(a.map(c=>b(this,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),r&&!l.isMuted&&l.source!==N.Source.ScreenShare&&l.source!==N.Source.ScreenShareAudio&&(di(l)||Ai(l))&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishOrRepublishTrack(l,c.options,!0)}))),s()}catch(a){a instanceof Error?o(a):o(new Error(String(a)))}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=r.reliable?Ae.RELIABLE:Ae.LOSSY,o=r.destinationIdentities,a=r.topic;let c=new Gh({participantIdentity:i.identity,payload:n,destinationIdentities:o,topic:a});const l=new qt({kind:s,value:{case:"user",value:c}});yield i.engine.sendDataPacket(l,s)}()})}publishDtmf(e,n){return b(this,void 0,void 0,function*(){const i=new qt({kind:Ae.RELIABLE,value:{case:"sipDtmf",value:new p0({code:e,digit:n})}});yield this.engine.sendDataPacket(i,Ae.RELIABLE)})}sendChatMessage(e,n){return b(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new qt({value:{case:"chatMessage",value:new Ic(Object.assign(Object.assign({},i),{timestamp:it.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,Ae.RELIABLE),this.emit(Q.ChatMessage,i),i})}editChatMessage(e,n){return b(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new qt({value:{case:"chatMessage",value:new Ic(Object.assign(Object.assign({},i),{timestamp:it.parse(i.timestamp),editTimestamp:it.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,Ae.RELIABLE),this.emit(Q.ChatMessage,i),i})}sendText(e,n){return b(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return b(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return b(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return b(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){let{destinationIdentity:n,method:i,payload:r,responseTimeout:s=15e3}=e;const o=7e3,a=o+1e3;return new rn((c,l)=>b(this,void 0,void 0,function*(){var d,h,f,p;if(mf(r)>Ek){l(ft.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((h=(d=this.engine.latestJoinResponse)===null||d===void 0?void 0:d.serverInfo)===null||h===void 0)&&h.version&&si((p=(f=this.engine.latestJoinResponse)===null||f===void 0?void 0:f.serverInfo)===null||p===void 0?void 0:p.version,"1.8.0")<0){l(ft.builtIn("UNSUPPORTED_SERVER"));return}const y=Math.max(s,a),v=crypto.randomUUID();yield this.publishRpcRequest(n,v,i,r,y);const T=setTimeout(()=>{this.pendingAcks.delete(v),l(ft.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(v),clearTimeout(g)},o);this.pendingAcks.set(v,{resolve:()=>{clearTimeout(T)},participantIdentity:n});const g=setTimeout(()=>{this.pendingResponses.delete(v),l(ft.builtIn("RESPONSE_TIMEOUT"))},s);this.pendingResponses.set(v,{resolve:(m,S)=>{clearTimeout(g),this.pendingAcks.has(v)&&(this.log.warn("RPC response received before ack",v),this.pendingAcks.delete(v),clearTimeout(T)),S?l(S):c(m??"")},participantIdentity:n})}))}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,s){return b(this,void 0,void 0,function*(){const o=new qt({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcRequest",value:new Jh({id:n,method:i,payload:r,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,Ae.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,ft.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((r=(i=s.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),De(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}setActiveAgent(e){var n,i,r,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(s=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||s===void 0||s.call(r,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new xn),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(di(r)||Ai(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return b(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(r)return r[1];yield Lt(20)}})}}class lR extends fi{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=s=>{this.setTrack(void 0),this.emit(B.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.visible=s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensionsAdaptiveStream=s,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new sl({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new g0({participantSid:"",trackSids:[this.trackSid]})]});this.emit(B.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?fi.SubscriptionStatus.Unsubscribed:super.isSubscribed?fi.SubscriptionStatus.Subscribed:fi.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?fi.PermissionStatus.Allowed:fi.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(td(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&td(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:pn.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(B.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(B.VisibilityChanged,this.handleVisibilityChange),r.off(B.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(B.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(B.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(B.VisibilityChanged,this.handleVisibilityChange),e.on(B.Ended,this.handleEnded),this.emit(B.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(B.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?B.Muted:B.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(B.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(B.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return td(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new w0({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===N.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)xm(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=xx(this.trackInfo,this.requestedMaxQuality);i&&xm(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:pn.HIGH})),e.quality=pn.HIGH)}this.emit(B.UpdateSettings,e)}}class Lc extends Ak{static fromParticipantInfo(e,n,i){return new Lc(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,s,o,a){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Go.STANDARD;super(n,i||"",r,s,o,a,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(B.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),De(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(B.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(B.SubscriptionPermissionChanged,n=>{this.emit(Q.TrackSubscriptionPermissionChanged,e,n)}),e.on(B.SubscriptionStatusChanged,n=>{this.emit(Q.TrackSubscriptionStatusChanged,e,n)}),e.on(B.Subscribed,n=>{this.emit(Q.TrackSubscribed,n,e)}),e.on(B.Unsubscribed,n=>{this.emit(Q.TrackUnsubscribed,n,e)}),e.on(B.SubscriptionFailed,n=>{this.emit(Q.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:N.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:N.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(d=>{!a&&e.kind===d.kind.toString()&&(a=d)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(Q.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),De(a))),this.emit(Q.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let l;return c?l=new nR(e,n,r,s):l=new tR(e,n,r,this.audioContext,this.audioOutput),l.source=a.source,l.isMuted=a.isMuted,l.setMediaStream(i),l.start(),a.setTrack(l),this.volumeMap.has(a.source)&&Fu(l)&&ii(l)&&l.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var s,o;let a=this.getTrackPublicationBySid(r.sid);if(a)a.updateInfo(r);else{const c=N.kindFromProto(r.type);if(!c)return;a=new lR(c,r,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(r),i.set(r.sid,a);const l=Array.from(this.trackPublications.values()).find(d=>d.source===(a==null?void 0:a.source));l&&a.source!==N.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:De(l),newTrack:De(a)})),this.addTrackPublication(a)}n.set(r.sid,a)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),De(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(Q.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case N.Kind.Audio:this.audioTrackPublications.delete(e);break;case N.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(Q.TrackUnpublished,i)}setAudioOutput(e){return b(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;ii(i.track)&&Fu(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var Ve;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(Ve||(Ve={}));const dR=4*1e3;class As extends ai.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,i,r,s,o;if(super(),n=this,this.state=Ve.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Ie,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(a,c,l)=>b(this,void 0,void 0,function*(){var d;if(!Dx())throw ri()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const h=yield this.disconnectLock.lock();if(this.state===Ve.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),h(),Promise.resolve();if(this.connectFuture)return h(),this.connectFuture.promise;this.setAndEmitConnectionState(Ve.Connecting),((d=this.regionUrlProvider)===null||d===void 0?void 0:d.getServerUrl().toString())!==Sk(a)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),_s(new URL(a))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Ue(a,c):this.regionUrlProvider.updateToken(c),this.regionUrlProvider.fetchRegionSettings().then(y=>{var v;(v=this.regionUrlProvider)===null||v===void 0||v.setServerReportedRegions(y)}).catch(y=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:y}))}));const f=(y,v,T)=>b(this,void 0,void 0,function*(){var g,m;this.abortController&&this.abortController.abort();const S=new AbortController;this.abortController=S,h==null||h();try{if(yield ms.getInstance().getBackOffPromise(a),S.signal.aborted)throw fe.cancelled("Connection attempt aborted");yield this.attemptConnection(T??a,c,l,S),this.abortController=void 0,y()}catch(k){if(this.regionUrlProvider&&k instanceof fe&&k.reason!==Ge.Cancelled&&k.reason!==Ge.NotAllowed){let E=null;try{this.log.debug("Fetching next region"),E=yield this.regionUrlProvider.getNextBestRegionUrl((g=this.abortController)===null||g===void 0?void 0:g.signal)}catch(x){if(x instanceof fe&&(x.status===401||x.reason===Ge.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),v(x);return}}[Ge.InternalError,Ge.ServerUnreachable,Ge.Timeout].includes(k.reason)&&(this.log.debug("Adding failed connection attempt to back off"),ms.getInstance().addFailedConnectionAttempt(a)),E&&!(!((m=this.abortController)===null||m===void 0)&&m.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(k.message,". Retrying with another region: ").concat(E),this.logContext),this.recreateEngine(),yield f(y,v,E)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Nm(k)),v(k))}else{let E=Vn.UNKNOWN_REASON;k instanceof fe&&(E=Nm(k)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,E),v(k)}}}),p=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new xn((y,v)=>{f(y,v,p)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(a,c,l,d,h,f)=>b(this,void 0,void 0,function*(){var p,y,v;const T=yield l.join(a,c,{autoSubscribe:d.autoSubscribe,adaptiveStream:typeof h.adaptiveStream=="object"?!0:h.adaptiveStream,maxRetries:d.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:d.websocketTimeout},f.signal,!h.singlePeerConnection);let g=T.serverInfo;if(g||(g={version:T.serverVersion,region:T.serverRegion}),this.serverInfo=g,this.log.debug("connected to Livekit Server ".concat(Object.entries(g).map(m=>{let[S,k]=m;return"".concat(S,": ").concat(k)}).join(", ")),{room:(p=T.room)===null||p===void 0?void 0:p.name,roomSid:(y=T.room)===null||y===void 0?void 0:y.sid,identity:(v=T.participant)===null||v===void 0?void 0:v.identity}),!g.version)throw new px("unknown server version");return g.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),h.dynacast=!1),T}),this.applyJoinResponse=a=>{const c=a.participant;if(this.localParticipant.sid=c.sid,this.localParticipant.identity=c.identity,this.localParticipant.setEnabledPublishCodecs(a.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(a.sifTrailer)}catch(l){this.log.error(l instanceof Error?l.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:l}))}this.handleParticipantUpdates([c,...a.otherParticipants]),a.room&&this.handleRoomUpdate(a.room)},this.attemptConnection=(a,c,l,d)=>b(this,void 0,void 0,function*(){var h,f;this.state===Ve.Reconnecting||this.isResuming||!((h=this.engine)===null||h===void 0)&&h.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((f=this.regionUrlProvider)===null||f===void 0)&&f.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},pf),l),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const p=yield this.connectSignal(a,c,this.engine,this.connOptions,this.options,d);this.applyJoinResponse(p),this.setupLocalParticipantEvents(),this.emit(U.SignalConnected)}catch(p){yield this.engine.close(),this.recreateEngine();const y=d.signal.aborted?fe.cancelled("Signal connection aborted"):fe.serverUnreachable("could not establish signal connection");throw p instanceof Error&&(y.message="".concat(y.message,": ").concat(p.message)),p instanceof fe&&(y.reason=p.reason,y.status=p.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:p})),y}if(d.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),fe.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,d)}catch(p){throw yield this.engine.close(),this.recreateEngine(),p}sn()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),sn()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Ve.Connected),this.emit(U.Connected),ms.getInstance().resetFailedConnectionAttempts(a),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return b(n,[...c],void 0,function(){var d=this;let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var f,p,y;const v=yield d.disconnectLock.lock();try{if(d.state===Ve.Disconnected){d.log.debug("already disconnected",d.logContext);return}if(d.log.info("disconnect from room",Object.assign({},d.logContext)),d.state===Ve.Connecting||d.state===Ve.Reconnecting||d.isResuming){const T="Abort connection attempt due to user initiated disconnect";d.log.warn(T,d.logContext),(f=d.abortController)===null||f===void 0||f.abort(T),(y=(p=d.connectFuture)===null||p===void 0?void 0:p.reject)===null||y===void 0||y.call(p,fe.cancelled("Client initiated disconnect")),d.connectFuture=void 0}d.engine&&(d.engine.client.isDisconnected||(yield d.engine.client.sendLeave()),yield d.engine.close()),d.handleDisconnect(h,Vn.CLIENT_INITIATED),d.engine=void 0}finally{v()}}()})},this.onPageLeave=()=>b(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>b(this,void 0,void 0,function*(){const a=[],c=ln();if(c&&c.os==="iOS"){const l="livekit-dummy-audio-el";let d=document.getElementById(l);if(!d){d=document.createElement("audio"),d.id=l,d.autoplay=!0,d.hidden=!0;const h=ed();h.enabled=!0;const f=new MediaStream([h]);d.srcObject=f,document.addEventListener("visibilitychange",()=>{d&&(d.srcObject=document.hidden?null:f,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(d),this.once(U.Disconnected,()=>{d==null||d.remove(),d=null})}a.push(d)}this.remoteParticipants.forEach(l=>{l.audioTrackPublications.forEach(d=>{d.track&&d.track.attachedElements.forEach(h=>{a.push(h)})})});try{yield Promise.all([this.acquireAudioContext(),...a.map(l=>(l.muted=!1,l.play()))]),this.handleAudioPlaybackStarted()}catch(l){throw this.handleAudioPlaybackFailed(l),l}}),this.startVideo=()=>b(this,void 0,void 0,function*(){const a=[];for(const c of this.remoteParticipants.values())c.videoTrackPublications.forEach(l=>{var d;(d=l.track)===null||d===void 0||d.attachedElements.forEach(h=>{a.includes(h)||a.push(h)})});yield Promise.all(a.map(c=>c.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(c=>{c.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const a of this.remoteParticipants.values())this.handleParticipantDisconnected(a.identity,a);this.setAndEmitConnectionState(Ve.Reconnecting)&&this.emit(U.Reconnecting)},this.handleSignalRestarted=a=>b(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(a.serverRegion),Object.assign(Object.assign({},this.logContext),{region:a.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(a);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(c){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:c}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:a.serverRegion}))}catch{return}this.setAndEmitConnectionState(Ve.Connected),this.emit(U.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=a=>{a.forEach(c=>{var l;if(c.identity===this.localParticipant.identity){this.localParticipant.updateInfo(c);return}c.identity===""&&(c.identity=(l=this.sidToIdentity.get(c.sid))!==null&&l!==void 0?l:"");let d=this.remoteParticipants.get(c.identity);c.state===ls.DISCONNECTED?this.handleParticipantDisconnected(c.identity,d):d=this.getOrCreateParticipant(c.identity,c)})},this.handleActiveSpeakersUpdate=a=>{const c=[],l={};a.forEach(d=>{if(l[d.sid]=!0,d.sid===this.localParticipant.sid)this.localParticipant.audioLevel=d.level,this.localParticipant.setIsSpeaking(!0),c.push(this.localParticipant);else{const h=this.getRemoteParticipantBySid(d.sid);h&&(h.audioLevel=d.level,h.setIsSpeaking(!0),c.push(h))}}),l[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(d=>{l[d.sid]||(d.audioLevel=0,d.setIsSpeaking(!1))}),this.activeSpeakers=c,this.emitWhenConnected(U.ActiveSpeakersChanged,c)},this.handleSpeakersChanged=a=>{const c=new Map;this.activeSpeakers.forEach(d=>{const h=this.remoteParticipants.get(d.identity);h&&h.sid!==d.sid||c.set(d.sid,d)}),a.forEach(d=>{let h=this.getRemoteParticipantBySid(d.sid);d.sid===this.localParticipant.sid&&(h=this.localParticipant),h&&(h.audioLevel=d.level,h.setIsSpeaking(d.active),d.active?c.set(d.sid,h):c.delete(d.sid))});const l=Array.from(c.values());l.sort((d,h)=>h.audioLevel-d.audioLevel),this.activeSpeakers=l,this.emitWhenConnected(U.ActiveSpeakersChanged,l)},this.handleStreamStateUpdate=a=>{a.streamStates.forEach(c=>{const l=this.getRemoteParticipantBySid(c.participantSid);if(!l)return;const d=l.getTrackPublicationBySid(c.trackSid);if(!d||!d.track)return;const h=N.streamStateFromProto(c.state);d.track.setStreamState(h),h!==d.track.streamState&&(l.emit(Q.TrackStreamStateChanged,d,d.track.streamState),this.emitWhenConnected(U.TrackStreamStateChanged,d,d.track.streamState,l))})},this.handleSubscriptionPermissionUpdate=a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);l&&l.setAllowed(a.allowed)},this.handleSubscriptionError=a=>{const c=Array.from(this.remoteParticipants.values()).find(d=>d.trackPublications.has(a.trackSid));if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);l&&l.setSubscriptionError(a.err)},this.handleDataPacket=(a,c)=>{const l=this.remoteParticipants.get(a.participantIdentity);if(a.value.case==="user")this.handleUserPacket(l,a.value.value,a.kind,c);else if(a.value.case==="transcription")this.handleTranscription(l,a.value.value);else if(a.value.case==="sipDtmf")this.handleSipDtmf(l,a.value.value);else if(a.value.case==="chatMessage")this.handleChatMessage(l,a.value.value);else if(a.value.case==="metrics")this.handleMetrics(a.value.value,l);else if(a.value.case==="streamHeader"||a.value.case==="streamChunk"||a.value.case==="streamTrailer")this.handleDataStream(a,c);else if(a.value.case==="rpcRequest"){const d=a.value.value;this.handleIncomingRpcRequest(a.participantIdentity,d.id,d.method,d.payload,d.responseTimeoutMs,d.version)}},this.handleUserPacket=(a,c,l,d)=>{this.emit(U.DataReceived,c.payload,a,l,c.topic,d),a==null||a.emit(Q.DataReceived,c.payload,l,d)},this.handleSipDtmf=(a,c)=>{this.emit(U.SipDTMFReceived,c,a),a==null||a.emit(Q.SipDTMFReceived,c)},this.handleTranscription=(a,c)=>{const l=c.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(c.transcribedParticipantIdentity),d=l==null?void 0:l.trackPublications.get(c.trackId),h=zx(c,this.transcriptionReceivedTimes);d==null||d.emit(B.TranscriptionReceived,h),l==null||l.emit(Q.TranscriptionReceived,h,d),this.emit(U.TranscriptionReceived,h,l,d)},this.handleChatMessage=(a,c)=>{const l=Vx(c);this.emit(U.ChatMessage,l,a)},this.handleMetrics=(a,c)=>{this.emit(U.MetricsReceived,a,c)},this.handleDataStream=(a,c)=>{this.incomingDataStreamManager.handleDataStreamPacket(a,c)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(U.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=a=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:a})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(U.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(U.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(U.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>b(this,void 0,void 0,function*(){var a;((a=ln())===null||a===void 0?void 0:a.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(U.MediaDevicesChanged)}),this.handleRoomUpdate=a=>{const c=this.roomInfo;this.roomInfo=a,c&&c.metadata!==a.metadata&&this.emitWhenConnected(U.RoomMetadataChanged,a.metadata),(c==null?void 0:c.activeRecording)!==a.activeRecording&&this.emitWhenConnected(U.RecordingStatusChanged,a.activeRecording)},this.handleConnectionQualityUpdate=a=>{a.updates.forEach(c=>{if(c.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(c.quality);return}const l=this.getRemoteParticipantBySid(c.participantSid);l&&l.setConnectionQuality(c.quality)})},this.onLocalParticipantMetadataChanged=a=>{this.emit(U.ParticipantMetadataChanged,a,this.localParticipant)},this.onLocalParticipantNameChanged=a=>{this.emit(U.ParticipantNameChanged,a,this.localParticipant)},this.onLocalAttributesChanged=a=>{this.emit(U.ParticipantAttributesChanged,a,this.localParticipant)},this.onLocalTrackMuted=a=>{this.emit(U.TrackMuted,a,this.localParticipant)},this.onLocalTrackUnmuted=a=>{this.emit(U.TrackUnmuted,a,this.localParticipant)},this.onTrackProcessorUpdate=a=>{var c;(c=a==null?void 0:a.onPublish)===null||c===void 0||c.call(a,this)},this.onLocalTrackPublished=a=>b(this,void 0,void 0,function*(){var c,l,d,h,f,p;(c=a.track)===null||c===void 0||c.on(B.TrackProcessorUpdate,this.onTrackProcessorUpdate),(l=a.track)===null||l===void 0||l.on(B.Restarted,this.onLocalTrackRestarted),(f=(h=(d=a.track)===null||d===void 0?void 0:d.getProcessor())===null||h===void 0?void 0:h.onPublish)===null||f===void 0||f.call(h,this),this.emit(U.LocalTrackPublished,a,this.localParticipant),di(a.track)&&(yield a.track.checkForSilence())&&this.emit(U.LocalAudioSilenceDetected,a);const y=yield(p=a.track)===null||p===void 0?void 0:p.getDeviceId(!1),v=Ou(a.source);v&&y&&y!==this.localParticipant.activeDeviceMap.get(v)&&(this.localParticipant.activeDeviceMap.set(v,y),this.emit(U.ActiveDeviceChanged,v,y))}),this.onLocalTrackUnpublished=a=>{var c,l;(c=a.track)===null||c===void 0||c.off(B.TrackProcessorUpdate,this.onTrackProcessorUpdate),(l=a.track)===null||l===void 0||l.off(B.Restarted,this.onLocalTrackRestarted),this.emit(U.LocalTrackUnpublished,a,this.localParticipant)},this.onLocalTrackRestarted=a=>b(this,void 0,void 0,function*(){const c=yield a.getDeviceId(!1),l=Ou(a.source);l&&c&&c!==this.localParticipant.activeDeviceMap.get(l)&&(this.log.debug("local track restarted, setting ".concat(l," ").concat(c," active"),this.logContext),this.localParticipant.activeDeviceMap.set(l,c),this.emit(U.ActiveDeviceChanged,l,c))}),this.onLocalConnectionQualityChanged=a=>{this.emit(U.ConnectionQualityChanged,a,this.localParticipant)},this.onMediaDevicesError=(a,c)=>{this.emit(U.MediaDevicesError,a,c)},this.onLocalParticipantPermissionsChanged=a=>{this.emit(U.ParticipantPermissionsChanged,a,this.localParticipant)},this.onLocalChatMessageSent=a=>{this.emit(U.ChatMessage,a,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},b1),e),this.log=xi((i=this.options.loggerName)!==null&&i!==void 0?i:Hn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},bk),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Ck),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},S1),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new Q1,this.outgoingDataStreamManager=new eR(this.engine,this.log),this.disconnectLock=new Kt,this.localParticipant=new cR("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Zi(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Zi(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",Zi(this.options.audioOutput.deviceId)).catch(a=>this.log.warn("Could not set audio output: ".concat(a.message),this.logContext)),sn()){const a=new AbortController;(o=(s=navigator.mediaDevices)===null||s===void 0?void 0:s.addEventListener)===null||o===void 0||o.call(s,"devicechange",this.handleDeviceChange,{signal:a.signal}),As.cleanupRegistry&&As.cleanupRegistry.register(this,()=>{a.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return b(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new i1(i,n),this.e2eeManager.on(Wi.ParticipantEncryptionStatusChanged,(r,s)=>{$x(s)&&(this.isE2EEEnabled=r),this.emit(U.ParticipantEncryptionStatusChanged,r,s)}),this.e2eeManager.on(Wi.EncryptionError,(r,s)=>{const o=s?this.getParticipantByIdentity(s):void 0;this.emit(U.EncryptionError,r,o)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return this.state===Ve.Disconnected?rn.resolve(""):this.roomInfo&&this.roomInfo.sid!==""?rn.resolve(this.roomInfo.sid):new rn((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(K.RoomUpdate,i),e(r.sid))};this.engine.on(K.RoomUpdate,i),this.once(U.Disconnected,()=>{this.engine.off(K.RoomUpdate,i),n(new gt("Room disconnected before room server id was available"))})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new K1(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(K.ParticipantUpdate,this.handleParticipantUpdates).on(K.RoomUpdate,this.handleRoomUpdate).on(K.SpeakersChanged,this.handleSpeakersChanged).on(K.StreamStateChanged,this.handleStreamStateUpdate).on(K.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(K.SubscriptionError,this.handleSubscriptionError).on(K.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(K.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(K.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(K.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(K.DataPacketReceived,this.handleDataPacket).on(K.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Ve.SignalReconnecting)&&this.emit(U.SignalReconnecting)}).on(K.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Ve.Connected)&&this.emit(U.Reconnected)}).on(K.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Ve.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(K.Restarting,this.handleRestarting).on(K.SignalRestarted,this.handleSignalRestarted).on(K.Offline,()=>{this.setAndEmitConnectionState(Ve.Reconnecting)&&this.emit(U.Reconnecting)}).on(K.DCBufferStatusChanged,(e,n)=>{this.emit(U.DCBufferStatusChanged,e,n)}).on(K.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(Q.LocalTrackSubscribed,n),this.emitWhenConnected(U.LocalTrackSubscribed,n,this.localParticipant)}).on(K.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(U.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return At.getInstance().getDevices(e,n)}prepareConnection(e,n){return b(this,void 0,void 0,function*(){if(this.state===Ve.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(_s(new URL(e))&&n){this.regionUrlProvider=new Ue(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===Ve.Disconnected&&(this.regionUrl=i,yield fetch(Xo(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(Xo(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return b(this,void 0,void 0,function*(){let i=()=>b(this,void 0,void 0,function*(){}),r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new Yn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new Yn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new Yn({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new Yn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>b(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Yn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>b(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Yn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new Yn({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>b(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new ol({reason:Vn.CLIENT_INITIATED,action:ds.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new Yn({scenario:{case:"subscriberBandwidth",value:gr(n)}});break;case"leave-full-reconnect":r=new Yn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return b(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,c,l,d,h,f,p;let y=!0,v=!1;const T=o?{exact:r}:r;if(i==="audioinput"){v=s.localParticipant.audioTrackPublications.size===0;const g=(a=s.getActiveDevice(i))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=T;const m=Array.from(s.localParticipant.audioTrackPublications.values()).filter(k=>k.source===N.Source.Microphone);try{y=(yield Promise.all(m.map(k=>{var E;return(E=k.audioTrack)===null||E===void 0?void 0:E.setDeviceId(T)}))).every(k=>k===!0)}catch(k){throw s.options.audioCaptureDefaults.deviceId=g,k}const S=m.some(k=>{var E,x;return(x=(E=k.track)===null||E===void 0?void 0:E.isMuted)!==null&&x!==void 0?x:!1});y&&S&&(v=!0)}else if(i==="videoinput"){v=s.localParticipant.videoTrackPublications.size===0;const g=(c=s.getActiveDevice(i))!==null&&c!==void 0?c:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=T;const m=Array.from(s.localParticipant.videoTrackPublications.values()).filter(k=>k.source===N.Source.Camera);try{y=(yield Promise.all(m.map(k=>{var E;return(E=k.videoTrack)===null||E===void 0?void 0:E.setDeviceId(T)}))).every(k=>k===!0)}catch(k){throw s.options.videoCaptureDefaults.deviceId=g,k}const S=m.some(k=>{var E,x;return(x=(E=k.track)===null||E===void 0?void 0:E.isMuted)!==null&&x!==void 0?x:!1});y&&S&&(v=!0)}else if(i==="audiooutput"){if(v=!0,!ju()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");s.options.webAudioMix&&(r=(l=yield At.getInstance().normalizeDeviceId("audiooutput",r))!==null&&l!==void 0?l:""),(d=(p=s.options).audioOutput)!==null&&d!==void 0||(p.audioOutput={});const g=(h=s.getActiveDevice(i))!==null&&h!==void 0?h:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=r;try{s.options.webAudioMix&&((f=s.audioContext)===null||f===void 0||f.setSinkId(r)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(m=>m.setAudioOutput({deviceId:r})))}catch(m){throw s.options.audioOutput.deviceId=g,m}}return v&&(s.localParticipant.activeDeviceMap.set(i,r),s.emit(U.ActiveDeviceChanged,i,r)),y}()})}setupLocalParticipantEvents(){this.localParticipant.on(Q.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(Q.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(Q.AttributesChanged,this.onLocalAttributesChanged).on(Q.TrackMuted,this.onLocalTrackMuted).on(Q.TrackUnmuted,this.onLocalTrackUnmuted).on(Q.LocalTrackPublished,this.onLocalTrackPublished).on(Q.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(Q.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(Q.MediaDevicesError,this.onMediaDevicesError).on(Q.AudioStreamAcquired,this.startAudio).on(Q.ChatMessage,this.onLocalChatMessageSent).on(Q.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===Ve.Connecting||this.state===Ve.Reconnecting){const h=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(p=>p.id)}),this.onTrackAdded(e,n,i),f()},f=()=>{this.off(U.Reconnected,h),this.off(U.Connected,h),this.off(U.Disconnected,f)};this.once(U.Reconnected,h),this.once(U.Connected,h),this.once(U.Disconnected,f);return}if(this.state===Ve.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=Px(n.id),s=r[0];let o=r[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(h=>h.sid===s);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}if(!a.startsWith("TR")){const h=this.engine.getTrackIdForReceiver(i);if(!h){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(s),this.logContext);return}a=h}a.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(s,", streamId: ").concat(o,", trackId: ").concat(a),Object.assign(Object.assign({},this.logContext),{rpID:s,streamId:o,trackId:a}));let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={});const d=c.addSubscribedMediaTrack(e,a,n,i,l);d!=null&&d.isEncrypted&&!this.e2eeManager&&this.emit(U.EncryptionError,new Error("Encrypted ".concat(d.source," track received from participant ").concat(c.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i,r;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==Ve.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(s=>{s.trackPublications.forEach(o=>{s.unpublishTrack(o.trackSid)})}),this.localParticipant.trackPublications.forEach(s=>{var o,a,c;s.track&&this.localParticipant.unpublishTrack(s.track,e),e?((o=s.track)===null||o===void 0||o.detach(),(a=s.track)===null||a===void 0||a.stop()):(c=s.track)===null||c===void 0||c.stopMonitor()}),this.localParticipant.off(Q.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(Q.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(Q.AttributesChanged,this.onLocalAttributesChanged).off(Q.TrackMuted,this.onLocalTrackMuted).off(Q.TrackUnmuted,this.onLocalTrackUnmuted).off(Q.LocalTrackPublished,this.onLocalTrackPublished).off(Q.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(Q.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(Q.MediaDevicesError,this.onMediaDevicesError).off(Q.AudioStreamAcquired,this.startAudio).off(Q.ChatMessage,this.onLocalChatMessageSent).off(Q.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),sn()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(r=(i=navigator.mediaDevices)===null||i===void 0?void 0:i.removeEventListener)===null||r===void 0||r.call(i,"devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Ve.Disconnected),this.emit(U.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(U.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,r,s,o){return b(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,ft.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(e,n,null,ft.builtIn("UNSUPPORTED_METHOD"));return}let c=null,l=null;try{const d=yield a({requestId:n,callerIdentity:e,payload:r,responseTimeout:s});mf(d)>Ek?(c=ft.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):l=d}catch(d){d instanceof ft?c=d:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),d),c=ft.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,l,c)})}selectDefaultDevices(){return b(this,void 0,void 0,function*(){var e,n,i;const r=At.getInstance().previousDevices,s=yield At.getInstance().getDevices(void 0,!1),o=ln();if((o==null?void 0:o.name)==="Chrome"&&o.os!=="iOS")for(let c of s){const l=r.find(d=>d.deviceId===c.deviceId);l&&l.label!==""&&l.kind===c.kind&&l.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(U.ActiveDeviceChanged,c.kind,c.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let c of a){const l=Sx(c),d=this.localParticipant.getTrackPublication(l);if(d&&(!((e=d.track)===null||e===void 0)&&e.isUserProvided))continue;const h=s.filter(p=>p.kind===c),f=this.getActiveDevice(c);if(f===((n=r.filter(p=>p.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&h.length>0&&((i=h[0])===null||i===void 0?void 0:i.deviceId)!==f){yield this.switchActiveDevice(c,h[0].deviceId);continue}c==="audioinput"&&!Qo()||c==="videoinput"||h.length>0&&!h.find(p=>p.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!Qo())&&(yield this.switchActiveDevice(c,h[0].deviceId))}})}acquireAudioContext(){return b(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=mk())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Lt(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(U.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Lc.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Lc(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(U.ParticipantConnected,i),i.on(Q.TrackPublished,r=>{this.emitWhenConnected(U.TrackPublished,r,i)}).on(Q.TrackSubscribed,(r,s)=>{r.kind===N.Kind.Audio?(r.on(B.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(B.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===N.Kind.Video&&(r.on(B.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(B.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(U.TrackSubscribed,r,s,i)}).on(Q.TrackUnpublished,r=>{this.emit(U.TrackUnpublished,r,i)}).on(Q.TrackUnsubscribed,(r,s)=>{this.emit(U.TrackUnsubscribed,r,s,i)}).on(Q.TrackMuted,r=>{this.emitWhenConnected(U.TrackMuted,r,i)}).on(Q.TrackUnmuted,r=>{this.emitWhenConnected(U.TrackUnmuted,r,i)}).on(Q.ParticipantMetadataChanged,r=>{this.emitWhenConnected(U.ParticipantMetadataChanged,r,i)}).on(Q.ParticipantNameChanged,r=>{this.emitWhenConnected(U.ParticipantNameChanged,r,i)}).on(Q.AttributesChanged,r=>{this.emitWhenConnected(U.ParticipantAttributesChanged,r,i)}).on(Q.ConnectionQualityChanged,r=>{this.emitWhenConnected(U.ConnectionQualityChanged,r,i)}).on(Q.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(U.ParticipantPermissionsChanged,r,i)}).on(Q.TrackSubscriptionStatusChanged,(r,s)=>{this.emitWhenConnected(U.TrackSubscriptionStatusChanged,r,s,i)}).on(Q.TrackSubscriptionFailed,(r,s)=>{this.emit(U.TrackSubscriptionFailed,r,i,s)}).on(Q.TrackSubscriptionPermissionChanged,(r,s)=>{this.emitWhenConnected(U.TrackSubscriptionPermissionChanged,r,s,i)}).on(Q.Active,()=>{this.emitWhenConnected(U.ParticipantActive,i),i.kind===Go.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&Wx(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Ot.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Vn.STATE_MISMATCH))):e=0},dR)}clearConnectionReconcile(){this.connectionReconcileInterval&&Ot.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(U.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===Ve.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===Ve.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return b(this,void 0,void 0,function*(){var n,i,r,s;const o=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),a=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new nl({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:it.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Ir({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(U.SignalConnected),this.emit(U.Connected),this.setAndEmitConnectionState(Ve.Connected),o.video){const c=new $u(N.Kind.Video,new Zr({source:St.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Fn.AUDIO,name:"video-dummy"}),new Oc(o.useRealTracks&&(!((n=window.navigator.mediaDevices)===null||n===void 0)&&n.getUserMedia)?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Dm(160*((i=a.aspectRatios[0])!==null&&i!==void 0?i:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(c),this.localParticipant.emit(Q.LocalTrackPublished,c)}if(o.audio){const c=new $u(N.Kind.Audio,new Zr({source:St.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Fn.AUDIO}),new Nc(o.useRealTracks&&(!((r=navigator.mediaDevices)===null||r===void 0)&&r.getUserMedia)?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:ed(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(c),this.localParticipant.emit(Q.LocalTrackPublished,c)}for(let c=0;c<a.count-1;c+=1){let l=new Ir({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(c),state:ls.ACTIVE,tracks:[],joinedAt:it.parse(Date.now())});const d=this.getOrCreateParticipant(l.identity,l);if(a.video){const h=Dm(160*((s=a.aspectRatios[c%a.aspectRatios.length])!==null&&s!==void 0?s:1),160,!1,!0),f=new Zr({source:St.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Fn.AUDIO});d.addSubscribedMediaTrack(h,f.sid,new MediaStream([h]),new RTCRtpReceiver),l.tracks=[...l.tracks,f]}if(a.audio){const h=ed(),f=new Zr({source:St.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Fn.AUDIO});d.addSubscribedMediaTrack(h,f.sid,new MediaStream([h]),new RTCRtpReceiver),l.tracks=[...l.tracks,f]}d.updateInfo(l)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==U.ActiveSpeakersChanged&&e!==U.TranscriptionReceived){const s=Dk(i).filter(o=>o!==void 0);(e===U.TrackSubscribed||e===U.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...i)}}As.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function Dk(t){return t.map(e=>{if(e)return Array.isArray(e)?Dk(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Mn;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Mn||(Mn={}));class ur extends ai.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Mn.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new As(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return b(this,void 0,void 0,function*(){if(this.status!==Mn.IDLE)throw Error("check is running already");this.setStatus(Mn.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Mn.SKIPPED&&this.setStatus(this.isSuccess()?Mn.SUCCESS:Mn.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return b(this,void 0,void 0,function*(){return this.room.state===Ve.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return b(this,void 0,void 0,function*(){this.room&&this.room.state!==Ve.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Mn.SKIPPED)}switchProtocol(e){return b(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(U.Reconnecting,()=>{n=!0}),this.room.once(U.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield Lt(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class uR extends ur{get description(){return"Cloud regions"}perform(){return b(this,void 0,void 0,function*(){const e=new Ue(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(i.has(o))continue;i.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return b(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,c=1e6/o,l="A".repeat(o),d=Date.now();for(let y=0;y<c;y++)yield s.write(l);yield s.close();const h=Date.now(),f=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),p={region:r,rtt:1e4,duration:h-d};return f==null||f.forEach(y=>{y.type==="candidate-pair"&&y.nominated&&(p.rtt=y.currentRoundTripTime*1e3)}),yield this.disconnect(),p})}}const ld=1e4;class hR extends ur{get description(){return"Connection via UDP vs TCP"}perform(){return b(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(ld/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(ld/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return b(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const s=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],l=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,d={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},h=setInterval(()=>b(this,void 0,void 0,function*(){const f=yield l.getRTCStatsReport();f==null||f.forEach(p=>{p.type==="outbound-rtp"?(d.packetsSent=p.packetsSent,d.qualityLimitationDurations=p.qualityLimitationDurations,d.bitrateTotal+=p.targetBitrate,d.count++):p.type==="remote-inbound-rtp"&&(d.packetsLost=p.packetsLost,d.rttTotal+=p.roundTripTime,d.jitterTotal+=p.jitter)})}),1e3);return yield new Promise(f=>setTimeout(f,ld)),clearInterval(h),a.stop(),n.remove(),yield this.disconnect(),d})}}class fR extends ur{get description(){return"Can publish audio"}perform(){return b(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield sR();if(yield pk(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class pR extends ur{get description(){return"Can publish video"}perform(){return b(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield rR();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return b(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var s,o,a,c;const l=document.createElement("canvas"),d=e.getSettings(),h=(o=(s=d.width)!==null&&s!==void 0?s:i.videoWidth)!==null&&o!==void 0?o:1280,f=(c=(a=d.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&c!==void 0?c:720;l.width=h,l.height=f;const p=l.getContext("2d");p.drawImage(i,0,0);const v=p.getImageData(0,0,l.width,l.height).data;let T=!0;for(let g=0;g<v.length;g+=4)if(v[g]!==0||v[g+1]!==0||v[g+2]!==0){T=!1;break}T?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class mR extends ur{get description(){return"Resuming connection after interruption"}perform(){return b(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,s;const o=new Promise(l=>{setTimeout(l,5e3),s=l}),a=()=>{i=!0};n.on(U.SignalReconnecting,a).on(U.Reconnecting,a).on(U.Reconnected,()=>{r=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield o,i){if(!r||n.state!==Ve.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class gR extends ur{get description(){return"Can connect via TURN"}perform(){return b(this,void 0,void 0,function*(){var e,n,i;_s(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new Ue(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const r=new df,s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0);let o=!1,a=!1,c=!1;for(let l of s.iceServers)for(let d of l.urls)d.startsWith("turn:")?(a=!0,c=!0):d.startsWith("turns:")&&(a=!0,c=!0,o=!0),d.startsWith("stun:")&&(c=!0);c?a&&!o&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((i=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||i===void 0)&&i.iceServers||a?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(l=>setTimeout(l,0)))})}}class vR extends ur{get description(){return"Establishing WebRTC connection"}perform(){return b(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(U.SignalConnected,()=>{var i;const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(s,o)=>{if(s.candidate){const a=new RTCIceCandidate(s);let c="".concat(a.protocol," ").concat(a.address,":").concat(a.port," ").concat(a.type);a.address&&(yR(a.address)?c+=" (private)":a.protocol==="tcp"&&a.tcpType==="passive"?(e=!0,c+=" (passive)"):a.protocol==="udp"&&(n=!0)),this.appendMessage(c)}r&&r(s,o)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=s=>{s instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(s.errorCode," ").concat(s.errorText," ").concat(s.url))})});try{yield this.connect(),Ie.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function yR(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class kR extends ur{get description(){return"Connecting to signal connection via WebSocket"}perform(){return b(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new df,s;try{s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0)}catch(o){if(_s(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(o.message,". Retrying with region fallback"));const c=yield new Ue(this.url,this.token).getNextBestRegionUrl();c&&(s=yield r.join(c,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}s?(this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===y0.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=s.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield r.close()})}}class XR extends ai.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Mn.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Mn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return b(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=o=>{this.updateCheck(n,o)};i.on("update",r);const s=yield i.run();return i.off("update",r),s})}checkWebsocket(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(kR)})}checkWebRTC(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(vR)})}checkTURN(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(gR)})}checkReconnect(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(mR)})}checkPublishAudio(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(fR)})}checkPublishVideo(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(pR)})}checkConnectionProtocol(){return b(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(hR);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(uR)})}}function Ne(t,e,n){return(e=bR(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function SR(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function bR(t){var e=SR(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class Yt extends Error{constructor(e,n){var i;super(e,n),Ne(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}Ne(Yt,"code","ERR_JOSE_GENERIC");class CR extends Yt{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),Ne(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),Ne(this,"claim",void 0),Ne(this,"reason",void 0),Ne(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}Ne(CR,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class TR extends Yt{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),Ne(this,"code","ERR_JWT_EXPIRED"),Ne(this,"claim",void 0),Ne(this,"reason",void 0),Ne(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}Ne(TR,"code","ERR_JWT_EXPIRED");class ER extends Yt{constructor(){super(...arguments),Ne(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}Ne(ER,"code","ERR_JOSE_ALG_NOT_ALLOWED");class wR extends Yt{constructor(){super(...arguments),Ne(this,"code","ERR_JOSE_NOT_SUPPORTED")}}Ne(wR,"code","ERR_JOSE_NOT_SUPPORTED");class xR extends Yt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ne(this,"code","ERR_JWE_DECRYPTION_FAILED")}}Ne(xR,"code","ERR_JWE_DECRYPTION_FAILED");class RR extends Yt{constructor(){super(...arguments),Ne(this,"code","ERR_JWE_INVALID")}}Ne(RR,"code","ERR_JWE_INVALID");class IR extends Yt{constructor(){super(...arguments),Ne(this,"code","ERR_JWS_INVALID")}}Ne(IR,"code","ERR_JWS_INVALID");class PR extends Yt{constructor(){super(...arguments),Ne(this,"code","ERR_JWT_INVALID")}}Ne(PR,"code","ERR_JWT_INVALID");class _R extends Yt{constructor(){super(...arguments),Ne(this,"code","ERR_JWK_INVALID")}}Ne(_R,"code","ERR_JWK_INVALID");class AR extends Yt{constructor(){super(...arguments),Ne(this,"code","ERR_JWKS_INVALID")}}Ne(AR,"code","ERR_JWKS_INVALID");class DR extends Yt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ne(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}Ne(DR,"code","ERR_JWKS_NO_MATCHING_KEY");class NR extends Yt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ne(this,Symbol.asyncIterator,void 0),Ne(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}Ne(NR,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class OR extends Yt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ne(this,"code","ERR_JWKS_TIMEOUT")}}Ne(OR,"code","ERR_JWKS_TIMEOUT");class LR extends Yt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ne(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}Ne(LR,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");const MR="http://localhost:3002/token",jR="wss://qhire-ai-interivew-xygij6p0.livekit.cloud";function FR({userName:t,roomName:e="intent-platform",onTranscript:n}){var p;const[i,r]=w.useState(null),[s,o]=w.useState(!1),[a,c]=w.useState([]),l=w.useRef(null),d=w.useRef(null),h=async()=>{try{const y=await fetch(`${MR}?name=${t}&room=${e}`);if(!y.ok)throw new Error(`Token service returned ${y.status}: ${y.statusText}`);const v=y.headers.get("content-type");if(!v||!v.includes("application/json")){const k=await y.text();throw new Error(`Token service returned non-JSON response. Is the video service running? Response: ${k.substring(0,100)}`)}const{token:T,url:g}=await y.json();if(!T)throw new Error("No token received from video service");const m=new As({adaptiveStream:!0,dynacast:!0});await m.connect(g||jR,T),r(m),o(!0),(await oa({audio:!0,video:!0})).forEach(k=>{if(m.localParticipant.publishTrack(k),k.kind==="video"&&l.current){const E=k.attach();l.current.appendChild(E)}}),m.on("trackSubscribed",(k,E,x)=>{if(k.kind==="video"&&d.current){const I=k.attach();d.current.appendChild(I)}c(Array.from(m.remoteParticipants.values()))}),m.on("participantConnected",()=>{c(Array.from(m.remoteParticipants.values()))}),m.on("participantDisconnected",()=>{c(Array.from(m.remoteParticipants.values()))})}catch(y){console.error("[Video Call] Failed to join room:",y),alert("Failed to start video call. Please check your connection.")}},f=async()=>{i&&(i.disconnect(),r(null),o(!1),c([]),l.current&&(l.current.innerHTML=""),d.current&&(d.current.innerHTML=""))};return w.useEffect(()=>()=>{i&&i.disconnect()},[i]),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:s?u.jsxs("div",{children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[u.jsxs("div",{className:"small",children:[u.jsx("b",{children:"Connected:"})," ",a.length+1," participant",a.length!==0?"s":""]}),u.jsx("button",{className:"btn",onClick:f,style:{background:"rgba(239,68,68,0.2)",color:"var(--bad)"},children:"End Call"})]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:a.length>0?"1fr 1fr":"1fr",gap:12},children:[u.jsxs("div",{style:{position:"relative",borderRadius:8,overflow:"hidden",background:"rgba(0,0,0,0.3)",minHeight:200},children:[u.jsx("div",{ref:l,style:{width:"100%",height:"100%"}}),u.jsxs("div",{style:{position:"absolute",bottom:8,left:8,padding:"4px 8px",background:"rgba(0,0,0,0.6)",borderRadius:4,fontSize:11},children:["You (",t,")"]})]}),a.length>0&&u.jsxs("div",{style:{position:"relative",borderRadius:8,overflow:"hidden",background:"rgba(0,0,0,0.3)",minHeight:200},children:[u.jsx("div",{ref:d,style:{width:"100%",height:"100%"}}),u.jsx("div",{style:{position:"absolute",bottom:8,left:8,padding:"4px 8px",background:"rgba(0,0,0,0.6)",borderRadius:4,fontSize:11},children:((p=a[0])==null?void 0:p.identity)||"Participant"})]})]})]}):u.jsxs("div",{style:{textAlign:"center",padding:20},children:[u.jsx("div",{style:{fontSize:48,marginBottom:12},children:""}),u.jsxs("div",{className:"small",style:{marginBottom:16},children:["Start a video call with ",e==="agent"?"Agent":"Buyer"]}),u.jsx("button",{className:"btn primary",onClick:h,children:"Start Video Call"})]})})}function UR({onTranscript:t,disabled:e=!1}){const[n,i]=w.useState(!1),[r,s]=w.useState(""),o=w.useRef(null);w.useRef(null),w.useRef(null),w.useEffect(()=>{const d=window.SpeechRecognition||window.webkitSpeechRecognition;if(!d){console.warn("[Speech-to-Text] Browser does not support Speech Recognition API");return}const h=new d;return h.continuous=!0,h.interimResults=!0,h.lang="en-US",h.onresult=f=>{let p="",y="";for(let v=f.resultIndex;v<f.results.length;v++){const T=f.results[v][0].transcript;f.results[v].isFinal?y+=T+" ":p+=T}y?(s(y.trim()),t&&t(y.trim())):s(p)},h.onerror=f=>{switch(console.error("[Speech-to-Text] Error:",f.error),f.error){case"no-speech":n&&(h.stop(),setTimeout(()=>{if(n&&o.current)try{o.current.start()}catch(p){console.warn("[Speech-to-Text] Failed to restart after no-speech:",p)}},1e3));break;case"aborted":console.log("[Speech-to-Text] Recognition aborted (this is normal when stopping)"),i(!1);break;case"not-allowed":alert("Microphone permission denied. Please enable microphone access in your browser settings."),i(!1);break;case"network":console.warn("[Speech-to-Text] Network error - speech recognition may be unavailable"),i(!1);break;case"audio-capture":alert("No microphone found. Please connect a microphone and try again."),i(!1);break;case"service-not-allowed":alert("Speech recognition service is not available. Please try again later."),i(!1);break;default:console.warn("[Speech-to-Text] Unhandled error:",f.error),i(!1)}},h.onend=()=>{n&&o.current&&setTimeout(()=>{if(n&&o.current)try{o.current.start()}catch(f){f.name!=="InvalidStateError"&&console.warn("[Speech-to-Text] Failed to restart:",f),i(!1)}},100)},o.current=h,()=>{h&&h.stop()}},[t,n]);const a=async()=>{if(!n&&o.current&&!n)try{if(o.current.state==="running"){console.log("[Speech-to-Text] Recognition already running");return}o.current.start(),i(!0),s(""),console.log("[Speech-to-Text] Started listening")}catch(d){console.error("[Speech-to-Text] Failed to start:",d),d.name==="InvalidStateError"?(console.log("[Speech-to-Text] Recognition in invalid state, resetting..."),i(!1),setTimeout(()=>{if(o.current)try{o.current.start(),i(!0)}catch(h){console.error("[Speech-to-Text] Retry failed:",h)}},500)):(alert("Failed to start speech recognition. Please check microphone permissions."),i(!1))}},c=()=>{if(i(!1),o.current)try{o.current.stop()}catch{console.log("[Speech-to-Text] Recognition already stopped")}},l=()=>{n?c():a()};return u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[u.jsx("button",{className:"btn",onClick:l,disabled:e,style:{padding:"12px 16px",borderRadius:12,minWidth:50,background:n?"rgba(239,68,68,0.2)":"rgba(0,0,0,0.2)",border:n?"1px solid var(--bad)":"1px solid var(--stroke)",animation:n?"pulse 1.5s infinite":"none"},title:n?"Stop listening":"Start voice input",children:n?"":""}),n&&u.jsx("div",{className:"small",style:{color:"var(--bad)",fontSize:11},children:"Listening..."}),r&&!n&&u.jsxs("div",{className:"small",style:{fontSize:11,opacity:.7},children:['"',r,'"']})]})}function BR(){var n,i,r;if(!xe||!xe.tokenParsed)return[];const t=[];(n=xe.tokenParsed.realm_access)!=null&&n.roles&&t.push(...xe.tokenParsed.realm_access.roles);const e=xe.clientId;return(r=(i=xe.tokenParsed.resource_access)==null?void 0:i[e])!=null&&r.roles&&t.push(...xe.tokenParsed.resource_access[e].roles),xe.tokenParsed.roles&&t.push(...xe.tokenParsed.roles),[...new Set(t)]}function Nk(){const t=BR();return t.some(e=>e.toLowerCase().includes("admin")||e.toLowerCase().includes("practitioner"))?"admin":t.some(e=>e.toLowerCase().includes("agent"))?"agent":(t.some(e=>e.toLowerCase().includes("buyer")),"buyer")}function zR(){const t=Nk(),e=[{key:"buyer",label:"Buyer",icon:""},{key:"agent",label:"Agent",icon:""},{key:"lender",label:"Lender",icon:""},{key:"property",label:"Property",icon:""},{key:"legal",label:"Legal",icon:""}];return t==="admin"?e:t==="agent"?e.filter(n=>["agent","property","legal"].includes(n.key)):t==="buyer"?e.filter(n=>["buyer","agent","property"].includes(n.key)):e.filter(n=>n.key==="buyer")}const VR=[{key:"buyer",label:"Buyer",icon:""},{key:"agent",label:"Agent",icon:""},{key:"lender",label:"Lender",icon:""},{key:"property",label:"Property",icon:""},{key:"legal",label:"Legal",icon:""}];function WR({result:t,compliance:e,decisions:n,actions:i,evidenceList:r,ragResponse:s,explainabilityResult:o,onAnalyze:a,onDecisionSelect:c,onActionOutcome:l,onVoiceClick:d,onDecisionChangeClick:h,onChatMessage:f,onAddChatMessage:p,input:y,setInput:v,loading:T,error:g}){var ct,H,ye,kt,mt,js,_e,Fs;const[m,S]=w.useState("buyer"),[k,E]=w.useState([]),[x,I]=w.useState(""),[_,F]=w.useState([]),[D,X]=w.useState(!1),[ce,Pe]=w.useState(null),[Qe,Rt]=w.useState(!1),We=w.useMemo(()=>zR(),[]),Tt=w.useMemo(()=>Nk(),[]);w.useEffect(()=>{We.length>0&&!We.some(C=>C.key===m)&&S(We[0].key)},[We]),w.useEffect(()=>{p&&(p.current=C=>{E(P=>[...P,{userId:"system",text:C.text||C,type:C.type||"system",timestamp:new Date().toLocaleString(),...C}])})},[p]);const J=()=>{if(!x.trim()||T)return;const C=x.trim();I("");const P={userId:"user",text:C,timestamp:new Date().toLocaleString()};E(W=>[...W,P]),f&&f(C)},ue=C=>{C&&C.trim()&&I(C)},z=w.useMemo(()=>VR.find(C=>C.key===m),[m]),Le=(C,P)=>{if(!P)return null;const W=(C.type||"").toUpperCase(),be=C.confidence?(C.confidence*100).toFixed(0):null,ve=be?`(${be}%)`:"";if(W.includes("AGENT")){const ke=P.name||P.label||"N/A",Je=P.experience?`${P.experience} years experience`:"",Ce=ve?`${ve} ${ke}`:ke;return Je?`${Ce} (${Je})`:Ce}else if(W.includes("PROPERTY")){const ke=[];return P.type&&ke.push(P.type),P.price&&ke.push(`${(P.price/1e5).toFixed(0)}Lakhs`),(P.location||P.address)&&ke.push(P.location||P.address),ke.join(", ")||P.label||"N/A"}else if(W.includes("LENDER")||W.includes("BANK")){const ke=[];if((P.name||P.label)&&ke.push(P.name||P.label),P.interestRate&&ke.push(`Interest: ${P.interestRate}%`),P.ltv&&ke.push(`LTV: ${P.ltv}%`),P.loanAmount||P.loanUpto){const Je=P.loanAmount||P.loanUpto;ke.push(`Loan upto: ${(Je/1e5).toFixed(0)}L`)}return ke.join(", ")||"N/A"}else if(W.includes("DOWN_PAYMENT")||W.includes("DOWNPAYMENT")){const ke=[];if(P.percentage&&ke.push(`${P.percentage}% down payment`),P.amount){const Je=(P.amount/1e5).toFixed(0);ke.push(`like ${Je} lakhs payment`)}return ke.join(" ")||P.label||"N/A"}return P.label||P.id||"N/A"},Ee=w.useMemo(()=>n.map(P=>{var lt,et,Me,tt,dn;const W=((lt=P.options)==null?void 0:lt.find(li=>li.id===P.recommendedOptionId))||((et=P.options)==null?void 0:et.find(li=>li.recommended===!0))||((Me=P.options)==null?void 0:Me[0]),be=P.selectedOptionId?(tt=P.options)==null?void 0:tt.find(li=>li.id===P.selectedOptionId):null,ve=P.evolutionState==="CONFIRMED",ke=ve?be:W,Je={...P,confidence:P.confidence||0,type:P.type},Ce=Le(Je,ke);return{decisionId:P.decisionId||P.id,type:(dn=P.type)==null?void 0:dn.replace(/_/g," "),isConfirmed:ve,confidence:(P.confidence||0)*100,reasoning:P.recommendation||P.reasoning||"Based on analysis of available data",option:ke,recommendedOption:W,selectedOption:be,details:Ce,decidedBy:P.decidedBy||null,decisionMethod:P.decisionMethod||null,decisionTimestamp:P.decisionTimestamp||null,originalDecision:P}}).sort((P,W)=>{var ke,Je;const be=Gp[(ke=P.originalDecision)==null?void 0:ke.type]||999,ve=Gp[(Je=W.originalDecision)==null?void 0:Je.type]||999;return be-ve}),[n]),pt=w.useMemo(()=>{const C=new Map;return i.forEach(P=>{const W=P.actionId||P.id||`${P.description}-${P.order}`,be=P.outcome==="COMPLETED"||P.outcome==="CONFIRMED";if(C.has(W)){const ve=C.get(W),ke=ve.outcome==="COMPLETED"||ve.outcome==="CONFIRMED";if(be&&!ke)C.set(W,P);else if(be&&ke){const Je=P.updatedAt||P.timestamp||0,Ce=ve.updatedAt||ve.timestamp||0;Je>Ce&&C.set(W,P)}else if(!be&&!ke){const Je=P.order||P.sequence||0,Ce=ve.order||ve.sequence||0;Je>Ce&&C.set(W,P)}}else C.set(W,P)}),Array.from(C.values()).filter(P=>!0).sort((P,W)=>{const be=P.order||P.sequence||999,ve=W.order||W.sequence||999;return be-ve})},[i]);return u.jsxs("div",{className:"container",children:[u.jsxs("div",{className:"topbar",children:[u.jsxs("div",{children:[u.jsx("div",{className:"h1",children:"Intent AI Platform  Real Estate"}),u.jsx("div",{className:"sub",children:"Living Space UI  All Engines Connected  Email Automation"})]}),u.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[u.jsx("button",{className:"btn",onClick:()=>window.location.reload(),children:"Refresh"}),u.jsxs("span",{className:"pill",children:["Status: ",u.jsx("b",{children:T?"Processing":t?"Active":"Ready"})]})]})]}),u.jsxs("div",{className:"grid",style:{height:"calc(100vh - 140px)",maxHeight:"900px"},children:[u.jsxs("div",{className:"card",style:{overflowY:"auto",overflowX:"hidden"},children:[u.jsx("div",{className:"title",style:{fontSize:t?13:16},children:"Sessions"}),u.jsx("div",{className:"small",style:{fontSize:t?10:12},children:"Switch between different session types"}),u.jsxs("div",{style:{marginTop:8,marginBottom:8,padding:"6px 10px",background:"rgba(59,130,246,0.2)",borderRadius:6,fontSize:11},children:[u.jsx("b",{children:"Role:"})," ",Tt.toUpperCase()]}),t&&u.jsxs("div",{style:{marginTop:12,marginBottom:12,paddingTop:12,borderTop:"1px solid var(--stroke)"},children:[u.jsx("div",{className:"title",style:{fontSize:12,marginBottom:8},children:"Participants"}),u.jsx("div",{className:"small",style:{fontSize:10,marginBottom:6},children:"Active users in this intent"}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"6px 8px",background:"rgba(0,0,0,0.1)",borderRadius:6},children:[u.jsx("span",{style:{fontSize:14},children:""}),u.jsxs("div",{style:{flex:1},children:[u.jsx("div",{style:{fontSize:11,fontWeight:"bold"},children:"Buyer"}),u.jsx("div",{className:"small",style:{fontSize:9,opacity:.7},children:((ct=xe.tokenParsed)==null?void 0:ct.name)||((H=xe.tokenParsed)==null?void 0:H.preferred_username)||"You"})]}),u.jsx("span",{className:"pill",style:{fontSize:9,background:"rgba(34,197,94,0.2)",color:"var(--good)"},children:"ONLINE"})]}),n.some(C=>C.type==="SELECT_AGENT"&&C.evolutionState==="CONFIRMED")&&u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"6px 8px",background:"rgba(0,0,0,0.1)",borderRadius:6},children:[u.jsx("span",{style:{fontSize:14},children:""}),u.jsxs("div",{style:{flex:1},children:[u.jsx("div",{style:{fontSize:11,fontWeight:"bold"},children:"Agent"}),u.jsx("div",{className:"small",style:{fontSize:9,opacity:.7},children:(()=>{var W;const C=n.find(be=>be.type==="SELECT_AGENT"&&be.evolutionState==="CONFIRMED"),P=(W=C==null?void 0:C.options)==null?void 0:W.find(be=>be.id===C.selectedOptionId);return(P==null?void 0:P.label)||(P==null?void 0:P.name)||"Selected Agent"})()})]}),u.jsx("span",{className:"pill",style:{fontSize:9,background:"rgba(251,191,36,0.2)",color:"var(--warn)"},children:"PENDING"})]}),n.some(C=>C.type==="SELECT_LENDER"&&C.evolutionState==="CONFIRMED")&&u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"6px 8px",background:"rgba(0,0,0,0.1)",borderRadius:6},children:[u.jsx("span",{style:{fontSize:14},children:""}),u.jsxs("div",{style:{flex:1},children:[u.jsx("div",{style:{fontSize:11,fontWeight:"bold"},children:"Lender"}),u.jsx("div",{className:"small",style:{fontSize:9,opacity:.7},children:(()=>{var W;const C=n.find(be=>be.type==="SELECT_LENDER"&&be.evolutionState==="CONFIRMED"),P=(W=C==null?void 0:C.options)==null?void 0:W.find(be=>be.id===C.selectedOptionId);return(P==null?void 0:P.label)||(P==null?void 0:P.name)||"Selected Bank"})()})]}),u.jsx("span",{className:"pill",style:{fontSize:9,background:"rgba(251,191,36,0.2)",color:"var(--warn)"},children:"PENDING"})]})]})]}),u.jsx("div",{style:{marginTop:t?8:12},children:We.map(C=>u.jsxs("div",{className:`roomItem ${m===C.key?"active":""}`,onClick:()=>S(C.key),style:{cursor:"pointer",padding:t?"8px":void 0},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:10},children:[u.jsxs("div",{style:{fontWeight:950,display:"flex",alignItems:"center",gap:8,fontSize:t?12:void 0},children:[u.jsx("span",{children:C.icon}),u.jsx("span",{children:C.label})]}),m===C.key&&u.jsx("span",{className:"pill",style:{fontSize:t?9:void 0},children:"ACTIVE"})]}),u.jsxs("div",{className:"small",style:{marginTop:t?4:6,fontSize:t?10:void 0},children:[C.key==="buyer"&&"Your property search session",C.key==="agent"&&"Agent communication & coordination",C.key==="lender"&&"Loan & financing details",C.key==="property"&&"Property details & documents",C.key==="legal"&&"Legal compliance & verification"]})]},C.key))}),t&&u.jsxs("div",{style:{marginTop:20,paddingTop:20,borderTop:"1px solid var(--stroke)"},children:[u.jsx("div",{className:"title",style:{fontSize:14,marginBottom:8},children:"AI Concierge"}),u.jsxs("div",{style:{display:"grid",gap:8},children:[u.jsxs("div",{style:{padding:8,borderRadius:8,border:"1px solid var(--stroke)",background:"rgba(0,0,0,0.18)"},children:[u.jsx("b",{style:{fontSize:11},children:" Intent"}),u.jsxs("div",{className:"small",style:{marginTop:4,fontSize:10},children:[u.jsx("b",{children:"Type:"})," ",t.type||"N/A"]}),((ye=t.payload)==null?void 0:ye.location)&&u.jsxs("div",{className:"small",style:{fontSize:10},children:[u.jsx("b",{children:"Location:"})," ",t.payload.location]}),((kt=t.payload)==null?void 0:kt.budget)&&u.jsxs("div",{className:"small",style:{fontSize:10},children:[u.jsx("b",{children:"Budget:"})," ",(t.payload.budget/1e5).toFixed(0),"L"]})]}),u.jsxs("div",{style:{padding:8,borderRadius:8,border:"1px solid var(--stroke)",background:"rgba(0,0,0,0.18)"},children:[u.jsx("b",{style:{fontSize:11},children:" Notes"}),u.jsx("div",{className:"small",style:{marginTop:4,fontSize:10},children:((mt=t==null?void 0:t.payload)==null?void 0:mt.originalText)||"Analysis notes..."})]}),u.jsxs("div",{style:{padding:8,borderRadius:8,border:"1px solid var(--stroke)",background:"rgba(0,0,0,0.18)"},children:[u.jsx("b",{style:{fontSize:11},children:" Hint"}),u.jsx("div",{className:"small",style:{marginTop:4,fontSize:10},children:i.length>0?i[0].guidance||"Follow actions below":"Complete compliance check"})]}),u.jsxs("div",{style:{padding:8,borderRadius:8,border:"1px solid var(--stroke)",background:"rgba(0,0,0,0.18)"},children:[u.jsx("b",{style:{fontSize:11},children:" Next"}),u.jsx("div",{className:"small",style:{marginTop:4,fontSize:10},children:i.length>0?i[0].description:"Complete decisions"})]})]})]})]}),u.jsxs("div",{className:"card",style:{display:"flex",flexDirection:"column",height:"calc(100vh - 180px)",maxHeight:"800px"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12,marginBottom:12},children:[u.jsxs("div",{children:[u.jsxs("div",{className:"title",children:[z==null?void 0:z.label," Session"]}),u.jsx("div",{className:"small",children:t?`${t.type||"Intent"}  ${((js=t.payload)==null?void 0:js.location)||"Location"}`:"No active intent"})]}),u.jsxs("span",{className:"pill",children:["Session: ",u.jsx("b",{children:z==null?void 0:z.label})]})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",flex:1,overflow:"hidden",background:"rgba(0,0,0,0.2)",borderRadius:12,border:"1px solid var(--stroke)"},children:[u.jsxs("div",{style:{flex:1,overflowY:"auto",padding:16,display:"flex",flexDirection:"column",gap:12},children:[T&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,opacity:.8},children:[u.jsx("div",{style:{fontSize:24,marginBottom:8},children:""}),u.jsx("div",{className:"small",style:{fontWeight:"bold"},children:"Understanding your intent..."}),u.jsx("div",{className:"small",style:{marginTop:4,fontSize:10,opacity:.7},children:"Extracting structure  Checking compliance  Preparing actions"})]}),!T&&k.length===0&&!t&&u.jsxs(u.Fragment,{children:[s&&u.jsx("div",{style:{alignSelf:"flex-start",maxWidth:"75%",display:"flex",flexDirection:"column",gap:4},children:u.jsxs("div",{style:{padding:14,borderRadius:16,background:"rgba(139,92,246,0.15)",border:"1px solid rgba(139,92,246,0.3)",color:"var(--text)"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[u.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"rgba(139,92,246,0.3)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16},children:""}),u.jsxs("div",{children:[u.jsx("b",{style:{fontSize:12},children:"Knowledge-Based Insights"}),u.jsx("div",{className:"small",style:{fontSize:10,opacity:.7},children:new Date().toLocaleString()})]})]}),s.summary&&u.jsx("div",{style:{fontSize:13,lineHeight:1.6,marginBottom:10},children:s.summary}),s.market_context&&u.jsxs("div",{style:{marginTop:10,padding:10,background:"rgba(59,130,246,0.1)",borderRadius:8,fontSize:12},children:[s.market_context.location_insights&&u.jsxs("div",{style:{marginBottom:6},children:[u.jsx("strong",{children:"Location:"})," ",s.market_context.location_insights]}),s.market_context.price_trends&&u.jsxs("div",{style:{marginBottom:6},children:[u.jsx("strong",{children:"Price Trends:"})," ",s.market_context.price_trends]}),s.market_context.market_conditions&&u.jsxs("div",{children:[u.jsx("strong",{children:"Market Conditions:"})," ",s.market_context.market_conditions]})]}),s.risk_signals&&s.risk_signals.length>0&&u.jsxs("div",{style:{marginTop:10,padding:10,background:"rgba(251,191,36,0.1)",borderRadius:8,fontSize:12},children:[u.jsx("strong",{style:{marginBottom:6,display:"block"},children:" Risk Signals:"}),s.risk_signals.slice(0,3).map((C,P)=>u.jsxs("div",{style:{marginBottom:4,fontSize:11},children:[typeof C=="string"?C:C.description||C.type,typeof C=="object"&&C.severity&&u.jsx("span",{className:"pill",style:{marginLeft:8,background:C.severity==="HIGH"?"rgba(239,68,68,0.2)":C.severity==="MEDIUM"?"rgba(251,191,36,0.2)":"rgba(34,197,94,0.2)",color:C.severity==="HIGH"?"var(--bad)":C.severity==="MEDIUM"?"var(--warn)":"var(--good)",fontSize:9},children:C.severity})]},P))]}),s.confidence&&u.jsxs("div",{className:"small",style:{fontSize:11,opacity:.8,marginTop:8},children:["Confidence: ",(s.confidence*100).toFixed(0),"%"]})]})}),o&&o.legalReferences&&o.legalReferences.length>0&&u.jsx("div",{style:{alignSelf:"flex-start",maxWidth:"75%",display:"flex",flexDirection:"column",gap:4,marginTop:s?12:0},children:u.jsxs("div",{style:{padding:14,borderRadius:16,background:"rgba(59,130,246,0.15)",border:"1px solid rgba(59,130,246,0.3)",color:"var(--text)"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[u.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"rgba(59,130,246,0.3)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16},children:""}),u.jsxs("div",{children:[u.jsx("b",{style:{fontSize:12},children:"Legal References"}),u.jsx("div",{className:"small",style:{fontSize:10,opacity:.7},children:new Date().toLocaleString()})]})]}),u.jsx("div",{style:{fontSize:13,lineHeight:1.6},children:o.legalReferences.slice(0,3).map((C,P)=>u.jsxs("div",{style:{marginBottom:8,padding:8,background:"rgba(0,0,0,0.2)",borderRadius:6},children:[u.jsx("div",{style:{fontWeight:600,marginBottom:4},children:typeof C=="string"?C:C.title||C.reference||"Legal Reference"}),typeof C=="object"&&C.description&&u.jsx("div",{className:"small",style:{fontSize:11,opacity:.8},children:C.description}),typeof C=="object"&&C.url&&u.jsx("a",{href:C.url,target:"_blank",rel:"noopener noreferrer",style:{fontSize:11,color:"var(--cool)",marginTop:4,display:"inline-block"},children:"View Reference "})]},P))})]})}),!s&&!o&&u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,opacity:.6},children:[u.jsx("div",{style:{fontSize:32,marginBottom:12},children:""}),u.jsx("div",{className:"small",children:"Enter your intent below to get started"})]})]}),!T&&k.length===0&&t&&u.jsxs("div",{style:{alignSelf:"flex-start",maxWidth:"75%",padding:14,borderRadius:16,background:"rgba(59,130,246,0.15)",border:"1px solid rgba(59,130,246,0.3)"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[u.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"linear-gradient(135deg, #3b82f6, #8b5cf6)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16},children:""}),u.jsxs("div",{children:[u.jsx("b",{style:{fontSize:12},children:"System"}),u.jsx("div",{className:"small",style:{fontSize:10,opacity:.7},children:new Date().toLocaleString()})]})]}),u.jsxs("div",{style:{marginTop:8,fontSize:13},children:["Intent processed: ",u.jsx("b",{children:t.type||"N/A"})]}),e&&u.jsxs("div",{style:{marginTop:8,padding:8,borderRadius:8,background:e.decision==="ALLOW"?"rgba(34,197,94,0.2)":e.decision==="DENY"?"rgba(239,68,68,0.2)":"rgba(251,191,36,0.2)",border:`1px solid ${e.decision==="ALLOW"?"var(--good)":e.decision==="DENY"?"var(--bad)":"var(--warn)"}`},children:["Compliance: ",e.decision==="ALLOW"?" ALLOWED":e.decision==="DENY"?" DENIED":" REVIEW"]})]}),!T&&t&&s&&u.jsx("div",{style:{alignSelf:"flex-start",maxWidth:"75%",display:"flex",flexDirection:"column",gap:4,marginTop:k.length>0?12:0},children:u.jsxs("div",{style:{padding:14,borderRadius:16,background:"rgba(139,92,246,0.15)",border:"1px solid rgba(139,92,246,0.3)",color:"var(--text)"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[u.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"rgba(139,92,246,0.3)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16},children:""}),u.jsxs("div",{children:[u.jsx("b",{style:{fontSize:12},children:"Knowledge-Based Insights"}),u.jsx("div",{className:"small",style:{fontSize:10,opacity:.7},children:new Date().toLocaleString()})]})]}),s.summary&&u.jsx("div",{style:{fontSize:13,lineHeight:1.6,marginBottom:10},children:s.summary}),s.market_context&&u.jsxs("div",{style:{marginTop:10,padding:10,background:"rgba(59,130,246,0.1)",borderRadius:8,fontSize:12},children:[s.market_context.location_insights&&u.jsxs("div",{style:{marginBottom:6},children:[u.jsx("strong",{children:"Location:"})," ",s.market_context.location_insights]}),s.market_context.price_trends&&u.jsxs("div",{style:{marginBottom:6},children:[u.jsx("strong",{children:"Price Trends:"})," ",s.market_context.price_trends]}),s.market_context.market_conditions&&u.jsxs("div",{children:[u.jsx("strong",{children:"Market Conditions:"})," ",s.market_context.market_conditions]})]}),s.risk_signals&&s.risk_signals.length>0&&u.jsxs("div",{style:{marginTop:10,padding:10,background:"rgba(251,191,36,0.1)",borderRadius:8,fontSize:12},children:[u.jsx("strong",{style:{marginBottom:6,display:"block"},children:" Risk Signals:"}),s.risk_signals.slice(0,3).map((C,P)=>u.jsxs("div",{style:{marginBottom:4,fontSize:11},children:[typeof C=="string"?C:C.description||C.type,typeof C=="object"&&C.severity&&u.jsx("span",{className:"pill",style:{marginLeft:8,background:C.severity==="HIGH"?"rgba(239,68,68,0.2)":C.severity==="MEDIUM"?"rgba(251,191,36,0.2)":"rgba(34,197,94,0.2)",color:C.severity==="HIGH"?"var(--bad)":C.severity==="MEDIUM"?"var(--warn)":"var(--good)",fontSize:9},children:C.severity})]},P))]}),s.confidence&&u.jsxs("div",{className:"small",style:{fontSize:11,opacity:.8,marginTop:8},children:["Confidence: ",(s.confidence*100).toFixed(0),"%"]})]})}),!T&&t&&o&&o.legalReferences&&o.legalReferences.length>0&&u.jsx("div",{style:{alignSelf:"flex-start",maxWidth:"75%",display:"flex",flexDirection:"column",gap:4,marginTop:12},children:u.jsxs("div",{style:{padding:14,borderRadius:16,background:"rgba(59,130,246,0.15)",border:"1px solid rgba(59,130,246,0.3)",color:"var(--text)"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[u.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"rgba(59,130,246,0.3)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16},children:""}),u.jsxs("div",{children:[u.jsx("b",{style:{fontSize:12},children:"Legal References"}),u.jsx("div",{className:"small",style:{fontSize:10,opacity:.7},children:new Date().toLocaleString()})]})]}),u.jsx("div",{style:{fontSize:13,lineHeight:1.6},children:o.legalReferences.slice(0,3).map((C,P)=>u.jsxs("div",{style:{marginBottom:8,padding:8,background:"rgba(0,0,0,0.2)",borderRadius:6},children:[u.jsx("div",{style:{fontWeight:600,marginBottom:4},children:typeof C=="string"?C:C.title||C.reference||"Legal Reference"}),typeof C=="object"&&C.description&&u.jsx("div",{className:"small",style:{fontSize:11,opacity:.8},children:C.description}),typeof C=="object"&&C.url&&u.jsx("a",{href:C.url,target:"_blank",rel:"noopener noreferrer",style:{fontSize:11,color:"var(--cool)",marginTop:4,display:"inline-block"},children:"View Reference "})]},P))})]})}),k.map((C,P)=>{var ve,ke,Je,Ce,lt,et,Me,tt;const W=C.userId==="user";if(C.userId==="system"||C.type==="system"||((ve=C.type)==null?void 0:ve.includes("compliance"))||((ke=C.type)==null?void 0:ke.includes("decisions"))||((Je=C.type)==null?void 0:Je.includes("actions"))||((Ce=C.type)==null?void 0:Ce.includes("intent"))||((lt=C.type)==null?void 0:lt.includes("decision_confirmed"))||((et=C.type)==null?void 0:et.includes("decisions_unlocked"))||((Me=C.type)==null?void 0:Me.includes("rag_insights"))||((tt=C.type)==null?void 0:tt.includes("legal_references"))){const dn=Se=>Se!=null&&Se.includes("compliance")?"rgba(59,130,246,0.15)":Se!=null&&Se.includes("decisions")||Se!=null&&Se.includes("decision")?"rgba(139,92,246,0.15)":Se!=null&&Se.includes("actions")?"rgba(34,197,94,0.15)":Se!=null&&Se.includes("intent")?"rgba(251,191,36,0.15)":Se!=null&&Se.includes("rag_insights")?"rgba(139,92,246,0.15)":Se!=null&&Se.includes("legal_references")?"rgba(59,130,246,0.15)":"rgba(255,255,255,0.08)",li=Se=>Se!=null&&Se.includes("compliance")?"rgba(59,130,246,0.3)":Se!=null&&Se.includes("decisions")||Se!=null&&Se.includes("decision")?"rgba(139,92,246,0.3)":Se!=null&&Se.includes("actions")?"rgba(34,197,94,0.3)":Se!=null&&Se.includes("intent")?"rgba(251,191,36,0.3)":Se!=null&&Se.includes("rag_insights")?"rgba(139,92,246,0.3)":Se!=null&&Se.includes("legal_references")?"rgba(59,130,246,0.3)":"var(--stroke)";return u.jsxs("div",{style:{alignSelf:"flex-start",maxWidth:"75%",display:"flex",flexDirection:"column",gap:4},children:[u.jsx("div",{style:{padding:12,borderRadius:16,background:dn(C.type),border:`1px solid ${li(C.type)}`,color:"var(--text)"},children:u.jsx("div",{style:{fontSize:13,lineHeight:1.5,fontWeight:500},children:C.text})}),u.jsx("div",{className:"small",style:{fontSize:10,opacity:.6,paddingLeft:4},children:C.timestamp||new Date().toLocaleString()})]},P)}return u.jsxs("div",{style:{alignSelf:W?"flex-end":"flex-start",maxWidth:"75%",display:"flex",flexDirection:"column",gap:4},children:[u.jsx("div",{style:{padding:12,borderRadius:16,background:W?"linear-gradient(135deg, #22c55e, #3b82f6)":"rgba(255,255,255,0.08)",border:W?"none":"1px solid var(--stroke)",color:W?"#fff":"var(--text)"},children:u.jsx("div",{style:{fontSize:13,lineHeight:1.5},children:C.text})}),u.jsx("div",{className:"small",style:{fontSize:10,opacity:.6,paddingLeft:4},children:C.timestamp||new Date().toLocaleString()})]},P)}),!T&&Ee.filter(C=>C.isConfirmed).length>0&&Ee.filter(C=>C.isConfirmed).map(C=>{var P,W;return u.jsxs("div",{style:{alignSelf:"flex-start",maxWidth:"75%",padding:14,borderRadius:16,background:"rgba(34,197,94,0.15)",border:"1px solid rgba(34,197,94,0.3)"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[u.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"rgba(34,197,94,0.3)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16},children:""}),u.jsxs("div",{children:[u.jsx("b",{style:{fontSize:12},children:"Decision Confirmed"}),u.jsx("div",{className:"small",style:{fontSize:10,opacity:.7},children:C.decisionTimestamp?new Date(C.decisionTimestamp).toLocaleString():new Date().toLocaleString()})]})]}),u.jsxs("div",{style:{marginTop:8,fontSize:13},children:[u.jsxs("b",{children:[C.type,":"]})," ",C.details||((P=C.option)==null?void 0:P.label)||((W=C.option)==null?void 0:W.id)]}),C.decidedBy&&u.jsxs("div",{style:{marginTop:6,fontSize:11,opacity:.8},children:["Decided by: ",C.decidedBy,"  Method: ",C.decisionMethod||"chat"]})]},C.decisionId)})]}),u.jsxs("div",{style:{padding:12,borderTop:"1px solid var(--stroke)",background:"rgba(0,0,0,0.3)",display:"flex",gap:8,alignItems:"center"},children:[m==="buyer"&&!t?u.jsxs(u.Fragment,{children:[u.jsx("input",{className:"input",placeholder:"Describe your intent... (e.g., Buy a home in Vizag Under 50L)",value:y,onChange:C=>v(C.target.value),onKeyDown:C=>{C.key==="Enter"&&!C.shiftKey&&!T&&y.trim()&&(C.preventDefault(),a())},disabled:T,style:{flex:1,background:"rgba(0,0,0,0.4)",border:"1px solid var(--stroke)",padding:"12px 16px",borderRadius:12,fontSize:13}}),u.jsx("button",{className:"btn",onClick:d,disabled:T,style:{padding:"12px 16px",borderRadius:12,minWidth:50},children:""}),u.jsx("button",{className:"btn primary",onClick:a,disabled:T||!y.trim(),style:{padding:"12px 24px",borderRadius:12,fontWeight:"bold"},children:T?"Analyzing...":"Analyze"})]}):u.jsxs(u.Fragment,{children:[u.jsx("input",{className:"input",placeholder:"Type a message... (e.g., 'I accept Agent A', 'Change to Agent B')",value:x,onChange:C=>I(C.target.value),onKeyDown:C=>{C.key==="Enter"&&!C.shiftKey&&!T&&x.trim()&&(C.preventDefault(),J())},style:{flex:1,background:"rgba(0,0,0,0.4)",border:"1px solid var(--stroke)",padding:"12px 16px",borderRadius:12,fontSize:13}}),u.jsx(UR,{onTranscript:ue,disabled:T}),u.jsx("button",{className:"btn primary",onClick:J,disabled:T||!x.trim(),style:{padding:"12px 24px",borderRadius:12,fontWeight:"bold"},children:"Send"})]}),g&&m==="buyer"&&u.jsx("div",{style:{marginTop:12,padding:12,background:"rgba(239,68,68,0.2)",borderRadius:8,border:"1px solid var(--bad)"},children:u.jsxs("div",{className:"small",style:{color:"var(--bad)"},children:[u.jsx("strong",{children:"Error:"})," ",g]})})]})]}),m==="property"&&u.jsxs("div",{className:"section card",style:{padding:12,marginTop:12},children:[u.jsx("div",{className:"title",children:"Property Viewer"}),_.length>0?u.jsx("div",{style:{display:"flex",gap:8,overflowX:"auto",padding:8,marginTop:8,borderRadius:8,background:"rgba(0,0,0,0.2)"},children:_.map((C,P)=>u.jsx("img",{src:C.url,alt:C.alt||`Property image ${P+1}`,style:{width:200,height:150,objectFit:"cover",borderRadius:8,cursor:"pointer"},onClick:()=>{X(!0),Pe(C.coordinates)}},P))}):u.jsx("div",{className:"small",style:{marginTop:8,padding:20,textAlign:"center",color:"var(--muted)"},children:"No property images available. Images will appear here when property is selected."}),D&&ce&&u.jsxs("div",{style:{marginTop:12,height:300,borderRadius:8,overflow:"hidden",border:"1px solid var(--stroke)"},children:[u.jsx("iframe",{width:"100%",height:"100%",frameBorder:"0",style:{border:0},src:`https://www.google.com/maps/embed/v1/place?key=YOUR_API_KEY&q=${ce.lat},${ce.lng}&zoom=15`,allowFullScreen:!0}),u.jsxs("div",{className:"small",style:{padding:8,background:"rgba(0,0,0,0.3)"},children:[" Location: ",ce.lat,", ",ce.lng]})]})]}),(m==="agent"||m==="buyer")&&Qe&&u.jsxs("div",{className:"section card",style:{padding:12,marginTop:12},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[u.jsxs("div",{children:[u.jsx("div",{className:"title",children:"Video Call"}),u.jsxs("div",{className:"small",children:["Live communication with ",m==="agent"?"Agent":"Buyer"]})]}),u.jsx("button",{className:"btn",onClick:()=>Rt(!1),style:{padding:"6px 12px",fontSize:12},children:""})]}),u.jsx(FR,{userName:((_e=xe.tokenParsed)==null?void 0:_e.name)||((Fs=xe.tokenParsed)==null?void 0:Fs.preferred_username)||"User",roomName:`intent-${(t==null?void 0:t.id)||"default"}-${m}`})]}),(m==="agent"||m==="buyer")&&!Qe&&u.jsx("div",{style:{marginTop:12,textAlign:"center"},children:u.jsx("button",{className:"btn primary",onClick:()=>Rt(!0),style:{width:"100%",padding:"10px"},children:" Start Video Call"})})]}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"calc(100vh - 180px)",maxHeight:"800px",overflowY:"auto",overflowX:"hidden",paddingRight:4},children:[u.jsxs("div",{className:"card",style:{padding:t?8:12,marginBottom:t?8:12},children:[u.jsx("div",{className:"title",style:{fontSize:t?13:16},children:"Trust Receipt (Certification Gate)"}),e?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"small",children:e.decision==="ALLOW"?"Intent is compliant and allowed to proceed.":e.decision==="DENY"?"Intent is not compliant and cannot proceed.":"Intent requires review before proceeding."}),u.jsxs("div",{style:{marginTop:t?6:10},children:[u.jsx("div",{className:"small",style:{fontSize:t?10:12},children:u.jsx("b",{children:"Gate Status:"})}),u.jsx("div",{style:{fontSize:t?14:20,fontWeight:950,color:e.decision==="ALLOW"?"var(--good)":e.decision==="DENY"?"var(--bad)":"var(--warn)",marginTop:4},children:e.decision==="ALLOW"?" UNLOCKED":e.decision==="DENY"?" LOCKED":" LOCKED"})]}),e.checks&&e.checks.length>0&&u.jsx("div",{className:"list",style:{marginTop:t?6:10},children:e.checks.map((C,P)=>u.jsxs("div",{className:"item",style:{display:"flex",justifyContent:"space-between",gap:10,padding:t?"6px":void 0},children:[u.jsxs("div",{children:[u.jsx("b",{style:{fontSize:t?11:void 0},children:C.check}),u.jsx("div",{className:"small",style:{fontSize:t?9:void 0},children:C.reason})]}),u.jsx("div",{className:C.passed?"statusPass":"statusFail",style:{fontSize:t?9:void 0},children:C.passed?"PASS":"FAIL"})]},P))}),Ee.filter(C=>C.isConfirmed).length>0&&u.jsxs("div",{style:{marginTop:t?8:15,paddingTop:t?8:15,borderTop:"1px solid var(--stroke)"},children:[u.jsx("div",{className:"small",style:{fontWeight:"bold",marginBottom:t?4:8,fontSize:t?10:void 0},children:"Decision Audit Trail:"}),u.jsx("div",{className:"list",style:{marginTop:t?4:8},children:Ee.filter(C=>C.isConfirmed).map((C,P)=>{var W,be;return u.jsxs("div",{className:"item",style:{padding:t?6:8},children:[u.jsx("div",{className:"small",style:{fontSize:t?10:void 0},children:u.jsxs("b",{children:[C.type,":"]})}),C.recommendedOption&&u.jsxs("div",{className:"small",style:{marginTop:t?2:4,opacity:.8,fontSize:t?9:void 0},children:["AI Recommended: ",C.recommendedOption.label||C.recommendedOption.id," (",C.confidence.toFixed(0),"%)"]}),u.jsxs("div",{className:"small",style:{marginTop:t?1:2,fontSize:t?10:void 0},children:["Final Decision: ",u.jsx("b",{children:C.details||((W=C.option)==null?void 0:W.label)||((be=C.option)==null?void 0:be.id)})]}),C.decidedBy&&u.jsxs("div",{className:"small",style:{marginTop:t?1:2,fontSize:t?9:10,opacity:.8},children:["Decided by: ",C.decidedBy,"  Method: ",C.decisionMethod||"chat"]}),C.decisionTimestamp&&u.jsx("div",{className:"small",style:{fontSize:t?9:10,opacity:.7},children:new Date(C.decisionTimestamp).toLocaleString()})]},P)})})]})]}):u.jsx("div",{className:"small",style:{marginTop:8,opacity:.6},children:"Enter your intent to see compliance status"})]}),u.jsxs("div",{className:"section card",style:{padding:12,marginBottom:12},children:[u.jsx("div",{className:"title",style:{fontSize:16},children:"Final Decisions"}),u.jsx("div",{className:"small",style:{fontSize:12},children:"Review AI recommendations and confirm your decisions."}),Ee.length>0?u.jsx("div",{className:"list",style:{marginTop:10},children:Ee.map((C,P)=>{var Ce,lt,et,Me;const W=(((Ce=C.originalDecision)==null?void 0:Ce.type)||"").toUpperCase(),be=W.includes("AGENT"),ve=W.includes("PROPERTY"),ke=W.includes("LENDER")||W.includes("BANK"),Je=W.includes("DOWN_PAYMENT")||W.includes("DOWNPAYMENT");return u.jsxs("div",{className:"item",style:{borderLeft:C.isConfirmed?"3px solid var(--good)":"3px solid var(--warn)",padding:"12px 12px 12px 12px"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[u.jsxs("b",{style:{fontSize:14},children:[be&&"Agent",ve&&"Property",ke&&"Bank",Je&&"Down Payment",!be&&!ve&&!ke&&!Je&&C.type]}),u.jsx("span",{className:"pill",style:{background:C.isConfirmed?"rgba(34,197,94,0.2)":"rgba(251,191,36,0.2)",color:C.isConfirmed?"var(--good)":"var(--warn)",fontSize:10},children:C.isConfirmed?" CONFIRMED":` ${C.confidence.toFixed(0)}%`})]}),u.jsx("div",{style:{padding:10,background:C.isConfirmed?"rgba(34,197,94,0.1)":"rgba(59,130,246,0.1)",borderRadius:6,border:C.isConfirmed?"1px solid var(--good)":"1px solid var(--cool)",marginBottom:8},children:C.isConfirmed?u.jsx("div",{className:"small",style:{fontSize:13,lineHeight:1.6,fontWeight:500},children:(()=>{var Se;const tt=C.option||C.selectedOption;if(!tt)return"Not available";const dn={...C.originalDecision,confidence:(C.confidence||0)/100,type:((Se=C.originalDecision)==null?void 0:Se.type)||C.type};return Le(dn,tt)||C.details||tt.label||"Not available"})()}):u.jsxs(u.Fragment,{children:[C.details?u.jsx("div",{className:"small",style:{fontSize:13,lineHeight:1.6,fontWeight:400},children:C.details}):u.jsx("div",{className:"small",style:{fontSize:12},children:((lt=C.option)==null?void 0:lt.label)||((et=C.option)==null?void 0:et.id)||"Not available"}),C.reasoning&&u.jsxs("div",{className:"small",style:{marginTop:6,fontSize:10,fontStyle:"italic",opacity:.8},children:[" ",C.reasoning]})]})}),!C.isConfirmed&&u.jsxs("div",{style:{display:"flex",gap:6,marginTop:8},children:[u.jsx("button",{className:"btn primary",style:{flex:1,fontSize:11,padding:"8px 12px"},onClick:()=>{c&&C.option&&c(C.decisionId,C.option.id,!0)},disabled:T,children:" Accept"}),u.jsx("button",{className:"btn",style:{flex:1,fontSize:11,padding:"8px 12px"},onClick:()=>{h&&h(C,null)},disabled:T,children:" Change"}),u.jsx("button",{className:"btn",style:{flex:1,fontSize:11,padding:"8px 12px",background:"rgba(239,68,68,0.2)",color:"var(--bad)"},onClick:()=>{console.log("Reject decision:",C.decisionId)},disabled:T,children:" Reject"})]}),C.isConfirmed&&u.jsxs("div",{children:[u.jsxs("div",{style:{marginTop:8,padding:6,background:"rgba(34,197,94,0.05)",borderRadius:4,marginBottom:8},children:[C.decidedBy&&u.jsxs("div",{className:"small",style:{fontSize:10,opacity:.8},children:["Approved by: ",C.decidedBy]}),C.decisionMethod&&u.jsxs("div",{className:"small",style:{fontSize:10,opacity:.8},children:["Method: ",C.decisionMethod==="chat"?" Chat":C.decisionMethod==="voice"?" Voice":C.decisionMethod]}),C.decisionTimestamp&&u.jsx("div",{className:"small",style:{fontSize:10,opacity:.7,marginTop:4},children:new Date(C.decisionTimestamp).toLocaleString()})]}),((Me=C.originalDecision)==null?void 0:Me.evolutionState)==="CONFIRMED"&&u.jsx("button",{className:"btn",style:{width:"100%",fontSize:11,padding:"8px 12px",marginTop:8},onClick:()=>{var tt,dn;h&&((tt=C.originalDecision)==null?void 0:tt.evolutionState)==="CONFIRMED"?h(C,null):console.warn("Cannot change decision: not in CONFIRMED state",(dn=C.originalDecision)==null?void 0:dn.evolutionState)},disabled:T,children:" Change Decision"})]})]},C.decisionId||P)})}):u.jsx("div",{className:"small",style:{marginTop:10,opacity:.6,fontSize:11},children:"AI recommendations will appear here after intent analysis"})]}),u.jsxs("div",{className:"section card",style:{padding:12},children:[u.jsx("div",{className:"title",style:{fontSize:16},children:"Actions"}),u.jsx("div",{className:"small",style:{fontSize:12},children:"Track and complete actions for this intent."}),pt.length>0?(()=>{const C=new Map;pt.forEach(W=>{const be=W.actionId||W.id,ve=W.outcome==="COMPLETED"||W.outcome==="CONFIRMED";if(!C.has(be))C.set(be,W);else{const ke=C.get(be);if((ke.outcome==="COMPLETED"||ke.outcome==="CONFIRMED")&&!ve)return;C.set(be,W)}});const P=Array.from(C.values()).sort((W,be)=>{const ve=W.order||W.sequence||999,ke=be.order||be.sequence||999;return ve-ke});return u.jsx("div",{className:"list",style:{marginTop:10},children:P.map((W,be)=>{const ve=W.outcome==="COMPLETED"||W.outcome==="CONFIRMED",ke=W.outcome==="FAILED",Je=W.outcome==="RESCHEDULED",Ce=be>0?P[be-1]:null,lt=Ce&&Ce.outcome!=="COMPLETED"&&Ce.outcome!=="CONFIRMED"&&Ce.outcome!=="SKIPPED";return u.jsxs("div",{className:"item",style:{opacity:lt?.5:1,borderLeft:!lt&&!W.outcome?"3px solid var(--primary)":"none",padding:!lt&&!W.outcome?"12px 12px 12px 12px":"12px"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[lt&&u.jsx("span",{style:{fontSize:18},children:""}),u.jsx("b",{style:{fontSize:14},children:W.description||"Action"})]}),u.jsx("span",{className:"pill",style:{background:ve?"rgba(34,197,94,0.2)":ke?"rgba(239,68,68,0.2)":Je?"rgba(251,191,36,0.2)":lt?"rgba(107,114,128,0.2)":"rgba(255,255,255,0.06)",color:ve?"var(--good)":ke?"var(--bad)":Je?"var(--warn)":"var(--muted)",fontSize:10},children:lt?" LOCKED":W.outcome||W.status||"READY"})]}),W.guidance&&u.jsxs("div",{className:"small",style:{marginBottom:8,fontSize:12},children:[" ",W.guidance]}),lt&&u.jsx("div",{className:"small",style:{marginBottom:8,color:"var(--muted)",fontStyle:"italic",fontSize:11},children:" Waiting for previous action to complete"}),!W.outcome&&!lt&&u.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[u.jsx("button",{className:"btn primary",onClick:()=>l(W,"COMPLETED"),disabled:T,style:{fontSize:11,padding:"8px 12px"},children:"Complete"}),u.jsx("button",{className:"btn",onClick:()=>l(W,"FAILED"),disabled:T,style:{fontSize:11,padding:"8px 12px"},children:"Fail"}),u.jsx("button",{className:"btn",onClick:()=>l(W,"RESCHEDULED"),disabled:T,style:{fontSize:11,padding:"8px 12px"},children:"Reschedule"})]})]},W.actionId)})})})():u.jsx("div",{className:"small",style:{marginTop:10,opacity:.6},children:"Actions will appear here after decisions are made"})]})]})]})]})}function $R(){var yf,kf;const[t,e]=w.useState(""),[n,i]=w.useState(!1),[r,s]=w.useState(null),[o,a]=w.useState(null),[c,l]=w.useState([]),[d,h]=w.useState([]),[f,p]=w.useState(null),[y,v]=w.useState(null),[T,g]=w.useState(null),[m,S]=w.useState(null),[k,E]=w.useState([]),[x,I]=w.useState(!1),[_,F]=w.useState(null),[D,X]=w.useState(!1),[ce,Pe]=w.useState(null),[Qe,Rt]=w.useState(!0),We=((yf=xe.tokenParsed)==null?void 0:yf.name)||((kf=xe.tokenParsed)==null?void 0:kf.preferred_username)||"You",Tt=(r==null?void 0:r.id)||(ce==null?void 0:ce.intentId)||"";rE({intentId:Tt||"",buyerName:We,decisions:c||[]});const[J,ue]=w.useState(!1),[z,Le]=w.useState(null),[Ee,pt]=w.useState(null),[ct,H]=w.useState(""),[ye,kt]=w.useState(!1),[mt,js]=w.useState(null),[_e,Fs]=w.useState(null),[C,P]=w.useState(""),[W,be]=w.useState(""),ve=w.useRef(null),ke=w.useRef(!1),[Je,Ce]=w.useState("idle"),[lt,et]=w.useState(!1),Me=w.useRef(null),tt=w.useRef(!1),dn=w.useRef(null),[li,Se]=w.useState(()=>localStorage.getItem("aiAgentMode")==="true"),Ok=w.useRef(null),[kn,Mr]=w.useState(null),Kn=w.useRef(null);w.useEffect(()=>()=>{Kn.current&&clearTimeout(Kn.current)},[]);const ll=w.useCallback((M,A={})=>{if(!window.speechSynthesis)return console.warn("[Voice Agent] Speech Synthesis not available"),!1;try{return window.speechSynthesis.cancel(),setTimeout(()=>{const Y=new SpeechSynthesisUtterance(M);Y.rate=A.rate||1,Y.pitch=A.pitch||1,Y.volume=A.volume||1,Y.lang=A.lang||"en-US",Y.onstart=()=>{console.log("[Voice Agent] Speech started:",M.substring(0,50)),A.onStart&&A.onStart()},Y.onerror=se=>{console.error("[Voice Agent] Speech error:",se),se.error==="network"&&!A.retried&&(console.log("[Voice Agent] Retrying speech after network error..."),setTimeout(()=>{ll(M,{...A,retried:!0})},500)),A.onError&&A.onError(se)},Y.onend=()=>{console.log("[Voice Agent] Speech ended"),A.onEnd&&A.onEnd()},Y.onpause=()=>{console.log("[Voice Agent] Speech paused")},Y.onresume=()=>{console.log("[Voice Agent] Speech resumed")},window.speechSynthesis.speak(Y),console.log("[Voice Agent] Queued speech:",M.substring(0,50))},100),!0}catch(Y){return console.error("[Voice Agent] Error setting up speech:",Y),!1}},[]),Us=w.useCallback(M=>{if(!c||c.length===0)return null;let A=null;if(M){const V={one:0,two:1,three:2,four:3,five:4},$=V[M]!==void 0?V[M]:parseInt(M)-1;if(!isNaN($)&&$>=0&&$<c.length)A=c[$];else{const Re=M.toLowerCase();A=c.find(me=>{var ne,ge;return((ne=me.type)==null?void 0:ne.toLowerCase().includes(Re))||((ge=me.options)==null?void 0:ge.some(oe=>{var q,he;return((q=oe.label)==null?void 0:q.toLowerCase().includes(Re))||((he=oe.id)==null?void 0:he.toLowerCase().includes(Re))}))})}}if(A||(A=c[c.length-1]),!A)return null;const Y=A.type||"Decision",se=A.options||[],Z=se.map((V,$)=>`${V.label||V.id||`Option ${$+1}`}`).join(", ");let ie=`${Y}. Options: ${Z}.`;if(A.selectedOptionId){const V=se.find(Re=>Re.id===A.selectedOptionId),$=(V==null?void 0:V.label)||(V==null?void 0:V.id)||A.selectedOptionId;ie+=` Currently selected: ${$}.`}return A.recommendation&&(ie+=` Recommended: ${A.recommendation}.`),ie},[c]),Bs=w.useCallback(M=>{if(!d||d.length===0)return null;let A=null;if(M){const V={one:0,two:1,three:2,four:3,five:4},$=V[M]!==void 0?V[M]:parseInt(M)-1;if(!isNaN($)&&$>=0&&$<d.length)A=d[$];else{const Re=M.toLowerCase();A=d.find(me=>{var ne,ge,oe;return((ne=me.description)==null?void 0:ne.toLowerCase().includes(Re))||((ge=me.actionId)==null?void 0:ge.toLowerCase().includes(Re))||((oe=me.type)==null?void 0:oe.toLowerCase().includes(Re))})}}if(A||(A=d[d.length-1]),!A)return null;const Y=A.description||"Action",se=A.status||"PENDING",Z=A.outcome||null;let ie=`${Y}. Status: ${se.toLowerCase()}.`;return A.guidance&&(ie+=` ${A.guidance}.`),Z&&(ie+=` Outcome: ${Z.toLowerCase()}.`),ie},[d]),dl=w.useCallback(()=>{if(!m)return null;if(m.decisionRationale){const M=m.decisionRationale.whyDecisionsNeeded||"",A=m.decisionRationale.recommendationBasis||"";return`This decision was recommended because: ${M}. ${A}`}return m.complianceExplanation?`This decision was made because: ${m.complianceExplanation.primaryReason||""}.`:null},[m]),zs=w.useCallback(()=>{if(!r)return null;const M=r.type||"Intent",A=r.extractedInfo||{};let se=`Intent type: ${M}. Current status: ${(f||"CREATED").toLowerCase().replace(/_/g," ")}.`;const Z=Object.keys(A).slice(0,3);if(Z.length>0){const ie=Z.map(V=>{const $=A[V];return`${V}: ${$}`}).join(", ");se+=` Extracted information: ${ie}.`}return se},[r,f]),ul=w.useCallback(()=>{if(!o)return null;const M=o.decision||"UNKNOWN",A=o.reason||"",Y=o.violations||[],se=o.warnings||[];let Z=`Compliance decision: ${M.toLowerCase()}.`;if(A&&(Z+=` Reason: ${A}.`),Y.length>0){const ie=Y.slice(0,3).join(", ");Z+=` Violations: ${ie}.`}if(se.length>0){const ie=se.slice(0,3).join(", ");Z+=` Warnings: ${ie}.`}return Z},[o]),hl=w.useCallback(()=>{if(!T)return null;const M=T.overallRisk||"UNKNOWN",A=T.riskLevel||"UNKNOWN",Y=T.riskScore||0,se=T.riskFactors||[],Z=T.recommendations||[];let ie=`Overall risk: ${M.toLowerCase()}. Risk level: ${A.toLowerCase()}. Risk score: ${Y}.`;if(se.length>0){const V=se.slice(0,3).map($=>typeof $=="string"?$:$.factor||$.description||$).join(", ");ie+=` Risk factors: ${V}.`}if(Z.length>0){const V=Z.slice(0,2).join(", ");ie+=` Recommendations: ${V}.`}return ie},[T]),fl=w.useCallback(()=>{if(!d||d.length===0){if(c&&c.length>0){const ie=c.filter(V=>!V.selectedOptionId);if(ie.length>0)return`Next step: Make a decision. ${ie.length} decision${ie.length>1?"s":""} pending.`}return f?`Next step: Current status is ${f.toLowerCase().replace(/_/g," ")}.`:"No next steps available yet."}const M=d.filter(ie=>!ie.outcome||ie.outcome!=="COMPLETED"&&ie.outcome!=="FAILED"&&ie.outcome!=="SKIPPED");if(M.length===0)return"All actions are completed. No next steps.";const A=M[0],Y=A.description||"Action",se=A.status||"PENDING";let Z=`Next step: ${Y}. Status: ${se.toLowerCase()}.`;return A.guidance&&(Z+=` ${A.guidance}.`),M.length>1&&(Z+=` There are ${M.length-1} more pending action${M.length>2?"s":""}.`),Z},[d,c,f]),pl=w.useCallback(()=>{var M;return kn?`Pending confirmation: ${((M=kn.params)==null?void 0:M.actionDescription)||kn.action||"action"}.`:c&&c.length>0?Us(null):d&&d.length>0?Bs(null):zs()},[kn,c,d,Us,Bs,zs]),ml=w.useCallback(async()=>{var A,Y,se,Z,ie,V;const M=t.trim();if(!M){v("Please enter your intent");return}i(!0),v(null),s(null),a(null),l([]),h([]),p(null),Pe(null),g(null),S(null),E([]),F(null),ke.current=!1;try{const $=xe.tokenParsed,Re=($==null?void 0:$.sub)||"unknown-user",me=($==null?void 0:$.realm)||"intent-platform",ne=await Wh({text:M,tenantId:me,actorId:Re,industry:"real-estate"});s(ne);const ge=($==null?void 0:$.email)||($==null?void 0:$.preferred_username)||null;if(console.log("[Email Debug] Intent Created - tokenParsed.email:",$==null?void 0:$.email,"tokenParsed.preferred_username:",$==null?void 0:$.preferred_username,"Final userEmail:",ge),ge?((ge==="test@example.com"||ge.includes("test@example"))&&console.warn("[Email Debug]  WARNING: Using test@example.com as email. Please update your Keycloak user profile email to bsai@acentle.com"),console.log("[Email Debug] Sending Intent Created email to:",ge),dE({userEmail:ge,intent:ne,intentId:ne.id||"unknown"}).catch(oe=>{console.warn("[Email] Failed to send intent created email:",oe)})):console.warn("[Email Debug] No user email found in Keycloak token. Email not sent."),ve.current){const oe=((A=ne.payload)==null?void 0:A.location)||((Y=ne.extractedInfo)==null?void 0:Y.location)||"Location",q=(se=ne.payload)!=null&&se.budget?`${(ne.payload.budget/1e5).toFixed(0)}L`:"",he=`Intent: ${ne.type||"Property Search"}${oe?` in ${oe}`:""}${q?` with budget ${q}`:""}`;ve.current({text:` ${he}`,type:"intent",timestamp:new Date().toLocaleString()})}try{const oe=GT(ne);console.log("[RAG Integration] Determining country:",oe,"from intent:",ne),X(!0);const q=await ku(ne,oe);if(q){if(F(q),console.log("[RAG Integration] RAG response received:",q),ve.current){const he=((Z=q.sources)==null?void 0:Z.length)||0,L=q.confidence?`${(q.confidence*100).toFixed(0)}%`:"";ve.current({text:` Knowledge-based insights retrieved${L?` (${L} confidence)`:""}. ${he>0?`${he} source${he>1?"s":""} referenced.`:""}`,type:"rag_insights",timestamp:new Date().toLocaleString()})}await un({eventType:"RAG_QUERY_EXECUTED",intentId:ne.id||"unknown",actorId:Re,tenantId:me,payload:{country:oe,adapter:q.country,query:{intent_type:ne.type,extracted_entities:ne.extractedInfo||{}},response_summary:q.summary.substring(0,100),confidence:q.confidence,sources_count:((ie=q.sources)==null?void 0:ie.length)||0},reason:"RAG knowledge retrieval for intent enrichment (advisory only)",confidence:q.confidence>=.7?"HIGH":"MEDIUM"})}else console.log("[RAG Integration] RAG query returned null (non-blocking)")}catch(oe){console.warn("[RAG Integration] RAG query error (non-blocking):",oe)}finally{X(!1)}if(ne.type==="BUY_PROPERTY")try{const oe=await vu(ne);if(a(oe),ge&&uE({userEmail:ge,compliance:oe,intentId:ne.id||"unknown"}).catch(q=>{console.warn("[Email] Failed to send compliance result email:",q)}),ve.current){const q=oe.decision==="ALLOW"?"":oe.decision==="DENY"?"":"",he=oe.decision==="ALLOW"?"Compliance check passed! You can proceed with your property search.":oe.decision==="DENY"?`Compliance check failed: ${oe.reason||"Not compliant"}`:`Compliance review required: ${oe.reason||"Needs review"}`;ve.current({text:`${q} ${he}`,type:"compliance",timestamp:new Date().toLocaleString()})}if(oe.decision==="ALLOW")try{const q=await Wy(ne,oe.decision,[]);if(l(q.decisions||[]),p(q.lifecycleState||"AWAITING_DECISIONS"),ge&&q.decisions&&q.decisions.length>0&&hE({userEmail:ge,decisions:q.decisions,intentId:ne.id||"unknown"}).catch(he=>{console.warn("[Email] Failed to send decision generated email:",he)}),ve.current&&q.decisions&&q.decisions.length>0){const he=q.decisions.length,L=q.decisions.filter(pe=>pe.evolutionState!=="CONFIRMED"&&pe.state!=="CONFIRMED").length;ve.current({text:` ${he} decision${he>1?"s":""} generated. ${L>0?`${L} pending your review.`:"All decisions confirmed."}`,type:"decisions",timestamp:new Date().toLocaleString()})}try{const he=await Hp(ne,oe,q.decisions||[]);if(he){g(he);try{const L=await Qs(ne,oe,he,q.decisions||[]);if(L&&(S(L),ve.current)){const pe=((V=L.legalReferences)==null?void 0:V.length)||0;pe>0&&ve.current({text:` ${pe} legal reference${pe>1?"s":""} available. Check Legal References section.`,type:"legal_references",timestamp:new Date().toLocaleString()})}}catch(L){console.error("Explainability engine error:",L)}}}catch(he){console.error("Risk engine error:",he)}if(q.lifecycleState==="DECISIONS_MADE"||q.lifecycleState==="ACTIONS_IN_PROGRESS")try{const he=await Br(ne,q.decisions,q.lifecycleState,[]);if(h(he.actions||[]),he.nextLifecycleState&&p(he.nextLifecycleState),ve.current&&he.actions&&he.actions.length>0){const L=he.actions.length,pe=he.actions.filter(je=>!je.outcome||je.outcome!=="COMPLETED"&&je.outcome!=="FAILED"&&je.outcome!=="SKIPPED").length;ve.current({text:` ${L} action${L>1?"s":""} created. ${pe>0?`${pe} ready to start.`:"All actions completed."}`,type:"actions",timestamp:new Date().toLocaleString()})}}catch(he){console.error("Action engine error:",he)}}catch(q){console.error("Decision engine error:",q)}else try{const q=await Qs(ne,oe,null,[]);q&&S(q)}catch(q){console.error("Explainability engine error:",q)}}catch(oe){console.error("Compliance check error:",oe),a({decision:"REVIEW",reason:"Compliance check unavailable",confidence:"LOW"})}}catch($){v($.message||"Failed to analyze intent"),console.error("Intent analysis error:",$)}finally{i(!1)}},[t]);w.useEffect(()=>{dn.current=ml},[ml]),w.useEffect(()=>{const M=window.SpeechRecognition||window.webkitSpeechRecognition;if(!M){console.warn("Speech Recognition API not supported in this browser. Voice input will be disabled."),Me.current=null;return}if(Me.current){console.log("Speech Recognition already initialized");return}try{console.log("Initializing Speech Recognition...");const A=new M,Y=localStorage.getItem("aiAgentMode")==="true";A.continuous=Y,A.interimResults=!1,A.lang="en-US","grammars"in A,console.log("[Speech Recognition] Continuous mode:",Y),A.onstart=()=>{console.log("Speech recognition started"),Ce("listening"),et(!0),tt.current=!0},A.onresult=async se=>{var V,$,Re,me,ne,ge,oe,q,he;const Z=se.results[0][0].transcript.trim();console.log("[Speech Recognition] Transcript:",Z),console.log("[Speech Recognition] Full transcript (for debugging):",JSON.stringify(Z)),Ce("transcribing");const ie=localStorage.getItem("aiAgentMode")==="true";if(console.log("[Voice Agent] AI Agent Mode enabled:",ie),ie)try{let L=nE(Z);if(console.log("[Voice Agent] Parsed command:",L),console.log("[Voice Agent] Parsed command type:",L.type),L.type==="scroll"&&L.direction==="down"){const ee=Z.toLowerCase().trim(),le=ee.length,rt=Array.isArray(c)&&c.length>0,Qt=Array.isArray(c)?c.length:0;console.log("[Voice Agent]  Checking 'scroll down' command:",{transcript:ee,length:le,hasDecisions:rt,decisionsCount:Qt,decisionsType:typeof c,decisionsIsArray:Array.isArray(c)});const Te=ee==="scroll down"||le<=12;rt&&Te?(console.log("[Voice Agent]  DETECTED MIS-TRANSCRIPTION: 'scroll down'  'read decision'"),console.log("[Voice Agent] Context: decisions available =",rt,"(",Qt,"decisions), transcript length =",le),console.log("[Voice Agent]  CONVERTING to 'read decision' command"),L={type:"read",target:"decision",identifier:null,confirmation:!1,action:"read_decision"},console.log("[Voice Agent]  Parsed command after conversion:",L)):rt?console.log("[Voice Agent]  'scroll down' detected with decisions available. If you meant 'read decision', try saying it more clearly."):console.log("[Voice Agent]  'scroll down' detected but no decisions available (count:",Qt,"). Treating as scroll command.")}(L.type==="read"||L.type==="scroll"||L.type==="select_decision"||L.type==="update_action_outcome"||L.type==="confirm_decision"||L.type==="cancel")&&console.log("[Voice Agent] This is a voice command, will not treat as intent input");const pe=xe.tokenParsed,je=(pe==null?void 0:pe.sub)||"unknown-user",ze=(pe==null?void 0:pe.realm)||"intent-platform",we=(r==null?void 0:r.id)||"unknown";if(await un({eventType:"VOICE_COMMAND_RECEIVED",intentId:we,actorId:je,tenantId:ze,payload:{rawCommand:Z,parsedCommand:L},reason:"Voice command received",confidence:"HIGH"}),(L.type==="confirm_decision"||L.type==="cancel")&&kn){if(L.type==="confirm_decision"){if(console.log("[Voice Agent] Confirmation received, executing action:",kn),await un({eventType:"VOICE_ACTION_CONFIRMED",intentId:we,actorId:je,tenantId:ze,payload:{pendingAction:kn.action,confirmationType:"voice"},reason:"Voice confirmation received"}),kn.action==="select_decision"){const{decisionId:le,optionId:rt}=kn.params;await Vs(le,rt,!1),await un({eventType:"VOICE_DECISION_SELECTED",intentId:we,actorId:je,tenantId:ze,payload:{decisionId:le,optionId:rt,confirmationMethod:"voice"},reason:"Decision selected via voice command"})}else if(kn.action==="update_action_outcome"){const{actionId:le,outcomeType:rt}=kn.params,Qt=xe.tokenParsed,Te=(Qt==null?void 0:Qt.sub)||"unknown-user",Fe=rt==="FAILED"||rt==="BLOCKED"||rt==="RESCHEDULED"?"Updated via voice command":null;try{const It=await yu(le,rt,Te,Fe,null);if(h(Xt=>Xt.map(Vt=>Vt.actionId===le?It.action:Vt)),It.nextActions&&It.nextActions.length>0){const Xt=await Br(r,c,f,d.map(Vt=>Vt.actionId===le?It.action:Vt));h(Xt.actions||[])}if(It.intentStatus&&p(It.intentStatus),await un({eventType:"VOICE_ACTION_OUTCOME_UPDATED",intentId:we,actorId:je,tenantId:ze,payload:{actionId:le,outcomeType:rt,confirmationMethod:"voice"},reason:"Action outcome updated via voice command"}),window.speechSynthesis){const Xt=rt.toLowerCase().replace(/_/g," "),Vt=new SpeechSynthesisUtterance(`Action marked as ${Xt}.`);Vt.rate=1,window.speechSynthesis.speak(Vt)}}catch(It){if(console.error("[Voice Agent] Failed to update action outcome:",It),await un({eventType:"VOICE_ACTION_FAILED",intentId:we,actorId:je,tenantId:ze,payload:{actionId:le,outcomeType:rt,error:It.message},reason:"Action outcome update failed"}),window.speechSynthesis){const Xt=new SpeechSynthesisUtterance(`Failed to update action. ${It.message}`);Xt.rate=1,window.speechSynthesis.speak(Xt)}}}if(Mr(null),Kn.current&&(clearTimeout(Kn.current),Kn.current=null),window.speechSynthesis){const le=new SpeechSynthesisUtterance("Decision confirmed and executed.");le.rate=1,window.speechSynthesis.speak(le)}}else if(L.type==="cancel"&&(console.log("[Voice Agent] Action cancelled by user"),await un({eventType:"VOICE_ACTION_CANCELLED",intentId:we,actorId:je,tenantId:ze,payload:{cancelledAction:kn.action},reason:"Voice action cancelled by user"}),Mr(null),Kn.current&&(clearTimeout(Kn.current),Kn.current=null),window.speechSynthesis)){const le=new SpeechSynthesisUtterance("Action cancelled.");le.rate=1,window.speechSynthesis.speak(le)}((V=Me.current)==null?void 0:V.continuous)||!1?Ce("listening"):(Ce("idle"),et(!1));return}if(L.type==="select_decision"){console.log("[Voice Agent] Decision selection command:",L.option);let ee=null,le=null;for(const Te of c)if(Te.evolutionState!=="CONFIRMED"){for(const Fe of Te.options){const It=Fe.label.toLowerCase(),Xt=Fe.id.toLowerCase(),Vt=L.option.toLowerCase();if(It.includes(Vt)||Vt.includes(It.split(" ")[0])){ee=Te,le=Fe;break}if(Xt.includes(Vt)||Vt===Xt.split("-")[0]){ee=Te,le=Fe;break}}if(ee&&le)break}if(!ee||!le){if(console.log("[Voice Agent] No matching decision/option found for:",L.option),window.speechSynthesis){const Fe=new SpeechSynthesisUtterance(`Could not find option ${L.option}. Please try again.`);Fe.rate=1,window.speechSynthesis.speak(Fe)}(($=Me.current)==null?void 0:$.continuous)||!1?Ce("listening"):(Ce("idle"),et(!1));return}console.log("[Voice Agent] Requesting confirmation for:",le.label),await un({eventType:"VOICE_ACTION_REQUESTED",intentId:we,actorId:je,tenantId:ze,payload:{command:L.action,decisionId:ee.decisionId,optionId:le.id,optionLabel:le.label,confirmationRequired:!0},reason:"Decision selection requested (confirmation required)"});const rt=setTimeout(()=>{console.log("[Voice Agent] Confirmation timeout - clearing pending action"),Mr(null)},3e4);if(Kn.current=rt,Mr({type:"select_decision",action:"select_decision",params:{decisionId:ee.decisionId,optionId:le.id,optionLabel:le.label},timeout:rt}),window.speechSynthesis){const Te=new SpeechSynthesisUtterance(`Asking confirmation: Select ${le.label}? Say 'Confirm' to proceed, or 'Cancel' to abort.`);Te.rate=1,window.speechSynthesis.speak(Te)}((Re=Me.current)==null?void 0:Re.continuous)||!1?Ce("listening"):setTimeout(()=>{var Te;try{(Te=Me.current)==null||Te.start(),Ce("listening"),et(!0)}catch(Fe){console.error("[Voice Agent] Error restarting for confirmation:",Fe)}},500);return}if(L.type==="update_action_outcome"){console.log("[Voice Agent] Action outcome update command:",L.actionIdentifier,L.outcomeType),console.log("[Voice Agent] Available actions:",d.length,d.map(Te=>({id:Te.actionId,desc:Te.description,outcome:Te.outcome})));let ee=null;if(d.length===0){if(console.log("[Voice Agent] No actions available yet"),window.speechSynthesis){const Fe=new SpeechSynthesisUtterance("No actions available yet. Please wait for actions to be generated.");Fe.rate=1,window.speechSynthesis.speak(Fe)}((me=Me.current)==null?void 0:me.continuous)||!1?Ce("listening"):(Ce("idle"),et(!1));return}const le=L.actionIdentifier.toLowerCase();if(/^\d+$/.test(le)){const Te=parseInt(le)-1;if(Te>=0&&Te<d.length){const Fe=d[Te];(!Fe.outcome||Fe.outcome==="PENDING")&&(ee=Fe,console.log("[Voice Agent] Matched by number:",Te,Fe.description))}}if(!ee)for(const Te of d){if(Te.outcome&&Te.outcome!=="PENDING")continue;const Fe=Te.description.toLowerCase(),It=Te.actionId.toLowerCase();if(Fe.includes(le)||le.includes(Fe.split(" ")[0])){ee=Te,console.log("[Voice Agent] Matched by description:",Te.description);break}const Xt=le.split(" "),Vt=Fe.split(" ");if(Xt.filter(Sf=>Vt.some(bf=>bf.includes(Sf)||Sf.includes(bf))).length>=Math.min(2,Xt.length)){ee=Te,console.log("[Voice Agent] Matched by word overlap:",Te.description);break}if(It.includes(le)||le===It.split("-")[0]){ee=Te,console.log("[Voice Agent] Matched by ID:",Te.actionId);break}}if(!ee){if(console.log("[Voice Agent] No matching action found for:",L.actionIdentifier),console.log("[Voice Agent] Available actions:",d.map(Fe=>Fe.description)),window.speechSynthesis){const Fe=new SpeechSynthesisUtterance(`Could not find action ${L.actionIdentifier}. Available actions: ${d.slice(0,3).map(It=>It.description).join(", ")}.`);Fe.rate=1,window.speechSynthesis.speak(Fe)}((ne=Me.current)==null?void 0:ne.continuous)||!1?Ce("listening"):(Ce("idle"),et(!1));return}console.log("[Voice Agent] Requesting confirmation for:",ee.description,L.outcomeType),await un({eventType:"VOICE_ACTION_REQUESTED",intentId:we,actorId:je,tenantId:ze,payload:{command:L.action,actionId:ee.actionId,actionDescription:ee.description,outcomeType:L.outcomeType,confirmationRequired:!0},reason:"Action outcome update requested (confirmation required)"});const rt=setTimeout(()=>{console.log("[Voice Agent] Confirmation timeout - clearing pending action"),Mr(null)},3e4);if(Kn.current=rt,Mr({type:"update_action_outcome",action:"update_action_outcome",params:{actionId:ee.actionId,actionDescription:ee.description,outcomeType:L.outcomeType},timeout:rt}),window.speechSynthesis){const Te=L.outcomeType.toLowerCase().replace(/_/g," "),Fe=new SpeechSynthesisUtterance(`Asking confirmation: Mark ${ee.description} as ${Te}? Say 'Confirm' to proceed, or 'Cancel' to abort.`);Fe.rate=1,window.speechSynthesis.speak(Fe)}((ge=Me.current)==null?void 0:ge.continuous)||!1?Ce("listening"):setTimeout(()=>{var Te;try{(Te=Me.current)==null||Te.start(),Ce("listening"),et(!0)}catch(Fe){console.error("[Voice Agent] Error restarting for confirmation:",Fe)}},500);return}if(L.type==="scroll"){console.log("[Voice Agent] Executing scroll command:",L.direction),await un({eventType:"VOICE_ACTION_REQUESTED",intentId:we,actorId:je,tenantId:ze,payload:{command:L.action,parameters:{direction:L.direction},confirmationRequired:!1},reason:"Navigation command requested"});const ee=Ok.current||window,le=ee===window?window.innerHeight*.8:ee.clientHeight*.8;console.log("[Voice Agent] Scrolling",L.direction,"by",le,"px"),L.direction==="down"?ee===window?window.scrollBy({top:le,behavior:"smooth"}):ee.scrollBy({top:le,behavior:"smooth"}):L.direction==="up"&&(ee===window?window.scrollBy({top:-le,behavior:"smooth"}):ee.scrollBy({top:-le,behavior:"smooth"})),await un({eventType:"VOICE_NAVIGATION_EXECUTED",intentId:we,actorId:je,tenantId:ze,payload:{command:L.action,direction:L.direction,scrollAmount:le},reason:"Navigation command executed"}),console.log("[Voice Agent] Scroll command executed successfully"),((oe=Me.current)==null?void 0:oe.continuous)||!1?(Ce("listening"),console.log("[Voice Agent] Continuous mode - keeping mic active")):(Ce("idle"),et(!1));return}if(L.type==="read"){console.log("[Voice Agent] Read command detected:",L.target,L.identifier),console.log("[Voice Agent] Content functions available:",{getDecisionContent:typeof Us,getActionContent:typeof Bs,getExplanationContent:typeof dl,getIntentSummary:typeof zs,getCurrentContent:typeof pl,getComplianceContent:typeof ul,getRiskContent:typeof hl,getNextStepContent:typeof fl});let ee=null,le=L.target;try{switch(L.target){case"decision":console.log("[Voice Agent] Extracting decision content, identifier:",L.identifier),ee=Us?Us(L.identifier):null,console.log("[Voice Agent] Decision content extracted:",ee?`${ee.substring(0,50)}...`:"null");break;case"action":console.log("[Voice Agent] Extracting action content, identifier:",L.identifier),ee=Bs?Bs(L.identifier):null,console.log("[Voice Agent] Action content extracted:",ee?`${ee.substring(0,50)}...`:"null");break;case"explanation":console.log("[Voice Agent] Extracting explanation content"),ee=dl?dl():null,console.log("[Voice Agent] Explanation content extracted:",ee?`${ee.substring(0,50)}...`:"null");break;case"intent":console.log("[Voice Agent] Extracting intent summary"),ee=zs?zs():null,console.log("[Voice Agent] Intent summary extracted:",ee?`${ee.substring(0,50)}...`:"null");break;case"compliance":console.log("[Voice Agent] Extracting compliance content"),ee=ul?ul():null,console.log("[Voice Agent] Compliance content extracted:",ee?`${ee.substring(0,50)}...`:"null");break;case"risk":console.log("[Voice Agent] Extracting risk content"),ee=hl?hl():null,console.log("[Voice Agent] Risk content extracted:",ee?`${ee.substring(0,50)}...`:"null");break;case"next_step":console.log("[Voice Agent] Extracting next step content"),ee=fl?fl():null,console.log("[Voice Agent] Next step content extracted:",ee?`${ee.substring(0,50)}...`:"null");break;case"current":console.log("[Voice Agent] Extracting current content"),ee=pl?pl():null,console.log("[Voice Agent] Current content extracted:",ee?`${ee.substring(0,50)}...`:"null");break;default:console.log("[Voice Agent] Unknown read target:",L.target),ee=null}}catch(Qt){console.error("[Voice Agent] Error extracting content:",Qt),ee=null}if(ee)await un({eventType:"VOICE_READ_REQUESTED",intentId:we,actorId:je,tenantId:ze,payload:{command:L.action,target:L.target,identifier:L.identifier,contentLength:ee.length},reason:"Read command requested"}),ll(ee,{rate:1,pitch:1,volume:1,lang:"en-US",onStart:()=>{console.log("[Voice Agent] Reading content:",le,"length:",ee.length)},onError:Te=>{console.error("[Voice Agent] Failed to read content:",Te),console.log("[Voice Agent] Content to read (fallback):",ee)},onEnd:()=>{console.log("[Voice Agent] Finished reading:",le)}})||console.log("[Voice Agent] Content to read (TTS unavailable):",ee);else{console.log("[Voice Agent] No content available for:",L.target),await un({eventType:"VOICE_READ_REQUESTED",intentId:we,actorId:je,tenantId:ze,payload:{command:L.action,target:L.target,identifier:L.identifier,contentLength:0,error:"No content available"},reason:"Read command requested but no content available"});const Qt=`No ${L.target} content available to read.`;ll(Qt,{rate:1,onError:Te=>{console.error("[Voice Agent] Failed to speak error message:",Te)}})}((q=Me.current)==null?void 0:q.continuous)||!1?(Ce("listening"),console.log("[Voice Agent] Continuous mode - keeping mic active")):(Ce("idle"),et(!1));return}if(L.type==="unknown")console.log("[Voice Agent] Command type is unknown, falling through to intent input");else{console.warn("[Voice Agent] Command recognized but not handled:",L.type),((he=Me.current)==null?void 0:he.continuous)||!1?Ce("listening"):(Ce("idle"),et(!1));return}}catch(L){console.error("[Voice Agent] Error processing command:",L)}else console.log("[Voice Agent] AI Agent Mode is disabled, treating as intent input");e(Z),setTimeout(()=>{var pe;((pe=Me.current)==null?void 0:pe.continuous)||!1?Ce("listening"):(Ce("idle"),et(!1)),Z&&setTimeout(()=>{dn.current&&dn.current()},150)},500)},A.onerror=se=>{console.error("Speech recognition error:",se.error),Ce("idle"),et(!1),tt.current=!1,se.error==="not-allowed"?v("Microphone permission denied. Please allow microphone access and try again."):se.error==="network"?console.warn("Speech recognition requires internet connection. Voice input temporarily unavailable. You can still type your intent."):se.error==="no-speech"?console.log("No speech detected - voice input cancelled"):se.error==="aborted"?console.log("Speech recognition aborted"):(console.warn(`Speech recognition failed: ${se.error}. You can still type your intent.`),v(`Voice input unavailable (${se.error}). You can type your intent instead.`))},A.onend=()=>{if(console.log("Speech recognition ended"),!(localStorage.getItem("aiAgentMode")==="true")||!lt)tt.current=!1,et(ie=>ie&&(Ce("idle"),!1));else{console.log("[Speech Recognition] Continuous mode - restarting...");try{setTimeout(()=>{Me.current&&lt&&!tt.current&&Me.current.start()},100)}catch(ie){console.log("[Speech Recognition] Restart skipped:",ie.message),tt.current=!1}}},Me.current=A,console.log(" Speech Recognition initialized successfully")}catch(A){console.error(" Failed to initialize Speech Recognition:",A),Me.current=null}return()=>{if(Me.current){try{Me.current.stop()}catch{}Me.current=null}}},[]),w.useEffect(()=>{const M=async()=>{try{if(_||m)return;try{const Z=await ku({type:"BUY_PROPERTY",extractedInfo:{},payload:{location:"General",budget:0},id:"general-insights"},"IN");Z&&(F(Z),console.log("[General Insights] Loaded general knowledge-based insights"))}catch(Y){console.warn("[General Insights] Could not load general RAG insights:",Y)}try{const Z=await Qs({type:"BUY_PROPERTY",extractedInfo:{},payload:{},id:"general-legal"},{decision:"ALLOW",reason:"General compliance information",confidence:"MEDIUM"},null,[]);Z&&(S(Z),console.log("[General Insights] Loaded general legal references"))}catch(Y){console.warn("[General Insights] Could not load general legal references:",Y)}}catch(Y){console.warn("[General Insights] Error loading general insights:",Y)}},A=setTimeout(()=>{M()},500);return()=>clearTimeout(A)},[]),w.useEffect(()=>{(async()=>{var A,Y;try{if(!xe||!xe.tokenParsed){console.warn("Keycloak token not available, skipping resume check"),Rt(!1);return}const se=xe.tokenParsed,Z=(se==null?void 0:se.sub)||"unknown-user",ie=(se==null?void 0:se.realm)||"intent-platform";try{const V=await $h(Z,ie);if(Pe(V),V&&V.resumable&&V.hasOpenIntent&&(s(V.intent),l(V.decisions||[]),h(V.actions||[]),p(V.lifecycleState),e(((Y=(A=V.intent)==null?void 0:A.payload)==null?void 0:Y.originalText)||""),V.intent&&V.lifecycleState!=="CREATED"))try{const $=await vu(V.intent);if(a($),$.decision==="ALLOW")try{const Re=await Hp(V.intent,$,V.decisions||[]);if(Re){g(Re);try{const me=await Qs(V.intent,$,Re,V.decisions||[]);me&&S(me)}catch(me){console.error("Explainability engine error on resume:",me)}}}catch(Re){console.error("Risk engine error on resume:",Re)}else try{const Re=await Qs(V.intent,$,null,V.decisions||[]);Re&&S(Re)}catch(Re){console.error("Explainability engine error on resume:",Re)}}catch($){console.error("Error restoring compliance:",$)}}catch(V){console.warn("Resume API call failed (this is OK if Decision Engine is not running):",V.message),Pe({hasOpenIntent:!1,resumable:!1})}}catch(se){console.warn("Resume check error (engines may not be running):",se.message),Pe({hasOpenIntent:!1,resumable:!1})}finally{Rt(!1)}})()},[]),w.useEffect(()=>{var M,A;if(f==="COMPLETED"&&r&&c.length>0&&d.length>0){const Y=((M=xe.tokenParsed)==null?void 0:M.email)||((A=xe.tokenParsed)==null?void 0:A.preferred_username)||null;Y&&!ke.current&&d.every(Z=>Z.outcome==="COMPLETED"||Z.outcome==="CONFIRMED")&&(ke.current=!0,Jp({userEmail:Y,intent:r,decisions:c,actions:d,intentId:r.id||"unknown"}).catch(Z=>{console.warn("[Email] Failed to send intent completed email:",Z),ke.current=!1}))}else f!=="COMPLETED"&&(ke.current=!1)},[f,r,c,d]);const Vs=async(M,A,Y=!1)=>{var se,Z,ie,V,$,Re;i(!0),v(null);try{const me=xe.tokenParsed,ne=(me==null?void 0:me.sub)||"unknown-user",ge=await $y(M,A,ne,Y),oe=ge.decision.evolutionState==="CONFIRMED";if(oe&&ve.current){const L=ge.decision.type||"Decision",pe=((se=ge.decision.options)==null?void 0:se.find(ze=>ze.id===A))||ge.decision.selectedOption||{label:A},je=pe.label||pe.name||A;ve.current({text:` Decision confirmed: ${L}  ${je}`,type:"decision_confirmed",timestamp:new Date().toLocaleString()})}let q=[];if(l(L=>{const pe=L.map(we=>we.decisionId===M?ge.decision:we);if(ge.unlockedDecisions&&ge.unlockedDecisions.length>0){const we=new Set(pe.map(le=>le.decisionId)),ee=ge.unlockedDecisions.filter(le=>!we.has(le.decisionId));pe.push(...ee),ve.current&&ee.length>0&&setTimeout(()=>{ve.current&&ve.current({text:` ${ee.length} new decision${ee.length>1?"s":""} unlocked. Please review.`,type:"decisions_unlocked",timestamp:new Date().toLocaleString()})},0)}q=pe;const je=pe.filter(we=>we.evolutionState==="PENDING"),ze=pe.filter(we=>we.evolutionState==="CONFIRMED");return je.length===0&&ze.length>0?p("DECISIONS_MADE"):je.length>0&&p("AWAITING_DECISIONS"),pe}),oe){const L=((Z=xe.tokenParsed)==null?void 0:Z.email)||((ie=xe.tokenParsed)==null?void 0:ie.preferred_username)||null;L&&fE({userEmail:L,decision:ge.decision,decisions:q.length>0?q:c,intentId:(r==null?void 0:r.id)||"unknown"}).catch(pe=>{console.warn("[Email] Failed to send decision confirmed email:",pe)})}if(ge.unlockedActions&&ge.unlockedActions.length>0||oe){const L=q.length>0?q:c.map(we=>we.decisionId===M?ge.decision:we),pe=L.filter(we=>we.evolutionState==="PENDING"),je=L.filter(we=>we.evolutionState==="CONFIRMED"),ze=pe.length===0&&je.length>0?"DECISIONS_MADE":f;try{console.log("[Decision Select] Fetching actions, lifecycleState:",ze,"decisions:",L.length);const we=await Br(r,L,ze,d);console.log("[Decision Select] Actions received:",((V=we.actions)==null?void 0:V.length)||0),we.actions&&we.actions.length>0?h(we.actions):we.actions&&we.actions.length===0&&d.length>0?console.warn("[Decision Select] Engine returned empty actions, keeping existing"):h(we.actions||[]),we.nextLifecycleState&&p(we.nextLifecycleState)}catch(we){console.error("[Decision Select] Action engine error:",we),d.length===0&&console.warn("[Decision Select] No actions available, keeping empty state")}}if(Y&&oe){const L=q.length>0?q:c.map(pe=>pe.decisionId===M?ge.decision:pe);if(cE(L)){const pe=lE(L),je=(($=xe.tokenParsed)==null?void 0:$.email)||((Re=xe.tokenParsed)==null?void 0:Re.preferred_username)||null;je&&oE({userEmail:je,agent:pe.agent,lender:pe.lender,property:pe.property,downPayment:pe.downPayment,intentId:(r==null?void 0:r.id)||"unknown"}).catch(ze=>{console.warn("[Email] Failed to send initial confirmation:",ze)})}}}catch(me){v(me.message||"Failed to select decision"),console.error("Decision selection error:",me)}finally{i(!1)}},Lk=(M,A)=>{var se,Z;const Y=((se=M.originalDecision)==null?void 0:se.evolutionState)||((Z=M.originalDecision)==null?void 0:Z.state);if(Y==="PENDING"||!Y)Le(M),pt(A||null),H(""),v(null),ue(!0);else if(Y==="CONFIRMED")Le(M),pt(A||null),H(""),v(null),ue(!0);else{v(`Cannot change decision. Invalid state: ${Y||"UNKNOWN"}`),console.warn("Attempted to change decision in invalid state:",Y,M);return}},Mk=async()=>{var A,Y,se,Z,ie,V,$,Re,me,ne,ge;if(!Ee){v("Please select a new option");return}const M=((A=z.originalDecision)==null?void 0:A.evolutionState)||((Y=z.originalDecision)==null?void 0:Y.state)||z.evolutionState;if(M==="PENDING"||!M){i(!0),v(null);try{const oe=xe.tokenParsed,q=(oe==null?void 0:oe.sub)||"unknown-user",he=z.decisionId||((se=z.originalDecision)==null?void 0:se.decisionId)||((Z=z.originalDecision)==null?void 0:Z.id);await Vs(he,Ee,!0),ue(!1),H(""),Le(null),pt(null),v(null)}catch(oe){v(oe.message||"Failed to update decision"),console.error("Decision update error:",oe)}finally{i(!1)}return}if(!ct.trim()){v("Change reason is required for confirmed decisions");return}if(M!=="CONFIRMED"){const oe=`Cannot change decision. Decision must be CONFIRMED first. Current state: ${M||"UNKNOWN"}. Please accept the decision first before changing it.`;v(oe),console.error("Decision change validation failed:",{decisionState:M,originalDecision:z.originalDecision,decisionToChange:z});return}i(!0),v(null);try{const oe=xe.tokenParsed,q=(oe==null?void 0:oe.sub)||"unknown-user",he=z.decisionId||((ie=z.originalDecision)==null?void 0:ie.decisionId)||((V=z.originalDecision)==null?void 0:V.id),L=await HT(he,Ee,ct,q);l(je=>{const ze=je.map(le=>le.decisionId===z.decisionId?L.decision:le),we=ze.filter(le=>le.evolutionState==="PENDING"),ee=ze.filter(le=>le.evolutionState==="CONFIRMED");return we.length===0&&ee.length>0?p("DECISIONS_MADE"):we.length>0&&p("AWAITING_DECISIONS"),ze});const pe=(($=xe.tokenParsed)==null?void 0:$.email)||((Re=xe.tokenParsed)==null?void 0:Re.preferred_username)||null;if(pe&&Ee){const je=((me=z.options)==null?void 0:me.find(ze=>ze.id===Ee))||((ge=(ne=z.originalDecision)==null?void 0:ne.options)==null?void 0:ge.find(ze=>ze.id===Ee));pE({userEmail:pe,decision:L.decision,newOption:je,reason:ct,intentId:(r==null?void 0:r.id)||"unknown"}).catch(ze=>{console.warn("[Email] Failed to send decision changed email:",ze)})}ue(!1),H(""),Le(null),pt(null),v(null)}catch(oe){v(oe.message||"Failed to change decision"),console.error("Decision change error:",oe)}finally{i(!1)}},jk=(M,A)=>{js(M),Fs(A),P(""),be(""),kt(!0)},Fk=async()=>{var M,A,Y,se;if((_e==="FAILED"||_e==="BLOCKED"||_e==="RESCHEDULED")&&!C.trim()){v(`${_e} requires a reason`);return}if(_e==="RESCHEDULED"&&!W){v("RESCHEDULED requires a scheduled date");return}i(!0),v(null);try{const Z=xe.tokenParsed,ie=(Z==null?void 0:Z.sub)||"unknown-user",V=await yu(mt.actionId,_e,ie,C||null,W||null),$=V.action;console.log("[Action Outcome] Action updated:",{actionId:$.actionId,outcome:$.outcome,description:$.description}),h(me=>{const ne=me.map(ge=>ge.actionId===mt.actionId?$:ge);return console.log("[Action Outcome] Actions state updated:",ne.length,"actions"),ne});const Re=((M=xe.tokenParsed)==null?void 0:M.email)||((A=xe.tokenParsed)==null?void 0:A.preferred_username)||null;if(Re&&aE({userEmail:Re,action:$,status:_e,reason:C||null,scheduledFor:W||null,intentId:(r==null?void 0:r.id)||"unknown"}).catch(me=>{console.warn("[Email] Failed to send action status email:",me)}),_e==="COMPLETED"||_e==="CONFIRMED"){const me=d.map(ne=>ne.actionId===mt.actionId?$:ne);try{const ne=await Br(r,c,f,me);if(ne.actions&&ne.actions.length>0){console.log("[Action Flow] Merging actions after completion:",{existing:me.length,new:ne.actions.length});const ge=new Map;me.forEach(q=>{const he=q.actionId||q.id;ge.set(he,q)}),ne.actions.forEach(q=>{const he=q.actionId||q.id,L=ge.get(he);if(L){const pe=L.outcome==="COMPLETED"||L.outcome==="CONFIRMED",je=q.outcome==="COMPLETED"||q.outcome==="CONFIRMED";if(pe&&!je)return;ge.set(he,q)}else ge.set(he,q)});const oe=Array.from(ge.values()).sort((q,he)=>{const L=q.order||q.sequence||999,pe=he.order||he.sequence||999;return L-pe});console.log("[Action Flow] Final merged actions:",oe.length),h(oe),ne.nextLifecycleState&&p(ne.nextLifecycleState)}else console.log("[Action Flow] No new actions, keeping updated action state"),h(me)}catch(ne){console.warn("[Action Flow] Failed to refresh actions for sequential unlock:",ne),h(me)}}else if(V.nextActions&&V.nextActions.length>0){const me=d.map(ne=>ne.actionId===mt.actionId?$:ne);try{const ne=await Br(r,c,f,me);if(ne.actions&&ne.actions.length>0){const ge=new Map;me.forEach(q=>{const he=q.actionId||q.id;ge.set(he,q)}),ne.actions.forEach(q=>{const he=q.actionId||q.id;ge.set(he,q)});const oe=Array.from(ge.values()).sort((q,he)=>{const L=q.order||q.sequence||999,pe=he.order||he.sequence||999;return L-pe});h(oe)}else h(me)}catch(ne){console.warn("[Action Flow] Failed to refresh actions:",ne),h(me)}}else h(me=>me.map(ne=>ne.actionId===mt.actionId?$:ne));if(V.intentStatus&&p(V.intentStatus),V.intentStatus==="COMPLETED"){const me=((Y=xe.tokenParsed)==null?void 0:Y.email)||((se=xe.tokenParsed)==null?void 0:se.preferred_username)||null;me&&r&&Jp({userEmail:me,intent:r,decisions:c,actions:d.map(ne=>ne.actionId===mt.actionId?$:ne),intentId:r.id||"unknown"}).catch(ne=>{console.warn("[Email] Failed to send intent completed email:",ne)})}kt(!1),P(""),be(""),js(null),Fs(null)}catch(Z){v(Z.message||"Failed to update action outcome"),console.error("Action outcome error:",Z)}finally{i(!1)}},Uk=()=>{if(!Me.current){v("Speech recognition not available in this browser");return}if(tt.current||lt)try{Me.current.stop(),tt.current=!1,Ce("idle"),et(!1)}catch(A){console.error("Error stopping recognition:",A),tt.current=!1}else{if(tt.current){console.log("[Voice Input] Recognition already running, skipping start");return}try{v(null);const A=localStorage.getItem("aiAgentMode")==="true";Me.current.continuous=A,console.log("[Voice Input] Starting listening, continuous:",A),Me.current.start()}catch(A){console.error("Error starting recognition:",A),tt.current=!1,A.message&&A.message.includes("already started")?(console.log("[Voice Input] Recognition was already started, resetting state"),tt.current=!0,et(!0),Ce("listening")):v("Failed to start voice input. Please check microphone permissions.")}}},Bk=w.useCallback(async M=>{if(!M||!M.trim()||!c||c.length===0)return;const A=M.trim().toLowerCase(),Y=xe.tokenParsed;Y!=null&&Y.sub;const se=(Y==null?void 0:Y.name)||(Y==null?void 0:Y.preferred_username)||"User";let Z=null,ie=null;for(const V of c)if(V.evolutionState!=="CONFIRMED"&&!(!V.options||V.options.length===0)){for(const $ of V.options){const Re=($.label||$.id||"").toLowerCase(),me=$.id;if(A.includes(Re)||A.includes(me.toLowerCase())){Z=V,ie=$;break}}if(Z)break}if(Z&&ie)try{await Vs(Z.decisionId||Z.id,ie.id,!0),l(V=>V.map($=>$.decisionId===Z.decisionId||$.id===Z.id?{...$,decidedBy:se,decisionMethod:"chat",decisionTimestamp:new Date().toISOString()}:$)),console.log(`[Chat Decision] User ${se} confirmed decision via chat: ${Z.type}  ${ie.label||ie.id}`)}catch(V){console.error("[Chat Decision] Error confirming decision:",V),v("Failed to confirm decision. Please try again.")}else console.log("[Chat] Message received but no decision match:",M)},[c,Vs]);return u.jsxs(u.Fragment,{children:[u.jsx(WR,{result:r,compliance:o,decisions:c,actions:d,evidenceList:k,ragResponse:_,explainabilityResult:m,onAnalyze:ml,onDecisionSelect:(M,A,Y)=>Vs(M,A,Y),onActionOutcome:(M,A)=>jk(M,A),onDecisionChangeClick:Lk,onVoiceClick:Uk,onChatMessage:Bk,onAddChatMessage:ve,input:t,setInput:e,loading:n,error:y}),J&&z&&u.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},onClick:()=>ue(!1),children:u.jsxs("div",{style:{backgroundColor:"#FAFBFC",padding:30,borderRadius:12,border:"1px solid #D1D5DB",width:500,maxWidth:"90%",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"},onClick:M=>M.stopPropagation(),children:[u.jsx("h3",{style:{marginTop:0,color:"#111827"},children:"Change Decision"}),(()=>{var Y,se,Z;const M=((Y=z==null?void 0:z.originalDecision)==null?void 0:Y.evolutionState)||((se=z==null?void 0:z.originalDecision)==null?void 0:se.state),A=M==="PENDING"||!M;return u.jsxs(u.Fragment,{children:[u.jsx("p",{style:{color:"#4B5563",marginBottom:20},children:A?"Select a different option. You can then accept this new option.":"Select a new option and provide a reason for changing this confirmed decision."}),((Z=z==null?void 0:z.originalDecision)==null?void 0:Z.options)&&z.originalDecision.options.length>0&&u.jsxs("div",{style:{marginBottom:15},children:[u.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:700,color:"#111827"},children:"Select New Option (Required):"}),u.jsxs("select",{value:Ee||"",onChange:ie=>pt(ie.target.value),style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #D1D5DB",fontSize:14,background:"#FFFFFF",color:"#111827"},children:[u.jsx("option",{value:"",children:"-- Select an option --"}),z.originalDecision.options.map(ie=>{var $,Re;const V=ie.id===(($=z.selectedOption)==null?void 0:$.id)||ie.id===((Re=z.option)==null?void 0:Re.id);return u.jsxs("option",{value:ie.id,children:[ie.label||ie.id," ",V?"(Current)":""]},ie.id)})]})]}),!A&&u.jsxs("div",{style:{marginBottom:15},children:[u.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:700,color:"#111827"},children:"Reason for Change (Required):"}),u.jsx("textarea",{value:ct,onChange:ie=>H(ie.target.value),placeholder:"Please explain why you are changing this decision...",rows:4,style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #D1D5DB",fontSize:14,background:"#FFFFFF",color:"#111827"}})]})]})})(),y&&u.jsx("div",{style:{marginBottom:15,padding:10,background:"rgba(239,68,68,0.1)",border:"1px solid #EF4444",borderRadius:8,color:"#DC2626",fontSize:14},children:y}),(()=>{var Z,ie;const M=((Z=z==null?void 0:z.originalDecision)==null?void 0:Z.evolutionState)||((ie=z==null?void 0:z.originalDecision)==null?void 0:ie.state),A=M==="PENDING"||!M,Y=A?Ee&&!n:ct.trim()&&Ee&&!n,se=A?!Ee||n:!ct.trim()||!Ee||n;return u.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:10},children:[u.jsx("button",{onClick:()=>{ue(!1),H(""),pt(null),v(null)},style:{padding:"10px 20px",backgroundColor:"#FFFFFF",color:"#111827",border:"1px solid #111827",borderRadius:8,cursor:"pointer",fontWeight:600},onMouseEnter:V=>{V.currentTarget.style.backgroundColor="#111827",V.currentTarget.style.color="#FFFFFF"},onMouseLeave:V=>{V.currentTarget.style.backgroundColor="#FFFFFF",V.currentTarget.style.color="#111827"},children:"Cancel"}),u.jsx("button",{onClick:Mk,disabled:se,style:{padding:"10px 20px",backgroundColor:Y?"#111827":"#9CA3AF",color:"#FFFFFF",border:"none",borderRadius:8,cursor:Y?"pointer":"not-allowed",fontWeight:600},onMouseEnter:V=>{Y&&(V.currentTarget.style.backgroundColor="#000000")},onMouseLeave:V=>{Y&&(V.currentTarget.style.backgroundColor="#111827")},children:A?"Select & Accept":"Confirm Change"})]})})()]})}),ye&&mt&&_e&&u.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},onClick:()=>kt(!1),children:u.jsxs("div",{style:{backgroundColor:"#FAFBFC",padding:30,borderRadius:12,border:"1px solid #D1D5DB",width:500,maxWidth:"90%",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"},onClick:M=>M.stopPropagation(),children:[u.jsx("h3",{style:{marginTop:0,color:"#111827"},children:"Update Action Outcome"}),u.jsxs("p",{style:{color:"#4B5563",marginBottom:20},children:["Action: ",u.jsx("strong",{style:{color:"#111827"},children:mt.description})]}),u.jsxs("p",{style:{color:"#4B5563",marginBottom:20},children:["Outcome: ",u.jsx("strong",{style:{color:"#111827"},children:_e})]}),(_e==="FAILED"||_e==="BLOCKED"||_e==="RESCHEDULED")&&u.jsxs("div",{style:{marginBottom:15},children:[u.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:700,color:"#111827"},children:"Reason (Required):"}),u.jsx("textarea",{value:C,onChange:M=>P(M.target.value),placeholder:"Please explain why...",rows:3,style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #D1D5DB",fontSize:14,background:"#FFFFFF",color:"#111827"}})]}),_e==="RESCHEDULED"&&u.jsxs("div",{style:{marginBottom:15},children:[u.jsx("label",{style:{display:"block",marginBottom:8,fontWeight:700,color:"#111827"},children:"Scheduled For (Required):"}),u.jsx("input",{type:"date",value:W,onChange:M=>be(M.target.value),style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #D1D5DB",fontSize:14,background:"#FFFFFF",color:"#111827"}})]}),u.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:10},children:[u.jsx("button",{onClick:()=>{kt(!1),P(""),be("")},style:{padding:"10px 20px",backgroundColor:"#FFFFFF",color:"#111827",border:"1px solid #111827",borderRadius:8,cursor:"pointer",fontWeight:600},onMouseEnter:M=>{M.currentTarget.style.backgroundColor="#111827",M.currentTarget.style.color="#FFFFFF"},onMouseLeave:M=>{M.currentTarget.style.backgroundColor="#FFFFFF",M.currentTarget.style.color="#111827"},children:"Cancel"}),u.jsx("button",{onClick:Fk,disabled:n||(_e==="FAILED"||_e==="BLOCKED"||_e==="RESCHEDULED")&&!C.trim()||_e==="RESCHEDULED"&&!W,style:{padding:"10px 20px",backgroundColor:!n&&!((_e==="FAILED"||_e==="BLOCKED"||_e==="RESCHEDULED")&&!C.trim()||_e==="RESCHEDULED"&&!W)?"#111827":"#9CA3AF",color:"#FFFFFF",border:"none",borderRadius:8,cursor:!n&&!((_e==="FAILED"||_e==="BLOCKED"||_e==="RESCHEDULED")&&!C.trim()||_e==="RESCHEDULED"&&!W)?"pointer":"not-allowed",fontWeight:600},onMouseEnter:M=>{!n&&!((_e==="FAILED"||_e==="BLOCKED"||_e==="RESCHEDULED")&&!C.trim()||_e==="RESCHEDULED"&&!W)&&(M.currentTarget.style.backgroundColor="#000000")},onMouseLeave:M=>{!n&&!((_e==="FAILED"||_e==="BLOCKED"||_e==="RESCHEDULED")&&!C.trim()||_e==="RESCHEDULED"&&!W)&&(M.currentTarget.style.backgroundColor="#111827")},children:"Confirm"})]})]})})]})}function qR({onIntentCreated:t}){const[e,n]=w.useState(""),[i,r]=w.useState(!1),[s,o]=w.useState(null),a=async()=>{var c;if(!e.trim()){o("Please enter your intent");return}r(!0),o(null);try{const l=await Wh({intentType:"BUY_PROPERTY",payload:{text:e,location:"",budget:null,area:null},tenantId:"intent-platform",actorId:((c=xe.tokenParsed)==null?void 0:c.preferred_username)||"user1"});t(l)}catch(l){o(l.message||"Failed to create intent"),r(!1)}};return u.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",padding:"40px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:u.jsxs("div",{style:{background:"rgba(255,255,255,0.95)",borderRadius:"16px",padding:"40px",maxWidth:"600px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[u.jsx("h1",{style:{fontSize:"32px",fontWeight:"bold",marginBottom:"12px",color:"#1a1a1a"},children:"Create Your Intent"}),u.jsx("p",{style:{fontSize:"16px",color:"#666",marginBottom:"32px"},children:'Tell us what you want to do. For example: "I want to buy a property in Vizag under 50 lakhs"'}),u.jsx("div",{style:{marginBottom:"24px"},children:u.jsx("textarea",{value:e,onChange:c=>n(c.target.value),placeholder:"Enter your intent here...",style:{width:"100%",minHeight:"120px",padding:"16px",fontSize:"16px",border:"2px solid #e0e0e0",borderRadius:"8px",fontFamily:"inherit",resize:"vertical"},onKeyDown:c=>{c.key==="Enter"&&c.ctrlKey&&a()}})}),s&&u.jsx("div",{style:{padding:"12px",background:"#fee",color:"#c33",borderRadius:"8px",marginBottom:"16px",fontSize:"14px"},children:s}),u.jsx("button",{onClick:a,disabled:i||!e.trim(),style:{width:"100%",padding:"16px",fontSize:"18px",fontWeight:"bold",background:i?"#ccc":"#667eea",color:"white",border:"none",borderRadius:"8px",cursor:i?"not-allowed":"pointer",transition:"all 0.2s"},children:i?"Creating Intent...":"Create Intent"}),u.jsx("p",{style:{fontSize:"12px",color:"#999",marginTop:"16px",textAlign:"center"},children:"Press Ctrl+Enter to submit"})]})})}function ng(t){return new Date(t).toLocaleString()}function hr(t){if(t==null)return"";const e=typeof t;if(e==="string"||e==="number"||e==="boolean")return String(t);try{return JSON.stringify(t)}catch{return String(t)}}const HR=[{key:"core",label:"Core + Trust"},{key:"decisions",label:"Decisions"},{key:"actions",label:"Actions"},{key:"evidence",label:"Evidence"}];function KR({intent:t,onIntentUpdate:e}){var ue,z,Le,Ee,pt,ct;const[n,i]=w.useState(t),[r,s]=w.useState(null),[o,a]=w.useState([]),[c,l]=w.useState([]),[d,h]=w.useState([]),[f,p]=w.useState(null),[y,v]=w.useState(!1),[T,g]=w.useState(null),[m,S]=w.useState("core"),[k,E]=w.useState(""),[x,I]=w.useState([{id:"sys1",userId:"system",text:"Welcome to Living Learning Space  Intent-driven real estate platform.",createdAt:Date.now()}]),[_,F]=w.useState(null),[D,X]=w.useState(null),ce=((ue=xe.tokenParsed)==null?void 0:ue.preferred_username)||"user1",Pe="intent-platform";w.useEffect(()=>{n&&Qe()},[n==null?void 0:n.id]);async function Qe(){if(n){v(!0);try{const H=await vu(n);s(H),X(H);const ye=await Wy(n,(H==null?void 0:H.compliant)||!1);a(ye.decisions||[]);const kt=await Br(n,ye.decisions||[],ye.lifecycleState||"AWAITING_DECISIONS");l(kt.actions||[]);try{const mt=await KT(n.id);h(mt.evidence||[])}catch(mt){console.warn("[Evidence] Not available:",mt.message)}try{const mt=await ku(n);p(mt)}catch(mt){console.warn("[RAG] Not available:",mt.message)}}catch(H){g(H.message)}finally{v(!1)}}}async function Rt(){if(!k.trim()||!n)return;const H={id:`msg_${Date.now()}`,userId:ce,text:k,createdAt:Date.now()};I(ye=>[...ye,H]),E("");try{const ye=await Wh({intentType:n.type,payload:{...n.payload,text:k},tenantId:Pe,actorId:ce});ye&&(i(ye),e&&e(ye))}catch(ye){console.warn("[Chat] Intent Engine not available:",ye.message)}}async function We(H,ye){try{const kt=await $y(H,ye,ce,!0);F(kt),await Qe()}catch(kt){g(kt.message)}}async function Tt(H,ye,kt){try{await yu(H,ye,ce,kt),await Qe()}catch(mt){g(mt.message)}}const J=w.useMemo(()=>{if(!r)return null;const H=[{name:"Compliance Status",status:r.compliant?"PASS":"FAIL",note:r.compliant?"All requirements met":"Compliance issues found"},...(r.violations||[]).map(ye=>({name:"Violation",status:"FAIL",note:ye})),...(r.warnings||[]).map(ye=>({name:"Warning",status:"WARN",note:ye}))];return{summary:r.compliant?"Trust Receipt: Ready for approval":"Trust Receipt: Not ready. Complete required checkpoints.",checkpoints:H,gate:r.compliant?"UNLOCKED":"LOCKED",gateReason:r.gateReason||r.reason||"Compliance check required"}},[r]);return n?u.jsxs("div",{className:"living-space-container",style:{background:"radial-gradient(900px 600px at 10% -5%, rgba(34,197,94,.14), transparent 55%), radial-gradient(900px 600px at 110% 0%, rgba(59,130,246,.18), transparent 55%), radial-gradient(700px 500px at 50% 120%, rgba(168,85,247,.14), transparent 55%), linear-gradient(180deg, #030614 0%, var(--bg) 100%)",minHeight:"100vh"},children:[u.jsxs("div",{className:"living-space-topbar",children:[u.jsxs("div",{children:[u.jsx("div",{className:"living-space-h1",children:"Living Learning Space  Real Estate Intent Platform"}),u.jsx("div",{className:"living-space-sub",children:"Intent Engine  Decision Engine  Compliance Engine  Evidence Engine"})]}),u.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[u.jsx("button",{className:"living-space-btn",onClick:Qe,children:"Refresh"}),u.jsxs("span",{className:"living-space-pill",children:["Intent: ",u.jsx("b",{children:n.type||"N/A"})]})]})]}),T&&u.jsxs("div",{style:{marginTop:14,padding:12,background:"rgba(239,68,68,0.2)",border:"1px solid rgba(239,68,68,0.4)",borderRadius:12,color:"var(--bad)"},children:["Error: ",T]}),u.jsxs("div",{className:"living-space-grid",style:{marginTop:14},children:[u.jsxs("div",{className:"living-space-card",children:[u.jsx("div",{className:"living-space-title",children:"Current Intent"}),u.jsxs("div",{className:"living-space-item",children:[u.jsx("div",{style:{fontWeight:950},children:n.type||"BUY_PROPERTY"}),u.jsxs("div",{className:"living-space-small",style:{marginTop:6},children:["ID: ",n.id]}),((z=n.payload)==null?void 0:z.location)&&u.jsxs("div",{className:"living-space-small",style:{marginTop:6},children:["Location: ",n.payload.location]}),((Le=n.payload)==null?void 0:Le.budget)&&u.jsxs("div",{className:"living-space-small",style:{marginTop:6},children:["Budget: ",(Ee=n.payload.budget)==null?void 0:Ee.toLocaleString()]}),(f==null?void 0:f.summary)&&u.jsxs("div",{className:"living-space-small",style:{marginTop:8,padding:8,background:"rgba(100,150,255,0.1)",borderRadius:6},children:[u.jsx("b",{children:"RAG Summary:"})," ",f.summary.substring(0,100),"..."]})]})]}),u.jsxs("div",{className:"living-space-card",children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[u.jsxs("div",{children:[u.jsxs("div",{className:"living-space-title",children:["Intent: ",n.type||"BUY_PROPERTY"]}),u.jsx("div",{className:"living-space-small",children:((pt=n.payload)==null?void 0:pt.text)||"Real estate intent processing"})]}),r&&u.jsxs("span",{className:"living-space-pill",children:["Compliance: ",u.jsx("b",{children:r.compliant?"":""})]})]}),u.jsx("div",{className:"living-space-tabs",children:HR.map(H=>u.jsx("div",{className:`living-space-tab ${m===H.key?"active":""}`,onClick:()=>S(H.key),children:H.label},H.key))}),u.jsxs("div",{className:"living-space-layout",style:{marginTop:12},children:[u.jsxs("div",{children:[u.jsxs("div",{className:"living-space-card",style:{padding:12},children:[u.jsx("div",{className:"living-space-title",children:"AI Concierge"}),u.jsxs("div",{style:{marginBottom:12,padding:8,background:"rgba(100,150,255,0.1)",borderRadius:6},children:[u.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:" Current Intent:"}),u.jsxs("div",{className:"living-space-small",children:[u.jsx("b",{children:"Type:"})," ",n.type||"N/A"]}),(f==null?void 0:f.summary)&&u.jsxs("div",{className:"living-space-small",style:{marginTop:4},children:[u.jsx("b",{children:"Summary:"})," ",f.summary.substring(0,150),"..."]}),((ct=f==null?void 0:f.valuation_hint)==null?void 0:ct.confidence)&&u.jsxs("div",{className:"living-space-small",style:{marginTop:4},children:[u.jsx("b",{children:"Confidence:"})," ",(f.valuation_hint.confidence*100).toFixed(0),"%"]})]}),(f==null?void 0:f.nextActions)&&f.nextActions.length>0&&u.jsxs("div",{className:"living-space-item",style:{marginTop:10},children:[u.jsx("b",{children:"Next Actions"}),u.jsx("ul",{style:{marginTop:6,paddingLeft:20},children:f.nextActions.map((H,ye)=>u.jsx("li",{className:"living-space-small",children:hr(H)},ye))})]})]}),u.jsxs("div",{className:"living-space-section living-space-card",style:{padding:12},children:[u.jsx("div",{className:"living-space-title",children:"Chat + Intent Processing"}),u.jsx("div",{className:"living-space-chatBox",children:[...x].slice(-10).reverse().map(H=>u.jsxs("div",{className:"living-space-msg",children:[u.jsx("b",{children:H.userId})," ",u.jsx("span",{className:"t",children:ng(H.createdAt)}),u.jsx("div",{style:{marginTop:6},children:H.text})]},H.id))}),u.jsxs("div",{style:{display:"flex",gap:10,marginTop:10},children:[u.jsx("input",{className:"living-space-input",value:k,onChange:H=>E(H.target.value),placeholder:"Type your message...",onKeyDown:H=>{H.key==="Enter"&&!H.shiftKey&&(H.preventDefault(),Rt())}}),u.jsx("button",{className:"living-space-btn primary",onClick:Rt,children:"Send"})]})]})]}),u.jsxs("div",{children:[m==="core"&&u.jsxs(u.Fragment,{children:[J&&u.jsxs("div",{className:"living-space-card",style:{padding:12},children:[u.jsx("div",{className:"living-space-title",children:"Trust Receipt (Compliance Gate)"}),u.jsx("div",{className:"living-space-small",children:J.summary}),D&&u.jsxs("div",{style:{marginTop:10,marginBottom:10,padding:8,background:"rgba(255,200,0,0.1)",borderRadius:6,border:"1px solid rgba(255,200,0,0.3)"},children:[u.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:" Compliance Engine:"}),u.jsxs("div",{className:"living-space-small",children:[u.jsx("b",{children:"Status:"})," ",D.compliant?" Compliant":" Non-Compliant"]}),u.jsxs("div",{className:"living-space-small",children:[u.jsx("b",{children:"Gate:"})," ",J.gate]}),u.jsxs("div",{className:"living-space-small",children:[u.jsx("b",{children:"Reason:"})," ",hr(J.gateReason)]}),Array.isArray(D.requiredActions)&&D.requiredActions.length>0&&u.jsxs("div",{className:"living-space-small",style:{marginTop:4},children:[u.jsx("b",{children:"Required:"})," ",D.requiredActions.join(", ")]})]}),u.jsx("div",{className:"living-space-list",style:{marginTop:10},children:J.checkpoints.map((H,ye)=>u.jsxs("div",{className:"living-space-item",style:{display:"flex",justifyContent:"space-between",gap:10},children:[u.jsxs("div",{children:[u.jsx("b",{children:H.name}),u.jsx("div",{className:"living-space-small",children:H.note})]}),u.jsx("div",{className:H.status==="PASS"?"living-space-statusPass":H.status==="WARN"?"living-space-statusWarn":"living-space-statusFail",children:H.status})]},ye))})]}),_&&u.jsxs("div",{className:"living-space-section living-space-card",style:{padding:12},children:[u.jsx("div",{className:"living-space-title",children:"Decision Engine Response"}),u.jsxs("div",{style:{marginTop:10,padding:10,background:"rgba(0,255,0,0.1)",borderRadius:6,border:"1px solid rgba(0,255,0,0.3)"},children:[u.jsx("div",{style:{fontWeight:"bold",marginBottom:6},children:" Decision:"}),u.jsxs("div",{className:"living-space-small",children:[u.jsx("b",{children:"Result:"})," ",hr(_.decision||_.result)]}),_.confidence&&u.jsxs("div",{className:"living-space-small",children:[u.jsx("b",{children:"Confidence:"})," ",(_.confidence*100).toFixed(0),"%"]}),_.reason&&u.jsxs("div",{className:"living-space-small",children:[u.jsx("b",{children:"Reason:"})," ",hr(_.reason)]})]})]})]}),m==="decisions"&&u.jsxs("div",{className:"living-space-card",style:{padding:12},children:[u.jsx("div",{className:"living-space-title",children:"Decisions"}),o.length===0?u.jsx("div",{className:"living-space-small",children:"No decisions available yet."}):u.jsx("div",{className:"living-space-list",children:o.map(H=>u.jsxs("div",{className:"living-space-item",children:[u.jsx("div",{style:{fontWeight:950},children:H.title||H.description}),u.jsx("div",{className:"living-space-small",style:{marginTop:6},children:H.description||hr(H)}),H.options&&H.options.length>0&&u.jsx("div",{style:{marginTop:10},children:H.options.map(ye=>u.jsx("button",{className:"living-space-btn",style:{marginRight:8,marginTop:6},onClick:()=>We(H.id,ye.id),children:ye.label||ye.title},ye.id))})]},H.id))})]}),m==="actions"&&u.jsxs("div",{className:"living-space-card",style:{padding:12},children:[u.jsx("div",{className:"living-space-title",children:"Actions"}),c.length===0?u.jsx("div",{className:"living-space-small",children:"No actions available yet."}):u.jsx("div",{className:"living-space-list",children:c.map(H=>u.jsxs("div",{className:"living-space-item",children:[u.jsx("div",{style:{fontWeight:950},children:H.title||H.description}),u.jsx("div",{className:"living-space-small",style:{marginTop:6},children:H.description||hr(H)}),u.jsxs("div",{style:{marginTop:10,display:"flex",gap:8},children:[u.jsx("button",{className:"living-space-btn primary",onClick:()=>Tt(H.id,"COMPLETED","Action completed"),children:"Complete"}),u.jsx("button",{className:"living-space-btn",onClick:()=>Tt(H.id,"FAILED","Action failed"),children:"Failed"})]})]},H.id))})]}),m==="evidence"&&u.jsxs("div",{className:"living-space-card",style:{padding:12},children:[u.jsx("div",{className:"living-space-title",children:"Evidence Trail"}),d.length===0?u.jsx("div",{className:"living-space-small",children:"No evidence recorded yet."}):u.jsx("div",{className:"living-space-list",children:d.map((H,ye)=>u.jsxs("div",{className:"living-space-item",children:[u.jsx("div",{style:{fontWeight:950},children:H.type||"Evidence"}),u.jsx("div",{className:"living-space-small",style:{marginTop:6},children:hr(H.description||H.reason||H)}),H.timestamp&&u.jsx("div",{className:"living-space-small",style:{marginTop:4},children:ng(H.timestamp)})]},ye))})]})]})]})]})]})]}):u.jsx("div",{className:"living-space-container",children:u.jsxs("div",{className:"living-space-card",children:[u.jsx("div",{className:"living-space-title",children:"No Intent Found"}),u.jsx("p",{children:"Please create an intent first."})]})})}function GR(){var a;const[t,e]=w.useState(null),[n,i]=w.useState(!0),r=((a=xe.tokenParsed)==null?void 0:a.preferred_username)||"user1",s="intent-platform";w.useEffect(()=>{o()},[]);async function o(){try{const c=await $h(r,s);c!=null&&c.hasOpenIntent&&(c!=null&&c.intent)&&e(c.intent)}catch(c){console.warn("[Resume] Check failed (non-blocking):",c.message)}finally{i(!1)}}return n?u.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:u.jsx("div",{children:"Loading..."})}):t?u.jsx(KR,{intent:t,onIntentUpdate:c=>{e(c)}}):u.jsx(qR,{onIntentCreated:c=>{e(c)}})}function dd({children:t}){return zh()?t:u.jsx(Iy,{to:"/"})}function ig(){return u.jsx(uT,{children:u.jsxs(cT,{children:[u.jsx(co,{path:"/",element:zh()?u.jsx(Iy,{to:"/intent",replace:!0}):u.jsx(MT,{})}),u.jsx(co,{path:"/dashboard",element:u.jsx(dd,{children:u.jsx(eE,{})})}),u.jsx(co,{path:"/intent",element:u.jsx(dd,{children:u.jsx($R,{})})}),u.jsx(co,{path:"/living-space",element:u.jsx(dd,{children:u.jsx(GR,{})})})]})})}console.log("Starting Keycloak initialization...");NT().then(t=>{console.log("Auth initialized, authenticated:",t),ec.createRoot(document.getElementById("root")).render(u.jsx(ud.StrictMode,{children:u.jsx(ig,{})}))}).catch(t=>{console.error("Auth initialization error:",t),console.warn("Rendering app anyway - may use mock auth"),ec.createRoot(document.getElementById("root")).render(u.jsx(ud.StrictMode,{children:u.jsx(ig,{})}))});
